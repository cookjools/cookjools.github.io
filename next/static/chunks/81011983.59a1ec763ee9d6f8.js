"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4077],{94155:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return ai}});var _chunk_3UUJB7QR_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(95354),_chunk_IDHCAN6N_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9862),_chunk_CHPN5XCG_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(26909),_chunk_NROV7LWX_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(68350),_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(41228),_chunk_RFQJXORI_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(80741),_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(60181),_chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(48386),_chunk_76YR7XP2_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(47903),_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(78853),_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(58262),_chunk_RPOSMM7Q_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(47891),_chunk_YAXTLTJC_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(75285),Ke=(0,_chunk_YAXTLTJC_js__WEBPACK_IMPORTED_MODULE_10__.b)(((exports,module)=>{function OpenSeadragon(e){return new OpenSeadragon.Viewer(e)}var t,e;!function(e){e.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,n=Object.prototype.hasOwnProperty;e.isFunction=function(t){return"function"===e.type(t)},e.isArray=Array.isArray||function(t){return"array"===e.type(t)},e.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},e.type=function(e){return null==e?String(e):t[i.call(e)]||"object"},e.isPlainObject=function(t){if(!t||"object"!==OpenSeadragon.type(t)||t.nodeType||e.isWindow(t)||t.constructor&&!n.call(t,"constructor")&&!n.call(t.constructor.prototype,"isPrototypeOf"))return!1;var i;for(var s in t)i=s;return void 0===i||n.call(t,i)},e.isEmptyObject=function(e){for(var t in e)return!1;return!0},e.freezeObject=function(t){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(e){return e},e.freezeObject(t)},e.supportsCanvas=function(){var t=document.createElement("canvas");return!(!e.isFunction(t.getContext)||!t.getContext("2d"))}(),e.isCanvasTainted=function(e){var t=!1;try{e.getContext("2d").getImageData(0,0,1,1)}catch{t=!0}return t},e.pixelDensityRatio=function(){if(e.supportsCanvas){var t=document.createElement("canvas").getContext("2d"),i=window.devicePixelRatio||1,n=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return Math.max(i,1)/n}return 1}()}(OpenSeadragon),function($){$.extend=function(){var e,t,i,n,s,o,r=arguments[0]||{},a=arguments.length,l=!1,h=1;for("boolean"==typeof r&&(l=r,r=arguments[1]||{},h=2),"object"!=typeof r&&!OpenSeadragon.isFunction(r)&&(r={}),a===h&&(r=this,--h);h<a;h++)if(null!==(e=arguments[h])||void 0!==e)for(t in e)i=r[t],r!==(n=e[t])&&(l&&n&&(OpenSeadragon.isPlainObject(n)||(s=OpenSeadragon.isArray(n)))?(s?(s=!1,o=i&&OpenSeadragon.isArray(i)?i:[]):o=i&&OpenSeadragon.isPlainObject(i)?i:{},r[t]=OpenSeadragon.extend(l,o,n)):void 0!==n&&(r[t]=n));return r};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var e=navigator.userAgent;return"string"==typeof e&&(-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")||-1!==e.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(e,t){return function(){var i=arguments;return void 0===i&&(i=[]),t.apply(e,i)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},getElementPosition:function(e){var t,i,n=new $.Point;for(i=getOffsetParent(e=$.getElement(e),t="fixed"==$.getElementStyle(e).position);i;)n.x+=e.offsetLeft,n.y+=e.offsetTop,t&&(n=n.plus($.getPageScroll())),i=getOffsetParent(e=i,t="fixed"==$.getElementStyle(e).position);return n},getElementOffset:function(e){var t,i,n=(e=$.getElement(e))&&e.ownerDocument,s={top:0,left:0};return n?(t=n.documentElement,"undefined"!=typeof e.getBoundingClientRect&&(s=e.getBoundingClientRect()),i=n==n.window?n:9===n.nodeType&&(n.defaultView||n.parentWindow),new $.Point(s.left+(i.pageXOffset||t.scrollLeft)-(t.clientLeft||0),s.top+(i.pageYOffset||t.scrollTop)-(t.clientTop||0))):new $.Point},getElementSize:function(e){return e=$.getElement(e),new $.Point(e.clientWidth,e.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(e){return(e=$.getElement(e)).currentStyle}:function(e){return e=$.getElement(e),window.getComputedStyle(e,"")},getCssPropertyWithVendorPrefix:function(e){var t={};return $.getCssPropertyWithVendorPrefix=function(e){if(void 0!==t[e])return t[e];var i=document.createElement("div").style,n=null;if(void 0!==i[e])n=e;else for(var s=["Webkit","Moz","MS","O","webkit","moz","ms","o"],o=$.capitalizeFirstLetter(e),r=0;r<s.length;r++){var a=s[r]+o;if(void 0!==i[a]){n=a;break}}return t[e]=n,n},$.getCssPropertyWithVendorPrefix(e)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},positiveModulo:function(e,t){var i=e%t;return i<0&&(i+=t),i},pointInElement:function(e,t){e=$.getElement(e);var i=$.getElementOffset(e),n=$.getElementSize(e);return t.x>=i.x&&t.x<i.x+n.x&&t.y<i.y+n.y&&t.y>=i.y},getEvent:function(e){return $.getEvent=e?function(e){return e}:function(){return window.event},$.getEvent(e)},getMousePosition:function(e){if("number"==typeof e.pageX)$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.pageX,t.y=e.pageY,t};else{if("number"!=typeof e.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop,t}}return $.getMousePosition(e)},getPageScroll:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(t.scrollLeft||t.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!e.scrollLeft&&!e.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(e){if("undefined"!=typeof window.scrollTo)$.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var t=$.getPageScroll();if(t.x===e.x&&t.y===e.y)return;document.body.scrollLeft=e.x,document.body.scrollTop=e.y;var i=$.getPageScroll();if(i.x!==t.x&&i.y!==t.y)return void($.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y});if(document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y,(i=$.getPageScroll()).x!==t.x&&i.y!==t.y)return void($.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y});$.setPageScroll=function(e){}}return $.setPageScroll(e)},getWindowSize:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(e.clientWidth||e.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!t.clientWidth&&!t.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(e){e=$.getElement(e);var t=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(t[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(t[1].style,{display:"table-row"}),$.extend(t[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),t[0].appendChild(t[1]),t[1].appendChild(t[2]),t[2].appendChild(e),t[0]},makeNeutralElement:function(e){var t=document.createElement(e),i=t.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",t},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(e){return $.makeTransparentImage=function(e){var t=$.makeNeutralElement("img");return t.src=e,t},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(e){var t=$.makeNeutralElement("img"),i=null;return(i=$.makeNeutralElement("span")).style.display="inline-block",t.onload=function(){i.style.width=i.style.width||t.width+"px",i.style.height=i.style.height||t.height+"px",t.onload=null,t=null},t.src=e,i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"', sizingMethod='scale')",i}),$.makeTransparentImage(e)},setElementOpacity:function(e,t,i){var n;e=$.getElement(e),i&&!$.Browser.alpha&&(t=Math.round(t)),$.Browser.opacity?e.style.opacity=t<1?t:"":t<1?(n="alpha(opacity="+Math.round(100*t)+")",e.style.filter=n):e.style.filter=""},setElementTouchActionNone:function(e){"undefined"!=typeof(e=$.getElement(e)).style.touchAction?e.style.touchAction="none":"undefined"!=typeof e.style.msTouchAction&&(e.style.msTouchAction="none")},addClass:function(e,t){(e=$.getElement(e)).className?-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=" "+t):e.className=t},indexOf:function(e,t,i){return Array.prototype.indexOf?this.indexOf=function(e,t,i){return e.indexOf(t,i)}:this.indexOf=function(e,t,i){var n,s,o=i||0;if(!e)throw new TypeError;if(0===(s=e.length)||o>=s)return-1;for(o<0&&(o=s-Math.abs(o)),n=o;n<s;n++)if(e[n]===t)return n;return-1},this.indexOf(e,t,i)},removeClass:function(e,t){var i,n,s=[];for(i=(e=$.getElement(e)).className.split(/\s+/),n=0;n<i.length;n++)i[n]&&i[n]!==t&&s.push(i[n]);e.className=s.join(" ")},addEvent:function(){if(window.addEventListener)return function(e,t,i,n){(e=$.getElement(e)).addEventListener(t,i,n)};if(window.attachEvent)return function(e,t,i,n){(e=$.getElement(e)).attachEvent("on"+t,i)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(e,t,i,n){(e=$.getElement(e)).removeEventListener(t,i,n)};if(window.detachEvent)return function(e,t,i,n){(e=$.getElement(e)).detachEvent("on"+t,i)};throw new Error("No known event model.")}(),cancelEvent:function(e){(e=$.getEvent(e)).preventDefault?$.cancelEvent=function(e){e.preventDefault()}:$.cancelEvent=function(e){(e=$.getEvent(e)).cancel=!0,e.returnValue=!1},$.cancelEvent(e)},stopEvent:function(e){(e=$.getEvent(e)).stopPropagation?$.stopEvent=function(e){e.stopPropagation()}:$.stopEvent=function(e){(e=$.getEvent(e)).cancelBubble=!0},$.stopEvent(e)},createCallback:function(e,t){var i,n=[];for(i=2;i<arguments.length;i++)n.push(arguments[i]);return function(){var i,s=n.concat([]);for(i=0;i<arguments.length;i++)s.push(arguments[i]);return t.apply(e,s)}},getUrlParameter:function(e){return URLPARAMS[e]||null},getUrlProtocol:function(e){var t=e.match(/^([a-z]+:)\/\//i);return null===t?window.location.protocol:t[1].toLowerCase()},createAjaxRequest:function(e){var t;try{t=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{t=!1}if(t)window.XMLHttpRequest?$.createAjaxRequest=function(e){return e?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(e)},makeAjaxRequest:function(e,t,i){var n,s,o;$.isPlainObject(e)&&(t=e.success,i=e.error,n=e.withCredentials,s=e.headers,o=e.responseType||null,e=e.url);var r=$.getUrlProtocol(e),a=$.createAjaxRequest("file:"===r);if(!$.isFunction(t))throw new Error("makeAjaxRequest requires a success callback");a.onreadystatechange=function(){4==a.readyState&&(a.onreadystatechange=function(){},a.status>=200&&a.status<300||0===a.status&&"http:"!==r&&"https:"!==r?t(a):($.console.log("AJAX request returned %d: %s",a.status,e),$.isFunction(i)&&i(a)))};try{if(a.open("GET",e,!0),o&&(a.responseType=o),s)for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&s[l]&&a.setRequestHeader(l,s[l]);n&&(a.withCredentials=!0),a.send(null)}catch(u){var h=u.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&"undefined"!=typeof u.number&&-2147024891==u.number&&(h+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",u.name,h),a.onreadystatechange=function(){},window.XDomainRequest){var c=new window.XDomainRequest;if(c){c.onload=function(e){$.isFunction(t)&&t({responseText:c.responseText,status:200,statusText:"OK"})},c.onerror=function(e){$.isFunction(i)&&i({responseText:c.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{c.open("GET",e),c.send()}catch{$.isFunction(i)&&i(a,u)}}}else $.isFunction(i)&&i(a,u)}return a},jsonp:function(e){var t,i=e.url,n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,s=e.callbackName||"openseadragon"+$.now(),o=window[s],r="$1"+s+"$2",a=e.param||"callback",l=e.callback;i=i.replace(/(\=)\?(&|$)|\?\?/i,r),i+=(/\?/.test(i)?"&":"?")+a+"="+s,window[s]=function(e){if(o)window[s]=o;else try{delete window[s]}catch{}l&&$.isFunction(l)&&l(e)},t=document.createElement("script"),(void 0!==e.async||!1!==e.async)&&(t.async="async"),e.scriptCharset&&(t.charset=e.scriptCharset),t.src=i,t.onload=t.onreadystatechange=function(e,i){(i||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,n&&t.parentNode&&n.removeChild(t),t=void 0)},n.insertBefore(t,n.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(e){if(window.DOMParser)$.parseXml=function(e){return(new DOMParser).parseFromString(e,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(e){var t=null;return(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e),t}}return $.parseXml(e)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(e){return!!FILEFORMATS[(e=e||"").toLowerCase()]}});var nullfunction=function(e){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};function getOffsetParent(e,t){return t&&e!=document.body?document.body:e.offsetParent}(function(){var e=navigator.appVersion,t=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(t.substring(t.indexOf("MSIE")+5,t.indexOf(";",t.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(t.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(t.substring(t.indexOf("Firefox")+8))):t.indexOf("Safari")>=0?($.Browser.vendor=t.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(t.substring(t.substring(0,t.indexOf("Safari")).lastIndexOf("/")+1,t.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(t)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(e)}var i,n,s,o=window.location.search.substring(1).split("&");for(s=0;s<o.length;s++)if((n=(i=o[s]).indexOf("="))>0){var r=i.substring(0,n),a=i.substring(n+1);try{URLPARAMS[r]=decodeURIComponent(a)}catch{$.console.error("Ignoring malformed URL parameter: %s=%s",r,a)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})(),function(e){var t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame,i=e.cancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelAnimationFrame||e.msCancelAnimationFrame;if(t&&i)$.requestAnimationFrame=function(){return t.apply(e,arguments)},$.cancelAnimationFrame=function(){return i.apply(e,arguments)};else{var n,s=[],o=[],r=0;$.requestAnimationFrame=function(e){return s.push([++r,e]),n||(n=setInterval((function(){if(s.length){var e=$.now(),t=o;for(o=s,s=t;o.length;)o.shift()[1](e)}else clearInterval(n),n=void 0}),20)),r},$.cancelAnimationFrame=function(e){var t,i;for(t=0,i=s.length;t<i;t+=1)if(s[t][0]===e)return void s.splice(t,1);for(t=0,i=o.length;t<i;t+=1)if(o[t][0]===e)return void o.splice(t,1)}}}(window)}(OpenSeadragon),t=exports,e=function(){return OpenSeadragon},"function"==typeof define&&__webpack_require__.amdO?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.OpenSeadragon=e(),function(e){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.fullscreenElement},t.requestFullScreen=function(e){return e.requestFullscreen()},t.exitFullScreen=function(){document.exitFullscreen()},t.fullScreenEventName="fullscreenchange",t.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.msFullscreenElement},t.requestFullScreen=function(e){return e.msRequestFullscreen()},t.exitFullScreen=function(){document.msExitFullscreen()},t.fullScreenEventName="MSFullscreenChange",t.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitFullscreenElement},t.requestFullScreen=function(e){return e.webkitRequestFullscreen()},t.exitFullScreen=function(){document.webkitExitFullscreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},t.requestFullScreen=function(e){return e.webkitRequestFullScreen()},t.exitFullScreen=function(){document.webkitCancelFullScreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.mozFullScreenElement},t.requestFullScreen=function(e){return e.mozRequestFullScreen()},t.exitFullScreen=function(){document.mozCancelFullScreen()},t.fullScreenEventName="mozfullscreenchange",t.fullScreenErrorEventName="mozfullscreenerror"),t.isFullScreen=function(){return null!==t.getFullScreenElement()},t.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),t.exitFullScreen()},e.extend(e,t)}(OpenSeadragon),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(e,t,i,n){var s=this;n=n||1;var o=0,r=function(i){++o===n&&s.removeHandler(e,r),t(i)};this.addHandler(e,r,i)},addHandler:function(t,i,n){var s=this.events[t];s||(this.events[t]=s=[]),i&&e.isFunction(i)&&(s[s.length]={handler:i,userData:n||null})},removeHandler:function(t,i){var n,s=this.events[t],o=[];if(s&&e.isArray(s)){for(n=0;n<s.length;n++)s[n].handler!==i&&o.push(s[n]);this.events[t]=o}},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var t=this.events[e];return t&&t.length?(t=1===t.length?[t[0]]:Array.apply(null,t),function(e,i){var n,s=t.length;for(n=0;n<s;n++)t[n]&&(i.eventSource=e,i.userData=t[n].userData,t[n].handler(i))}):null},raiseEvent:function(e,t){var i=this.getHandler(e);i&&(t||(t={}),i(this,t))}}}(OpenSeadragon),function(e){var t=[],i={};function n(t){var n,s=i[t.hash],o=s.activePointersLists.length;for(n=0;n<o;n++)s.activePointersLists[n].captureCount>0&&(e.removeEvent(e.MouseTracker.captureElement,"mousemove",s.mousemovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"mouseup",s.mouseupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",s.pointermovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",s.pointerupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchmove",s.touchmovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchend",s.touchendcaptured,!0),s.activePointersLists[n].captureCount=0);for(n=0;n<o;n++)s.activePointersLists.pop()}function s(t){var s,o,r=i[t.hash];if(r.tracking){for(o=0;o<e.MouseTracker.subscribeEvents.length;o++)s=e.MouseTracker.subscribeEvents[o],e.removeEvent(t.element,s,r[s],!1);n(t),r.tracking=!1}}function o(t,n){var s=i[t.hash];if("pointerevent"===n)return{upName:e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:s.pointerupcaptured,moveName:e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:s.pointermovecaptured};if("mouse"===n)return{upName:"mouseup",upHandler:s.mouseupcaptured,moveName:"mousemove",moveHandler:s.mousemovecaptured};if("touch"===n)return{upName:"touchend",upHandler:s.touchendcaptured,moveName:"touchmove",moveHandler:s.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function r(t,i,n){var s,r=t.getActivePointersListByType(i);r.captureCount+=n||1,1===r.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?t.element.setCapture(!0):(s=o(t,e.MouseTracker.havePointerEvents?"pointerevent":i),de&&pe(window.top)&&e.addEvent(window.top,s.upName,s.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,s.upName,s.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,s.moveName,s.moveHandler,!0)))}function a(t,i,n){var s,r=t.getActivePointersListByType(i);r.captureCount-=n||1,0===r.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?t.element.releaseCapture():(s=o(t,e.MouseTracker.havePointerEvents?"pointerevent":i),de&&pe(window.top)&&e.removeEvent(window.top,s.upName,s.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,s.moveName,s.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,s.upName,s.upHandler,!0)))}function l(t){var i;if(e.MouseTracker.unprefixedPointerEvents)i=t.pointerType;else switch(t.pointerType){case 2:i="touch";break;case 3:i="pen";break;case 4:i="mouse";break;default:i=""}return i}function h(t){return e.getMousePosition(t)}function c(e,t){return u(h(e),t)}function u(t,i){var n=e.getElementOffset(i);return t.minus(n)}function d(t,i){return new e.Point((t.x+i.x)/2,(t.y+i.y)/2)}function p(t,i){t.clickHandler&&e.cancelEvent(i)}function _(t,i){t.dblClickHandler&&e.cancelEvent(i)}function g(t,i){t.keyDownHandler&&(i=e.getEvent(i),t.keyDownHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(i))}function m(t,i){t.keyUpHandler&&(i=e.getEvent(i),t.keyUpHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(i))}function v(t,i){t.keyHandler&&(i=e.getEvent(i),t.keyHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(i))}function E(t,i){t.focusHandler&&(i=e.getEvent(i),!1===t.focusHandler({eventSource:t,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i))}function f(t,i){t.blurHandler&&(i=e.getEvent(i),!1===t.blurHandler({eventSource:t,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i))}function T(e,t){P(e,t,t)}function w(t,i){var n={target:(i=e.getEvent(i)).target||i.srcElement,type:"wheel",shiftKey:i.shiftKey||!1,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX?i.pageX:i.clientX,pageY:i.pageY?i.pageY:i.clientY,deltaMode:"MozMousePixelScroll"==i.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==e.MouseTracker.wheelEventName?n.deltaY=-i.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:n.deltaY=i.detail,P(t,n,i)}function P(t,i,n){var s;s=i.deltaY<0?1:-1,t.scrollHandler&&(!1===t.scrollHandler({eventSource:t,pointerType:"mouse",position:c(i,t.element),scroll:s,shift:i.shiftKey,isTouchEvent:!1,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n))}function O(e,t){if(e===t)return!1;for(;t&&t!==e;)t=t.parentNode;return t===e}function x(t,i){y(t,i=e.getEvent(i))}function C(t,i){(i=e.getEvent(i)).currentTarget!==i.relatedTarget&&!O(i.currentTarget,i.relatedTarget)&&y(t,i)}function y(t,i){ae(t,i,[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(i),currentTime:e.now()}])}function R(t,i){b(t,i=e.getEvent(i))}function S(t,i){(i=e.getEvent(i)).currentTarget!==i.relatedTarget&&!O(i.currentTarget,i.relatedTarget)&&b(t,i)}function b(t,i){le(t,i,[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(i),currentTime:e.now()}])}function M(t){return e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?1===t?0:2===t?2:4===t?1:-1:t}function I(t,i){he(t,i=e.getEvent(i),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(i),currentTime:e.now()}],M(i.button))&&(e.stopEvent(i),r(t,"mouse")),(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler)&&e.cancelEvent(i)}function D(e,t){B(e,t)}function A(t,i){B(t,i),e.stopEvent(i)}function B(t,i){ce(t,i=e.getEvent(i),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(i),currentTime:e.now()}],M(i.button))&&a(t,"mouse")}function L(e,t){H(e,t)}function k(t,i){H(t,i),e.stopEvent(i)}function H(t,i){ue(t,i=e.getEvent(i),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(i),currentTime:e.now()}])}function N(e,t,i){var n,s=i.getLength(),o=[];if("touch"===i.type||i.contacts>0){for(n=0;n<s;n++)o.push(i.getByIndex(n));o.length>0&&(ce(e,t,o,0),i.captureCount=1,a(e,i.type),le(e,t,o))}}function $(i,n){var s,o,a,l,c=n.changedTouches.length,u=[],d=i.getActivePointersListByType("touch");for(s=e.now(),d.getLength()>n.touches.length-c&&(e.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),N(i,n,d)),o=0;o<c;o++)u.push({id:n.changedTouches[o].identifier,type:"touch",currentPos:h(n.changedTouches[o]),currentTime:s});for(ae(i,n,u),o=0;o<t.length;o++)if(t[o]!==i&&t[o].isTracking()&&O(t[o].element,i.element)){for(l=[],a=0;a<c;a++)l.push({id:n.changedTouches[a].identifier,type:"touch",currentPos:h(n.changedTouches[a]),currentTime:s});ae(t[o],n,l)}he(i,n,u,0)&&(e.stopEvent(n),r(i,"touch",c)),e.cancelEvent(n)}function W(e,t){F(e,t)}function U(t,i){F(t,i),e.stopEvent(i)}function F(i,n){var s,o,r,l,c=n.changedTouches.length,u=[];for(s=e.now(),o=0;o<c;o++)u.push({id:n.changedTouches[o].identifier,type:"touch",currentPos:h(n.changedTouches[o]),currentTime:s});for(ce(i,n,u,0)&&a(i,"touch",c),le(i,n,u),o=0;o<t.length;o++)if(t[o]!==i&&t[o].isTracking()&&O(t[o].element,i.element)){for(l=[],r=0;r<c;r++)l.push({id:n.changedTouches[r].identifier,type:"touch",currentPos:h(n.changedTouches[r]),currentTime:s});le(t[o],n,l)}e.cancelEvent(n)}function j(e,t){V(e,t)}function z(t,i){V(t,i),e.stopEvent(i)}function V(t,i){var n,s=i.changedTouches.length,o=[];for(n=0;n<s;n++)o.push({id:i.changedTouches[n].identifier,type:"touch",currentPos:h(i.changedTouches[n]),currentTime:e.now()});ue(t,i,o),e.cancelEvent(i)}function G(e,t){var i=e.getActivePointersListByType("touch");N(e,t,i)}function K(e,t){return t.stopPropagation(),t.preventDefault(),!1}function q(e,t){return t.stopPropagation(),t.preventDefault(),!1}function J(t,i){i.currentTarget===i.relatedTarget||O(i.currentTarget,i.relatedTarget)||ae(t,i,[{id:i.pointerId,type:l(i),isPrimary:i.isPrimary,currentPos:h(i),currentTime:e.now()}])}function Z(t,i){i.currentTarget===i.relatedTarget||O(i.currentTarget,i.relatedTarget)||le(t,i,[{id:i.pointerId,type:l(i),isPrimary:i.isPrimary,currentPos:h(i),currentTime:e.now()}])}function Y(t,i){var n;he(t,i,[n={id:i.pointerId,type:l(i),isPrimary:i.isPrimary,currentPos:h(i),currentTime:e.now()}],i.button)&&(e.stopEvent(i),r(t,n.type)),(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.cancelEvent(i)}function X(e,t){ee(e,t)}function Q(t,i){t.getActivePointersListByType(l(i)).getById(i.pointerId)&&ee(t,i),e.stopEvent(i)}function ee(t,i){var n;ce(t,i,[n={id:i.pointerId,type:l(i),isPrimary:i.isPrimary,currentPos:h(i),currentTime:e.now()}],i.button)&&a(t,n.type)}function te(e,t){ne(e,t)}function ie(t,i){t.getActivePointersListByType(l(i)).getById(i.pointerId)&&ne(t,i),e.stopEvent(i)}function ne(t,i){ue(t,i,[{id:i.pointerId,type:l(i),isPrimary:i.isPrimary,currentPos:h(i),currentTime:e.now()}])}function se(e,t){(function(e,t,i){ce(e,t,i,0),le(e,t,i)})(e,t,[{id:t.pointerId,type:l(t)}])}function oe(e,t){return Object.prototype.hasOwnProperty.call(t,"isPrimary")||(0===e.getLength()?t.isPrimary=!0:t.isPrimary=!1),t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function re(e,t){var i,n;return e.getById(t.id)?(i=e.removeById(t.id),Object.prototype.hasOwnProperty.call(t,"isPrimary")||((n=e.getPrimary())||(n=e.getByIndex(0))&&(n.isPrimary=!0))):i=e.getLength(),i}function ae(t,i,n){var s,o,r,a=t.getActivePointersListByType(n[0].type),l=n.length;for(s=0;s<l;s++)o=n[s],(r=a.getById(o.id))?(r.insideElement=!0,r.lastPos=r.currentPos,r.lastTime=r.currentTime,r.currentPos=o.currentPos,r.currentTime=o.currentTime,o=r):(o.captured=!1,o.insideElementPressed=!1,o.insideElement=!0,oe(a,o)),t.enterHandler&&(!1===t.enterHandler({eventSource:t,pointerType:o.type,position:u(o.currentPos,t.element),buttons:a.buttons,pointers:t.getActivePointerCount(),insideElementPressed:o.insideElementPressed,buttonDownAny:0!==a.buttons,isTouchEvent:"touch"===o.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i))}function le(t,i,n){var s,o,r,a=t.getActivePointersListByType(n[0].type),l=n.length;for(s=0;s<l;s++)o=n[s],(r=a.getById(o.id))&&(r.captured?(r.insideElement=!1,r.lastPos=r.currentPos,r.lastTime=r.currentTime,r.currentPos=o.currentPos,r.currentTime=o.currentTime):re(a,r),o=r),t.exitHandler&&(!1===t.exitHandler({eventSource:t,pointerType:o.type,position:o.currentPos&&u(o.currentPos,t.element),buttons:a.buttons,pointers:t.getActivePointerCount(),insideElementPressed:!!r&&r.insideElementPressed,buttonDownAny:0!==a.buttons,isTouchEvent:"touch"===o.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i))}function he(t,n,s,o){var r,a,l,h=i[t.hash],c=t.getActivePointersListByType(s[0].type),p=s.length;"undefined"!=typeof n.buttons?c.buttons=n.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===o?c.buttons+=1:1===o?c.buttons+=4:2===o?c.buttons+=2:3===o?c.buttons+=8:4===o?c.buttons+=16:5===o&&(c.buttons+=32):0===o?c.buttons|=1:1===o?c.buttons|=4:2===o?c.buttons|=2:3===o?c.buttons|=8:4===o?c.buttons|=16:5===o&&(c.buttons|=32);var _=t.getActivePointersListsExceptType(s[0].type);for(r=0;r<_.length;r++)N(t,n,_[r]);if(0!==o)return t.nonPrimaryPressHandler&&(!1===t.nonPrimaryPressHandler({eventSource:t,pointerType:s[0].type,position:u(s[0].currentPos,t.element),button:o,buttons:c.buttons,isTouchEvent:"touch"===s[0].type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)),!1;for(r=0;r<p;r++)a=s[r],(l=c.getById(a.id))?(l.captured=!0,l.insideElementPressed=!0,l.insideElement=!0,l.contactPos=a.currentPos,l.contactTime=a.currentTime,l.lastPos=l.currentPos,l.lastTime=l.currentTime,l.currentPos=a.currentPos,l.currentTime=a.currentTime,a=l):(a.captured=!0,a.insideElementPressed=!0,a.insideElement=!0,oe(c,a)),c.addContact(),(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(t,a),1===c.contacts?t.pressHandler&&(!1===t.pressHandler({eventSource:t,pointerType:a.type,position:u(a.contactPos,t.element),buttons:c.buttons,isTouchEvent:"touch"===a.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)):2===c.contacts&&t.pinchHandler&&"touch"===a.type&&(h.pinchGPoints=c.asArray(),h.lastPinchDist=h.currentPinchDist=h.pinchGPoints[0].currentPos.distanceTo(h.pinchGPoints[1].currentPos),h.lastPinchCenter=h.currentPinchCenter=d(h.pinchGPoints[0].currentPos,h.pinchGPoints[1].currentPos));return!0}function ce(t,n,s,o){var r,a,l,h,c,p,_=i[t.hash],g=t.getActivePointersListByType(s[0].type),m=s.length,v=!1,E=!1;if("undefined"!=typeof n.buttons?g.buttons=n.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===o?g.buttons-=1:1===o?g.buttons-=4:2===o?g.buttons-=2:3===o?g.buttons-=8:4===o?g.buttons-=16:5===o&&(g.buttons-=32):0===o?g.buttons^=-2:1===o?g.buttons^=-5:2===o?g.buttons^=-3:3===o?g.buttons^=-9:4===o?g.buttons^=-17:5===o&&(g.buttons^=-33),0!==o){t.nonPrimaryReleaseHandler&&(!1===t.nonPrimaryReleaseHandler({eventSource:t,pointerType:s[0].type,position:u(s[0].currentPos,t.element),button:o,buttons:g.buttons,isTouchEvent:"touch"===s[0].type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n));var f=t.getActivePointersListByType("mouse");return N(t,n,f),!1}if("undefined"==typeof s[0].currentPos)return N(t,n,g),!1;for(l=0;l<m;l++)h=s[l],(c=g.getById(h.id))&&(c.captured&&(c.captured=!1,v=!0,E=!0),c.lastPos=c.currentPos,c.lastTime=c.currentTime,c.currentPos=h.currentPos,c.currentTime=h.currentTime,c.insideElement||re(g,c),r=c.currentPos,a=c.currentTime,E?(g.removeContact(),(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(t,c),0===g.contacts?(t.releaseHandler&&(!1===t.releaseHandler({eventSource:t,pointerType:c.type,position:u(r,t.element),buttons:g.buttons,insideElementPressed:c.insideElementPressed,insideElementReleased:c.insideElement,isTouchEvent:"touch"===c.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)),t.dragEndHandler&&!c.currentPos.equals(c.contactPos)&&(!1===t.dragEndHandler({eventSource:t,pointerType:c.type,position:u(c.currentPos,t.element),speed:c.speed,direction:c.direction,shift:n.shiftKey,isTouchEvent:"touch"===c.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)),(t.clickHandler||t.dblClickHandler)&&c.insideElement&&(p=a-c.contactTime<=t.clickTimeThreshold&&c.contactPos.distanceTo(r)<=t.clickDistThreshold,t.clickHandler&&(!1===t.clickHandler({eventSource:t,pointerType:c.type,position:u(c.currentPos,t.element),quick:p,shift:n.shiftKey,isTouchEvent:"touch"===c.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)),t.dblClickHandler&&p&&(g.clicks++,1===g.clicks?(_.lastClickPos=r,_.dblClickTimeOut=setTimeout((function(){g.clicks=0}),t.dblClickTimeThreshold)):2===g.clicks&&(clearTimeout(_.dblClickTimeOut),g.clicks=0,_.lastClickPos.distanceTo(r)<=t.dblClickDistThreshold&&(!1===t.dblClickHandler({eventSource:t,pointerType:c.type,position:u(c.currentPos,t.element),shift:n.shiftKey,isTouchEvent:"touch"===c.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)),_.lastClickPos=null)))):2===g.contacts&&t.pinchHandler&&"touch"===c.type&&(_.pinchGPoints=g.asArray(),_.lastPinchDist=_.currentPinchDist=_.pinchGPoints[0].currentPos.distanceTo(_.pinchGPoints[1].currentPos),_.lastPinchCenter=_.currentPinchCenter=d(_.pinchGPoints[0].currentPos,_.pinchGPoints[1].currentPos))):t.releaseHandler&&(!1===t.releaseHandler({eventSource:t,pointerType:c.type,position:u(r,t.element),buttons:g.buttons,insideElementPressed:c.insideElementPressed,insideElementReleased:c.insideElement,isTouchEvent:"touch"===c.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)));return v}function ue(t,n,s){var o,r,a,l,h,p=i[t.hash],_=t.getActivePointersListByType(s[0].type),g=s.length;for("undefined"!=typeof n.buttons&&(_.buttons=n.buttons),o=0;o<g;o++)r=s[o],(a=_.getById(r.id))?(Object.prototype.hasOwnProperty.call(r,"isPrimary")&&(a.isPrimary=r.isPrimary),a.lastPos=a.currentPos,a.lastTime=a.currentTime,a.currentPos=r.currentPos,a.currentTime=r.currentTime):(r.captured=!1,r.insideElementPressed=!1,r.insideElement=!0,oe(_,r));t.stopHandler&&"mouse"===s[0].type&&(clearTimeout(t.stopTimeOut),t.stopTimeOut=setTimeout((function(){!function(e,t,i){e.stopHandler&&e.stopHandler({eventSource:e,pointerType:i,position:c(t,e.element),buttons:e.getActivePointersListByType(i).buttons,isTouchEvent:"touch"===i,originalEvent:t,preventDefaultAction:!1,userData:e.userData})}(t,n,s[0].type)}),t.stopDelay)),0===_.contacts?t.moveHandler&&(!1===t.moveHandler({eventSource:t,pointerType:s[0].type,position:u(s[0].currentPos,t.element),buttons:_.buttons,isTouchEvent:"touch"===s[0].type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)):1===_.contacts?(t.moveHandler&&(a=_.asArray()[0],!1===t.moveHandler({eventSource:t,pointerType:a.type,position:u(a.currentPos,t.element),buttons:_.buttons,isTouchEvent:"touch"===a.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)),t.dragHandler&&(h=(a=_.asArray()[0]).currentPos.minus(a.lastPos),!1===t.dragHandler({eventSource:t,pointerType:a.type,position:u(a.currentPos,t.element),buttons:_.buttons,delta:h,speed:a.speed,direction:a.direction,shift:n.shiftKey,isTouchEvent:"touch"===a.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n))):2===_.contacts&&(t.moveHandler&&(l=_.asArray(),!1===t.moveHandler({eventSource:t,pointerType:l[0].type,position:u(d(l[0].currentPos,l[1].currentPos),t.element),buttons:_.buttons,isTouchEvent:"touch"===l[0].type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)),t.pinchHandler&&"touch"===s[0].type&&((h=p.pinchGPoints[0].currentPos.distanceTo(p.pinchGPoints[1].currentPos))!=p.currentPinchDist&&(p.lastPinchDist=p.currentPinchDist,p.currentPinchDist=h,p.lastPinchCenter=p.currentPinchCenter,p.currentPinchCenter=d(p.pinchGPoints[0].currentPos,p.pinchGPoints[1].currentPos),!1===t.pinchHandler({eventSource:t,pointerType:"touch",gesturePoints:p.pinchGPoints,lastCenter:u(p.lastPinchCenter,t.element),center:u(p.currentPinchCenter,t.element),lastDistance:p.lastPinchDist,distance:p.currentPinchDist,shift:n.shiftKey,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n))))}e.MouseTracker=function(n){t.push(this);var s=arguments;e.isPlainObject(n)||(n={element:s[0],clickTimeThreshold:s[1],clickDistThreshold:s[2]}),this.hash=Math.random(),this.element=e.getElement(n.element),this.clickTimeThreshold=n.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=n.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=n.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=n.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=n.userData||null,this.stopDelay=n.stopDelay||50,this.enterHandler=n.enterHandler||null,this.exitHandler=n.exitHandler||null,this.pressHandler=n.pressHandler||null,this.nonPrimaryPressHandler=n.nonPrimaryPressHandler||null,this.releaseHandler=n.releaseHandler||null,this.nonPrimaryReleaseHandler=n.nonPrimaryReleaseHandler||null,this.moveHandler=n.moveHandler||null,this.scrollHandler=n.scrollHandler||null,this.clickHandler=n.clickHandler||null,this.dblClickHandler=n.dblClickHandler||null,this.dragHandler=n.dragHandler||null,this.dragEndHandler=n.dragEndHandler||null,this.pinchHandler=n.pinchHandler||null,this.stopHandler=n.stopHandler||null,this.keyDownHandler=n.keyDownHandler||null,this.keyUpHandler=n.keyUpHandler||null,this.keyHandler=n.keyHandler||null,this.focusHandler=n.focusHandler||null,this.blurHandler=n.blurHandler||null;var o=this;i[this.hash]={click:function(e){p(o,e)},dblclick:function(e){_(o,e)},keydown:function(e){g(o,e)},keyup:function(e){m(o,e)},keypress:function(e){v(o,e)},focus:function(e){E(o,e)},blur:function(e){f(o,e)},wheel:function(e){T(o,e)},mousewheel:function(e){w(o,e)},DOMMouseScroll:function(e){w(o,e)},MozMousePixelScroll:function(e){w(o,e)},mouseenter:function(e){x(o,e)},mouseleave:function(e){R(o,e)},mouseover:function(e){C(o,e)},mouseout:function(e){S(o,e)},mousedown:function(e){I(o,e)},mouseup:function(e){D(o,e)},mouseupcaptured:function(e){A(o,e)},mousemove:function(e){L(o,e)},mousemovecaptured:function(e){k(o,e)},touchstart:function(e){$(o,e)},touchend:function(e){W(o,e)},touchendcaptured:function(e){U(o,e)},touchmove:function(e){j(o,e)},touchmovecaptured:function(e){z(o,e)},touchcancel:function(e){G(o,e)},gesturestart:function(e){K(o,e)},gesturechange:function(e){q(o,e)},pointerover:function(e){J(o,e)},MSPointerOver:function(e){J(o,e)},pointerout:function(e){Z(o,e)},MSPointerOut:function(e){Z(o,e)},pointerdown:function(e){Y(o,e)},MSPointerDown:function(e){Y(o,e)},pointerup:function(e){X(o,e)},MSPointerUp:function(e){X(o,e)},pointermove:function(e){te(o,e)},MSPointerMove:function(e){te(o,e)},pointercancel:function(e){se(o,e)},MSPointerCancel:function(e){se(o,e)},pointerupcaptured:function(e){Q(o,e)},pointermovecaptured:function(e){ie(o,e)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},n.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){var e;for(s(this),this.element=null,e=0;e<t.length;e++)if(t[e]===this){t.splice(e,1);break}i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(t){return t?function(t){var s,o,r=i[t.hash];if(!r.tracking){for(o=0;o<e.MouseTracker.subscribeEvents.length;o++)s=e.MouseTracker.subscribeEvents[o],e.addEvent(t.element,s,r[s],!1);n(t),r.tracking=!0}}(this):s(this),this},getActivePointersListsExceptType:function(e){for(var t=i[this.hash],n=[],s=0;s<t.activePointersLists.length;++s)t.activePointersLists[s].type!==e&&n.push(t.activePointersLists[s]);return n},getActivePointersListByType:function(t){var n,s,o=i[this.hash],r=o.activePointersLists.length;for(n=0;n<r;n++)if(o.activePointersLists[n].type===t)return o.activePointersLists[n];return s=new e.MouseTracker.GesturePointList(t),o.activePointersLists.push(s),s},getActivePointerCount:function(){var e,t=i[this.hash],n=t.activePointersLists.length,s=0;for(e=0;e<n;e++)s+=t.activePointersLists[e].getLength();return s},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},e.MouseTracker.resetAllMouseTrackers=function(){for(var e=0;e<t.length;e++)t[e].isTracking()&&(t[e].setTracking(!1),t[e].setTracking(!0))},e.MouseTracker.gesturePointVelocityTracker=function(){var t=[],i=0,n=0,s=function(e,t){return e.hash.toString()+t.type+t.id.toString()},o=function(){var i,s,o,r,a,l,h=t.length,c=e.now();for(r=c-n,n=c,i=0;i<h;i++)(o=(s=t[i]).gPoint).direction=Math.atan2(o.currentPos.y-s.lastPos.y,o.currentPos.x-s.lastPos.x),a=s.lastPos.distanceTo(o.currentPos),s.lastPos=o.currentPos,l=1e3*a/(r+1),o.speed=.75*l+.25*o.speed};return{addPoint:function(r,a){var l=s(r,a);t.push({guid:l,gPoint:a,lastPos:a.currentPos}),1===t.length&&(n=e.now(),i=window.setInterval(o,50))},removePoint:function(e,n){var o,r=s(e,n),a=t.length;for(o=0;o<a;o++)if(t[o].guid===r){t.splice(o,1),0===--a&&window.clearInterval(i);break}}}}(),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e.MouseTracker.supportsMouseCapture=function(){var t=document.createElement("div");return e.isFunction(t.setCapture)&&e.isFunction(t.releaseCapture)}(),e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",e.MouseTracker.wheelEventName],"DOMMouseScroll"==e.MouseTracker.wheelEventName&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||e.Browser.vendor!==e.BROWSERS.IE)?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?e.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:e.MouseTracker.maxTouchPoints=0,e.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),e.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?e.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:e.MouseTracker.maxTouchPoints=0,e.MouseTracker.haveMouseEnter=!1):(e.MouseTracker.havePointerEvents=!1,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?(e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),e.MouseTracker.haveMouseEnter=!0):(e.MouseTracker.subscribeEvents.push("mouseover","mouseout"),e.MouseTracker.haveMouseEnter=!1),e.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.maxTouchPoints=10),e.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].id===e){this._gPoints.splice(t,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].id===e)return this._gPoints[t];return null},getPrimary:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].isPrimary)return this._gPoints[t];return null},addContact:function(){++this.contacts,this.contacts>1&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var de=function(){try{return window.self!==window.top}catch{return!0}}();function pe(e){try{return e.addEventListener&&e.removeEventListener}catch{return!1}}}(OpenSeadragon),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(t,i,n){var s=t.parentNode;"number"==typeof i&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer="undefined"==typeof i.attachToViewer||i.attachToViewer,this.autoFade="undefined"==typeof i.autoFade||i.autoFade,this.element=t,this.anchor=i.anchor,this.container=n,this.anchor==e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof i.top?i.top+"px":i.top,this.wrapper.style.left="number"==typeof i.left?i.left+"px":i.left,this.wrapper.style.height="number"==typeof i.height?i.height+"px":i.height,this.wrapper.style.width="number"==typeof i.width?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor==e.ControlAnchor.TOP_RIGHT||this.anchor==e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):s.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(t){this.wrapper.style.display=t?this.anchor==e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(t){this.element[e.SIGNAL]&&e.Browser.vendor==e.BROWSERS.IE?e.setElementOpacity(this.element,t,!0):e.setElementOpacity(this.wrapper,t,!0)}}}(OpenSeadragon),function(e){function t(e,t){var i,n=e.controls;for(i=n.length-1;i>=0;i--)if(n[i].element==t)return i;return-1}e.ControlDock=function(t){var i,n,s=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(1e6*Math.random()),container:e.makeNeutralElement("div"),controls:[]},t),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),n=0;n<s.length;n++)i=s[n],this.controls[i]=e.makeNeutralElement("div"),this.controls[i].style.position="absolute",i.match("left")&&(this.controls[i].style.left="0px"),i.match("right")&&(this.controls[i].style.right="0px"),i.match("top")&&(this.controls[i].style.top="0px"),i.match("bottom")&&(this.controls[i].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(i,n){var s=null;if(!(t(this,i=e.getElement(i))>=0)){switch(n.anchor){case e.ControlAnchor.TOP_RIGHT:s=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:s=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:s=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:s=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:default:case e.ControlAnchor.NONE:s=this.container,i.style.margin="0px",i.style.padding="0px"}this.controls.push(new e.Control(i,n,s)),i.style.display="inline-block"}},removeControl:function(i){var n=t(this,i=e.getElement(i));return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;e>=0;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;t>=0;t--)this.controls[t].setVisible(e);return this}}}(OpenSeadragon),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(e){var t={},i=1;function n(t){return t=e.getElement(t),new e.Point(0===t.clientWidth?1:t.clientWidth,0===t.clientHeight?1:t.clientHeight)}function s(t,i){if(i instanceof e.Overlay)return i;var n=null;if(i.element)n=e.getElement(i.element);else{var s=i.id?i.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());(n=e.getElement(i.id))||((n=document.createElement("a")).href="#/overlay/"+s),n.id=s,e.addClass(n,i.className?i.className:"openseadragon-overlay")}var o=i.location,r=i.width,a=i.height;if(!o){var l=i.x,h=i.y;if(void 0!==i.px){var c=t.viewport.imageToViewportRectangle(new e.Rect(i.px,i.py,r||0,a||0));l=c.x,h=c.y,r=void 0!==r?c.width:void 0,a=void 0!==a?c.height:void 0}o=new e.Point(l,h)}var u=i.placement;return u&&"string"===e.type(u)&&(u=e.Placement[i.placement.toUpperCase()]),new e.Overlay({element:n,location:o,placement:u,onDraw:i.onDraw,checkResize:i.checkResize,width:r,height:a,rotationMode:i.rotationMode})}function o(e,t){var i;for(i=e.length-1;i>=0;i--)if(e[i].element===t)return i;return-1}function r(t,i){return e.requestAnimationFrame((function(){i(t)}))}function a(t){e.requestAnimationFrame((function(){!function(t){var i,n;if(t.controlsShouldFade){for(i=1-(e.now()-t.controlsFadeBeginTime)/t.controlsFadeLength,i=Math.min(1,i),i=Math.max(0,i),n=t.controls.length-1;n>=0;n--)t.controls[n].autoFade&&t.controls[n].setOpacity(i);i>0&&a(t)}}(t)}))}function l(t){!t.autoHideControls||(t.controlsShouldFade=!0,t.controlsFadeBeginTime=e.now()+t.controlsFadeDelay,window.setTimeout((function(){a(t)}),t.controlsFadeDelay))}function h(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;t>=0;t--)e.controls[t].setOpacity(1)}function c(){h(this)}function u(){l(this)}function d(t){var i={originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction,preventVerticalPan:t.preventVerticalPan,preventHorizontalPan:t.preventHorizontalPan};if(this.raiseEvent("canvas-key",i),i.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 38:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}}function p(t){var i={originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction,preventVerticalPan:t.preventVerticalPan,preventHorizontalPan:t.preventHorizontalPan};if(this.raiseEvent("canvas-key",i),i.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}}function _(e){var t;document.activeElement==this.canvas||this.canvas.focus(),this.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var i={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-click",i),!i.preventDefaultAction&&this.viewport&&e.quick&&((t=this.gestureSettingsByDeviceType(e.pointerType)).clickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints()))}function g(e){var t,i={tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-double-click",i),!i.preventDefaultAction&&this.viewport&&((t=this.gestureSettingsByDeviceType(e.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints()))}function m(e){var t,i={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};if(this.raiseEvent("canvas-drag",i),!i.preventDefaultAction&&this.viewport){if(t=this.gestureSettingsByDeviceType(e.pointerType),this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.flipped&&(e.delta.x=-e.delta.x),this.constrainDuringPan){var n=this.viewport.deltaPointsFromPixels(e.delta.negate());this.viewport.centerSpringX.target.value+=n.x,this.viewport.centerSpringY.target.value+=n.y;var s=this.viewport.getBounds(),o=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=n.x,this.viewport.centerSpringY.target.value-=n.y,s.x!=o.x&&(e.delta.x=0),s.y!=o.y&&(e.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),t.flickEnabled&&!this.constrainDuringPan)}}function v(t){if(!t.preventDefaultAction&&this.viewport){var i=this.gestureSettingsByDeviceType(t.pointerType);if(i.flickEnabled&&t.speed>=i.flickMinSpeed){var n=0;this.panHorizontal&&(n=i.flickMomentum*t.speed*Math.cos(t.direction));var s=0;this.panVertical&&(s=i.flickMomentum*t.speed*Math.sin(t.direction));var o=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),r=this.viewport.pointFromPixel(new e.Point(o.x-n,o.y-s));this.viewport.panTo(r,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:t.eventSource,position:t.position,speed:t.speed,direction:t.direction,shift:t.shift,originalEvent:t.originalEvent})}function E(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function f(t){window.location!=window.parent.location&&e.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function T(e){this.raiseEvent("canvas-press",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function w(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function P(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function O(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function x(e){var t,i,n;if(!e.preventDefaultAction&&this.viewport&&((t=this.gestureSettingsByDeviceType(e.pointerType)).pinchToZoom&&(i=this.viewport.pointFromPixel(e.center,!0),n=this.viewport.pointFromPixel(e.lastCenter,!0).minus(i),this.panHorizontal||(n.x=0),this.panVertical||(n.y=0),this.viewport.zoomBy(e.distance/e.lastDistance,i,!0),t.zoomToRefPoint&&this.viewport.panBy(n,!0),this.viewport.applyConstraints()),t.pinchRotate)){var s=Math.atan2(e.gesturePoints[0].currentPos.y-e.gesturePoints[1].currentPos.y,e.gesturePoints[0].currentPos.x-e.gesturePoints[1].currentPos.x),o=Math.atan2(e.gesturePoints[0].lastPos.y-e.gesturePoints[1].lastPos.y,e.gesturePoints[0].lastPos.x-e.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(s-o)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:e.eventSource,gesturePoints:e.gesturePoints,lastCenter:e.lastCenter,center:e.center,lastDistance:e.lastDistance,distance:e.distance,shift:e.shift,originalEvent:e.originalEvent}),!1}function C(t){var i,n,s;if((s=e.now())-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=s,this.viewport.flipped&&(t.position.x=this.viewport.getContainerSize().x-t.position.x),!t.preventDefaultAction&&this.viewport&&((i=this.gestureSettingsByDeviceType(t.pointerType)).scrollToZoom&&(n=Math.pow(this.zoomPerScroll,t.scroll),this.viewport.zoomBy(n,i.zoomToRefPoint?this.viewport.pointFromPixel(t.position,!0):null),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:t.eventSource,position:t.position,scroll:t.scroll,shift:t.shift,originalEvent:t.originalEvent}),i&&i.scrollToZoom)return!1}else if((i=this.gestureSettingsByDeviceType(t.pointerType))&&i.scrollToZoom)return!1}function y(e){t[this.hash].mouseInside=!0,h(this),this.raiseEvent("container-enter",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function R(e){e.pointers<1&&(t[this.hash].mouseInside=!1,t[this.hash].animating||l(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function S(e){(function(e){if(!e._opening){if(e.autoResize){var i=n(e.container),s=t[e.hash].prevContainerSize;if(!i.equals(s)){var o=e.viewport;if(e.preserveImageSizeOnResize){var r=s.x/i.x,a=o.getZoom()*r,c=o.getCenter();o.resize(i,!1),o.zoomTo(a,null,!0),o.panTo(c,!0)}else{var u=o.getBounds();o.resize(i,!0),o.fitBoundsWithConstraints(u,!0)}t[e.hash].prevContainerSize=i,t[e.hash].forceRedraw=!0}}var d=e.viewport.update(),p=e.world.update()||d;d&&e.raiseEvent("viewport-change"),e.referenceStrip&&(p=e.referenceStrip.update(e.viewport)||p),!t[e.hash].animating&&p&&(e.raiseEvent("animation-start"),h(e)),(p||t[e.hash].forceRedraw||e.world.needsDraw())&&(function(e){e.imageLoader.clear(),e.drawer.clear(),e.world.draw(),e.raiseEvent("update-viewport",{})}(e),e._drawOverlays(),e.navigator&&e.navigator.update(e.viewport),t[e.hash].forceRedraw=!1,p&&e.raiseEvent("animation")),t[e.hash].animating&&!p&&(e.raiseEvent("animation-finish"),t[e.hash].mouseInside||l(e)),t[e.hash].animating=p}})(e),e.isOpen()?e._updateRequestId=r(e,S):e._updateRequestId=!1}function b(e,t){return e?e+t:t}function M(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=this.zoomPerSecond,t[this.hash].zooming=!0,A(this)}function I(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=1/this.zoomPerSecond,t[this.hash].zooming=!0,A(this)}function D(){t[this.hash].zooming=!1}function A(t){e.requestAnimationFrame(e.delegate(t,B))}function B(){var i,n,s;t[this.hash].zooming&&this.viewport&&(n=(i=e.now())-t[this.hash].lastZoomTime,s=Math.pow(t[this.hash].zoomFactor,n/1e3),this.viewport.zoomBy(s),this.viewport.applyConstraints(),t[this.hash].lastZoomTime=i,A(this))}function L(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function k(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function H(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function N(){this.viewport&&this.viewport.goHome()}function $(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function W(){if(this.viewport){var t=this.viewport.getRotation();t=this.viewport.flipped?e.positiveModulo(t+this.rotationIncrement,360):e.positiveModulo(t-this.rotationIncrement,360),this.viewport.setRotation(t)}}function U(){if(this.viewport){var t=this.viewport.getRotation();t=this.viewport.flipped?e.positiveModulo(t-this.rotationIncrement,360):e.positiveModulo(t+this.rotationIncrement,360),this.viewport.setRotation(t)}}function F(){this.viewport.toggleFlip()}function j(){var e=this._sequenceIndex-1;this.navPrevNextWrap&&e<0&&(e+=this.tileSources.length),this.goToPage(e)}function z(){var e=this._sequenceIndex+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)}e.Viewer=function(s){var o,a,h=arguments,c=this;if(e.isPlainObject(s)||(s={id:h[0],xmlPath:h.length>1?h[1]:void 0,prefixUrl:h.length>2?h[2]:void 0,controls:h.length>3?h[3]:void 0,overlays:h.length>4?h[4]:void 0}),s.config&&(e.extend(!0,s,s.config),delete s.config),e.extend(!0,this,{id:s.id,hash:s.hash||i++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,s),"undefined"==typeof this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for("undefined"!=typeof t[this.hash]&&e.console.warn("Hash "+this.hash+" has already been used."),t[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",(function(t){var i=e.getString("Errors.OpenFailed",t.eventSource,t.message);c._showMessage(i)})),e.ControlDock.call(this,s),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(a=this.canvas.style).width="100%",a.height="100%",a.overflow="hidden",a.position="absolute",a.top="0px",a.left="0px",e.setElementTouchActionNone(this.canvas),""!==s.tabIndex&&(this.canvas.tabIndex=void 0===s.tabIndex?0:s.tabIndex),this.container.className="openseadragon-container",function(e){e.width="100%",e.height="100%",e.position="relative",e.overflow="hidden",e.left="0px",e.top="0px",e.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:e.delegate(this,d),keyHandler:e.delegate(this,p),clickHandler:e.delegate(this,_),dblClickHandler:e.delegate(this,g),dragHandler:e.delegate(this,m),dragEndHandler:e.delegate(this,v),enterHandler:e.delegate(this,E),exitHandler:e.delegate(this,f),pressHandler:e.delegate(this,T),releaseHandler:e.delegate(this,w),nonPrimaryPressHandler:e.delegate(this,P),nonPrimaryReleaseHandler:e.delegate(this,O),scrollHandler:e.delegate(this,C),pinchHandler:e.delegate(this,x)}),this.outerTracker=new e.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,y),exitHandler:e.delegate(this,R)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),t[this.hash].prevContainerSize=n(this.container),this.world=new e.World({viewer:this}),this.world.addHandler("add-item",(function(e){c.source=c.world.getItemAt(0).source,t[c.hash].forceRedraw=!0,c._updateRequestId||(c._updateRequestId=r(c,S))})),this.world.addHandler("remove-item",(function(e){c.world.getItemCount()?c.source=c.world.getItemAt(0).source:c.source=null,t[c.hash].forceRedraw=!0})),this.world.addHandler("metrics-change",(function(e){c.viewport&&c.viewport._setContentBounds(c.world.getHomeBounds(),c.world.getContentFactor())})),this.world.addHandler("item-index-change",(function(e){c.source=c.world.getItemAt(0).source})),this.viewport=new e.Viewport({containerSize:t[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:s.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(o=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(o,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(o=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(o,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new e.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),o=0;o<this.customControls.length;o++)this.addControl(this.customControls[o].id,{anchor:this.customControls[o].anchor});e.requestAnimationFrame((function(){l(c)})),void 0!==this.imageSmoothingEnabled&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(t){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(t)},openTileSource:function(t){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(t)},open:function(t,i){var n=this;if(this.close(),t){if(this.sequenceMode&&e.isArray(t))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),"undefined"!=typeof i&&!isNaN(i)&&(this.initialPage=i),this.tileSources=t,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),void this._updateSequenceButtons(this._sequenceIndex);if(e.isArray(t)||(t=[t]),t.length){this._opening=!0;for(var o,r=t.length,a=0,l=0,h=function(){if(a+l===r)if(a){(n._firstOpen||!n.preserveViewport)&&(n.viewport.goHome(!0),n.viewport.update()),n._firstOpen=!1;var e=t[0];if(e.tileSource&&(e=e.tileSource),n.overlays&&!n.preserveOverlays)for(var i=0;i<n.overlays.length;i++)n.currentOverlays[i]=s(n,n.overlays[i]);n._drawOverlays(),n._opening=!1,n.raiseEvent("open",{source:e})}else n._opening=!1,n.raiseEvent("open-failed",o)},c=function(t){(!e.isPlainObject(t)||!t.tileSource)&&(t={tileSource:t}),void 0!==t.index&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete t.index),void 0===t.collectionImmediately&&(t.collectionImmediately=!0);var i=t.success;t.success=function(e){if(a++,t.tileSource.overlays)for(var s=0;s<t.tileSource.overlays.length;s++)n.addOverlay(t.tileSource.overlays[s]);i&&i(e),h()};var s=t.error;t.error=function(e){l++,o||(o=e),s&&s(e),h()},n.addTiledImage(t)},u=0;u<t.length;u++)c(t[u]);return this}}},close:function(){return t[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),t[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(t[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),t[this.hash]=null,delete t[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.outerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){var e,t=this.controls.length;for(e=0;e<this.controls.length;e++)t=t&&this.controls[e].isVisible();return t},setControlsEnabled:function(e){return e?h(this):l(this),this.raiseEvent("controls-enabled",{enabled:e}),this},setDebugMode:function(e){for(var t=0;t<this.world.getItemCount();t++)this.world.getItemAt(t).debugMode=e;this.debugMode=e,this.forceRedraw()},isFullPage:function(){return t[this.hash].fullPage},setFullPage:function(i){var n,s,o=document.body,r=o.style,a=document.documentElement.style,l=this;if(i==this.isFullPage())return this;var h={fullPage:i,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",h),h.preventDefaultAction)return this;if(i){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=r.margin,this.docMargin=a.margin,r.margin="0",a.margin="0",this.bodyPadding=r.padding,this.docPadding=a.padding,r.padding="0",a.padding="0",this.bodyWidth=r.width,this.docWidth=a.width,r.width="100%",a.width="100%",this.bodyHeight=r.height,this.docHeight=a.height,r.height="100%",a.height="100%",this.previousBody=[],t[this.hash].prevElementParent=this.element.parentNode,t[this.hash].prevNextSibling=this.element.nextSibling,t[this.hash].prevElementWidth=this.element.style.width,t[this.hash].prevElementHeight=this.element.style.height,n=o.childNodes.length,s=0;s<n;s++)this.previousBody.push(o.childNodes[0]),o.removeChild(o.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,o.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),o.appendChild(this.element),this.element.style.height=e.getWindowSize().y+"px",this.element.style.width=e.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),t[this.hash].fullPage=!0,e.delegate(this,y)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,r.margin=this.bodyMargin,a.margin=this.docMargin,r.padding=this.bodyPadding,a.padding=this.docPadding,r.width=this.bodyWidth,a.width=this.docWidth,r.height=this.bodyHeight,a.height=this.docHeight,o.removeChild(this.element),n=this.previousBody.length,s=0;s<n;s++)o.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),t[this.hash].prevElementParent.insertBefore(this.element,t[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(o.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=t[this.hash].prevElementWidth,this.element.style.height=t[this.hash].prevElementHeight;var c=0,u=function(){e.setPageScroll(l.pageScroll);var t=e.getPageScroll();++c<10&&(t.x!==l.pageScroll.x||t.y!==l.pageScroll.y)&&e.requestAnimationFrame(u)};e.requestAnimationFrame(u),t[this.hash].fullPage=!1,e.delegate(this,R)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:i}),this},setFullScreen:function(t){var i=this;if(!e.supportsFullScreen)return this.setFullPage(t);if(e.isFullScreen()===t)return this;var n={fullScreen:t,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",n),n.preventDefaultAction)return this;if(t){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var s=function(){var t=e.isFullScreen();t||(e.removeEvent(document,e.fullScreenEventName,s),e.removeEvent(document,e.fullScreenErrorEventName,s),i.setFullPage(!1),i.isFullPage()&&(i.element.style.width=i.fullPageStyleWidth,i.element.style.height=i.fullPageStyleHeight)),i.navigator&&i.viewport&&setTimeout((function(){i.navigator.update(i.viewport)})),i.raiseEvent("full-screen",{fullScreen:t})};e.addEvent(document,e.fullScreenEventName,s),e.addEvent(document,e.fullScreenErrorEventName,s),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addTiledImage:function(t){e.console.assert(t,"[Viewer.addTiledImage] options is required"),e.console.assert(t.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!t.replace||t.index>-1&&t.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var i=this;t.replace&&(t.replaceItem=i.world.getItemAt(t.index)),this._hideMessage(),void 0===t.placeholderFillStyle&&(t.placeholderFillStyle=this.placeholderFillStyle),void 0===t.opacity&&(t.opacity=this.opacity),void 0===t.preload&&(t.preload=this.preload),void 0===t.compositeOperation&&(t.compositeOperation=this.compositeOperation),void 0===t.crossOriginPolicy&&(t.crossOriginPolicy=void 0!==t.tileSource.crossOriginPolicy?t.tileSource.crossOriginPolicy:this.crossOriginPolicy),void 0===t.ajaxWithCredentials&&(t.ajaxWithCredentials=this.ajaxWithCredentials),void 0===t.loadTilesWithAjax&&(t.loadTilesWithAjax=this.loadTilesWithAjax),void 0===t.ajaxHeaders||null===t.ajaxHeaders?t.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(t.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(t.ajaxHeaders=e.extend({},this.ajaxHeaders,t.ajaxHeaders));var n={options:t};function s(e){for(var s=0;s<i._loadQueue.length;s++)if(i._loadQueue[s]===n){i._loadQueue.splice(s,1);break}0===i._loadQueue.length&&o(n),i.raiseEvent("add-item-failed",e),t.error&&t.error(e)}function o(e){i.collectionMode&&(i.world.arrange({immediately:e.options.collectionImmediately,rows:i.collectionRows,columns:i.collectionColumns,layout:i.collectionLayout,tileSize:i.collectionTileSize,tileMargin:i.collectionTileMargin}),i.world.setAutoRefigureSizes(!0))}function r(){for(var t,n,s;i._loadQueue.length&&(t=i._loadQueue[0]).tileSource;){if(i._loadQueue.splice(0,1),t.options.replace){var r=i.world.getIndexOfItem(t.options.replaceItem);-1!=r&&(t.options.index=r),i.world.removeItem(t.options.replaceItem)}n=new e.TiledImage({viewer:i,source:t.tileSource,viewport:i.viewport,drawer:i.drawer,tileCache:i.tileCache,imageLoader:i.imageLoader,x:t.options.x,y:t.options.y,width:t.options.width,height:t.options.height,fitBounds:t.options.fitBounds,fitBoundsPlacement:t.options.fitBoundsPlacement,clip:t.options.clip,placeholderFillStyle:t.options.placeholderFillStyle,opacity:t.options.opacity,preload:t.options.preload,degrees:t.options.degrees,compositeOperation:t.options.compositeOperation,springStiffness:i.springStiffness,animationTime:i.animationTime,minZoomImageRatio:i.minZoomImageRatio,wrapHorizontal:i.wrapHorizontal,wrapVertical:i.wrapVertical,immediateRender:i.immediateRender,blendTime:i.blendTime,alwaysBlend:i.alwaysBlend,minPixelRatio:i.minPixelRatio,smoothTileEdgesMinZoom:i.smoothTileEdgesMinZoom,iOSDevice:i.iOSDevice,crossOriginPolicy:t.options.crossOriginPolicy,ajaxWithCredentials:t.options.ajaxWithCredentials,loadTilesWithAjax:t.options.loadTilesWithAjax,ajaxHeaders:t.options.ajaxHeaders,debugMode:i.debugMode}),i.collectionMode&&i.world.setAutoRefigureSizes(!1),i.world.addItem(n,{index:t.options.index}),0===i._loadQueue.length&&o(t),1===i.world.getItemCount()&&!i.preserveViewport&&i.viewport.goHome(!0),i.navigator&&(s=e.extend({},t.options,{replace:!1,originalTiledImage:n,tileSource:t.tileSource}),i.navigator.addTiledImage(s)),t.options.success&&t.options.success({item:n})}}e.isArray(t.tileSource)?setTimeout((function(){s({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:t.tileSource,options:t})})):(this._loadQueue.push(n),function(t,i,n,s,o){var r=t;if("string"==e.type(i))if(i.match(/^\s*<.*>\s*$/))i=e.parseXml(i);else if(i.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var a=e.parseJSON(i);i=a}catch{}function l(e,t){e.ready?s(e):(e.addHandler("ready",(function(){s(e)})),e.addHandler("open-failed",(function(e){o({message:e.message,source:t})})))}setTimeout((function(){if("string"==e.type(i))(i=new e.TileSource({url:i,crossOriginPolicy:void 0!==n.crossOriginPolicy?n.crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,ajaxHeaders:t.ajaxHeaders,useCanvas:t.useCanvas,success:function(e){s(e.tileSource)}})).addHandler("open-failed",(function(e){o(e)}));else if(e.isPlainObject(i)||i.nodeType)if(void 0===i.crossOriginPolicy&&(void 0!==n.crossOriginPolicy||void 0!==t.crossOriginPolicy)&&(i.crossOriginPolicy=void 0!==n.crossOriginPolicy?n.crossOriginPolicy:t.crossOriginPolicy),void 0===i.ajaxWithCredentials&&(i.ajaxWithCredentials=t.ajaxWithCredentials),void 0===i.useCanvas&&(i.useCanvas=t.useCanvas),e.isFunction(i.getTileUrl)){var a=new e.TileSource(i);a.getTileUrl=i.getTileUrl,s(a)}else{var h=e.TileSource.determineType(r,i);if(!h)return void o({message:"Unable to load TileSource",source:i});var c=h.prototype.configure.apply(r,[i]);l(new h(c),i)}else l(i,i)}))}(this,t.tileSource,t,(function(e){n.tileSource=e,r()}),(function(e){e.options=t,s(e),r()})))},addSimpleImage:function(t){e.console.assert(t,"[Viewer.addSimpleImage] options is required"),e.console.assert(t.url,"[Viewer.addSimpleImage] options.url is required");var i=e.extend({},t,{tileSource:{type:"image",url:t.url}});delete i.url,this.addTiledImage(i)},addLayer:function(t){var i=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var n=e.extend({},t,{success:function(e){i.raiseEvent("add-layer",{options:t,drawer:e.item})},error:function(e){i.raiseEvent("add-layer-failed",e)}});return this.addTiledImage(n),this},getLayerAtLevel:function(t){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(t)},getLevelOfLayer:function(t){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(t)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(t,i){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(t,i)},removeLayer:function(t){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(t)},forceRedraw:function(){return t[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var t=e.delegate(this,c),i=e.delegate(this,u),n=e.delegate(this,z),s=e.delegate(this,j),o=this.navImages,r=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(r=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:b(this.prefixUrl,o.previous.REST),srcGroup:b(this.prefixUrl,o.previous.GROUP),srcHover:b(this.prefixUrl,o.previous.HOVER),srcDown:b(this.prefixUrl,o.previous.DOWN),onRelease:s,onFocus:t,onBlur:i}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:b(this.prefixUrl,o.next.REST),srcGroup:b(this.prefixUrl,o.next.GROUP),srcHover:b(this.prefixUrl,o.next.HOVER),srcDown:b(this.prefixUrl,o.next.DOWN),onRelease:n,onFocus:t,onBlur:i}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),r&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var t=e.delegate(this,M),i=e.delegate(this,D),n=e.delegate(this,L),s=e.delegate(this,I),o=e.delegate(this,k),r=e.delegate(this,N),a=e.delegate(this,$),l=e.delegate(this,W),h=e.delegate(this,U),d=e.delegate(this,F),p=e.delegate(this,c),_=e.delegate(this,u),g=this.navImages,m=[],v=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(v=!1),this.showZoomControl&&(m.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:b(this.prefixUrl,g.zoomIn.REST),srcGroup:b(this.prefixUrl,g.zoomIn.GROUP),srcHover:b(this.prefixUrl,g.zoomIn.HOVER),srcDown:b(this.prefixUrl,g.zoomIn.DOWN),onPress:t,onRelease:i,onClick:n,onEnter:t,onExit:i,onFocus:p,onBlur:_})),m.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:b(this.prefixUrl,g.zoomOut.REST),srcGroup:b(this.prefixUrl,g.zoomOut.GROUP),srcHover:b(this.prefixUrl,g.zoomOut.HOVER),srcDown:b(this.prefixUrl,g.zoomOut.DOWN),onPress:s,onRelease:i,onClick:o,onEnter:s,onExit:i,onFocus:p,onBlur:_}))),this.showHomeControl&&m.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:b(this.prefixUrl,g.home.REST),srcGroup:b(this.prefixUrl,g.home.GROUP),srcHover:b(this.prefixUrl,g.home.HOVER),srcDown:b(this.prefixUrl,g.home.DOWN),onRelease:r,onFocus:p,onBlur:_})),this.showFullPageControl&&m.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:b(this.prefixUrl,g.fullpage.REST),srcGroup:b(this.prefixUrl,g.fullpage.GROUP),srcHover:b(this.prefixUrl,g.fullpage.HOVER),srcDown:b(this.prefixUrl,g.fullpage.DOWN),onRelease:a,onFocus:p,onBlur:_})),this.showRotationControl&&(m.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:b(this.prefixUrl,g.rotateleft.REST),srcGroup:b(this.prefixUrl,g.rotateleft.GROUP),srcHover:b(this.prefixUrl,g.rotateleft.HOVER),srcDown:b(this.prefixUrl,g.rotateleft.DOWN),onRelease:l,onFocus:p,onBlur:_})),m.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:b(this.prefixUrl,g.rotateright.REST),srcGroup:b(this.prefixUrl,g.rotateright.GROUP),srcHover:b(this.prefixUrl,g.rotateright.HOVER),srcDown:b(this.prefixUrl,g.rotateright.DOWN),onRelease:h,onFocus:p,onBlur:_}))),this.showFlipControl&&m.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:b(this.prefixUrl,g.flip.REST),srcGroup:b(this.prefixUrl,g.flip.GROUP),srcHover:b(this.prefixUrl,g.flip.HOVER),srcDown:b(this.prefixUrl,g.flip.DOWN),onRelease:d,onFocus:p,onBlur:_})),v&&(this.buttons=new e.ButtonGroup({buttons:m,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",e.delegate(this,H)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(e){return this.tileSources&&e>=0&&e<this.tileSources.length&&(this._sequenceIndex=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e),this.raiseEvent("page",{page:e})),this},addOverlay:function(t,i,n,r){var a;if(a=e.isPlainObject(t)?t:{element:t,location:i,placement:n,onDraw:r},t=e.getElement(a.element),o(this.currentOverlays,t)>=0)return this;var l=s(this,a);return this.currentOverlays.push(l),l.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:t,location:a.location,placement:a.placement}),this},updateOverlay:function(i,n,s){var r;return i=e.getElement(i),(r=o(this.currentOverlays,i))>=0&&(this.currentOverlays[r].update(n,s),t[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:i,location:n,placement:s})),this},removeOverlay:function(i){var n;return i=e.getElement(i),(n=o(this.currentOverlays,i))>=0&&(this.currentOverlays[n].destroy(),this.currentOverlays.splice(n,1),t[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:i})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return t[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(t){var i;return t=e.getElement(t),(i=o(this.currentOverlays,t))>=0?this.currentOverlays[i]:null},_updateSequenceButtons:function(e){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==e?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(e>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(t){this._hideMessage();var i=e.makeNeutralElement("div");i.appendChild(document.createTextNode(t)),this.messageDiv=e.makeCenteredNode(i),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){switch(e){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var e,t=this.currentOverlays.length;for(e=0;e<t;e++)this.currentOverlays[e].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function(e){function t(e){var t={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",t),!t.preventDefaultAction&&e.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var i=this.viewport.pointFromPixel(e.position);this.panVertical?this.panHorizontal||(i.x=this.viewer.viewport.getCenter(!0).x):i.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(i),this.viewer.viewport.applyConstraints()}}function i(e){var t={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",t),!t.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.flipped&&(e.delta.x=-e.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function s(e){return this.viewer.raiseEvent("navigator-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),!1}function o(e,t){r(e,"rotate("+t+"deg)")}function r(e,t){e.style.webkitTransform=t,e.style.mozTransform=t,e.style.msTransform=t,e.style.oTransform=t,e.style.transform=t}e.Navigator=function(r){var a,l,h,c,u=r.viewer,d=this;function p(e){o(d.displayRegionContainer,e),o(d.displayRegion,-e),d.viewport.setRotation(e)}(r.id?(this.element=document.getElementById(r.id),r.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(r.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),r.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:r.autoFade},r.position&&("BOTTOM_RIGHT"==r.position?r.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==r.position?r.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==r.position?r.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==r.position?r.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"==r.position&&(r.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,r.controlOptions.top=r.top,r.controlOptions.left=r.left,r.controlOptions.height=r.height,r.controlOptions.width=r.width))),this.element.id=r.id,this.element.className+=" navigator",(r=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},r,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:r.autoResize,minZoomImageRatio:1,background:r.background,opacity:r.opacity,borderColor:r.borderColor,displayRegionColor:r.displayRegionColor})).minPixelRatio=this.minPixelRatio=u.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),r.controlOptions.anchor!=e.ControlAnchor.NONE&&(h=this.element.style,c=this.borderWidth,h.margin="0px",h.border=c+"px solid "+r.borderColor,h.padding="0px",h.background=r.background,h.opacity=r.opacity,h.overflow="hidden"),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,t){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.overflow="hidden",e.border=t+"px solid "+r.displayRegionColor,e.margin="0px",e.padding="0px",e.background="transparent",e.float="left",e.cssFloat="left",e.styleFloat="left",e.zIndex=999999999,e.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",u.addControl(this.element,r.controlOptions),this._resizeWithViewer=r.controlOptions.anchor!=e.ControlAnchor.ABSOLUTE&&r.controlOptions.anchor!=e.ControlAnchor.NONE,r.width&&r.height?(this.setWidth(r.width),this.setHeight(r.height)):this._resizeWithViewer&&(a=e.getElementSize(u.element),this.element.style.height=Math.round(a.y*r.sizeRatio)+"px",this.element.style.width=Math.round(a.x*r.sizeRatio)+"px",this.oldViewerSize=a,l=e.getElementSize(this.element),this.elementArea=l.x*l.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[r]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),r.navigatorRotate)&&(p(r.viewer.viewport?r.viewer.viewport.getRotation():r.viewer.degrees||0),r.viewer.addHandler("rotate",(function(e){p(e.degrees)})));this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,i),clickHandler:e.delegate(this,t),releaseHandler:e.delegate(this,n),scrollHandler:e.delegate(this,s)}),this.addHandler("reset-size",(function(){d.viewport&&d.viewport.goHome(!0)})),u.world.addHandler("item-index-change",(function(e){window.setTimeout((function(){var t=d.world.getItemAt(e.previousIndex);d.world.setItemIndex(t,e.newIndex)}),1)})),u.world.addHandler("remove-item",(function(e){var t=e.item,i=d._getMatchingItem(t);i&&d.world.removeItem(i)})),this.update(u.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var t=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);t.equals(this.oldContainerSize)||(this.viewport.resize(t,!0),this.viewport.goHome(!0),this.oldContainerSize=t,this.drawer.clear(),this.world.draw())}},setWidth:function(e){this.width=e,this.element.style.width="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setHeight:function(e){this.height=e,this.element.style.height="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setFlip:function(e){return this.viewport.setFlip(e),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(e){r(this.displayRegion,e),r(this.canvas,e),r(this.element,e)},update:function(t){var i,n,s,o,r,a;if(i=e.getElementSize(this.viewer.element),this._resizeWithViewer&&i.x&&i.y&&!i.equals(this.oldViewerSize)&&(this.oldViewerSize=i,this.maintainSizeRatio||!this.elementArea?(n=i.x*this.sizeRatio,s=i.y*this.sizeRatio):(n=Math.sqrt(this.elementArea*(i.x/i.y)),s=this.elementArea/n),this.element.style.width=Math.round(n)+"px",this.element.style.height=Math.round(s)+"px",this.elementArea||(this.elementArea=n*s),this.updateSize()),t&&this.viewport){o=t.getBoundsNoRotate(!0),r=this.viewport.pixelFromPointNoRotate(o.getTopLeft(),!1),a=this.viewport.pixelFromPointNoRotate(o.getBottomRight(),!1).minus(this.totalBorderWidths);var l=this.displayRegion.style;l.display=this.world.getItemCount()?"block":"none",l.top=Math.round(r.y)+"px",l.left=Math.round(r.x)+"px";var h=Math.abs(r.x-a.x),c=Math.abs(r.y-a.y);l.width=Math.round(Math.max(h,0))+"px",l.height=Math.round(Math.max(c,0))+"px"}},addTiledImage:function(t){var i=this,n=t.originalTiledImage;delete t.original;var s=e.extend({},t,{success:function(e){var t=e.item;function s(){i._matchBounds(t,n)}t._originalForNavigator=n,i._matchBounds(t,n,!0),n.addHandler("bounds-change",s),n.addHandler("clip-change",s),n.addHandler("opacity-change",(function(){i._matchOpacity(t,n)})),n.addHandler("composite-operation-change",(function(){i._matchCompositeOperation(t,n)}))}});return e.Viewer.prototype.addTiledImage.apply(this,[s])},_getMatchingItem:function(e){for(var t,i=this.world.getItemCount(),n=0;n<i;n++)if((t=this.world.getItemAt(n))._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,i){var n=t.getBoundsNoRotate();e.setPosition(n.getTopLeft(),i),e.setWidth(n.width,i),e.setRotation(t.getRotation(),i),e.setClip(t.getClip())},_matchOpacity:function(e,t){e.setOpacity(t.opacity)},_matchCompositeOperation:function(e,t){e.setCompositeOperation(t.compositeOperation)}})}(OpenSeadragon),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(i){var n,s=i.split("."),o=null,r=arguments,a=t;for(n=0;n<s.length-1;n++)a=a[s[n]]||{};return"string"!=typeof(o=a[s[n]])&&(e.console.log("Untranslated source string:",i),o=""),o.replace(/\{\d+\}/g,(function(e){var t=parseInt(e.match(/\d+/),10)+1;return t<r.length?r[t]:""}))},setString:function(e,i){var n,s=e.split("."),o=t;for(n=0;n<s.length-1;n++)o[s[n]]||(o[s[n]]={}),o=o[s[n]];o[s[n]]=i}})}(OpenSeadragon),function(e){e.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},squaredDistanceTo:function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,i){var n,s;if(i=i||new e.Point(0,0),t%90==0){switch(e.positiveModulo(t,360)){case 0:n=1,s=0;break;case 90:n=0,s=1;break;case 180:n=-1,s=0;break;case 270:n=0,s=-1}}else{var o=t*Math.PI/180;n=Math.cos(o),s=Math.sin(o)}var r=n*(this.x-i.x)-s*(this.y-i.y)+i.x,a=s*(this.x-i.x)+n*(this.y-i.y)+i.y;return new e.Point(r,a)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(e){e.TileSource=function(t,i,n,s,o,r){var a,l,h=this,c=arguments;if(a=e.isPlainObject(t)?t:{width:c[0],height:c[1],tileSize:c[2],tileOverlap:c[3],minLevel:c[4],maxLevel:c[5]},e.EventSource.call(this),e.extend(!0,this,a),!this.success)for(l=0;l<arguments.length;l++)if(e.isFunction(arguments[l])){this.success=arguments[l];break}this.success&&this.addHandler("ready",(function(e){h.success(e)})),"string"==e.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=a.width&&a.height?a.width/a.height:1,this.dimensions=new e.Point(a.width,a.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=a.tileOverlap?a.tileOverlap:0,this.minLevel=a.minLevel?a.minLevel:0,this.maxLevel=void 0!==a.maxLevel&&null!==a.maxLevel?a.maxLevel:a.width&&a.height?Math.ceil(Math.log(Math.max(a.width,a.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(t){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth?this._tileWidth:this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight?this._tileHeight:this.getTileSize(e)},getLevelScale:function(e){var t,i={};for(t=0;t<=this.maxLevel;t++)i[t]=1/Math.pow(2,this.maxLevel-t);return this.getLevelScale=function(e){return i[e]},this.getLevelScale(e)},getNumTiles:function(t){var i=this.getLevelScale(t),n=Math.ceil(i*this.dimensions.x/this.getTileWidth(t)),s=Math.ceil(i*this.dimensions.y/this.getTileHeight(t));return new e.Point(n,s)},getPixelRatio:function(t){var i=this.dimensions.times(this.getLevelScale(t)),n=1/i.x,s=1/i.y;return new e.Point(n,s)},getClosestLevel:function(){var e,t;for(e=this.minLevel+1;e<=this.maxLevel&&!((t=this.getNumTiles(e)).x>1||t.y>1);e++);return e-1},getTileAtPoint:function(t,i){var n=i.x>=0&&i.x<=1&&i.y>=0&&i.y<=1/this.aspectRatio;e.console.assert(n,"[TileSource.getTileAtPoint] must be called with a valid point.");var s=this.dimensions.x*this.getLevelScale(t),o=i.x*s,r=i.y*s,a=Math.floor(o/this.getTileWidth(t)),l=Math.floor(r/this.getTileHeight(t));i.x>=1&&(a=this.getNumTiles(t).x-1);return i.y>=1/this.aspectRatio-1e-15&&(l=this.getNumTiles(t).y-1),new e.Point(a,l)},getTileBounds:function(t,i,n,s){var o=this.dimensions.times(this.getLevelScale(t)),r=this.getTileWidth(t),a=this.getTileHeight(t),l=0===i?0:r*i-this.tileOverlap,h=0===n?0:a*n-this.tileOverlap,c=r+(0===i?1:2)*this.tileOverlap,u=a+(0===n?1:2)*this.tileOverlap,d=1/o.x;return c=Math.min(c,o.x-l),u=Math.min(u,o.y-h),s?new e.Rect(0,0,c,u):new e.Rect(l*d,h*d,c*d,u*d)},getImageInfo:function(t){var i,n,s,o,r,a,l,h=this;t&&((l=(a=(r=t.split("/"))[r.length-1]).lastIndexOf("."))>-1&&(r[r.length-1]=a.slice(0,l))),n=function(i){"string"==typeof i&&(i=e.parseXml(i));var n=e.TileSource.determineType(h,i,t);n?(void 0===(o=n.prototype.configure.apply(h,[i,t])).ajaxWithCredentials&&(o.ajaxWithCredentials=h.ajaxWithCredentials),s=new n(o),h.ready=!0,h.raiseEvent("ready",{tileSource:s})):h.raiseEvent("open-failed",{message:"Unable to load TileSource",source:t})},t.match(/\.js$/)?(i=t.split("/").pop().replace(".js",""),e.jsonp({url:t,async:!1,callbackName:i,callback:n})):e.makeAjaxRequest({url:t,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(t){var i=function(t){var i,n,s=t.responseText,o=t.status;if(!t)throw new Error(e.getString("Errors.Security"));if(200!==t.status&&0!==t.status)throw i=404==(o=t.status)?"Not Found":t.statusText,new Error(e.getString("Errors.Status",o,i));if(s.match(/\s*<.*/))try{n=t.responseXML&&t.responseXML.documentElement?t.responseXML:e.parseXml(s)}catch{n=t.responseText}else if(s.match(/\s*[\{\[].*/))try{n=e.parseJSON(s)}catch{n=s}else n=s;return n}(t);n(i)},error:function(e,i){var n;try{n="HTTP "+e.status+" attempting to load TileSource"}catch{n=("undefined"!=typeof i&&i.toString?i.toString():"Unknown error")+" attempting to load TileSource"}h.raiseEvent("open-failed",{message:n,source:t})}})},supports:function(e,t){return!1},configure:function(e,t){throw new Error("Method not implemented.")},getTileUrl:function(e,t,i){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(e,t,i){return{}},tileExists:function(e,t,i){var n=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&t>=0&&i>=0&&t<n.x&&i<n.y}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype),e.TileSource.determineType=function(t,i,n){var s;for(s in OpenSeadragon)if(s.match(/.+TileSource$/)&&e.isFunction(OpenSeadragon[s])&&e.isFunction(OpenSeadragon[s].prototype.supports)&&OpenSeadragon[s].prototype.supports.call(t,i,n))return OpenSeadragon[s];e.console.error("No TileSource was able to open %s %s",n,i)}}(OpenSeadragon),function(e){function t(t,i){var n,s,o=i.Image,r=o.Url,a=o.Format,l=o.Size,h=o.DisplayRect||[],c=parseInt(l.Width,10),u=parseInt(l.Height,10),d=parseInt(o.TileSize,10),p=parseInt(o.Overlap,10),_=[];for(s=0;s<h.length;s++)n=h[s].Rect,_.push(new e.DisplayRect(parseInt(n.X,10),parseInt(n.Y,10),parseInt(n.Width,10),parseInt(n.Height,10),parseInt(n.MinLevel,10),parseInt(n.MaxLevel,10)));return e.extend(!0,{width:c,height:u,tileSize:d,tileOverlap:p,minLevel:null,maxLevel:null,tilesUrl:r,fileFormat:a,displayRects:_},i)}e.DziTileSource=function(t,i,n,s,o,r,a,l,h){var c,u,d,p;if(p=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=p.tilesUrl,this.fileFormat=p.fileFormat,this.displayRects=p.displayRects,this.displayRects)for(c=this.displayRects.length-1;c>=0;c--)for(d=(u=this.displayRects[c]).minLevel;d<=u.maxLevel;d++)this._levelRects[d]||(this._levelRects[d]=[]),this._levelRects[d].push(u);e.TileSource.apply(this,[p])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){var i;return e.Image?i=e.Image.xmlns:e.documentElement&&("Image"==e.documentElement.localName||"Image"==e.documentElement.tagName)&&(i=e.documentElement.namespaceURI),-1!==(i=(i||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==i.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(i,n){var s;return s=e.isPlainObject(i)?t(this,i):function(i,n){if(!n||!n.documentElement)throw new Error(e.getString("Errors.Xml"));var s,o,r,a,l,h=n.documentElement,c=h.localName||h.tagName,u=n.documentElement.namespaceURI,d=null,p=[];if("Image"==c)try{if(void 0===(a=h.getElementsByTagName("Size")[0])&&(a=h.getElementsByTagNameNS(u,"Size")[0]),d={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:h.getAttribute("Url"),Format:h.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(h.getAttribute("Overlap"),10),TileSize:parseInt(h.getAttribute("TileSize"),10),Size:{Height:parseInt(a.getAttribute("Height"),10),Width:parseInt(a.getAttribute("Width"),10)}}},!e.imageFormatSupported(d.Image.Format))throw new Error(e.getString("Errors.ImageFormat",d.Image.Format.toUpperCase()));for(void 0===(s=h.getElementsByTagName("DisplayRect"))&&(s=h.getElementsByTagNameNS(u,"DisplayRect")[0]),l=0;l<s.length;l++)void 0===(r=(o=s[l]).getElementsByTagName("Rect")[0])&&(r=o.getElementsByTagNameNS(u,"Rect")[0]),p.push({Rect:{X:parseInt(r.getAttribute("X"),10),Y:parseInt(r.getAttribute("Y"),10),Width:parseInt(r.getAttribute("Width"),10),Height:parseInt(r.getAttribute("Height"),10),MinLevel:parseInt(o.getAttribute("MinLevel"),10),MaxLevel:parseInt(o.getAttribute("MaxLevel"),10)}});return p.length&&(d.Image.DisplayRect=p),t(i,d)}catch(g){throw g instanceof Error?g:new Error(e.getString("Errors.Dzi"))}else{if("Collection"==c)throw new Error(e.getString("Errors.Dzc"));if("Error"==c){var _=h.getElementsByTagName("Message")[0].firstChild.nodeValue;throw new Error(_)}}throw new Error(e.getString("Errors.Dzi"))}(this,i),n&&!s.tilesUrl&&(s.tilesUrl=n.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=n.search(/\.(dzi|xml|js)\?/)?s.queryParams=n.match(/\?.*/):s.queryParams=""),s},getTileUrl:function(e,t,i){return[this.tilesUrl,e,"/",t,"_",i,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,t,i){var n,s,o,r,a,l,h,c=this._levelRects[e];if(this.minLevel&&e<this.minLevel||this.maxLevel&&e>this.maxLevel)return!1;if(!c||!c.length)return!0;for(h=c.length-1;h>=0;h--)if(!(e<(n=c[h]).minLevel||e>n.maxLevel)&&(s=this.getLevelScale(e),o=n.x*s,r=n.y*s,a=o+n.width*s,l=r+n.height*s,o=Math.floor(o/this._tileWidth),r=Math.floor(r/this._tileWidth),a=Math.ceil(a/this._tileWidth),l=Math.ceil(l/this._tileWidth),o<=t&&t<a&&r<=i&&i<l))return!0;return!1}})}(OpenSeadragon),function(e){function t(e){var t=Array.isArray(e.profile)?e.profile[0]:e.profile,i=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(t),n=!1;return 2===e.version&&e.profile.length>1&&e.profile[1].supports&&(n=-1!==e.profile[1].supports.indexOf("sizeByW")),3===e.version&&e.extraFeatures&&(n=-1!==e.extraFeatures.indexOf("sizeByWh")),!i||n}function i(e){for(var t=[],i=0;i<e.sizes.length;i++)t.push({url:e["@id"]+"/full/"+e.sizes[i].width+","+(3===e.version?e.sizes[i].height:"")+"/0/default."+e.tileFormat,width:e.sizes[i].width,height:e.sizes[i].height});return t.sort((function(e,t){return e.width-t.width}))}function n(t,i,s){var o,r;if(3==t.nodeType&&s)(r=t.nodeValue.trim()).match(/^\d*$/)&&(r=Number(r)),i[s]?(e.isArray(i[s])||(i[s]=[i[s]]),i[s].push(r)):i[s]=r;else if(1==t.nodeType)for(o=0;o<t.childNodes.length;o++)n(t.childNodes[o],i,t.nodeName)}e.IIIFTileSource=function(n){if(e.extend(!0,this,n),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(n.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=n.version,this.tile_width&&this.tile_height)n.tileWidth=this.tile_width,n.tileHeight=this.tile_height;else if(this.tile_width)n.tileSize=this.tile_width;else if(this.tile_height)n.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)n.tileWidth=this.tiles[0].width,n.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var s=0;s<this.tiles.length;s++)for(var o=0;o<this.tiles[s].scaleFactors.length;o++){var r=this.tiles[s].scaleFactors[o];this.scale_factors.push(r),n.tileSizePerScaleFactor[r]={width:this.tiles[s].width,height:this.tiles[s].height||this.tiles[s].width}}}else if(t(n)){for(var a=Math.min(this.height,this.width),l=[256,512,1024],h=[],c=0;c<l.length;c++)l[c]<=a&&h.push(l[c]);h.length>0?n.tileSize=Math.max.apply(null,h):n.tileSize=a}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,n.levels=i(this),e.extend(!0,n,{width:n.levels[n.levels.length-1].width,height:n.levels[n.levels.length-1].height,tileSize:Math.max(n.height,n.width),tileOverlap:0,minLevel:0,maxLevel:n.levels.length-1}),this.levels=n.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!n.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var u=Math.max.apply(null,this.scale_factors);n.maxLevel=Math.round(Math.log(u)*Math.LOG2E)}else n.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));e.TileSource.apply(this,[n])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return!!(e.protocol&&"http://iiif.io/api/image"==e.protocol||e["@context"]&&("http://library.stanford.edu/iiif/image-api/1.1/context.json"==e["@context"]||"http://iiif.io/api/image/1/context.json"==e["@context"])||e.profile&&0===e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")||e.identifier&&e.width&&e.height)||!(!e.documentElement||"info"!=e.documentElement.tagName||"http://library.stanford.edu/iiif/image-api/ns/"!=e.documentElement.namespaceURI)},configure:function(t,i){if(e.isPlainObject(t)){if(t["@context"]){var s=t["@context"];if(Array.isArray(s))for(var o=0;o<s.length;o++)if("string"==typeof s[o]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(s[o])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===s[o])){s=s[o];break}switch(s){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":t.version=1;break;case"http://iiif.io/api/image/2/context.json":t.version=2;break;case"http://iiif.io/api/image/3/context.json":t.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}else t["@context"]="http://iiif.io/api/image/1.0/context.json",t["@id"]=i.replace("/info.json",""),t.version=1;if(!t["@id"]&&t.id&&(t["@id"]=t.id),t.preferredFormats)for(var r=0;r<t.preferredFormats.length;r++)if(OpenSeadragon.imageFormatSupported(t.preferredFormats[r])){t.tileFormat=t.preferredFormats[r];break}return t}var a=function(t){if(!t||!t.documentElement)throw new Error(e.getString("Errors.Xml"));var i=t.documentElement,s=i.tagName,r=null;if("info"==s)try{return n(i,r={}),r}catch(o){throw o instanceof Error?o:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}(t);return a["@context"]="http://iiif.io/api/image/1.0/context.json",a["@id"]=i.replace("/info.xml",""),a.version=1,a},getTileWidth:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,t);var i=Math.pow(2,this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].width:this._tileWidth},getTileHeight:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,t);var i=Math.pow(2,this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].height:this._tileHeight},getLevelScale:function(t){if(this.emulateLegacyImagePyramid){var i=NaN;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(i=this.levels[t].width/this.levels[this.maxLevel].width),i}return e.TileSource.prototype.getLevelScale.call(this,t)},getNumTiles:function(t){return this.emulateLegacyImagePyramid?this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0):e.TileSource.prototype.getNumTiles.call(this,t)},getTileAtPoint:function(t,i){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,t,i)},getTileUrl:function(e,t,i){if(this.emulateLegacyImagePyramid){var n=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n}var s,o,r,a,l,h,c,u,d,p,_,g,m,v=Math.pow(.5,this.maxLevel-e),E=Math.ceil(this.width*v),f=Math.ceil(this.height*v);return s=this.getTileWidth(e),o=this.getTileHeight(e),r=Math.ceil(s/v),a=Math.ceil(o/v),m=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,E<s&&f<o?(p=2===this.version&&E===this.width||3===this.version&&E===this.width&&f===this.height?"max":3===this.version?E+","+f:E+",",l="full"):(h=t*r,c=i*a,u=Math.min(r,this.width-h),d=Math.min(a,this.height-c),l=0===t&&0===i&&u===this.width&&d===this.height?"full":[h,c,u,d].join(","),_=Math.ceil(u*v),g=Math.ceil(d*v),p=2===this.version&&_===this.width||3===this.version&&_===this.width&&g===this.height?"max":3===this.version?_+","+g:_+","),[this["@id"],l,p,"0",m].join("/")},__testonly__:{canBeTiled:t,constructLevels:i}})}(OpenSeadragon),function(e){e.OsmTileSource=function(t,i,n,s,o){var r;(!(r=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]}).width||!r.height)&&(r.width=65572864,r.height=65572864),r.tileSize||(r.tileSize=256,r.tileOverlap=0),r.tilesUrl||(r.tilesUrl="http://tile.openstreetmap.org/"),r.minLevel=8,e.TileSource.apply(this,[r])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"openstreetmaps"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){return this.tilesUrl+(e-8)+"/"+t+"/"+i+".png"}})}(OpenSeadragon),function(e){e.TmsTileSource=function(t,i,n,s,o){var r;r=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var a,l=256*Math.ceil(r.width/256),h=256*Math.ceil(r.height/256);a=l>h?l/256:h/256,r.maxLevel=Math.ceil(Math.log(a)/Math.log(2))-1,r.tileSize=256,r.width=l,r.height=h,e.TileSource.apply(this,[r])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"tiledmapservice"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){var n=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(n-i)+".png"}})}(OpenSeadragon),function(e){e.ZoomifyTileSource=function(e){e.tileSize=256;var t={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(t.x,10)>e.tileSize||parseInt(t.y,10)>e.tileSize;)t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),e.imageSizes.push({x:t.x,y:t.y}),e.gridSize.push(this._getGridSize(t.x,t.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[e])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(e,t,i){return{x:Math.ceil(e/i),y:Math.ceil(t/i)}},_calculateAbsoluteTileNumber:function(e,t,i){for(var n=0,s={},o=0;o<e;o++)n+=(s=this.gridSize[o]).x*s.y;return n+=(s=this.gridSize[e]).x*i+t},supports:function(e,t){return e.type&&"zoomifytileservice"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){var n,s=this._calculateAbsoluteTileNumber(e,t,i);return n=Math.floor(s/256),this.tilesUrl+"TileGroup"+n+"/"+e+"-"+t+"-"+i+".jpg"}})}(OpenSeadragon),function(e){function t(e,t){return t.levels}e.LegacyTileSource=function(t){var i,n,s;e.isArray(t)&&(i={type:"legacy-image-pyramid",levels:t}),i.levels=function(t){var i,n,s=[];for(n=0;n<t.length;n++)(i=t[n]).height&&i.width&&i.url?s.push({url:i.url,width:Number(i.width),height:Number(i.height)}):e.console.error("Unsupported image format: %s",i.url?i.url:"<no URL>");return s.sort((function(e,t){return e.height-t.height}))}(i.levels),i.levels.length>0?(n=i.levels[i.levels.length-1].width,s=i.levels[i.levels.length-1].height):(n=0,s=0,e.console.error("No supported image formats found")),e.extend(!0,i,{width:n,height:s,tileSize:Math.max(s,n),tileOverlap:0,minLevel:0,maxLevel:i.levels.length>0?i.levels.length-1:0}),e.TileSource.apply(this,[i]),this.levels=i.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"legacy-image-pyramid"==e.type||e.documentElement&&"legacy-image-pyramid"==e.documentElement.getAttribute("type")},configure:function(i,n){var s;return s=e.isPlainObject(i)?t(this,i):function(i,n){if(!n||!n.documentElement)throw new Error(e.getString("Errors.Xml"));var s,o,r=n.documentElement,a=r.tagName,l=null,h=[];if("image"==a)try{for(l={type:r.getAttribute("type"),levels:[]},h=r.getElementsByTagName("level"),o=0;o<h.length;o++)s=h[o],l.levels.push({url:s.getAttribute("url"),width:parseInt(s.getAttribute("width"),10),height:parseInt(s.getAttribute("height"),10)});return t(i,l)}catch(c){throw c instanceof Error?c:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==a)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==a)throw new Error("Error: "+n)}throw new Error("Unknown element "+a)}(this,i),s},getLevelScale:function(e){var t=NaN;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e,t,i){var n=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n}})}(OpenSeadragon),function(e){e.ImageTileSource=function(t){t=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},t),e.TileSource.apply(this,[t])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"image"===e.type},configure:function(e,t){return e},getImageInfo:function(t){var i=this._image=new Image,n=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),e.addEvent(i,"load",(function(){n.width=Object.prototype.hasOwnProperty.call(i,"naturalWidth")?i.naturalWidth:i.width,n.height=Object.prototype.hasOwnProperty.call(i,"naturalHeight")?i.naturalHeight:i.height,n.aspectRatio=n.width/n.height,n.dimensions=new e.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})})),e.addEvent(i,"error",(function(){n.raiseEvent("open-failed",{message:"Error loading image at "+t,source:t})})),i.src=t},getLevelScale:function(e){var t=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e,t,i){var n=null;return e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n},getContext2D:function(e,t,i){var n=null;return e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].context2D),n},_buildLevels:function(){var t=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,t;var i=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,n=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,s=document.createElement("canvas"),o=s.getContext("2d");if(s.width=i,s.height=n,o.drawImage(this._image,0,0,i,n),t[0].context2D=o,delete this._image,e.isCanvasTainted(s))return t;for(;i>=2&&n>=2;){i=Math.floor(i/2),n=Math.floor(n/2);var r=document.createElement("canvas"),a=r.getContext("2d");r.width=i,r.height=n,a.drawImage(s,0,0,i,n),t.splice(0,0,{context2D:a,width:i,height:n}),s=r,o=a}return t}})}(OpenSeadragon),function(e){e.TileSourceCollection=function(t,i,n,s){e.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(e){function t(i){e.requestAnimationFrame((function(){!function(i){var n,s,o;i.shouldFade&&(n=e.now(),s=n-i.fadeBeginTime,o=1-s/i.fadeLength,o=Math.min(1,o),o=Math.max(0,o),i.imgGroup&&e.setElementOpacity(i.imgGroup,o,!0),o>0&&t(i))}(i)}))}function i(t,i){t.element.disabled||(i>=e.ButtonState.GROUP&&t.currentState==e.ButtonState.REST&&(function(t){t.shouldFade=!1,t.imgGroup&&e.setElementOpacity(t.imgGroup,1,!0)}(t),t.currentState=e.ButtonState.GROUP),i>=e.ButtonState.HOVER&&t.currentState==e.ButtonState.GROUP&&(t.imgHover&&(t.imgHover.style.visibility=""),t.currentState=e.ButtonState.HOVER),i>=e.ButtonState.DOWN&&t.currentState==e.ButtonState.HOVER&&(t.imgDown&&(t.imgDown.style.visibility=""),t.currentState=e.ButtonState.DOWN))}function n(i,n){i.element.disabled||(n<=e.ButtonState.HOVER&&i.currentState==e.ButtonState.DOWN&&(i.imgDown&&(i.imgDown.style.visibility="hidden"),i.currentState=e.ButtonState.HOVER),n<=e.ButtonState.GROUP&&i.currentState==e.ButtonState.HOVER&&(i.imgHover&&(i.imgHover.style.visibility="hidden"),i.currentState=e.ButtonState.GROUP),n<=e.ButtonState.REST&&i.currentState==e.ButtonState.GROUP&&(function(i){i.shouldFade=!0,i.fadeBeginTime=e.now()+i.fadeDelay,window.setTimeout((function(){t(i)}),i.fadeDelay)}(i),i.currentState=e.ButtonState.REST))}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(t){var s=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},t),this.element=t.element||e.makeNeutralElement("div"),t.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor==e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(t){t.insideElementPressed?(i(s,e.ButtonState.DOWN),s.raiseEvent("enter",{originalEvent:t.originalEvent})):t.buttonDownAny||i(s,e.ButtonState.HOVER)},focusHandler:function(e){this.enterHandler(e),s.raiseEvent("focus",{originalEvent:e.originalEvent})},exitHandler:function(t){n(s,e.ButtonState.GROUP),t.insideElementPressed&&s.raiseEvent("exit",{originalEvent:t.originalEvent})},blurHandler:function(e){this.exitHandler(e),s.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(t){i(s,e.ButtonState.DOWN),s.raiseEvent("press",{originalEvent:t.originalEvent})},releaseHandler:function(t){t.insideElementPressed&&t.insideElementReleased?(n(s,e.ButtonState.HOVER),s.raiseEvent("release",{originalEvent:t.originalEvent})):t.insideElementPressed?n(s,e.ButtonState.GROUP):i(s,e.ButtonState.HOVER)},clickHandler:function(e){e.quick&&s.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){return 13!==e.keyCode||(s.raiseEvent("click",{originalEvent:e.originalEvent}),s.raiseEvent("release",{originalEvent:e.originalEvent}),!1)}}),n(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){i(this,e.ButtonState.GROUP)},notifyGroupExit:function(){n(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var i,n=this.buttons.concat([]),s=this;if(this.element=t.element||e.makeNeutralElement("div"),!t.group)for(this.element.style.display="inline-block",i=0;i<n.length;i++)this.element.appendChild(n[i].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){var t;for(t=0;t<s.buttons.length;t++)s.buttons[t].notifyGroupEnter()},exitHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<s.buttons.length;t++)s.buttons[t].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(e){e.Rect=function(t,i,n,s,o){var r,a;this.x="number"==typeof t?t:0,this.y="number"==typeof i?i:0,this.width="number"==typeof n?n:0,this.height="number"==typeof s?s:0,this.degrees="number"==typeof o?o:0,this.degrees=e.positiveModulo(this.degrees,360),this.degrees>=270?(r=this.getTopRight(),this.x=r.x,this.y=r.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=270):this.degrees>=180?(r=this.getBottomRight(),this.x=r.x,this.y=r.y,this.degrees-=180):this.degrees>=90&&(r=this.getBottomLeft(),this.x=r.x,this.y=r.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=90)},e.Rect.fromSummits=function(t,i,n){var s=t.distanceTo(i),o=t.distanceTo(n),r=i.minus(t),a=Math.atan(r.y/r.x);return r.x<0?a+=Math.PI:r.y<0&&(a+=2*Math.PI),new e.Rect(t.x,t.y,s,o,a/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.degrees===t.degrees},times:function(t){return new e.Rect(this.x*t,this.y*t,this.width*t,this.height*t,this.degrees)},translate:function(t){return new e.Rect(this.x+t.x,this.y+t.y,this.width,this.height,this.degrees)},union:function(t){var i=this.getBoundingBox(),n=t.getBoundingBox(),s=Math.min(i.x,n.x),o=Math.min(i.y,n.y),r=Math.max(i.x+i.width,n.x+n.width),a=Math.max(i.y+i.height,n.y+n.height);return new e.Rect(s,o,r-s,a-o)},intersection:function(t){var i=1e-10,n=[],s=this.getTopLeft();t.containsPoint(s,i)&&n.push(s);var o=this.getTopRight();t.containsPoint(o,i)&&n.push(o);var r=this.getBottomLeft();t.containsPoint(r,i)&&n.push(r);var a=this.getBottomRight();t.containsPoint(a,i)&&n.push(a);var l=t.getTopLeft();this.containsPoint(l,i)&&n.push(l);var h=t.getTopRight();this.containsPoint(h,i)&&n.push(h);var c=t.getBottomLeft();this.containsPoint(c,i)&&n.push(c);var u=t.getBottomRight();this.containsPoint(u,i)&&n.push(u);for(var d=this._getSegments(),p=t._getSegments(),_=0;_<d.length;_++)for(var g=d[_],m=0;m<p.length;m++){var v=p[m],E=f(g[0],g[1],v[0],v[1]);E&&n.push(E)}function f(t,n,s,o){var r=n.minus(t),a=o.minus(s),l=-a.x*r.y+r.x*a.y;if(0===l)return null;var h=(r.x*(t.y-s.y)-r.y*(t.x-s.x))/l,c=(a.x*(t.y-s.y)-a.y*(t.x-s.x))/l;return-i<=h&&h<=1-i&&-i<=c&&c<=1-i?new e.Point(t.x+c*r.x,t.y+c*r.y):null}if(0===n.length)return null;for(var T=n[0].x,w=n[0].x,P=n[0].y,O=n[0].y,x=1;x<n.length;x++){var C=n[x];C.x<T&&(T=C.x),C.x>w&&(w=C.x),C.y<P&&(P=C.y),C.y>O&&(O=C.y)}return new e.Rect(T,P,w-T,O-P)},_getSegments:function(){var e=this.getTopLeft(),t=this.getTopRight(),i=this.getBottomLeft(),n=this.getBottomRight();return[[e,t],[t,n],[n,i],[i,e]]},rotate:function(t,i){if(0===(t=e.positiveModulo(t,360)))return this.clone();i=i||this.getCenter();var n=this.getTopLeft().rotate(t,i),s=this.getTopRight().rotate(t,i).minus(n);s=s.apply((function(e){return Math.abs(e)<1e-15?0:e}));var o=Math.atan(s.y/s.x);return s.x<0?o+=Math.PI:s.y<0&&(o+=2*Math.PI),new e.Rect(n.x,n.y,this.width,this.height,o/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var t=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),s=this.getBottomRight(),o=Math.min(t.x,i.x,n.x,s.x),r=Math.max(t.x,i.x,n.x,s.x),a=Math.min(t.y,i.y,n.y,s.y),l=Math.max(t.y,i.y,n.y,s.y);return new e.Rect(o,a,r-o,l-a)},getIntegerBoundingBox:function(){var t=this.getBoundingBox(),i=Math.floor(t.x),n=Math.floor(t.y),s=Math.ceil(t.width+t.x-i),o=Math.ceil(t.height+t.y-n);return new e.Rect(i,n,s,o)},containsPoint:function(e,t){t=t||0;var i=this.getTopLeft(),n=this.getTopRight(),s=this.getBottomLeft(),o=n.minus(i),r=s.minus(i);return(e.x-i.x)*o.x+(e.y-i.y)*o.y>=-t&&(e.x-n.x)*o.x+(e.y-n.y)*o.y<=t&&(e.x-i.x)*r.x+(e.y-i.y)*r.y>=-t&&(e.x-s.x)*r.x+(e.y-s.y)*r.y<=t},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(e){var t={};function i(t){var i=Number(this.element.style.marginLeft.replace("px","")),n=Number(this.element.style.marginTop.replace("px","")),o=Number(this.element.style.width.replace("px","")),r=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-t.delta.x>0?i>-(o-a.x)&&(this.element.style.marginLeft=i+2*t.delta.x+"px",s(this,a.x,i+2*t.delta.x)):-t.delta.x<0&&i<0&&(this.element.style.marginLeft=i+2*t.delta.x+"px",s(this,a.x,i+2*t.delta.x)):-t.delta.y>0?n>-(r-a.y)&&(this.element.style.marginTop=n+2*t.delta.y+"px",s(this,a.y,n+2*t.delta.y)):-t.delta.y<0&&n<0&&(this.element.style.marginTop=n+2*t.delta.y+"px",s(this,a.y,n+2*t.delta.y))),!1}function n(t){var i=Number(this.element.style.marginLeft.replace("px","")),n=Number(this.element.style.marginTop.replace("px","")),o=Number(this.element.style.width.replace("px","")),r=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?t.scroll>0?i>-(o-a.x)&&(this.element.style.marginLeft=i-60*t.scroll+"px",s(this,a.x,i-60*t.scroll)):t.scroll<0&&i<0&&(this.element.style.marginLeft=i-60*t.scroll+"px",s(this,a.x,i-60*t.scroll)):t.scroll<0?n>a.y-r&&(this.element.style.marginTop=n+60*t.scroll+"px",s(this,a.y,n+60*t.scroll)):t.scroll>0&&n<0&&(this.element.style.marginTop=n+60*t.scroll+"px",s(this,a.y,n+60*t.scroll))),!1}function s(t,i,n){var s,o,r,a,l,h,c;for(s="horizontal"==t.scroll?t.panelWidth:t.panelHeight,o=Math.ceil(i/s)+5,h=o=(o=(r=Math.ceil((Math.abs(n)+i)/s)+1)-o)<0?0:o;h<r&&h<t.panels.length;h++)if(!(c=t.panels[h]).activePanel){var u,d=t.viewer.tileSources[h];u=d.referenceStripThumbnailUrl?{type:"image",url:d.referenceStripThumbnailUrl}:d,(a=new e.Viewer({id:c.id,tileSources:[u],element:c,navigatorSizeRatio:t.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:t.viewer.loadTilesWithAjax,ajaxHeaders:t.viewer.ajaxHeaders,useCanvas:t.useCanvas})).displayRegion=e.makeNeutralElement("div"),a.displayRegion.id=c.id+"-displayregion",a.displayRegion.className="displayregion",(l=a.displayRegion.style).position="relative",l.top="0px",l.left="0px",l.fontSize="0px",l.overflow="hidden",l.float="left",l.cssFloat="left",l.styleFloat="left",l.zIndex=999999999,l.cursor="default",l.width=t.panelWidth-4+"px",l.height=t.panelHeight-4+"px",a.displayRegion.innerTracker=new e.MouseTracker({element:a.displayRegion,startDisabled:!0}),c.getElementsByTagName("div")[0].appendChild(a.displayRegion),t.miniViewers[c.id]=a,c.activePanel=!0}}function o(e){var t=e.eventSource.element;return"horizontal"==this.scroll?t.style.marginBottom="0px":t.style.marginLeft="0px",!1}function r(t){var i=t.eventSource.element;return"horizontal"==this.scroll?i.style.marginBottom="-"+e.getElementSize(i).y/2+"px":i.style.marginLeft="-"+e.getElementSize(i).x/2+"px",!1}function a(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:case 39:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;default:return!0}}function l(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 61:case 48:case 119:case 87:case 100:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:case 115:case 83:case 97:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;default:return!0}}e.ReferenceStrip=function(h){var c,u,d,p=h.viewer,_=e.getElementSize(p.element);for(h.id||(h.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=h.id,this.element.className="referencestrip"),h=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},h,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),e.extend(this,h),t[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(u=this.element.style).marginTop="0px",u.marginRight="0px",u.marginBottom="0px",u.marginLeft="0px",u.left="0px",u.bottom="0px",u.border="0px",u.background="#000",u.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=p,this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,i),scrollHandler:e.delegate(this,n),enterHandler:e.delegate(this,o),exitHandler:e.delegate(this,r),keyDownHandler:e.delegate(this,a),keyHandler:e.delegate(this,l)}),h.width&&h.height?(this.element.style.width=h.width+"px",this.element.style.height=h.height+"px",p.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):"horizontal"==h.scroll?(this.element.style.width=_.x*h.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.height=_.y*h.sizeRatio+"px",p.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=_.y*h.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.width=_.x*h.sizeRatio+"px",p.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=_.x*this.sizeRatio+8,this.panelHeight=_.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},d=0;d<p.tileSources.length;d++)(c=e.makeNeutralElement("div")).id=this.element.id+"-"+d,c.style.width=this.panelWidth+"px",c.style.height=this.panelHeight+"px",c.style.display="inline",c.style.float="left",c.style.cssFloat="left",c.style.styleFloat="left",c.style.padding="2px",e.setElementTouchActionNone(c),c.innerTracker=new e.MouseTracker({element:c,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(t){t.eventSource.dragging=e.now()},releaseHandler:function(t){var i=t.eventSource,n=i.element.id,s=Number(n.split("-")[2]),o=e.now();t.insideElementPressed&&t.insideElementReleased&&i.dragging&&o-i.dragging<i.clickTimeThreshold&&(i.dragging=null,p.goToPage(s))}}),this.element.appendChild(c),c.activePanel=!1,this.panels.push(c);s(this,"vertical"==this.scroll?_.y:_.x,0),this.setFocus(0)},e.extend(e.ReferenceStrip.prototype,e.EventSource.prototype,e.Viewer.prototype,{setFocus:function(t){var i,n=this.element.querySelector("#"+this.element.id+"-"+t),r=e.getElementSize(this.viewer.canvas),a=Number(this.element.style.width.replace("px","")),l=Number(this.element.style.height.replace("px","")),h=-Number(this.element.style.marginLeft.replace("px","")),c=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==n&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=n,this.currentSelected.style.background="#999","horizontal"==this.scroll?(i=Number(t)*(this.panelWidth+3))>h+r.x-this.panelWidth?(i=Math.min(i,a-r.x),this.element.style.marginLeft=-i+"px",s(this,r.x,-i)):i<h&&(i=Math.max(0,i-r.x/2),this.element.style.marginLeft=-i+"px",s(this,r.x,-i)):(i=Number(t)*(this.panelHeight+3))>c+r.y-this.panelHeight?(i=Math.min(i,l-r.y),this.element.style.marginTop=-i+"px",s(this,r.y,-i)):i<c&&(i=Math.max(0,i-r.y/2),this.element.style.marginTop=-i+"px",s(this,r.y,-i)),this.currentPage=t,o.call(this,{eventSource:this.innerTracker}))},update:function(){return!!t[this.id].animating&&(e.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var e in this.miniViewers)this.miniViewers[e].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(e){e.DisplayRect=function(t,i,n,s,o,r){e.Rect.apply(this,[t,i,n,s]),this.minLevel=o,this.maxLevel=r},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(OpenSeadragon),function(e){e.Spring=function(t){var i=arguments;"object"!=typeof t&&(t={initial:i.length&&"number"==typeof i[0]?i[0]:void 0,springStiffness:i.length>1?i[1].springStiffness:5,animationTime:i.length>1?i[1].animationTime:1.5}),e.console.assert("number"==typeof t.springStiffness&&0!==t.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert("number"==typeof t.animationTime&&t.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),t.exponential&&(this._exponential=!0,delete t.exponential),e.extend(!0,this,t),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=t,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=t,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(t){this.start.value+=t,this.target.value+=t,this._exponential&&(e.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(t){this._exponential=t,this._exponential&&(e.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var t,i;this.current.time=e.now(),this._exponential?(t=this.start._logValue,i=this.target._logValue):(t=this.start.value,i=this.target.value);var n=this.current.time>=this.target.time?i:t+(i-t)*function(e,t){return(1-Math.exp(e*-t))/(1-Math.exp(-e))}(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),s=this.current.value;return this._exponential?this.current.value=Math.exp(n):this.current.value=n,s!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(e){function t(t){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},t),this.image=null}t.prototype={errorMsg:null,start:function(){var t=this,i=this.abort;this.image=new Image,this.image.onload=function(){t.finish(!0)},this.image.onabort=this.image.onerror=function(){t.errorMsg="Image load aborted",t.finish(!1)},this.jobId=window.setTimeout((function(){t.errorMsg="Image load exceeded timeout ("+t.timeout+" ms)",t.finish(!1)}),this.timeout),this.loadWithAjax?(this.request=e.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(e){var i;try{i=new window.Blob([e.response])}catch(r){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===r.name&&n){var s=new n;s.append(e.response),i=s.getBlob()}}0===i.size&&(t.errorMsg="Empty image response.",t.finish(!1));var o=(window.URL||window.webkitURL).createObjectURL(i);t.image.src=o},error:function(e){t.errorMsg="Image load aborted - XHR error",t.finish(!1)}}),this.abort=function(){t.request.abort(),"function"==typeof i&&i()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(e){this.image.onload=this.image.onerror=this.image.onabort=null,e||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(t){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},t)},e.ImageLoader.prototype={addJob:function(e){var i=this,n={src:e.src,loadWithAjax:e.loadWithAjax,ajaxHeaders:e.loadWithAjax?e.ajaxHeaders:null,crossOriginPolicy:e.crossOriginPolicy,ajaxWithCredentials:e.ajaxWithCredentials,callback:function(t){!function(e,t,i){e.jobsInProgress--,(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&e.jobQueue.length>0&&(e.jobQueue.shift().start(),e.jobsInProgress++),i(t.image,t.errorMsg,t.request)}(i,t,e.callback)},abort:e.abort,timeout:this.timeout},s=new t(n);!this.jobLimit||this.jobsInProgress<this.jobLimit?(s.start(),this.jobsInProgress++):this.jobQueue.push(s)},clear:function(){for(var e=0;e<this.jobQueue.length;e++){var t=this.jobQueue[e];"function"==typeof t.abort&&t.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(e){e.Tile=function(e,t,i,n,s,o,r,a,l,h){this.level=e,this.x=t,this.y=i,this.bounds=n,this.sourceBounds=h,this.exists=s,this.url=o,this.context2D=r,this.loadWithAjax=a,this.ajaxHeaders=l,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(t){this.cacheImageRecord?this.loaded?(this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=t&&t.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",e.setElementOpacity(this.element,this.opacity)):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(t,i,n,s){var o,r,a,l=this.position.times(e.pixelDensityRatio),h=this.size.times(e.pixelDensityRatio);this.context2D||this.cacheImageRecord?(o=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&o?(t.save(),t.globalAlpha=this.opacity,"number"==typeof n&&1!==n&&(l=l.times(n),h=h.times(n)),s instanceof e.Point&&(l=l.plus(s)),1===t.globalAlpha&&this._hasTransparencyChannel()&&t.clearRect(l.x,l.y,h.x,h.y),i({context:t,tile:this,rendered:o}),this.sourceBounds?(r=Math.min(this.sourceBounds.width,o.canvas.width),a=Math.min(this.sourceBounds.height,o.canvas.height)):(r=o.canvas.width,a=o.canvas.height),t.drawImage(o.canvas,0,0,r,a,l.x,l.y,h.x,h.y),t.restore()):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var t;if(this.cacheImageRecord)t=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;t=this.context2D}return t.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(t,i,n){var s=Math.max(1,Math.ceil((n.x-i.x)/2)),o=Math.max(1,Math.ceil((n.y-i.y)/2));return new e.Point(s,o).minus(this.position.times(e.pixelDensityRatio).times(t||1).apply((function(e){return e%1})))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(t,i,n){var s;s=e.isPlainObject(t)?t:{element:t,location:i,placement:n},this.element=s.element,this.style=s.element.style,this._init(s)},e.Overlay.prototype={_init:function(t){this.location=t.location,this.placement=void 0===t.placement?e.Placement.TOP_LEFT:t.placement,this.onDraw=t.onDraw,this.checkResize=void 0===t.checkResize||t.checkResize,this.width=void 0===t.width?null:t.width,this.height=void 0===t.height?null:t.height,this.rotationMode=t.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(t,i){var n=e.Placement.properties[this.placement];!n||(n.isHorizontallyCentered?t.x-=i.x/2:n.isRight&&(t.x-=i.x),n.isVerticallyCentered?t.y-=i.y/2:n.isBottom&&(t.y-=i.y))},destroy:function(){var t=this.element,i=this.style;t.parentNode&&(t.parentNode.removeChild(t),t.prevElementParent&&(i.display="none",document.body.appendChild(t))),this.onDraw=null,i.top="",i.left="",i.position="",null!==this.width&&(i.width=""),null!==this.height&&(i.height="");var n=e.getCssPropertyWithVendorPrefix("transformOrigin"),s=e.getCssPropertyWithVendorPrefix("transform");n&&s&&(i[n]="",i[s]="")},drawHTML:function(t,i){var n=this.element;n.parentNode!==t&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,t.appendChild(n),this.style.position="absolute",this.size=e.getElementSize(n));var s=this._getOverlayPositionAndSize(i),o=s.position,r=this.size=s.size,a=s.rotate;if(this.onDraw)this.onDraw(o,r,this.element);else{var l=this.style;l.left=o.x+"px",l.top=o.y+"px",null!==this.width&&(l.width=r.x+"px"),null!==this.height&&(l.height=r.y+"px");var h=e.getCssPropertyWithVendorPrefix("transformOrigin"),c=e.getCssPropertyWithVendorPrefix("transform");h&&c&&(a?(l[h]=this._getTransformOrigin(),l[c]="rotate("+a+"deg)"):(l[h]="",l[c]="")),"none"!==l.display&&(l.display="block")}},_getOverlayPositionAndSize:function(t){var i=t.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(t);this.adjust(i,n);var s=0;if(t.degrees&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var o=new e.Rect(i.x,i.y,n.x,n.y),r=this._getBoundingBox(o,t.degrees);i=r.getTopLeft(),n=r.getSize()}else s=t.degrees;return{position:i,size:n,rotate:s}},_getSizeInPixels:function(t){var i=this.size.x,n=this.size.y;if(null!==this.width||null!==this.height){var s=t.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);null!==this.width&&(i=s.x),null!==this.height&&(n=s.y)}if(this.checkResize&&(null===this.width||null===this.height)){var o=this.size=e.getElementSize(this.element);null===this.width&&(i=o.x),null===this.height&&(n=o.y)}return new e.Point(i,n)},_getBoundingBox:function(e,t){var i=this._getPlacementPoint(e);return e.rotate(t,i).getBoundingBox()},_getPlacementPoint:function(t){var i=new e.Point(t.x,t.y),n=e.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?i.x+=t.width/2:n.isRight&&(i.x+=t.width),n.isVerticallyCentered?i.y+=t.height/2:n.isBottom&&(i.y+=t.height)),i},_getTransformOrigin:function(){var t="",i=e.Placement.properties[this.placement];return i&&(i.isLeft?t="left":i.isRight&&(t="right"),i.isTop?t+=" top":i.isBottom&&(t+=" bottom")),t},update:function(t,i){var n=e.isPlainObject(t)?t:{location:t,placement:i};this._init({location:n.location||this.location,placement:void 0!==n.placement?n.placement:this.placement,onDraw:n.onDraw||this.onDraw,checkResize:n.checkResize||this.checkResize,width:void 0!==n.width?n.width:this.width,height:void 0!==n.height?n.height:this.height,rotationMode:n.rotationMode||this.rotationMode})},getBounds:function(t){e.console.assert(t,"A viewport must now be passed to Overlay.getBounds.");var i=this.width,n=this.height;if(null===i||null===n){var s=t.deltaPointsFromPixelsNoRotate(this.size,!0);null===i&&(i=s.x),null===n&&(n=s.y)}var o=this.location.clone();return this.adjust(o,new e.Point(i,n)),this._adjustBoundsForRotation(t,new e.Rect(o.x,o.y,i,n))},_adjustBoundsForRotation:function(t,i){if(!t||0===t.degrees||this.rotationMode===e.OverlayRotationMode.EXACT)return i;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return i;var n=this._getOverlayPositionAndSize(t);return t.viewerElementToViewportRectangle(new e.Rect(n.position.x,n.position.y,n.size.x,n.size.y))}return i.rotate(-t.degrees,this._getPlacementPoint(i))}}}(OpenSeadragon),function(e){e.Drawer=function(t){e.console.assert(t.viewer,"[Drawer] options.viewer is required");var i=arguments;if(e.isPlainObject(t)||(t={source:i[0],viewport:i[1],element:i[2]}),e.console.assert(t.viewport,"[Drawer] options.viewport is required"),e.console.assert(t.element,"[Drawer] options.element is required"),t.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=t.viewer,this.viewport=t.viewport,this.debugGridColor="string"==typeof t.debugGridColor?[t.debugGridColor]:t.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,t.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=e.getElement(t.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var n=this._calculateCanvasSize();this.canvas.width=n.x,this.canvas.height=n.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(t,i,n,s){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(t,i,n,s),this},updateOverlay:function(t,i,n){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(t,i,n),this},removeOverlay:function(t){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(t),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(t){var i=this.viewport.pixelFromPointNoRotate(t,!0);return new e.Point(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio)},clipWithPolygons:function(e,t){if(this.useCanvas){var i=this._getContext(t);i.beginPath(),e.forEach((function(e){e.forEach((function(e,t){i[0===t?"moveTo":"lineTo"](e.x,e.y)}))})),i.clip()}},setOpacity:function(t){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var i=this.viewer.world,n=0;n<i.getItemCount();n++)i.getItemAt(n).setOpacity(t);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var t=this.viewer.world,i=0,n=0;n<t.getItemCount();n++){var s=t.getItemAt(n).getOpacity();s>i&&(i=s)}return i},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var e=this._calculateCanvasSize();if((this.canvas.width!=e.x||this.canvas.height!=e.y)&&(this.canvas.width=e.x,this.canvas.height=e.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas)){var t=this._calculateSketchCanvasSize();this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(e,t){if(this.useCanvas){var i=this._getContext(e);if(t)i.clearRect(t.x,t.y,t.width,t.height);else{var n=i.canvas;i.clearRect(0,0,n.width,n.height)}}},viewportToDrawerRectangle:function(t){var i=this.viewport.pixelFromPointNoRotate(t.getTopLeft(),!0),n=this.viewport.deltaPixelsFromPointsNoRotate(t.getSize(),!0);return new e.Rect(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio,n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio)},drawTile:function(t,i,n,s,o){if(e.console.assert(t,"[Drawer.drawTile] tile is required"),e.console.assert(i,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var r=this._getContext(n);s=s||1,t.drawCanvas(r,i,s,o)}else t.drawHTML(this.canvas)},_getContext:function(e){var t=this.context;if(e){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var i=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=i.x,this.sketchCanvas.height=i.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var n=this;this.viewer.addHandler("rotate",(function e(){if(0!==n.viewport.getRotation()){n.viewer.removeHandler("rotate",e);var t=n._calculateSketchCanvasSize();n.sketchCanvas.width=t.x,n.sketchCanvas.height=t.y}}))}this._updateImageSmoothingEnabled(this.sketchContext)}t=this.sketchContext}return t},saveContext:function(e){!this.useCanvas||this._getContext(e).save()},restoreContext:function(e){!this.useCanvas||this._getContext(e).restore()},setClip:function(e,t){if(this.useCanvas){var i=this._getContext(t);i.beginPath(),i.rect(e.x,e.y,e.width,e.height),i.clip()}},drawRectangle:function(e,t,i){if(this.useCanvas){var n=this._getContext(i);n.save(),n.fillStyle=t,n.fillRect(e.x,e.y,e.width,e.height),n.restore()}},blendSketch:function(t,i,n,s){var o=t;if(e.isPlainObject(o)||(o={opacity:t,scale:i,translate:n,compositeOperation:s}),this.useCanvas&&this.sketchCanvas){t=o.opacity,s=o.compositeOperation;var r=o.bounds;if(this.context.save(),this.context.globalAlpha=t,s&&(this.context.globalCompositeOperation=s),r)r.x<0&&(r.width+=r.x,r.x=0),r.x+r.width>this.canvas.width&&(r.width=this.canvas.width-r.x),r.y<0&&(r.height+=r.y,r.y=0),r.y+r.height>this.canvas.height&&(r.height=this.canvas.height-r.y),this.context.drawImage(this.sketchCanvas,r.x,r.y,r.width,r.height,r.x,r.y,r.width,r.height);else{i=o.scale||1;var a=(n=o.translate)instanceof e.Point?n:new e.Point(0,0),l=0,h=0;if(n){var c=this.sketchCanvas.width-this.canvas.width,u=this.sketchCanvas.height-this.canvas.height;l=Math.round(c/2),h=Math.round(u/2)}this.context.drawImage(this.sketchCanvas,a.x-l*i,a.y-h*i,(this.canvas.width+2*l)*i,(this.canvas.height+2*h)*i,-l,-h,this.canvas.width+2*l,this.canvas.height+2*h)}this.context.restore()}},drawDebugInfo:function(t,i,n,s){if(this.useCanvas){var o=this.viewer.world.getIndexOfItem(s)%this.debugGridColor.length,r=this.context;r.save(),r.lineWidth=2*e.pixelDensityRatio,r.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",r.strokeStyle=this.debugGridColor[o],r.fillStyle=this.debugGridColor[o],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),s.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:s.getRotation(!0),point:s.viewport.pixelFromPointNoRotate(s._getRotationPoint(!0),!0)}),0===s.viewport.degrees&&s.getRotation(!0)%360==0&&s._drawer.viewer.viewport.getFlip()&&s._drawer._flip(),r.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio);var a=(t.position.x+t.size.x/2)*e.pixelDensityRatio,l=(t.position.y+t.size.y/2)*e.pixelDensityRatio;r.translate(a,l),r.rotate(Math.PI/180*-this.viewport.degrees),r.translate(-a,-l),0===t.x&&0===t.y&&(r.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),r.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),r.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),r.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),r.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),r.fillText("Order: "+n+" of "+i,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),r.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),r.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),s.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===s.viewport.degrees&&s.getRotation(!0)%360==0&&s._drawer.viewer.viewport.getFlip()&&s._drawer._flip(),r.restore()}},debugRect:function(t){if(this.useCanvas){var i=this.context;i.save(),i.lineWidth=2*e.pixelDensityRatio,i.strokeStyle=this.debugGridColor[0],i.fillStyle=this.debugGridColor[0],i.strokeRect(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio,t.width*e.pixelDensityRatio,t.height*e.pixelDensityRatio),i.restore()}},setImageSmoothingEnabled:function(e){this.useCanvas&&(this._imageSmoothingEnabled=e,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(e){e.msImageSmoothingEnabled=this._imageSmoothingEnabled,e.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(t){var i=this._getContext(t).canvas;return new e.Point(i.width,i.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(t){var i=t.point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(t.useSketch);n.save(),n.translate(i.x,i.y),this.viewer.viewport.flipped?(n.rotate(Math.PI/180*-t.degrees),n.scale(-1,1)):n.rotate(Math.PI/180*t.degrees),n.translate(-i.x,-i.y)},_flip:function(t){var i=(t=t||{}).point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(t.useSketch);n.translate(i.x,0),n.scale(-1,1),n.translate(-i.x,0)},_restoreRotationChanges:function(e){this._getContext(e).restore()},_calculateCanvasSize:function(){var t=e.pixelDensityRatio,i=this.viewport.getContainerSize();return{x:Math.round(i.x*t),y:Math.round(i.y*t)}},_calculateSketchCanvasSize:function(){var e=this._calculateCanvasSize();if(0===this.viewport.getRotation())return e;var t=Math.ceil(Math.sqrt(e.x*e.x+e.y*e.y));return{x:t,y:t}}}}(OpenSeadragon),function(e){e.Viewport=function(t){var i=arguments;i.length&&i[0]instanceof e.Point&&(t={containerSize:i[0],contentSize:i[1],config:i[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t.margins||{}),delete t.margins,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer},t),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){return e.console.assert(t,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(t instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(t.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(t.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,t.y/t.x),t.x),this},setHomeBounds:function(t,i){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(t,i)},_setContentBounds:function(t,i){e.console.assert(t,"[Viewport._setContentBounds] bounds is required"),e.console.assert(t instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(t.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(t.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=t.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=t.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?e>=1?e:1:e>=1?1:e)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var t=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new e.Rect(t.x-i/2,t.y-n/2,i,n)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(t){e.console.assert("object"===e.type(t),"[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation())},getBoundsNoRotate:function(t){var i=this.getCenter(t),n=1/this.getZoom(t),s=n/this.getAspectRatio();return new e.Rect(i.x-n/2,i.y-s/2,n,s)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var t=this.getBoundsNoRotate(e),i=this._containerInnerSize.x*this.getZoom(e);return t.x-=this._margins.left/i,t.y-=this._margins.top/i,t.width+=(this._margins.left+this._margins.right)/i,t.height+=(this._margins.top+this._margins.bottom)/i,t},getCenter:function(t){var i,n,s,o,r,a,l=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),h=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?l:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),o=(s=1/(n=this.getZoom()))/this.getAspectRatio(),r=new e.Rect(l.x-s/2,l.y-o/2,s,o),a=this._pixelFromPoint(this.zoomPoint,r).minus(i).divide(this._containerInnerSize.x*n),h.plus(a)):h},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(t){var i=new e.Rect(t.x,t.y,t.width,t.height);if(!this.wrapHorizontal){var n=this.visibilityRatio*i.width,s=i.x+i.width,o=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,r=this._contentBoundsNoRotate.x-s+n,a=o-i.x-n;n>this._contentBoundsNoRotate.width?i.x+=(r+a)/2:a<0?i.x+=a:r>0&&(i.x+=r)}if(!this.wrapVertical){var l=this.visibilityRatio*i.height,h=i.y+i.height,c=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,u=this._contentBoundsNoRotate.y-h+l,d=c-i.y-l;l>this._contentBoundsNoRotate.height?i.y+=(u+d)/2:d<0?i.y+=d:u>0&&(i.y+=u)}return i},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var t=this.getZoom(),i=this._applyZoomConstraints(t);t!==i&&this.zoomTo(i,this.zoomPoint,e);var n=this.getBoundsNoRotate(),s=this._applyBoundaryConstraints(n);return this._raiseConstraintsEvent(e),(n.x!==s.x||n.y!==s.y||e)&&this.fitBounds(s.rotate(-this.getRotation()),e),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(t,i){var n=(i=i||{}).immediately||!1,s=i.constraints||!1,o=this.getAspectRatio(),r=t.getCenter(),a=new e.Rect(t.x,t.y,t.width,t.height,t.degrees+this.getRotation()).getBoundingBox();a.getAspectRatio()>=o?a.height=a.width/o:a.width=a.height*o,a.x=r.x-a.width/2,a.y=r.y-a.height/2;var l=1/a.width;if(s){var h=a.getAspectRatio(),c=this._applyZoomConstraints(l);l!==c&&(l=c,a.width=1/l,a.x=r.x-a.width/2,a.height=a.width/h,a.y=r.y-a.height/2),r=(a=this._applyBoundaryConstraints(a)).getCenter(),this._raiseConstraintsEvent(n)}if(n)return this.panTo(r,!0),this.zoomTo(l,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var u=this.getBounds(),d=this.getZoom();if(0===d||Math.abs(l/d-1)<1e-8)return this.zoomTo(l,!0),this.panTo(r,n);var p=(a=a.rotate(-this.getRotation())).getTopLeft().times(l).minus(u.getTopLeft().times(d)).divide(l-d);return this.zoomTo(l,p,n)},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(t){var i=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,t)},fitHorizontally:function(t){var i=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,t)},getConstrainedBounds:function(e){var t;return t=this.getBounds(e),this._applyBoundaryConstraints(t)},panBy:function(t,i){var n=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(t),i)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(e,t,i){return this.zoomTo(this.zoomSpring.target.value*e,t,i)},zoomTo:function(t,i,n){var s=this;return this.zoomPoint=i instanceof e.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,n?this._adjustCenterSpringsForZoomPoint((function(){s.zoomSpring.resetTo(t)})):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:i,immediately:n}),this},setRotation:function(t){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=e.positiveModulo(t,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:t}),this):this},getRotation:function(){return this.degrees},resize:function(e,t){var i,n=this.getBoundsNoRotate(),s=n;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),t&&(i=e.x/this.containerSize.x,s.width=n.width*i,s.height=s.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:t}),this.fitBounds(s,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e=this;this._adjustCenterSpringsForZoomPoint((function(){e.zoomSpring.update()})),this.centerSpringX.update(),this.centerSpringY.update();var t=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,t},_adjustCenterSpringsForZoomPoint:function(e){if(this.zoomPoint){var t=this.pixelFromPoint(this.zoomPoint,!0);e();var i=this.pixelFromPoint(this.zoomPoint,!0).minus(t),n=this.deltaPointsFromPixels(i,!0);this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else e()},deltaPixelsFromPointsNoRotate:function(e,t){return e.times(this._containerInnerSize.x*this.getZoom(t))},deltaPixelsFromPoints:function(e,t){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()),t)},deltaPointsFromPixelsNoRotate:function(e,t){return e.divide(this._containerInnerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return this.deltaPointsFromPixelsNoRotate(e,t).rotate(-this.getRotation())},pixelFromPointNoRotate:function(e,t){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(t))},pixelFromPoint:function(e,t){return this._pixelFromPoint(e,this.getBoundsNoRotate(t))},_pixelFromPointNoRotate:function(t,i){return t.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,t){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(),this.getCenter(!0)),t)},pointFromPixelNoRotate:function(t,i){var n=this.getBoundsNoRotate(i);return t.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/n.width).plus(n.getTopLeft())},pointFromPixel:function(e,t){return this.pointFromPixelNoRotate(e,t).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(t,i){var n=this._contentBoundsNoRotate.width;return new e.Point(t*this._contentSizeNoRotate.x/n,i*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(t,i){if(t instanceof e.Point)return this.viewportToImageCoordinates(t.x,t.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===n){return this.viewer.world.getItemAt(0).viewportToImageCoordinates(t,i,!0)}}return this._viewportToImageDelta(t-this._contentBoundsNoRotate.x,i-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(t,i){var n=this._contentBoundsNoRotate.width;return new e.Point(t/this._contentSizeNoRotate.x*n,i/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(t,i){if(t instanceof e.Point)return this.imageToViewportCoordinates(t.x,t.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===n){return this.viewer.world.getItemAt(0).imageToViewportCoordinates(t,i,!0)}}var s=this._imageToViewportDelta(t,i);return s.x+=this._contentBoundsNoRotate.x,s.y+=this._contentBoundsNoRotate.y,s},imageToViewportRectangle:function(t,i,n,s){var o=t;if(o instanceof e.Rect||(o=new e.Rect(t,i,n,s)),this.viewer){var r=this.viewer.world.getItemCount();if(r>1)e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===r){return this.viewer.world.getItemAt(0).imageToViewportRectangle(t,i,n,s,!0)}}var a=this.imageToViewportCoordinates(o.x,o.y),l=this._imageToViewportDelta(o.width,o.height);return new e.Rect(a.x,a.y,l.x,l.y,o.degrees)},viewportToImageRectangle:function(t,i,n,s){var o=t;if(o instanceof e.Rect||(o=new e.Rect(t,i,n,s)),this.viewer){var r=this.viewer.world.getItemCount();if(r>1)e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===r){return this.viewer.world.getItemAt(0).viewportToImageRectangle(t,i,n,s,!0)}}var a=this.viewportToImageCoordinates(o.x,o.y),l=this._viewportToImageDelta(o.width,o.height);return new e.Rect(a.x,a.y,l.x,l.y,o.degrees)},viewerElementToImageCoordinates:function(e){var t=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var i=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(i)},imageToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(t){return e.Rect.fromSummits(this.pointFromPixel(t.getTopLeft(),!0),this.pointFromPixel(t.getTopRight(),!0),this.pointFromPixel(t.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(t){return e.Rect.fromSummits(this.pixelFromPoint(t.getTopLeft(),!0),this.pixelFromPoint(t.getTopRight(),!0),this.pixelFromPoint(t.getBottomLeft(),!0))},windowToViewportCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var i=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(i)},viewportToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===i){return this.viewer.world.getItemAt(0).viewportToImageZoom(t)}}var n=this._contentSizeNoRotate.x;return t*(this._containerInnerSize.x/n*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===i){return this.viewer.world.getItemAt(0).imageToViewportZoom(t)}}return t*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(e){return this.flipped===e||(this.flipped=e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:e})),this}}}(OpenSeadragon),function(e){function t(e,t,n,s,o,r,l,h,c){var u=l.getBoundingBox().getTopLeft(),d=l.getBoundingBox().getBottomRight();e.viewer&&e.viewer.raiseEvent("update-level",{tiledImage:e,havedrawn:t,level:s,opacity:o,visibility:r,drawArea:l,topleft:u,bottomright:d,currenttime:h,best:c}),a(e.coverage,s),a(e.loadingCoverage,s);for(var p=e._getCornerTiles(s,u,d),_=p.topLeft,g=p.bottomRight,m=e.source.getNumTiles(s),v=e.viewport.pixelFromPoint(e.viewport.getCenter()),E=_.x;E<=g.x;E++)for(var f=_.y;f<=g.y;f++){if(!e.wrapHorizontal&&!e.wrapVertical){var T=e.source.getTileBounds(s,E,f);if(null===l.intersection(T))continue}c=i(e,n,t,E,f,s,o,r,v,m,h,c)}return c}function i(t,i,s,a,l,h,c,u,d,p,_,g){var m=function(t,i,n,s,o,r,a,l,h,c){var u,d,p,_,g,m,v,E,f;return r[n]||(r[n]={}),r[n][t]||(r[n][t]={}),r[n][t][i]||(u=(l.x+t%l.x)%l.x,d=(l.y+i%l.y)%l.y,p=o.getTileBounds(n,u,d),_=o.getTileBounds(n,u,d,!0),g=o.tileExists(n,u,d),m=o.getTileUrl(n,u,d),s.loadTilesWithAjax?(v=o.getTileAjaxHeaders(n,u,d),e.isPlainObject(s.ajaxHeaders)&&(v=e.extend({},s.ajaxHeaders,v))):v=null,E=o.getContext2D?o.getContext2D(n,u,d):void 0,p.x+=(t-u)/l.x,p.y+=c/h*((i-d)/l.y),f=new e.Tile(n,t,i,p,g,m,E,s.loadTilesWithAjax,v,_),u===l.x-1&&(f.isRightMost=!0),d===l.y-1&&(f.isBottomMost=!0),r[n][t][i]=f),(f=r[n][t][i]).lastTouchTime=a,f}(a,l,h,t,t.source,t.tilesMatrix,_,p,t._worldWidthCurrent,t._worldHeightCurrent),v=s;t.viewer&&t.viewer.raiseEvent("update-tile",{tiledImage:t,tile:m}),r(t.coverage,h,a,l,!1);var E=m.loaded||m.loading||o(t.loadingCoverage,h,a,l);if(r(t.loadingCoverage,h,a,l,E),!m.exists||(i&&!v&&(o(t.coverage,h,a,l)?r(t.coverage,h,a,l,!0):v=!0),!v))return g;if(function(t,i,n,s,o,r){var a=t.bounds.getTopLeft();a.x*=r._scaleSpring.current.value,a.y*=r._scaleSpring.current.value,a.x+=r._xSpring.current.value,a.y+=r._ySpring.current.value;var l=t.bounds.getSize();l.x*=r._scaleSpring.current.value,l.y*=r._scaleSpring.current.value;var h=n.pixelFromPointNoRotate(a,!0),c=n.pixelFromPointNoRotate(a,!1),u=n.deltaPixelsFromPointsNoRotate(l,!0),d=n.deltaPixelsFromPointsNoRotate(l,!1),p=c.plus(d.divide(2)),_=s.squaredDistanceTo(p);i||(u=u.plus(new e.Point(1,1))),t.isRightMost&&r.wrapHorizontal&&(u.x+=.75),t.isBottomMost&&r.wrapVertical&&(u.y+=.75),t.position=h,t.size=u,t.squaredDistance=_,t.visibility=o}(m,t.source.tileOverlap,t.viewport,d,u,t),!m.loaded)if(m.context2D)n(t,m);else{var f=t._tileCache.getImageRecord(m.cacheKey);if(f)n(t,m,f.getImage())}if(m.loaded){var T=function(e,t,i,n,s,o,a){var l,h,c=1e3*e.blendTime;if(t.blendStart||(t.blendStart=a),l=a-t.blendStart,h=c?Math.min(1,l/c):1,e.alwaysBlend&&(h*=o),t.opacity=h,e.lastDrawn.push(t),1===h)r(e.coverage,s,i,n,!0),e._hasOpaqueTile=!0;else if(l<c)return!0;return!1}(t,m,a,l,h,c,_);T&&(t._needsDraw=!0)}else m.loading?t._tilesLoading++:E||(g=function(e,t){return!e||t.visibility>e.visibility||t.visibility==e.visibility&&t.squaredDistance<e.squaredDistance?t:e}(g,m));return g}function n(e,t,i,n,s){var o=0;function r(){return o++,a}function a(){0===--o&&(t.loading=!1,t.loaded=!0,t.context2D||e._tileCache.cacheTile({image:i,tile:t,cutoff:n,tiledImage:e}),e._needsDraw=!0)}e.viewer.raiseEvent("tile-loaded",{tile:t,tiledImage:e,tileRequest:s,image:i,getCompletionCallback:r}),r()()}function s(e,t,i,n){var s,o,r,a;if(!e[t])return!1;if(void 0===i||void 0===n){for(r in s=e[t])if(Object.prototype.hasOwnProperty.call(s,r))for(a in o=s[r])if(Object.prototype.hasOwnProperty.call(o,a)&&!o[a])return!1;return!0}return void 0===e[t][i]||void 0===e[t][i][n]||!0===e[t][i][n]}function o(e,t,i,n){return void 0===i||void 0===n?s(e,t+1):s(e,t+1,2*i,2*n)&&s(e,t+1,2*i,2*n+1)&&s(e,t+1,2*i+1,2*n)&&s(e,t+1,2*i+1,2*n+1)}function r(t,i,n,s,o){t[i]?(t[i][n]||(t[i][n]={}),t[i][n][s]=o):e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",i)}function a(e,t){e[t]={}}e.TiledImage=function(t){var i=this;e.console.assert(t.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(t.drawer,"[TiledImage] options.drawer is required"),e.console.assert(t.viewer,"[TiledImage] options.viewer is required"),e.console.assert(t.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(t.source,"[TiledImage] options.source is required"),e.console.assert(!t.clip||t.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=t.tileCache,delete t.tileCache,this._drawer=t.drawer,delete t.drawer,this._imageLoader=t.imageLoader,delete t.imageLoader,t.clip instanceof e.Rect&&(this._clip=t.clip.clone()),delete t.clip;var n=t.x||0;delete t.x;var s=t.y||0;delete t.y,this.normHeight=t.source.dimensions.y/t.source.dimensions.x,this.contentAspectX=t.source.dimensions.x/t.source.dimensions.y;var o=1;t.width?(o=t.width,delete t.width,t.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete t.height)):t.height&&(o=t.height/this.normHeight,delete t.height);var r=t.fitBounds;delete t.fitBounds;var a=t.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete t.fitBoundsPlacement;var l=t.degrees||0;delete t.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation},t),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:n,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:s,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:o,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),r&&this.fitBounds(r,a,!0),this._drawingHandler=function(t){i.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:i},t))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(e){e!==this._fullyLoaded&&(this._fullyLoaded=e,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var e=this._xSpring.update(),t=this._ySpring.update(),i=this._scaleSpring.update(),n=this._degreesSpring.update();return!!(e||t||i||n)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(this.getRotation(e),this._getRotationPoint(e))},getBoundsNoRotate:function(t){return t?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(t){var i=this.getBoundsNoRotate(t);if(this._clip){var n=(t?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,s=this._clip.times(n);i=new e.Rect(i.x+s.x,i.y+s.y,s.width,s.height)}return i.rotate(this.getRotation(t),this._getRotationPoint(t))},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(t,i,n){var s=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t*(this.source.dimensions.x/s),i*(this.source.dimensions.y*this.contentAspectX/s))},viewportToImageCoordinates:function(t,i,n){var s;return t instanceof e.Point?(n=i,s=t):s=new e.Point(t,i),s=s.rotate(-this.getRotation(n),this._getRotationPoint(n)),n?this._viewportToImageDelta(s.x-this._xSpring.current.value,s.y-this._ySpring.current.value):this._viewportToImageDelta(s.x-this._xSpring.target.value,s.y-this._ySpring.target.value)},_imageToViewportDelta:function(t,i,n){var s=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t/this.source.dimensions.x*s,i/this.source.dimensions.y/this.contentAspectX*s)},imageToViewportCoordinates:function(t,i,n){t instanceof e.Point&&(n=i,i=t.y,t=t.x);var s=this._imageToViewportDelta(t,i);return n?(s.x+=this._xSpring.current.value,s.y+=this._ySpring.current.value):(s.x+=this._xSpring.target.value,s.y+=this._ySpring.target.value),s.rotate(this.getRotation(n),this._getRotationPoint(n))},imageToViewportRectangle:function(t,i,n,s,o){var r=t;r instanceof e.Rect?o=i:r=new e.Rect(t,i,n,s);var a=this.imageToViewportCoordinates(r.getTopLeft(),o),l=this._imageToViewportDelta(r.width,r.height,o);return new e.Rect(a.x,a.y,l.x,l.y,r.degrees+this.getRotation(o))},viewportToImageRectangle:function(t,i,n,s,o){var r=t;t instanceof e.Rect?o=i:r=new e.Rect(t,i,n,s);var a=this.viewportToImageCoordinates(r.getTopLeft(),o),l=this._viewportToImageDelta(r.width,r.height,o);return new e.Rect(a.x,a.y,l.x,l.y,r.degrees-this.getRotation(o))},viewerElementToImageCoordinates:function(e){var t=this.viewport.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.viewport.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){var t=e.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(e){return this.imageToViewerElementCoordinates(e).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(t){var i=this._scaleSpring.current.value;return t=t.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((t.x-this._xSpring.current.value)/i,(t.y-this._ySpring.current.value)/i,t.width/i,t.height/i,t.degrees)},viewportToImageZoom:function(e){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*e},imageToViewportZoom:function(e){return e/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(e,t){var i=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(t){if(i&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y),this._needsDraw=!0}else{if(i)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y),this._needsDraw=!0}i||this._raiseBoundsChange()},setWidth:function(e,t){this._setScale(e,t)},setHeight:function(e,t){this._setScale(e/this.normHeight,t)},setCroppingPolygons:function(t){var i=function(t){return t.map((function(t){try{if(function(t){return t instanceof e.Point||"number"==typeof t.x&&"number"==typeof t.y}(t))return{x:t.x,y:t.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}}))};try{if(!e.isArray(t))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=t.map((function(e){return i(e)}))}catch(n){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(n),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(t,i,n){i=i||e.Placement.CENTER;var s=e.Placement.properties[i],o=this.contentAspectX,r=0,a=0,l=1,h=1;if(this._clip&&(o=this._clip.getAspectRatio(),l=this._clip.width/this.source.dimensions.x,h=this._clip.height/this.source.dimensions.y,t.getAspectRatio()>o?(r=this._clip.x/this._clip.height*t.height,a=this._clip.y/this._clip.height*t.height):(r=this._clip.x/this._clip.width*t.width,a=this._clip.y/this._clip.width*t.width)),t.getAspectRatio()>o){var c=t.height/h,u=0;s.isHorizontallyCentered?u=(t.width-t.height*o)/2:s.isRight&&(u=t.width-t.height*o),this.setPosition(new e.Point(t.x-r+u,t.y-a),n),this.setHeight(c,n)}else{var d=t.width/l,p=0;s.isVerticallyCentered?p=(t.height-t.width/o)/2:s.isBottom&&(p=t.height-t.width/o),this.setPosition(new e.Point(t.x-r,t.y-a+p),n),this.setWidth(d,n)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(t){e.console.assert(!t||t instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),t instanceof e.Rect?this._clip=t.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(e){e!==this.opacity&&(this.opacity=e,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(e){this._preload=!!e,this._needsDraw=!0},getRotation:function(e){return e?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(e,t){this._degreesSpring.target.value===e&&this._degreesSpring.isAtTargetValue()||(t?this._degreesSpring.resetTo(e):this._degreesSpring.springTo(e),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(e){return this.getBoundsNoRotate(e).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(e){e!==this.compositeOperation&&(this.compositeOperation=e,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(e,t){var i=this._scaleSpring.target.value===e;if(t){if(i&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e),this._updateForScale(),this._needsDraw=!0}else{if(i)return;this._scaleSpring.springTo(e),this._updateForScale(),this._needsDraw=!0}i||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var e=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),t=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,i=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(t/this.minPixelRatio)/Math.log(2))));return i=Math.max(i,this.source.minLevel||0),{lowestLevel:e=Math.min(e,i),highestLevel:i}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){this.lastDrawn.pop().beingDrawn=!1}var i=this.viewport,o=this._viewportToTiledImageRectangle(i.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var r=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(o=o.intersection(r)))return}for(var a=this._getLevelsInterval(),l=a.lowestLevel,h=a.highestLevel,c=null,u=!1,d=e.now(),p=h;p>=l;p--){var _=!1,g=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(p),!0).x*this._scaleSpring.current.value;if(p===l||!u&&g>=this.minPixelRatio)_=!0,u=!0;else if(!u)continue;var m=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(p),!1).x*this._scaleSpring.current.value,v=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,E=this.immediateRender?1:v;if(c=t(this,u,_,p,Math.min(1,(g-.5)/.5),E/Math.abs(E-m),o,d,c),s(this.coverage,p))break}(function(t,i){if(0!==t.opacity&&(0!==i.length||t.placeholderFillStyle)){var n,s=i[0];s&&(n=t.opacity<1||t.compositeOperation&&"source-over"!==t.compositeOperation||!t._isBottomItem()&&s._hasTransparencyChannel());var o,r,a,l=t.viewport.getZoom(!0),h=t.viewportToImageZoom(l);i.length>1&&h>t.smoothTileEdgesMinZoom&&!t.iOSDevice&&t.getRotation(!0)%360==0&&e.supportsCanvas&&(n=!0,o=s.getScaleForEdgeSmoothing(),r=s.getTranslationForEdgeSmoothing(o,t._drawer.getCanvasSize(!1),t._drawer.getCanvasSize(!0))),n&&(o||(a=t.viewport.viewportToViewerElementRectangle(t.getClippedBounds(!0)).getIntegerBoundingBox(),t._drawer.viewer.viewport.getFlip()&&(0!==t.viewport.degrees||t.getRotation(!0)%360!=0)&&(a.x=t._drawer.viewer.container.clientWidth-(a.x+a.width)),a=a.times(e.pixelDensityRatio)),t._drawer._clear(!0,a)),o||(0!==t.viewport.degrees&&t._drawer._offsetForRotation({degrees:t.viewport.degrees,useSketch:n}),t.getRotation(!0)%360!=0&&t._drawer._offsetForRotation({degrees:t.getRotation(!0),point:t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0),!0),useSketch:n}),0===t.viewport.degrees&&t.getRotation(!0)%360==0&&t._drawer.viewer.viewport.getFlip()&&t._drawer._flip());var c=!1;if(t._clip){t._drawer.saveContext(n);var u=t.imageToViewportRectangle(t._clip,!0);u=u.rotate(-t.getRotation(!0),t._getRotationPoint(!0));var d=t._drawer.viewportToDrawerRectangle(u);o&&(d=d.times(o)),r&&(d=d.translate(r)),t._drawer.setClip(d,n),c=!0}if(t._croppingPolygons){t._drawer.saveContext(n);try{var p=t._croppingPolygons.map((function(e){return e.map((function(e){var i=t.imageToViewportCoordinates(e.x,e.y,!0).rotate(-t.getRotation(!0),t._getRotationPoint(!0)),n=t._drawer.viewportCoordToDrawerCoord(i);return o&&(n=n.times(o)),n}))}));t._drawer.clipWithPolygons(p,n)}catch(v){e.console.error(v)}c=!0}if(t.placeholderFillStyle&&!1===t._hasOpaqueTile){var _=t._drawer.viewportToDrawerRectangle(t.getBounds(!0));o&&(_=_.times(o)),r&&(_=_.translate(r));var g=null;g="function"==typeof t.placeholderFillStyle?t.placeholderFillStyle(t,t._drawer.context):t.placeholderFillStyle,t._drawer.drawRectangle(_,g,n)}for(var m=i.length-1;m>=0;m--)s=i[m],t._drawer.drawTile(s,t._drawingHandler,n,o,r),s.beingDrawn=!0,t.viewer&&t.viewer.raiseEvent("tile-drawn",{tiledImage:t,tile:s});c&&t._drawer.restoreContext(n),o||(t.getRotation(!0)%360!=0&&t._drawer._restoreRotationChanges(n),0!==t.viewport.degrees&&t._drawer._restoreRotationChanges(n)),n&&(o&&(0!==t.viewport.degrees&&t._drawer._offsetForRotation({degrees:t.viewport.degrees,useSketch:!1}),t.getRotation(!0)%360!=0&&t._drawer._offsetForRotation({degrees:t.getRotation(!0),point:t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0),!0),useSketch:!1})),t._drawer.blendSketch({opacity:t.opacity,scale:o,translate:r,compositeOperation:t.compositeOperation,bounds:a}),o&&(t.getRotation(!0)%360!=0&&t._drawer._restoreRotationChanges(!1),0!==t.viewport.degrees&&t._drawer._restoreRotationChanges(!1))),o||0===t.viewport.degrees&&t.getRotation(!0)%360==0&&t._drawer.viewer.viewport.getFlip()&&t._drawer._flip(),function(t,i){if(t.debugMode)for(var n=i.length-1;n>=0;n--){var s=i[n];try{t._drawer.drawDebugInfo(s,i.length,n,t)}catch(o){e.console.error(o)}}}(t,i)}})(this,this.lastDrawn),c&&!c.context2D?(function(t,i,s){i.loading=!0,t._imageLoader.addJob({src:i.url,loadWithAjax:i.loadWithAjax,ajaxHeaders:i.ajaxHeaders,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,callback:function(o,r,a){!function(t,i,s,o,r,a){if(!o)return e.console.log("Tile %s failed to load: %s - error: %s",i,i.url,r),t.viewer.raiseEvent("tile-load-failed",{tile:i,tiledImage:t,time:s,message:r,tileRequest:a}),i.loading=!1,void(i.exists=!1);if(s<t.lastResetTime)return e.console.log("Ignoring tile %s loaded before reset: %s",i,i.url),void(i.loading=!1);var l=function(){var e=t.source.getClosestLevel();n(t,i,o,e,a)};t._midDraw?window.setTimeout(l,1):l()}(t,i,s,o,r,a)},abort:function(){i.loading=!1}})}(this,c,d),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(t,i,n){var s,o;this.wrapHorizontal?(s=e.positiveModulo(i.x,1),o=e.positiveModulo(n.x,1)):(s=Math.max(0,i.x),o=Math.min(1,n.x));var r,a,l=1/this.source.aspectRatio;this.wrapVertical?(r=e.positiveModulo(i.y,l),a=e.positiveModulo(n.y,l)):(r=Math.max(0,i.y),a=Math.min(l,n.y));var h=this.source.getTileAtPoint(t,new e.Point(s,r)),c=this.source.getTileAtPoint(t,new e.Point(o,a)),u=this.source.getNumTiles(t);return this.wrapHorizontal&&(h.x+=u.x*Math.floor(i.x),c.x+=u.x*Math.floor(n.x)),this.wrapVertical&&(h.y+=u.y*Math.floor(i.y/l),c.y+=u.y*Math.floor(n.y/l)),{topLeft:h,bottomRight:c}}})}(OpenSeadragon),function(e){var t=function(t){e.console.assert(t,"[TileCache.cacheTile] options is required"),e.console.assert(t.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(t.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=t.tile,this.tiledImage=t.tiledImage},i=function(t){e.console.assert(t,"[ImageRecord] options is required"),e.console.assert(t.image,"[ImageRecord] options.image is required"),this._image=t.image,this._tiles=[]};i.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var e=document.createElement("canvas");e.width=this._image.width,e.height=this._image.height,this._renderedContext=e.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(t){e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=t},addTile:function(t){e.console.assert(t,"[ImageRecord.addTile] tile is required"),this._tiles.push(t)},removeTile:function(t){for(var i=0;i<this._tiles.length;i++)if(this._tiles[i]===t)return void this._tiles.splice(i,1);e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",t)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(t){t=t||{},this._maxImageCacheCount=t.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(n){e.console.assert(n,"[TileCache.cacheTile] options is required"),e.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(n.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var s=n.cutoff||0,o=this._tilesLoaded.length,r=this._imagesLoaded[n.tile.cacheKey];if(r||(e.console.assert(n.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),r=this._imagesLoaded[n.tile.cacheKey]=new i({image:n.image}),this._imagesLoadedCount++),r.addTile(n.tile),n.tile.cacheImageRecord=r,this._imagesLoadedCount>this._maxImageCacheCount){for(var a,l,h,c,u,d,p=null,_=-1,g=null,m=this._tilesLoaded.length-1;m>=0;m--)if(!((a=(d=this._tilesLoaded[m]).tile).level<=s||a.beingDrawn)){if(!p){p=a,_=m,g=d;continue}c=a.lastTouchTime,l=p.lastTouchTime,u=a.level,h=p.level,(c<l||c==l&&u>h)&&(p=a,_=m,g=d)}p&&_>=0&&(this._unloadTile(g),o=_)}this._tilesLoaded[o]=new t({tile:n.tile,tiledImage:n.tiledImage})},clearTilesFor:function(t){e.console.assert(t,"[TileCache.clearTilesFor] tiledImage is required");for(var i,n=0;n<this._tilesLoaded.length;++n)(i=this._tilesLoaded[n]).tiledImage===t&&(this._unloadTile(i),this._tilesLoaded.splice(n,1),n--)},getImageRecord:function(t){return e.console.assert(t,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[t]},_unloadTile:function(t){e.console.assert(t,"[TileCache._unloadTile] tileRecord is required");var i=t.tile,n=t.tiledImage;i.unload(),i.cacheImageRecord=null;var s=this._imagesLoaded[i.cacheKey];s.removeTile(i),s.getTileCount()||(s.destroy(),delete this._imagesLoaded[i.cacheKey],this._imagesLoadedCount--),n.viewer.raiseEvent("tile-unloaded",{tile:i,tiledImage:n})}}}(OpenSeadragon),function(e){e.World=function(t){var i=this;e.console.assert(t.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=t.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(e){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(t,i){if(e.console.assert(t,"[World.addItem] item is required"),e.console.assert(t instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(i=i||{}).index){var n=Math.max(0,Math.min(this._items.length,i.index));this._items.splice(n,0,t)}else this._items.push(t);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,t.addHandler("bounds-change",this._delegatedFigureSizes),t.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:t})},getItemAt:function(t){return e.console.assert(void 0!==t,"[World.getItemAt] index is required"),this._items[t]},getIndexOfItem:function(t){return e.console.assert(t,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,t)},getItemCount:function(){return this._items.length},setItemIndex:function(t,i){e.console.assert(t,"[World.setItemIndex] item is required"),e.console.assert(void 0!==i,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(t);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i===n||-1===n||(this._items.splice(n,1),this._items.splice(i,0,t),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:t,previousIndex:n,newIndex:i}))},removeItem:function(t){e.console.assert(t,"[World.removeItem] item is required");var i=e.indexOf(this._items,t);-1!==i&&(t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(t))},removeAll:function(){var e,t;for(this.viewer._cancelPendingImages(),t=0;t<this._items.length;t++)(e=this._items[t]).removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy();var i=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,t=0;t<i.length;t++)e=i[t],this._raiseRemoveItem(e)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(){for(var e=!1,t=0;t<this._items.length;t++)e=this._items[t].update()||e;return e},draw:function(){for(var e=0;e<this._items.length;e++)this._items[e].draw();this._needsDraw=!1},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){this._autoRefigureSizes=e,e&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(t){var i,n=(t=t||{}).immediately||!1,s=t.layout||e.DEFAULT_SETTINGS.collectionLayout,o=t.rows||e.DEFAULT_SETTINGS.collectionRows,r=t.columns||e.DEFAULT_SETTINGS.collectionColumns,a=t.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,l=a+(t.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin);i=!t.rows&&r?r:Math.ceil(this._items.length/o);var h,c,u,d,p,_=0,g=0;this.setAutoRefigureSizes(!1);for(var m=0;m<this._items.length;m++)m&&m%i==0&&("horizontal"===s?(g+=l,_=0):(_+=l,g=0)),d=(u=(c=(h=this._items[m]).getBounds()).width>c.height?a:a*(c.width/c.height))*(c.height/c.width),p=new e.Point(_+(a-u)/2,g+(a-d)/2),h.setPosition(p,n),h.setWidth(u,n),"horizontal"===s?_+=l:g+=l;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var t=this._homeBounds?this._homeBounds.clone():null,i=this._contentSize?this._contentSize.clone():null,n=this._contentFactor||0;if(this._items.length){var s=this._items[0],o=s.getBounds();this._contentFactor=s.getContentSize().x/o.width;for(var r=s.getClippedBounds().getBoundingBox(),a=r.x,l=r.y,h=r.x+r.width,c=r.y+r.height,u=1;u<this._items.length;u++)o=(s=this._items[u]).getBounds(),this._contentFactor=Math.max(this._contentFactor,s.getContentSize().x/o.width),r=s.getClippedBounds().getBoundingBox(),a=Math.min(a,r.x),l=Math.min(l,r.y),h=Math.max(h,r.x+r.width),c=Math.max(c,r.y+r.height);this._homeBounds=new e.Rect(a,l,h-a,c-l),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;(this._contentFactor!==n||!this._homeBounds.equals(t)||!this._contentSize.equals(i))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})}(OpenSeadragon)})),oi=(0,_chunk_YAXTLTJC_js__WEBPACK_IMPORTED_MODULE_10__.b)(((e,t)=>{var i,n;i=window,n=function(e){return function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i||4&i&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var s in e)t.d(n,s,function(t){return e[t]}.bind(null,s));return n},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(t){t.exports=e},function(e,t,i){i.r(t);var n=i(0),s=i.n(n);t.default=function(e,t){if(!e.version||1>e.version.major)throw new Error("OpenSeadragonViewerInputHook requires OpenSeadragon version 1.0.0+");return e.Viewer.prototype.addViewerInputHook=function(e){return(e=e||{}).viewer=this,new t.ViewerInputHook(e)},t.ViewerInputHook=function(e){var t,i;for((e=e||{}).hooks=e.hooks||[],this.viewer=e.viewer||null,this.viewerTrackers={},this.hooks=[],this.viewer&&(this.viewerTrackers.viewer=this.viewer.innerTracker,this.viewerTrackers.viewer_outer=this.viewer.outerTracker),t=0;t<e.hooks.length;t++){if("string"==typeof e.hooks[t].tracker){if(!this.viewer)throw new Error("A viewer must be specified.");if(void 0===(i=this.viewerTrackers[e.hooks[t].tracker]))throw new Error("Unknown tracker specified: "+e.hooks[t].tracker)}else i=e.hooks[t].tracker;this.hooks.push({tracker:i,handlerName:e.hooks[t].handler,origHandler:i[e.hooks[t].handler],hookHandler:e.hooks[t].hookHandler}),function(e,t,i,n){var s=t[i];t[i]=function(t){return e._callHandlers(n,s,t)}}(this,i,e.hooks[t].handler,e.hooks[t].hookHandler)}},t.ViewerInputHook.version={versionStr:"2.2.1",major:2,minor:2,revision:1},t.ViewerInputHook.prototype._callHandlers=function(e,t,i){var n=e(i);return t&&!i.stopHandlers&&(n=t(i)),!i.stopBubbling&&n},t.ViewerInputHook.prototype.destroy=function(){for(;0<this.hooks.length;){var e=this.hooks.pop();e.tracker[e.handlerName]=e.origHandler}this.viewer&&(delete this.viewerTrackers.viewer,delete this.viewerTrackers.viewer_outer,this.viewer=null)},t.ViewerInputHook}(s.a||window.OpenSeadragon,window.OpenSeadragonImaging=window.OpenSeadragonImaging||{})}]).default},"object"==typeof e&&"object"==typeof t?t.exports=n(Ke()):"function"==typeof define&&__webpack_require__.amdO?define(["openseadragon"],n):"object"==typeof e?e["openseadragon-viewerinputhook"]=n(Ke()):i["openseadragon-viewerinputhook"]=n(i.openseadragon)})),Se=class{constructor(e,t,i,n){this.x=e,this.y=t,this.w=i,this.h=n}toString(){return`${this.x},${this.y},${this.w},${this.h}`}static fromString(e){let t=(e=e.replace("xywh=","")).split(",");return new Se(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3]))}},Ge=class{constructor(e,t){this.x=e,this.y=t}},gt=class{constructor(){this.region=new _chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.h(0,0),this.regionPos=new Ge(0,0),this.size=new _chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.h(0,0)}},Ve=(0,_chunk_YAXTLTJC_js__WEBPACK_IMPORTED_MODULE_10__.c)((0,_chunk_76YR7XP2_js__WEBPACK_IMPORTED_MODULE_6__.c)()),fe=(0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.a)(),ft=class extends _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.b{constructor(e){super(e)}create(){this.setConfig("downloadDialogue"),super.create(),this.$settingsButton=fe('<a class="settings" href="#">'+this.content.editSettings+"</a>"),this.$pagingNote=fe('<div class="pagingNote">'+this.content.pagingNote+" </div>"),this.$pagingNote.append(this.$settingsButton),this.$content.append(this.$pagingNote),this.$imageOptionsContainer=fe('<li class="group image"></li>'),this.$downloadOptions.append(this.$imageOptionsContainer),this.$imageOptions=fe("<ul></ul>"),this.$imageOptionsContainer.append(this.$imageOptions),this.$currentViewAsJpgButton=fe('<li class="option single"><input id="'+_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.CURRENT_VIEW+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.CURRENT_VIEW+'"></label></li>'),this.$imageOptions.append(this.$currentViewAsJpgButton),this.$currentViewAsJpgButton.hide(),this.$wholeImageHighResButton=fe('<li class="option single"><input id="'+_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGE_HIGH_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGE_HIGH_RES+'label" for="'+_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGE_HIGH_RES+'"></label></li>'),this.$imageOptions.append(this.$wholeImageHighResButton),this.$wholeImageHighResButton.hide(),this.$wholeImagesHighResButton=fe('<li class="option multiple"><input id="'+_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGES_HIGH_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGES_HIGH_RES+'label" for="'+_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGES_HIGH_RES+'"></label></li>'),this.$imageOptions.append(this.$wholeImagesHighResButton),this.$wholeImageHighResButton.hide(),this.$wholeImageLowResAsJpgButton=fe('<li class="option single"><input id="'+_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGE_LOW_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGE_LOW_RES+'">'+this.content.wholeImageLowResAsJpg+"</label></li>"),this.$imageOptions.append(this.$wholeImageLowResAsJpgButton),this.$wholeImageLowResAsJpgButton.hide(),this.$canvasOptionsContainer=fe('<li class="group canvas"></li>'),this.$downloadOptions.append(this.$canvasOptionsContainer),this.$canvasOptions=fe("<ul></ul>"),this.$canvasOptionsContainer.append(this.$canvasOptions),this.$manifestOptionsContainer=fe('<li class="group manifest"></li>'),this.$downloadOptions.append(this.$manifestOptionsContainer),this.$manifestOptions=fe("<ul></ul>"),this.$manifestOptionsContainer.append(this.$manifestOptions),this.$selectionButton=fe('<li class="option"><input id="'+_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.SELECTION+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.SELECTION+'label" for="'+_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.SELECTION+'"></label></li>'),this.$manifestOptions.append(this.$selectionButton),this.$selectionButton.hide(),this.$downloadButton=fe('<a class="btn btn-primary" href="#" tabindex="0">'+this.content.download+"</a>"),this.$buttons.prepend(this.$downloadButton),this.$explanatoryTextTemplate=fe('<span class="explanatory"></span>');let e=this;this.$downloadButton.on("click",(t=>{t.preventDefault();let i=e.getSelectedOption(),n=i.attr("id"),s=i.attr("title"),o=i.data("mime"),r=_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.UNKNOWN,a=this.extension.helper.getCurrentCanvas();if(this.renderingUrls[n])o&&(-1!==o.toLowerCase().indexOf("pdf")?r=_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.ENTIRE_DOCUMENT_AS_PDF:-1!==o.toLowerCase().indexOf("txt")&&(r=_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.ENTIRE_DOCUMENT_AS_TEXT)),(r=_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.ENTIRE_DOCUMENT_AS_PDF)&&window.open(this.renderingUrls[n]);else switch(r=n,r){case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.CURRENT_VIEW:let t=e.extension.getViewer();window.open(e.extension.getCroppedImageUri(a,t));break;case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.SELECTION:_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.a.waitFor((()=>!this.isActive),(()=>{this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.SHOW_MULTISELECT_DIALOGUE)}));break;case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGE_HIGH_RES:window.open(this.getCanvasHighResImageUri(this.extension.helper.getCurrentCanvas()));break;case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGES_HIGH_RES:let i=this.extension.getPagedIndices();for(let e=0;e<i.length;e++)window.open(this.getCanvasHighResImageUri(this.extension.helper.getCanvasByIndex(i[e])));break;case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGE_LOW_RES:let n=e.extension.getConfinedImageUri(a,e.options.confinedImageSize);n&&window.open(n)}this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.DOWNLOAD,{type:r,label:s}),this.close()})),this.$settingsButton.onPressed((()=>{this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.HIDE_DOWNLOAD_DIALOGUE),this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.SHOW_SETTINGS_DIALOGUE)}))}open(e){super.open(e);let t=this.extension.helper.getCurrentCanvas(),i=this.extension.getViewerRotation()%180==0;if(this.isDownloadOptionAvailable(_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.CURRENT_VIEW)){let e=this.$currentViewAsJpgButton.find("input"),n=this.$currentViewAsJpgButton.find("label"),s=this.content.currentViewAsJpg,o=this.extension.getViewer(),r=this.extension.getCroppedImageDimensions(t,o);if(r?(s=i?_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(s,r.size.width.toString(),r.size.height.toString()):_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(s,r.size.height.toString(),r.size.width.toString()),n.text(s),e.prop("title",s),this.$currentViewAsJpgButton.data("width",r.size.width),this.$currentViewAsJpgButton.data("height",r.size.height),this.$currentViewAsJpgButton.show()):this.$currentViewAsJpgButton.hide(),_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let e=this.content.currentViewAsJpgExplanation;if(e){let t=this.$explanatoryTextTemplate.clone();t.text(e),n.append(t)}}}else this.$currentViewAsJpgButton.hide();if(this.isDownloadOptionAvailable(_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGE_HIGH_RES)){let e=this.$wholeImageHighResButton.find("input"),n=this.$wholeImageHighResButton.find("label"),s=this.getCanvasMimeType(this.extension.helper.getCurrentCanvas());s=s?_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.e.simplifyMimeType(s):"?";let o=this.getCanvasComputedDimensions(this.extension.helper.getCurrentCanvas());if(o){let t=i?_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(this.content.wholeImageHighRes,o.width.toString(),o.height.toString(),s):_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(this.content.wholeImageHighRes,o.height.toString(),o.width.toString(),s);n.text(t),e.prop("title",t),this.$wholeImageHighResButton.data("width",o.width),this.$wholeImageHighResButton.data("height",o.height),this.$wholeImageHighResButton.show()}else if(t.externalResource&&!t.externalResource.hasServiceDescriptor()){let t=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(this.content.wholeImageHighRes,"?","?",s);n.text(t),e.prop("title",t),this.$wholeImageHighResButton.show()}else this.$wholeImageHighResButton.hide();if(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let e=this.content.wholeImageHighResExplanation;if(e){let t=this.$explanatoryTextTemplate.clone();t.text(e),n.append(t)}}}else this.$wholeImageHighResButton.hide();if(this.isDownloadOptionAvailable(_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGES_HIGH_RES)){let e=this.$wholeImagesHighResButton.find("input"),t=this.$wholeImagesHighResButton.find("label"),i=this.getCanvasMimeType(this.extension.helper.getCurrentCanvas());i=i?_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.e.simplifyMimeType(i):"?";let n=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(this.content.wholeImagesHighRes,i);if(t.text(n),e.prop("title",n),this.$wholeImagesHighResButton.show(),_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let e=this.content.wholeImagesHighResExplanation;if(e){let i=this.$explanatoryTextTemplate.clone();i.text(e),t.append(i)}}}else this.$wholeImagesHighResButton.hide();if(this.isDownloadOptionAvailable(_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGE_LOW_RES)){let e=this.$wholeImageLowResAsJpgButton.find("input"),n=this.$wholeImageLowResAsJpgButton.find("label"),s=this.extension.getConfinedImageDimensions(t,this.options.confinedImageSize),o=i?_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(this.content.wholeImageLowResAsJpg,s.width.toString(),s.height.toString()):_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(this.content.wholeImageLowResAsJpg,s.height.toString(),s.width.toString());if(n.text(o),e.prop("title",o),this.$wholeImageLowResAsJpgButton.data("width",s.width),this.$wholeImageLowResAsJpgButton.data("height",s.height),this.$wholeImageLowResAsJpgButton.show(),_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let e=this.content.wholeImageLowResAsJpgExplanation;if(e){let t=this.$explanatoryTextTemplate.clone();t.text(e),n.append(t)}}}else this.$wholeImageLowResAsJpgButton.hide();if(this.isDownloadOptionAvailable(_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.SELECTION)){let e=this.$selectionButton.find("input"),t=this.$selectionButton.find("label");if(t.text(this.content.downloadSelection),e.prop("title",this.content.downloadSelection),this.$selectionButton.show(),_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let e=this.content.selectionExplanation;if(e){let i=this.$explanatoryTextTemplate.clone();i.text(e),t.append(i)}}}else this.$selectionButton.hide();if(this.resetDynamicDownloadOptions(),this.isDownloadOptionAvailable(_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.RANGE_RENDERINGS)&&t.ranges&&t.ranges.length)for(let s=0;s<t.ranges.length;s++){let e=t.ranges[s],i=this.getDownloadOptionsForRenderings(e,this.content.entireFileAsOriginal,_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.CANVAS_RENDERINGS);this.addDownloadOptionsForRenderings(i)}if(this.isDownloadOptionAvailable(_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.IMAGE_RENDERINGS)){let e=t.getImages();for(let t=0;t<e.length;t++){let i=this.getDownloadOptionsForRenderings(e[t].getResource(),this.content.entireFileAsOriginal,_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.IMAGE_RENDERINGS);this.addDownloadOptionsForRenderings(i)}}if(this.isDownloadOptionAvailable(_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.CANVAS_RENDERINGS)){let e=this.getDownloadOptionsForRenderings(t,this.content.entireFileAsOriginal,_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.CANVAS_RENDERINGS);this.addDownloadOptionsForRenderings(e)}if(this.isDownloadOptionAvailable(_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.MANIFEST_RENDERINGS)){let e=this.getDownloadOptionsForRenderings(this.extension.helper.getCurrentSequence(),this.content.entireDocument,_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.MANIFEST_RENDERINGS);!e.length&&this.extension.helper.manifest&&(e=this.getDownloadOptionsForRenderings(this.extension.helper.manifest,this.content.entireDocument,_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.MANIFEST_RENDERINGS)),this.addDownloadOptionsForRenderings(e)}if(this.isDownloadOptionAvailable(_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.CURRENT_VIEW)){let e=parseInt(this.$currentViewAsJpgButton.data("width").toString()),t=parseInt(this.$currentViewAsJpgButton.data("height").toString()),i=e/parseInt(this.$wholeImageHighResButton.data("width").toString())*100,n=t/parseInt(this.$wholeImageHighResButton.data("height").toString())*100,s=this.options.currentViewDisabledPercentage;i>=s&&n>=s?this.$currentViewAsJpgButton.hide():this.$currentViewAsJpgButton.show()}let n=this.$imageOptions.find("li.single");n=n.sort(((e,t)=>{let i=fe(e).data("width");i&&(i=parseInt(i.toString()));let n=fe(e).data("height");n&&(n=parseInt(n.toString()));let s=fe(t).data("width");s&&(s=parseInt(s.toString()));let o=fe(t).data("height");o&&(o=parseInt(o.toString()));let r=i*n,a=s*o;return r<a?-1:r>a?1:0})),n.detach().appendTo(this.$imageOptions),this.$downloadOptions.find("li.group").each(((e,t)=>{let i=fe(t);i.show(),i.find("li.option:hidden").length===i.find("li.option").length&&i.hide()})),this.$downloadOptions.find("li.group:visible").last().addClass("lastVisible"),this.extension.isPagingSettingEnabled()&&this.config.options.downloadPagingNoteEnabled?this.$pagingNote.show():this.$pagingNote.hide(),this.$downloadOptions.find("li.option:visible").length?(this.$downloadOptions.find("li.option input:visible:first").prop("checked",!0),this.$noneAvailable.hide(),this.$downloadButton.show()):(this.$noneAvailable.show(),this.$downloadButton.hide()),this.resize()}addDownloadOptionsForRenderings(e){e.forEach((e=>{switch(e.type){case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.IMAGE_RENDERINGS:this.$imageOptions.append(e.button);break;case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.CANVAS_RENDERINGS:this.$canvasOptions.append(e.button);break;case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.MANIFEST_RENDERINGS:this.$manifestOptions.append(e.button)}}))}getCanvasImageResource(e){let t=e.getImages();return t[0]?t[0].getResource():null}getCanvasHighResImageUri(e){let t=this.getCanvasComputedDimensions(e);if(t){let i=t.width,n=e.getCanonicalImageUri(i);if(e.externalResource&&e.externalResource.hasServiceDescriptor()){let e=n.split("/"),t=this.extension.getViewerRotation();e[e.length-2]=String(t),n=e.join("/")}return n}return e.externalResource&&!e.externalResource.hasServiceDescriptor()?e.externalResource.dataUri:""}getCanvasMimeType(e){let t=this.getCanvasImageResource(e);if(t){let e=t.getFormat();if(e)return e.toString()}return null}getCanvasDimensions(e){if(e.externalResource.data){let t=e.externalResource.data.width,i=e.externalResource.data.height;if(t&&i)return new Ve.Size(t,i)}return null}getCanvasComputedDimensions(e){let t=this.getCanvasDimensions(e),i=e.getMaxDimensions();if(!t)return null;if(!i||t.width<=i.width&&t.height<=i.height)return t;let n=i.width/t.width,s=i.height/t.height,o=Math.min(n,s);return new Ve.Size(Math.floor(t.width*o),Math.floor(t.height*o))}_isLevel0(e){return!(!e||!e.length)&&Ve.Utils.isLevel0ImageProfile(e[0])}isDownloadOptionAvailable(e){if(!this.extension.resources)return!1;let t=this.extension.helper.getCurrentCanvas();if(!t.externalResource.hasServiceDescriptor()||this._isLevel0(t.externalResource.data.profile))return!(e!==_chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGE_HIGH_RES||!(!this.extension.isPagingSettingEnabled()||this.extension.isPagingSettingEnabled()&&this.extension.resources&&1===this.extension.resources.length));switch(e){case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.CURRENT_VIEW:case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.CANVAS_RENDERINGS:case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.IMAGE_RENDERINGS:case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGE_HIGH_RES:if(!this.extension.isPagingSettingEnabled()||this.extension.isPagingSettingEnabled()&&this.extension.resources&&1===this.extension.resources.length){let e=t.getMaxDimensions();return!e||e.width<=this.options.maxImageWidth}return!1;case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGES_HIGH_RES:return!!(this.extension.isPagingSettingEnabled()&&this.extension.resources&&this.extension.resources.length>1);case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.WHOLE_IMAGE_LOW_RES:let i=this.getCanvasComputedDimensions(t);return!!i&&(!this.extension.isPagingSettingEnabled()&&i.width>this.options.confinedImageSize);case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.SELECTION:return this.options.selectionEnabled;case _chunk_OVW6INCV_js__WEBPACK_IMPORTED_MODULE_4__.a.RANGE_RENDERINGS:return!(!t.ranges||!t.ranges.length)&&t.ranges[0].getRenderings().length>0;default:return super.isDownloadOptionAvailable(e)}}},ci=(0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.a)(),mt=class extends _chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.d{constructor(e){super(e)}create(){this.setConfig("externalContentDialogue"),super.create(),this.openCommand=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.SHOW_EXTERNALCONTENT_DIALOGUE,this.closeCommand=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.HIDE_EXTERNALCONTENT_DIALOGUE,this.extensionHost.subscribe(this.openCommand,(e=>{this.open(),this.$iframe.prop("src",e.uri)})),this.extensionHost.subscribe(this.closeCommand,(()=>{this.close()})),this.$iframe=ci("<iframe></iframe>"),this.$content.append(this.$iframe),this.$element.hide()}resize(){super.resize(),this.$iframe.width(this.$content.width()),this.$iframe.height(this.$content.height())}},vt=(0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.a)(),wt=class extends _chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.h{constructor(e){super(e)}create(){this.setConfig("mobileFooterPanel"),super.create(),this.$rotateButton=vt(`\n            <button class="btn imageBtn rotate" title="${this.content.rotateRight}">\n                <i class="uv-icon-rotate" aria-hidden="true"></i>${this.content.rotateRight}\n            </button>\n        `),this.$options.prepend(this.$rotateButton),this.$zoomOutButton=vt(`\n            <button class="btn imageBtn zoomOut" title="${this.content.zoomOut}">\n                <i class="uv-icon-zoom-out" aria-hidden="true"></i>${this.content.zoomOut}\n            </button>\n        `),this.$options.prepend(this.$zoomOutButton),this.$zoomInButton=vt(`\n            <button class="btn imageBtn zoomIn" title="${this.content.zoomIn}">\n                <i class="uv-icon-zoom-in" aria-hidden="true"></i>${this.content.zoomIn}\n            </button>\n        `),this.$options.prepend(this.$zoomInButton),this.$zoomInButton.onPressed((()=>{this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.ZOOM_IN)})),this.$zoomOutButton.onPressed((()=>{this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.ZOOM_OUT)})),this.$rotateButton.onPressed((()=>{this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.ROTATE)}))}resize(){super.resize(),setTimeout((()=>{this.$options.css("left",Math.floor(this.$element.width()/2-this.$options.width()/2))}),1)}},_e=(0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.a)(),Ue=class{constructor(e,t,i,n,s=300,o=2,r=!1,a=!1){this._$element=e,this._autoCompleteFunc=t,this._delay=s,this._minChars=o,this._onSelect=n,this._parseResultsFunc=i,this._positionAbove=r,this._allowWords=a,this._$searchResultsList=_e('<ul class="autocomplete"></ul>'),this._positionAbove?this._$element.parent().prepend(this._$searchResultsList):this._$element.parent().append(this._$searchResultsList),this._$searchResultTemplate=_e('<li class="result"><a href="#" tabindex="-1"></a></li>');let l=function(){let e=0;return function(t,i){clearTimeout(e),e=setTimeout(t,i)}}(),h=this;this._$element.on("keydown",(function(e){let t=e.originalEvent,i=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.f.getCharCode(t),n=!1;(i===_chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.e.LeftArrow||i===_chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.e.RightArrow)&&(n=!0),n&&(t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation())})),this._$element.on("keyup",(function(e){if(h._getSelectedListItem().length||e.keyCode!==_chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.e.Enter){if(e.keyCode!==_chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.e.Tab){if((0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.d)(h._$searchResultsList)&&h._results.length)if(e.keyCode===_chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.e.Enter)h._searchForItem(h._getSelectedListItem());else{if(e.keyCode===_chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.e.DownArrow)return void h._setSelectedResultIndex(1);if(e.keyCode===_chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.e.UpArrow)return void h._setSelectedResultIndex(-1)}e.keyCode!==_chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.e.Enter&&l((()=>{let e=h._getTerms();e&&e.length>h._minChars&&h._searchForWords(e)?h._search(e):(h._clearResults(),h._hideResults())}),h._delay)}}else h._onSelect(h._getTerms())})),_e(document).on("mouseup",(e=>{0===this._$searchResultsList.parent().has(_e(e.target)[0]).length&&(this._clearResults(),this._hideResults())})),_e(document).on("focusin",(e=>{0===this._$searchResultsList.has(_e(e.target)[0]).length&&!this._$element.is(_e(e.target)[0])&&(this._clearResults(),this._hideResults())})),this._hideResults()}_searchForWords(e){return!(!this._allowWords&&e.includes(" "))}_getTerms(){return this._$element.val().trim()}_setSelectedResultIndex(e){let t;t=1===e?this._selectedResultIndex+1:this._selectedResultIndex-1;let i=this._$searchResultsList.find("li");t<0?t=i.length-1:t>i.length-1&&(t=0),this._selectedResultIndex=t,i.removeClass("selected");let n=i.eq(this._selectedResultIndex);n.addClass("selected");let s=n.outerHeight(!0)*this._selectedResultIndex;this._$searchResultsList.scrollTop(s)}_search(e){this._results=[],this._clearResults(),this._showResults(),this._$searchResultsList.append('<li class="loading"></li>'),this._updateListPosition();let t=this;this._autoCompleteFunc(e,(e=>{t._listResults(e)}))}_clearResults(){this._$searchResultsList.empty()}_hideResults(){this._$searchResultsList.hide()}_showResults(){this._selectedResultIndex=-1,this._$searchResultsList.show()}_updateListPosition(){this._positionAbove?this._$searchResultsList.css({top:-1*this._$searchResultsList.outerHeight(!0)}):this._$searchResultsList.css({top:this._$element.outerHeight(!0)})}_listResults(e){if(this._results=this._parseResultsFunc(e),this._clearResults(),!this._results.length)return void this._hideResults();for(let i=0;i<this._results.length;i++){let e=this._results[i],t=this._$searchResultTemplate.clone();t.find("a").text(e),this._$searchResultsList.append(t)}this._updateListPosition();let t=this;this._$searchResultsList.find("li").each(((e,i)=>{_e(i).on("click",(function(e){e.preventDefault(),t._searchForItem(_e(this))}))}))}_searchForItem(e){let t=e.find("a").text();this._$element.val(t),this._hideResults(),this._onSelect(t),this._clearResults(),this._hideResults()}_getSelectedListItem(){return this._$searchResultsList.find("li.selected")}},xt=(0,_chunk_YAXTLTJC_js__WEBPACK_IMPORTED_MODULE_10__.c)((0,_chunk_76YR7XP2_js__WEBPACK_IMPORTED_MODULE_6__.c)()),oe=(0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.a)(),yt=class extends _chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.h{constructor(e){super(e),this.placemarkerTouched=!1}create(){this.setConfig("searchFooterPanel"),super.create(),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,(()=>{this.canvasIndexChanged(),this.setCurrentSearchResultPlacemarker(),this.updatePrevButton(),this.updateNextButton()})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CLEAR_ANNOTATIONS,(()=>{this.clearSearchResults()})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.MODE_CHANGE,(()=>{this.settingsChanged()})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.SEARCH,(e=>{this.terms=e})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATIONS,(e=>{e.annotations.length&&(this.displaySearchResults(e.annotations,e.terms),this.setCurrentSearchResultPlacemarker(),this.updatePrevButton(),this.updateNextButton())})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATIONS_EMPTY,(()=>{this.hideSearchSpinner()})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATION_CHANGE,(()=>{this.updatePrevButton(),this.updateNextButton()})),this.$printButton=oe(`\n          <button class="print btn imageBtn" title="${this.content.print}" tabindex="0">\n            <i class="uv-icon uv-icon-print" aria-hidden="true"></i>${this.content.print}\n          </button>\n        `),this.$options.prepend(this.$printButton),this.$searchContainer=oe('<div class="search"></div>'),this.$element.prepend(this.$searchContainer),this.$searchOptions=oe('<div class="searchOptions"></div>'),this.$searchContainer.append(this.$searchOptions),this.$searchLabel=oe('<label class="label" for="searchWithinInput">'+this.content.searchWithin+"</label>"),this.$searchOptions.append(this.$searchLabel),this.$searchTextContainer=oe('<div class="searchTextContainer"></div>'),this.$searchOptions.append(this.$searchTextContainer),this.$searchText=oe('<input class="searchText" id="searchWithinInput" autocomplete="off" type="text" maxlength="100" value="'+this.content.enterKeyword+'" aria-label="'+this.content.searchWithin+'"/>'),this.$searchTextContainer.append(this.$searchText),this.$searchButton=oe('<button class="imageButton searchButton"></button>'),this.$searchTextContainer.append(this.$searchButton),this.$searchPagerContainer=oe('<div class="searchPager"></div>'),this.$element.prepend(this.$searchPagerContainer),this.$searchPagerControls=oe('<div class="controls"></div>'),this.$searchPagerContainer.prepend(this.$searchPagerControls),this.$previousResultButton=oe('<button class="previousResult">'+this.content.previousResult+"</button>"),this.$searchPagerControls.append(this.$previousResultButton),this.$searchResultsInfo=oe('<div class="searchResultsInfo"><span class="info"><span class="number">x</span> <span class="foundFor"></span> \'<span class="terms">y</span>\'</span></div>'),this.$searchPagerControls.append(this.$searchResultsInfo),this.$clearSearchResultsButton=oe('<button class="clearSearch">'+this.content.clearSearch+"</button>"),this.$searchResultsInfo.append(this.$clearSearchResultsButton),this.$nextResultButton=oe('<button class="nextResult">'+this.content.nextResult+"</button>"),this.$searchPagerControls.append(this.$nextResultButton),this.$searchResultsContainer=oe('<div class="searchResults"></div>'),this.$element.prepend(this.$searchResultsContainer),this.$line=oe('<div class="line"></div>'),this.$searchResultsContainer.append(this.$line),this.$pagePositionMarker=oe('<div class="positionPlacemarker"></div>'),this.$searchResultsContainer.append(this.$pagePositionMarker),this.$pagePositionLabel=oe('<div class="label"></div>'),this.$searchResultsContainer.append(this.$pagePositionLabel),this.$placemarkerDetails=oe('<div class="placeMarkerDetails"></div>'),this.$searchResultsContainer.append(this.$placemarkerDetails),this.$placemarkerDetailsTop=oe('<div role="heading" class="heading"></div>'),this.$placemarkerDetails.append(this.$placemarkerDetailsTop),this.$placemarkerDetailsBottom=oe("<p></p>"),this.$placemarkerDetails.append(this.$placemarkerDetailsBottom),this.$searchPagerContainer.hide(),this.$placemarkerDetails.hide();var e=this;this.$searchButton.on("click",(e=>{e.preventDefault(),this.search(this.$searchText.val())})),this.$searchText.on("focus",(()=>{this.$searchText.val()===this.content.enterKeyword&&this.$searchText.val("")})),this.$placemarkerDetails.on("mouseover",(()=>{e.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.SEARCH_PREVIEW_START,this.currentPlacemarkerIndex)})),this.$placemarkerDetails.on("mouseleave",(function(){oe(this).hide(),e.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.SEARCH_PREVIEW_FINISH),e.getSearchResultPlacemarkers().removeClass("hover")})),this.onAccessibleClick(this.$placemarkerDetails,(()=>{e.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,this.currentPlacemarkerIndex)})),this.$previousResultButton.on("click",(t=>{t.preventDefault(),this.isPreviousButtonEnabled()&&e.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PREV_SEARCH_RESULT)})),this.$nextResultButton.on("click",(t=>{t.preventDefault(),this.isNextButtonEnabled()&&e.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.NEXT_SEARCH_RESULT)})),this.$clearSearchResultsButton.on("click",(t=>{t.preventDefault(),e.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CLEAR_ANNOTATIONS)})),this.isSearchEnabled()||(this.$searchContainer.hide(),this.$searchPagerContainer.hide(),this.$searchResultsContainer.hide(),this.$element.addClass("min")),1===this.extension.helper.getTotalCanvases()&&this.$searchResultsContainer.hide();let t=this.extension.getAutoCompleteUri();t?new Ue(this.$searchText,((e,i)=>{fetch(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(t,e)).then((e=>e.json())).then((e=>{i(e)}))}),(e=>oe.map(e.terms,(e=>e.match))),(e=>{this.search(e)}),300,2,!0,_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.options.autocompleteAllowWords,!1)):this.$searchText.on("keyup",(t=>{t.keyCode===_chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.e.Enter&&e.search(e.$searchText.val())})),this.$printButton.onPressed((()=>{e.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PRINT)})),this.updatePrintButton(),_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.config.options.positionMarkerEnabled,!0)||(this.$pagePositionMarker.hide(),this.$pagePositionLabel.hide())}isSearchEnabled(){return this.extension.isSearchEnabled()}isZoomToSearchResultEnabled(){return _chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)}isPreviousButtonEnabled(){let e=this.extension.helper.canvasIndex,t=this.getFirstSearchResultCanvasIndex(),i=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?!(e<t)&&!(e===t&&0===i):e>t}isNextButtonEnabled(){let e=this.extension.helper.canvasIndex,t=this.getLastSearchResultCanvasIndex(),i=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?!(e>t)&&!(e===t&&i===this.getLastSearchResultRectIndex()):e<t}getSearchResults(){return this.extension.annotations}getCurrentSearchResultRectIndex(){return this.extension.getCurrentAnnotationRectIndex()}getFirstSearchResultCanvasIndex(){let e=this.getSearchResults();return e&&e.length?e[0].canvasIndex:-1}getLastSearchResultCanvasIndex(){let e=this.getSearchResults();return e&&e.length?e[e.length-1].canvasIndex:-1}getLastSearchResultRectIndex(){return this.extension.getLastAnnotationRectIndex()}updateNextButton(){let e=this.getSearchResults();e&&e.length&&(this.isNextButtonEnabled()?this.$nextResultButton.removeClass("disabled"):this.$nextResultButton.addClass("disabled"))}updatePrevButton(){let e=this.getSearchResults();e&&e.length&&(this.isPreviousButtonEnabled()?this.$previousResultButton.removeClass("disabled"):this.$previousResultButton.addClass("disabled"))}updatePrintButton(){_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.options.printEnabled,!1)?this.$printButton.show():this.$printButton.hide()}search(e){this.terms=e,""!==this.terms&&this.terms!==this.content.enterKeyword?(this.$searchText.blur(),this.showSearchSpinner(),this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.SEARCH,this.terms)):this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.emptyValue,(function(){this.$searchText.focus()}))}getSearchResultPlacemarkers(){return this.$searchResultsContainer.find(".searchResultPlacemarker")}setCurrentSearchResultPlacemarker(){this.getSearchResultPlacemarkers().parent().find(".current").removeClass("current"),oe('.searchResultPlacemarker[data-index="'+this.extension.helper.canvasIndex+'"]').addClass("current")}positionSearchResultPlacemarkers(){let e=this.getSearchResults();if(!e||!e.length)return;let t=this.getSearchResultPlacemarkers(),i=0===t.length;t.remove();let n=this.getPageLineRatio(),s=this.$line.position().top,o=this.$line.position().left,r=this;for(let a=0;a<e.length;a++){let t=e[a],l=t.canvasIndex*n,h=oe('<div class="searchResultPlacemarker" tabindex="0" data-index="'+t.canvasIndex+'"></div>');h[0].ontouchstart=function(e){r.onPlacemarkerTouchStart.call(this,r)},h.click((function(e){r.onPlacemarkerClick.call(this,r)})),h.mouseenter((function(e){r.onPlacemarkerMouseEnter.call(this,r)})),this.onAccessibleClick(h,(e=>{r.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,this.currentPlacemarkerIndex),r.onPlacemarkerMouseLeave.call(this,e,r)}),!1),h.mouseleave((function(e){r.onPlacemarkerMouseLeave.call(this,e,r)})),h.blur((function(e){r.onPlacemarkerMouseLeave.call(this,e,r)})),this.$searchResultsContainer.append(h);let c=s-h.height(),u=o+l-h.width()/2;h.css({top:c,left:u}),0===a&&i&&h.focus()}}onPlacemarkerTouchStart(e){e.placemarkerTouched=!0}onPlacemarkerClick(e){e.placemarkerTouched||(e.placemarkerTouched=!1)}onPlacemarkerMouseEnter(e){if(e.placemarkerTouched)return;let t=oe(this);t.addClass("hover");let i=parseInt(t.attr("data-index"));e.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.SEARCH_PREVIEW_START,i);let n=e.getSearchResultPlacemarkers().index(t[0]);e.currentPlacemarkerIndex=i,e.$placemarkerDetails.show();let s="{0} {1}";if(e.isPageModeEnabled()){let t=e.extension.helper.getCanvasByIndex(i),n=xt.LanguageMap.getValue(t.getLabel());!n&&e.extension.helper.manifest&&(n=e.extension.helper.manifest.options.defaultLabel),n&&(s=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(s,e.content.pageCaps,n))}else s=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(s,e.content.imageCaps,String(i+1));e.$placemarkerDetailsTop.html(s);let o=e.getSearchResults();if(o){let t=o[n],i="";e.terms&&(i=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.ellipsis(e.terms,e.options.elideDetailsTermsCount));let s=e.content.instanceFound,r=e.content.instancesFound,a="";1===t.rects.length?(a=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(s,i),e.$placemarkerDetailsBottom.html(a)):(a=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(r,String(t.rects.length),i),e.$placemarkerDetailsBottom.html(a))}let r=t.position(),a=r.top-e.$placemarkerDetails.height(),l=r.left;l<e.$placemarkerDetails.width()/2?l=0-t.width()/2:l>e.$line.width()-e.$placemarkerDetails.width()/2?l=e.$line.width()-e.$placemarkerDetails.width()+t.width()/2:l-=e.$placemarkerDetails.width()/2,e.$placemarkerDetails.css({top:a,left:l})}onPlacemarkerMouseLeave(e,t){t.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.SEARCH_PREVIEW_FINISH);let i=oe(this),n=e.toElement||e.relatedTarget,s=oe(n).closest(t.$placemarkerDetails).length;n!=t.$placemarkerDetails.get(0)&&0===s&&(t.$placemarkerDetails.hide(),i.removeClass("hover"))}setPageMarkerPosition(){if(null===this.extension.helper.canvasIndex)return;let e=this.getPageLineRatio(),t=this.$line.position().top,i=this.$line.position().left+this.extension.helper.canvasIndex*e;this.$pagePositionMarker.css({top:t,left:i});let n=this.$line.width();i+this.$pagePositionLabel.outerWidth(!0)>n?(i-=this.$pagePositionLabel.outerWidth(!0),this.$pagePositionLabel.removeClass("right"),this.$pagePositionLabel.addClass("left")):(this.$pagePositionLabel.removeClass("left"),this.$pagePositionLabel.addClass("right")),this.$pagePositionLabel.css({top:t,left:i})}clearSearchResults(){this.isSearchEnabled()&&(this.getSearchResultPlacemarkers().remove(),this.$searchText.val(this.content.enterKeyword),this.$searchContainer.show(),this.$searchPagerContainer.hide(),this.$searchText.focus())}getPageLineRatio(){let e=this.$line.width();return 1===this.extension.helper.getTotalCanvases()?0:e/(this.extension.helper.getTotalCanvases()-1)}canvasIndexChanged(){this.setPageMarkerPosition(),this.setPlacemarkerLabel()}settingsChanged(){this.setPlacemarkerLabel()}setPlacemarkerLabel(){let e=this.content.displaying,t=this.extension.helper.canvasIndex;if(this.isPageModeEnabled()){let i=this.extension.helper.getCanvasByIndex(t),n=xt.LanguageMap.getValue(i.getLabel());n||(n=this.content.defaultLabel);let s=this.extension.helper.getLastCanvasLabel(!0);s&&this.$pagePositionLabel.html(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(e,this.content.page,(0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.b)(n),(0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.b)(s)))}else this.$pagePositionLabel.html(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(e,this.content.image,String(t+1),this.extension.helper.getTotalCanvases().toString()))}isPageModeEnabled(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.b.page.toString()&&!_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.config.options.forceImageMode,!1)}showSearchSpinner(){this.$searchText.addClass("searching")}hideSearchSpinner(){this.$searchText.removeClass("searching")}displaySearchResults(e,t){if(!this.isSearchEnabled())return;this.hideSearchSpinner(),this.positionSearchResultPlacemarkers(),this.$searchContainer.hide(),this.$searchPagerControls.css({left:0});let i=this.$searchResultsInfo.find(".info"),n=i.find(".number"),s=i.find(".foundFor"),o=i.find(".terms");t?(i.show(),n.text(this.extension.getTotalAnnotationRects()),1===e.length?s.html(this.content.resultFoundFor):s.html(this.content.resultsFoundFor),o.html(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.ellipsis(t,this.options.elideResultsTermsCount)),o.prop("title",t)):i.hide(),this.$searchPagerContainer.show(),this.resize()}resize(){super.resize();let e=this.getSearchResults();e&&e.length&&this.positionSearchResultPlacemarkers(),this.setPageMarkerPosition(),this.$searchPagerContainer.width(this.$element.width());let t=this.$element.width()/2;this.$searchPagerControls.css({left:t-this.$searchPagerControls.width()/2}),this.$searchOptions.css({left:t-this.$searchOptions.outerWidth()/2})}},Qt=(0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.a)(),Et=class extends _chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.d{constructor(e){super(e)}create(){this.setConfig("multiSelectDialogue"),super.create();let e=this;this.openCommand=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.SHOW_MULTISELECT_DIALOGUE,this.closeCommand=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.HIDE_MULTISELECT_DIALOGUE,this.extensionHost.subscribe(this.openCommand,(()=>{this.open(),this.extension.helper.getMultiSelectState().setEnabled(!0),this.galleryComponent.set(this.data)})),this.extensionHost.subscribe(this.closeCommand,(()=>{this.close(),this.extension.helper.getMultiSelectState().setEnabled(!1)})),this.$title=Qt('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$title.text(this.content.title),this.$gallery=Qt('<div class="iiif-gallery-component"></div>'),this.$content.append(this.$gallery),this.data={helper:this.extension.helper,chunkedResizingThreshold:this.config.options.galleryThumbChunkedResizingThreshold,content:this.config.content,debug:!1,imageFadeInDuration:300,initialZoom:4,minLabelWidth:20,pageModeEnabled:this.isPageModeEnabled(),searchResults:[],scrollStopDuration:100,sizingEnabled:!0,thumbHeight:this.config.options.galleryThumbHeight,thumbLoadPadding:this.config.options.galleryThumbLoadPadding,thumbWidth:this.config.options.galleryThumbWidth,viewingDirection:this.extension.helper.getViewingDirection()},this.galleryComponent=new _chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.a({target:this.$gallery[0]}),this.$gallery.find("a.select").addClass("btn btn-primary"),this.galleryComponent.on("multiSelectionMade",(t=>{this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.MULTISELECTION_MADE,t),e.close()}),!1),this.$element.hide()}isPageModeEnabled(){return _chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.config.options.pageModeEnabled,!0)&&this.extension.getMode().toString()===_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.b.page.toString()}open(){super.open()}close(){super.close()}resize(){super.resize();let e=this.$gallery.find(".main"),t=this.$gallery.find(".header");e.height(this.$content.height()-this.$title.outerHeight()-this.$title.verticalMargins()-t.height())}},Tt=class{},me=(0,_chunk_YAXTLTJC_js__WEBPACK_IMPORTED_MODULE_10__.c)((0,_chunk_76YR7XP2_js__WEBPACK_IMPORTED_MODULE_6__.a)()),Ne=(0,_chunk_YAXTLTJC_js__WEBPACK_IMPORTED_MODULE_10__.c)((0,_chunk_76YR7XP2_js__WEBPACK_IMPORTED_MODULE_6__.c)()),pe=(0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.a)(),bt=class extends _chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.i{constructor(e){super(e),this.firstButtonEnabled=!1,this.lastButtonEnabled=!1,this.nextButtonEnabled=!1,this.prevButtonEnabled=!1}create(){if(this.setConfig("pagingHeaderPanel"),super.create(),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,(e=>{this.canvasIndexChanged(e)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.SETTINGS_CHANGE,(()=>{this.modeChanged(),this.updatePagingToggle()})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE_FAILED,(()=>{this.setSearchFieldValue(this.extension.helper.canvasIndex)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.LEFTPANEL_EXPAND_FULL_START,(()=>{this.openGallery()})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.LEFTPANEL_COLLAPSE_FULL_START,(()=>{this.closeGallery()})),this.$prevOptions=pe('<div class="prevOptions"></div>'),this.$centerOptions.append(this.$prevOptions),this.$firstButton=pe(`\n          <button class="btn imageBtn first" tabindex="0" title="${this.content.first}">\n            <i class="uv-icon-first" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.first}</span>\n          </button>\n        `),this.$prevOptions.append(this.$firstButton),this.$prevButton=pe(`\n          <button class="btn imageBtn prev" tabindex="0" title="${this.content.previous}">\n            <i class="uv-icon-prev" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.previous}</span>\n          </button>\n        `),this.$prevOptions.append(this.$prevButton),this.$modeOptions=pe('<div class="mode"></div>'),this.$centerOptions.append(this.$modeOptions),this.$imageModeLabel=pe('<label for="image">'+this.content.image+"</label>"),this.$modeOptions.append(this.$imageModeLabel),this.$imageModeOption=pe('<input type="radio" id="image" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$imageModeOption),this.$pageModeLabel=pe('<label for="page"></label>'),this.$modeOptions.append(this.$pageModeLabel),this.$pageModeOption=pe('<input type="radio" id="page" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$pageModeOption),this.$search=pe('<div class="search"></div>'),this.$centerOptions.append(this.$search),this.$searchText=pe('<input class="searchText" maxlength="50" type="text" tabindex="0" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$searchText),_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.options.autoCompleteBoxEnabled,!0))this.$searchText.hide(),this.$autoCompleteBox=pe('<input class="autocompleteText" type="text" maxlength="100" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$autoCompleteBox),new Ue(this.$autoCompleteBox,((e,t)=>{let i=[],n=this.extension.helper.getCanvases();if(this.isPageModeEnabled())for(let s=0;s<n.length;s++){let t=n[s],o=Ne.LanguageMap.getValue(t.getLabel());o&&o.startsWith(e)&&i.push(o)}else for(let s=0;s<n.length;s++){let t=n[s];t.index.toString().startsWith(e)&&i.push(t.index.toString())}t(i)}),(e=>e),(e=>{this.search(e)}),300,0,_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.options.autocompleteAllowWords,!1));else if(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.options.imageSelectionBoxEnabled,!0)){this.$selectionBoxOptions=pe('<div class="image-selectionbox-options"></div>'),this.$centerOptions.append(this.$selectionBoxOptions),this.$imageSelectionBox=pe('<select class="image-selectionbox" name="image-select" tabindex="0" ></select>'),this.$selectionBoxOptions.append(this.$imageSelectionBox);for(let e=0;e<this.extension.helper.getTotalCanvases();e++){let t=this.extension.helper.getCanvasByIndex(e),i=(0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.b)(Ne.LanguageMap.getValue(t.getLabel(),this.extension.helper.options.locale));this.$imageSelectionBox.append("<option value="+e+">"+i+"</option>")}this.$imageSelectionBox.change((()=>{let e=parseInt(this.$imageSelectionBox.val());this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.IMAGE_SEARCH,e)}))}this.$total=pe('<span class="total"></span>'),this.$search.append(this.$total),this.$searchButton=pe(`<a class="go btn btn-primary" tabindex="0">${this.content.go}</a>`),this.$search.append(this.$searchButton),this.$nextOptions=pe('<div class="nextOptions"></div>'),this.$centerOptions.append(this.$nextOptions),this.$nextButton=pe(`\n          <button class="btn imageBtn next" tabindex="0" title="${this.content.next}">\n            <i class="uv-icon-next" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.next}</span>\n          </button>\n        `),this.$nextOptions.append(this.$nextButton),this.$lastButton=pe(`\n          <button class="btn imageBtn last" tabindex="0" title="${this.content.last}">\n            <i class="uv-icon-last" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.last}</span>\n          </button>\n        `),this.$nextOptions.append(this.$lastButton),this.isPageModeEnabled()?(this.$pageModeOption.attr("checked","checked"),this.$pageModeOption.removeAttr("disabled"),this.$pageModeLabel.removeClass("disabled")):(this.$imageModeOption.attr("checked","checked"),this.$pageModeOption.attr("disabled","disabled"),this.$pageModeLabel.addClass("disabled")),this.extension.helper.getManifestType()===Ne.ManifestType.MANUSCRIPT?this.$pageModeLabel.text(this.content.folio):this.$pageModeLabel.text(this.content.page),this.$galleryButton=pe(`\n          <button class="btn imageBtn gallery" title="${this.content.gallery}">\n            <i class="uv-icon-gallery" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.gallery}</span>\n          </button>\n        `),this.$rightOptions.prepend(this.$galleryButton),this.$pagingToggleButtons=pe('<div class="pagingToggleButtons"></div>'),this.$rightOptions.prepend(this.$pagingToggleButtons),this.$oneUpButton=pe(`\n          <button class="btn imageBtn one-up" title="${this.content.oneUp}">\n            <i class="uv-icon-one-up" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.oneUp}</span>\n          </button>`),this.$pagingToggleButtons.append(this.$oneUpButton),this.$twoUpButton=pe(`\n          <button class="btn imageBtn two-up" title="${this.content.twoUp}">\n            <i class="uv-icon-two-up" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.twoUp}</span>\n          </button>\n        `),this.$pagingToggleButtons.append(this.$twoUpButton),this.updatePagingToggle(),this.updateGalleryButton(),this.$oneUpButton.onPressed((()=>{this.updateSettings({pagingEnabled:false}),this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PAGING_TOGGLED,false)})),this.$twoUpButton.onPressed((()=>{this.updateSettings({pagingEnabled:true}),this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PAGING_TOGGLED,true)})),this.$galleryButton.onPressed((()=>{this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.TOGGLE_EXPAND_LEFT_PANEL)})),this.setNavigationTitles(),this.setTotal();let e=this.extension.helper.getViewingDirection()||me.ViewingDirection.LEFT_TO_RIGHT;1===this.extension.helper.getTotalCanvases()&&this.$centerOptions.hide(),this.$firstButton.onPressed((()=>{switch(e.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.TOP_TO_BOTTOM:case me.ViewingDirection.BOTTOM_TO_TOP:this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.FIRST);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.LAST)}})),this.$prevButton.onPressed((()=>{switch(e.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.BOTTOM_TO_TOP:case me.ViewingDirection.TOP_TO_BOTTOM:this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.PREV);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.NEXT)}})),this.$nextButton.onPressed((()=>{switch(e.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.BOTTOM_TO_TOP:case me.ViewingDirection.TOP_TO_BOTTOM:this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.NEXT);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.PREV)}})),this.$lastButton.onPressed((()=>{switch(e.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.TOP_TO_BOTTOM:case me.ViewingDirection.BOTTOM_TO_TOP:this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.LAST);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.FIRST)}})),this.config.options.pageModeEnabled?(this.$imageModeOption.on("click",(()=>{this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.MODE_CHANGE,_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.b.image.toString())})),this.$pageModeOption.on("click",(()=>{this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.MODE_CHANGE,_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.b.page.toString())}))):(this.$imageModeOption.hide(),this.$pageModeLabel.hide(),this.$pageModeOption.hide()),this.$searchText.onEnter((()=>{this.$searchText.blur(),this.search(this.$searchText.val())})),this.$searchText.click((function(){pe(this).select()})),this.$searchButton.onPressed((()=>{this.options.autoCompleteBoxEnabled?this.search(this.$autoCompleteBox.val()):this.search(this.$searchText.val())})),!1===this.options.modeOptionsEnabled&&(this.$modeOptions.hide(),this.$centerOptions.addClass("modeOptionsDisabled")),!0===this.options.imageSelectionBoxEnabled&&!0!==this.options.autoCompleteBoxEnabled&&this.$search.hide(),!1===this.options.helpEnabled&&this.$helpButton.hide(),_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.options.pagingToggleEnabled,!0)||this.$pagingToggleButtons.hide()}openGallery(){this.$oneUpButton.removeClass("on"),this.$twoUpButton.removeClass("on"),this.$galleryButton.addClass("on")}closeGallery(){this.updatePagingToggle(),this.$galleryButton.removeClass("on")}isPageModeEnabled(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.b.page.toString()}setNavigationTitles(){this.isPageModeEnabled()?this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastPage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextPage),this.$prevButton.find("span").text(this.content.nextPage),this.$nextButton.prop("title",this.content.previousPage),this.$nextButton.find("span").text(this.content.previousPage),this.$lastButton.prop("title",this.content.firstPage),this.$lastButton.find("span").text(this.content.firstPage)):(this.$firstButton.prop("title",this.content.firstPage),this.$firstButton.find("span").text(this.content.firstPage),this.$prevButton.prop("title",this.content.previousPage),this.$prevButton.find("span").text(this.content.previousPage),this.$nextButton.prop("title",this.content.nextPage),this.$nextButton.find("span").text(this.content.nextPage),this.$lastButton.prop("title",this.content.lastPage),this.$lastButton.find("span").text(this.content.lastPage)):this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastImage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextImage),this.$prevButton.find("span").text(this.content.nextImage),this.$nextButton.prop("title",this.content.previousImage),this.$nextButton.find("span").text(this.content.previousImage),this.$lastButton.prop("title",this.content.firstImage),this.$lastButton.find("span").text(this.content.firstImage)):(this.$firstButton.prop("title",this.content.firstImage),this.$firstButton.find("span").text(this.content.firstImage),this.$prevButton.prop("title",this.content.previousImage),this.$prevButton.find("span").text(this.content.previousImage),this.$nextButton.prop("title",this.content.nextImage),this.$nextButton.find("span").text(this.content.nextImage),this.$lastButton.prop("title",this.content.lastImage),this.$lastButton.find("span").text(this.content.lastImage))}updatePagingToggle(){this.pagingToggleIsVisible()?this.extension.isPagingSettingEnabled()?(this.$oneUpButton.removeClass("on"),this.$twoUpButton.addClass("on")):(this.$twoUpButton.removeClass("on"),this.$oneUpButton.addClass("on")):this.$pagingToggleButtons.hide()}pagingToggleIsVisible(){return _chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.options.pagingToggleEnabled,!0)&&this.extension.helper.isPagingAvailable()}updateGalleryButton(){this.galleryIsVisible()||this.$galleryButton.hide()}galleryIsVisible(){return _chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.options.galleryButtonEnabled,!0)&&this.extension.isLeftPanelEnabled()}setTotal(){let e=this.content.of;this.isPageModeEnabled()?this.$total.html(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(e,this.extension.helper.getLastCanvasLabel(!0))):this.$total.html(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(e,this.extension.helper.getTotalCanvases().toString()))}setSearchFieldValue(e){let t=this.extension.helper.getCanvasByIndex(e),i=null;if(this.isPageModeEnabled()){let e=Ne.LanguageMap.getValue(t.getLabel());i="-"===e?"":e}else i=(e+=1).toString();this.options.autoCompleteBoxEnabled?this.$autoCompleteBox.val(i):this.$searchText.val(i)}search(e){if(!e)return this.extension.showMessage(this.content.emptyValue),void this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE_FAILED);if(this.isPageModeEnabled())this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PAGE_SEARCH,e);else{let e;if(e=this.options.autoCompleteBoxEnabled?parseInt(this.$autoCompleteBox.val(),10):parseInt(this.$searchText.val(),10),e-=1,isNaN(e))return this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.invalidNumber),void this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE_FAILED);if(!this.extension.helper.getCanvasByIndex(e))return this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.pageNotFound),void this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE_FAILED);this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.IMAGE_SEARCH,e)}}canvasIndexChanged(e){this.setSearchFieldValue(e),!0===this.options.imageSelectionBoxEnabled&&!0!==this.options.autoCompleteBoxEnabled&&this.$imageSelectionBox.val(e),(this.extension.helper.getViewingDirection()||me.ViewingDirection.LEFT_TO_RIGHT)===me.ViewingDirection.RIGHT_TO_LEFT?(this.extension.helper.isFirstCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()),this.extension.helper.isLastCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton())):(this.extension.helper.isFirstCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton()),this.extension.helper.isLastCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()))}disableFirstButton(){this.firstButtonEnabled=!1,this.$firstButton.disable()}enableFirstButton(){this.firstButtonEnabled=!0,this.$firstButton.enable()}disableLastButton(){this.lastButtonEnabled=!1,this.$lastButton.disable()}enableLastButton(){this.lastButtonEnabled=!0,this.$lastButton.enable()}disablePrevButton(){this.prevButtonEnabled=!1,this.$prevButton.disable()}enablePrevButton(){this.prevButtonEnabled=!0,this.$prevButton.enable()}disableNextButton(){this.nextButtonEnabled=!1,this.$nextButton.disable()}enableNextButton(){this.nextButtonEnabled=!0,this.$nextButton.enable()}modeChanged(){this.setSearchFieldValue(this.extension.helper.canvasIndex),this.setNavigationTitles(),this.setTotal()}resize(){super.resize(),this.extension.width()<this.extension.data.config.options.minWidthBreakPoint?(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.hide(),this.galleryIsVisible()&&this.$galleryButton.hide()):(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.show(),this.galleryIsVisible()&&this.$galleryButton.show())}},Kt,t,Yt,$t,ei,ti,ii,ni,ve,si;t=Kt||(Kt={}),t.BOOKMARKING="oa:bookmarking",t.CLASSIFYING="oa:classifying",t.COMMENTING="oa:commenting",t.DESCRIBING="oa:describing",t.EDITING="oa:editing",t.HIGHLIGHTING="oa:highlighting",t.IDENTIFYING="oa:identifying",t.LINKING="oa:linking",t.MODERATING="oa:moderating",t.PAINTING="sc:painting",t.QUESTIONING="oa:questioning",t.REPLYING="oa:replying",t.TAGGING="oa:tagging",t.TRANSCRIBING="oad:transcribing",function(e){e.AUTO_ADVANCE="auto-advance",e.CONTINUOUS="continuous",e.FACING_PAGES="facing-pages",e.HIDDEN="hidden",e.INDIVIDUALS="individuals",e.MULTI_PART="multi-part",e.NO_NAV="no-nav",e.NON_PAGED="non-paged",e.PAGED="paged",e.REPEAT="repeat",e.SEQUENCE="sequence",e.THUMBNAIL_NAV="thumbnail-nav",e.TOGETHER="together",e.UNORDERED="unordered"}(Yt||(Yt={})),function(e){e.CANVAS="canvas",e.CHOICE="choice",e.OA_CHOICE="oa:choice",e.CONTENT_AS_TEXT="contentastext",e.DATASET="dataset",e.DOCUMENT="document",e.IMAGE="image",e.MODEL="model",e.MOVING_IMAGE="movingimage",e.PDF="pdf",e.PHYSICAL_OBJECT="physicalobject",e.SOUND="sound",e.TEXT="text",e.TEXTUALBODY="textualbody",e.VIDEO="video"}($t||($t={})),function(e){e.ANNOTATION="annotation",e.CANVAS="canvas",e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range",e.SEQUENCE="sequence"}(ei||(ei={})),function(e){e.AUDIO_MP4="audio/mp4",e.CORTO="application/corto",e.DICOM="application/dicom",e.DRACO="application/draco",e.EPUB="application/epub+zip",e.GIRDER="image/vnd.kitware.girder",e.GLB="model/gltf-binary",e.GLTF="model/gltf+json",e.IIIF_PRESENTATION_2='application/ld+json;profile="http://iiif.io/api/presentation/2/context.json"',e.IIIF_PRESENTATION_3='application/ld+json;profile="http://iiif.io/api/presentation/3/context.json"',e.JPG="image/jpeg",e.M3U8="application/vnd.apple.mpegurl",e.MP3="audio/mp3",e.MPEG_DASH="application/dash+xml",e.OBJ="text/plain",e.OPF="application/oebps-package+xml",e.PDF="application/pdf",e.PLY="application/ply",e.THREEJS="application/vnd.threejs+json",e.USDZ="model/vnd.usd+zip",e.VIDEO_MP4="video/mp4",e.WEBM="video/webm"}(ti||(ti={})),function(e){e.DOC="application/msword",e.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.PDF="application/pdf"}(ii||(ii={})),function(e){e.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",e.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",e.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",e.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",e.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",e.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",e.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",e.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",e.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",e.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",e.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",e.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",e.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",e.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",e.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",e.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",e.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",e.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",e.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",e.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",e.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",e.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",e.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",e.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",e.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",e.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",e.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",e.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",e.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",e.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",e.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",e.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",e.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",e.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",e.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",e.SEARCH_0="http://iiif.io/api/search/0/search",e.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",e.SEARCH_1="http://iiif.io/api/search/1/search",e.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",e.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",e.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",e.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",e.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",e.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",e.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(ni||(ni={})),function(e){e.BOTTOM_TO_TOP="bottom-to-top",e.LEFT_TO_RIGHT="left-to-right",e.RIGHT_TO_LEFT="right-to-left",e.TOP_TO_BOTTOM="top-to-bottom"}(ve||(ve={})),function(e){e.CONTINUOUS="continuous",e.INDIVIDUALS="individuals",e.NON_PAGED="non-paged",e.PAGED="paged",e.TOP="top"}(si||(si={}));var Ae=(0,_chunk_YAXTLTJC_js__WEBPACK_IMPORTED_MODULE_10__.c)(Ke()),Tn=(0,_chunk_YAXTLTJC_js__WEBPACK_IMPORTED_MODULE_10__.c)(oi()),ri=(0,_chunk_YAXTLTJC_js__WEBPACK_IMPORTED_MODULE_10__.c)((0,_chunk_76YR7XP2_js__WEBPACK_IMPORTED_MODULE_6__.a)()),Pe=(0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.a)(),Rt=class extends _chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.c{constructor(e){super(e),this.controlsVisible=!1,this.isCreated=!1,this.isLoaded=!1,this.isFirstLoad=!0,this.navigatedFromSearch=!1,this.nextButtonEnabled=!1,this.prevButtonEnabled=!1}create(){this.setConfig("openSeadragonCenterPanel"),super.create(),this.viewerId="osd"+(new Date).getTime(),this.$viewer=Pe('<div id="'+this.viewerId+'" class="viewer"></div>'),this.$content.prepend(this.$viewer),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATIONS,(e=>{this.overlayAnnotations()})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.SETTINGS_CHANGE,(e=>{this.viewer.gestureSettingsMouse.clickToZoom=e.clickToZoomEnabled})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.OPEN_EXTERNAL_RESOURCE,(e=>{this.whenResized((async()=>{this.isCreated||this.createUI(),this.isLoaded=!1,await this.openMedia(e),this.isLoaded=!0,this.extensionHost.publish(_chunk_RPOSMM7Q_js__WEBPACK_IMPORTED_MODULE_9__.a.EXTERNAL_RESOURCE_OPENED),this.extensionHost.publish(_chunk_RPOSMM7Q_js__WEBPACK_IMPORTED_MODULE_9__.a.LOAD)}))})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CLEAR_ANNOTATIONS,(()=>{this.whenCreated((()=>{this.extension.currentAnnotationRect=null,this.clearAnnotations()}))})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.NEXT_SEARCH_RESULT,(()=>{this.whenCreated((()=>{this.nextAnnotation()}))})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PREV_SEARCH_RESULT,(()=>{this.whenCreated((()=>{this.prevAnnotation()}))})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.ZOOM_IN,(()=>{this.whenCreated((()=>{this.zoomIn()}))})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.ZOOM_OUT,(()=>{this.whenCreated((()=>{this.zoomOut()}))})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.ROTATE,(()=>{this.whenCreated((()=>{this.rotateRight()}))})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.METRIC_CHANGE,(()=>{this.whenCreated((()=>{this.updateResponsiveView()}))})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.SET_TARGET,(e=>{this.whenLoaded((()=>{this.fitToBounds(e,!1)}))})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.SET_ROTATION,(e=>{this.whenLoaded((()=>{this.viewer.viewport.setRotation(e)}))}))}whenCreated(e){_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.a.waitFor((()=>this.isCreated),e)}whenLoaded(e){_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.a.waitFor((()=>this.isLoaded),e)}zoomIn(){this.viewer.viewport.zoomTo(2*this.viewer.viewport.getZoom(!0))}zoomOut(){this.viewer.viewport.zoomTo(.5*this.viewer.viewport.getZoom(!0))}rotateRight(){this.viewer.viewport.setRotation(this.viewer.viewport.getRotation()+90)}updateResponsiveView(){this.setNavigatorVisible(),this.extension.isDesktopMetric()?this.viewer.autoHideControls=!0:this.viewer.autoHideControls=!1}async createUI(){this.$spinner=Pe('<div class="spinner"></div>'),this.$content.append(this.$spinner);let e="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";this.viewer=(0,Ae.default)({element:this.$viewer[0],crossOriginPolicy:"Anonymous",showNavigationControl:!0,showNavigator:!0,showRotationControl:!0,showHomeControl:_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.config.options.showHomeControl,!1),showFullPageControl:!1,defaultZoomLevel:this.config.options.defaultZoomLevel||0,maxZoomPixelRatio:this.config.options.maxZoomPixelRatio||2,controlsFadeDelay:this.config.options.controlsFadeDelay||250,controlsFadeLength:this.config.options.controlsFadeLength||250,navigatorPosition:this.config.options.navigatorPosition||"BOTTOM_RIGHT",navigatorHeight:"100px",navigatorWidth:"100px",animationTime:this.config.options.animationTime||1.2,visibilityRatio:this.config.options.visibilityRatio||.5,constrainDuringPan:_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.config.options.constrainDuringPan,!1),immediateRender:_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.config.options.immediateRender,!1),blendTime:this.config.options.blendTime||0,autoHideControls:_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.config.options.autoHideControls,!0),prefixUrl:null,gestureSettingsMouse:{clickToZoom:_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.extension.data.config.options.clickToZoomEnabled,!0)},navImages:{zoomIn:{REST:e,GROUP:e,HOVER:e,DOWN:e},zoomOut:{REST:e,GROUP:e,HOVER:e,DOWN:e},home:{REST:e,GROUP:e,HOVER:e,DOWN:e},rotateright:{REST:e,GROUP:e,HOVER:e,DOWN:e},rotateleft:{REST:e,GROUP:e,HOVER:e,DOWN:e},next:{REST:e,GROUP:e,HOVER:e,DOWN:e},previous:{REST:e,GROUP:e,HOVER:e,DOWN:e}}});let t=this,i=(0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.c)((e=>{let i=t.extension.helper.getCurrentCanvas();var n=t.viewer.viewport.pointFromPixel(e.position),s=t.viewer.viewport.viewportToImageCoordinates(n.x,n.y);this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.DOUBLECLICK,{target:`${i.id}#xywh=${Math.round(s.x)},${Math.round(s.y)},1,1`})}),100);this.viewer.addViewerInputHook({hooks:[{tracker:"viewer",handler:"dblClickHandler",hookHandler:e=>{let t=this.extension.getSettings(),n=this.extension.helper.isPagingAvailable();(n&&!t.pagingEnabled||!n)&&this.config.options.doubleClickAnnotationEnabled&&i(e)}}]}),this.$zoomInButton=this.$viewer.find('div[title="Zoom in"]'),this.$zoomInButton.attr("tabindex",0),this.$zoomInButton.prop("title",this.content.zoomIn),this.$zoomInButton.prop("aria-label",this.content.zoomIn),this.$zoomInButton.addClass("zoomIn viewportNavButton"),this.$zoomOutButton=this.$viewer.find('div[title="Zoom out"]'),this.$zoomOutButton.attr("tabindex",0),this.$zoomOutButton.prop("title",this.content.zoomOut),this.$zoomOutButton.prop("aria-label",this.content.zoomOut),this.$zoomOutButton.addClass("zoomOut viewportNavButton"),this.$goHomeButton=this.$viewer.find('div[title="Go home"]'),this.$goHomeButton.attr("tabindex",0),this.$goHomeButton.prop("title",this.content.goHome),this.$goHomeButton.prop("aria-label",this.content.goHome),this.$goHomeButton.addClass("goHome viewportNavButton"),this.$rotateButton=this.$viewer.find('div[title="Rotate right"]'),this.$rotateButton.attr("tabindex",0),this.$rotateButton.prop("title",this.content.rotateRight),this.$rotateButton.prop("aria-label",this.content.rotateRight),this.$rotateButton.addClass("rotate viewportNavButton"),this.$viewportNavButtonsContainer=this.$viewer.find(".openseadragon-container > div:not(.openseadragon-canvas):first"),this.$viewportNavButtons=this.$viewportNavButtonsContainer.find(".viewportNavButton"),this.$canvas=Pe(this.viewer.canvas),this.$canvas.on("contextmenu",(()=>!1)),this.$navigator=this.$viewer.find(".navigator"),this.setNavigatorVisible(),this.$element.on("mousemove",(()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))})),this.$element.on("mouseleave",(()=>{!this.controlsVisible||(this.controlsVisible=!1,this.viewer.setControlsEnabled(!1))})),this.$element.on("mousemove",(()=>{if(!this.$prevButton.ismouseover()&&!this.$nextButton.ismouseover()&&!this.$viewer.find(".navigator").ismouseover()){if(!this.controlsVisible)return;this.controlsVisible=!1,this.viewer.setControlsEnabled(!1)}}),this.config.options.controlsFadeAfterInactive),this.viewer.addHandler("tile-drawn",(()=>{this.$spinner.hide()})),this.viewer.addHandler("resize",(e=>{this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_RESIZE,e),this.viewerResize(e)})),this.viewer.addHandler("animation-start",(e=>{this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_ANIMATION_START,e)})),this.viewer.addHandler("animation",(e=>{this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_ANIMATION,e)})),this.viewer.addHandler("animation-finish",(e=>{this.currentBounds=this.getViewportBounds(),this.updateVisibleAnnotationRects(),this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_ANIMATION_FINISH,e)})),this.viewer.addHandler("rotate",(e=>{this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_ROTATION,e.degrees)})),this.title=this.extension.helper.getLabel(),this.createNavigationButtons(),this.hidePrevButton(),this.hideNextButton(),this.isCreated=!0}createNavigationButtons(){let e=this.extension.helper.getViewingDirection()||ve.LEFT_TO_RIGHT;switch(this.$prevButton=Pe('<div class="paging btn prev" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$prevButton.prop("title",this.content.next):this.$prevButton.prop("title",this.content.previous),this.$nextButton=Pe('<div class="paging btn next" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$nextButton.prop("title",this.content.previous):this.$nextButton.prop("title",this.content.next),this.viewer.addControl(this.$prevButton[0],{anchor:Ae.default.ControlAnchor.TOP_LEFT}),this.viewer.addControl(this.$nextButton[0],{anchor:Ae.default.ControlAnchor.TOP_RIGHT}),e){case ve.BOTTOM_TO_TOP:case ve.TOP_TO_BOTTOM:this.$prevButton.addClass("vertical"),this.$nextButton.addClass("vertical")}let t=this;this.onAccessibleClick(this.$prevButton,(i=>{if(i.preventDefault(),Ae.default.cancelEvent(i),t.prevButtonEnabled)switch(e){case ve.LEFT_TO_RIGHT:case ve.BOTTOM_TO_TOP:case ve.TOP_TO_BOTTOM:this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.PREV);break;case ve.RIGHT_TO_LEFT:this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.NEXT)}})),this.onAccessibleClick(this.$nextButton,(i=>{if(i.preventDefault(),Ae.default.cancelEvent(i),t.nextButtonEnabled)switch(e){case ve.LEFT_TO_RIGHT:case ve.BOTTOM_TO_TOP:case ve.TOP_TO_BOTTOM:this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.NEXT);break;case ve.RIGHT_TO_LEFT:this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.PREV)}})),this.$prevButton.on("focus",(()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))})),this.$nextButton.on("focus",(()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))}))}async getGirderTileSource(){return new Promise((e=>{let t=this.extension.helper.getCurrentCanvas().getContent();if(t.length){let i=t[0].getBody();if(i.length){let t=i[0].getServices();if(t.length){let i=t[0].id,n=i;n.endsWith("/")||(n+="/"),n+="tiles",i.endsWith("/")&&(i=i.substr(0,i.length-1)),fetch(n).then((e=>e.json())).then((t=>{let i={height:t.sizeY,width:t.sizeX,tileWidth:t.tileWidth,tileHeight:t.tileHeight,minLevel:0,maxLevel:t.levels-1,units:"mm",spacing:[t.mm_x,t.mm_y],getTileUrl:function(e,t,i,s){var o=n+"/zxy/"+e+"/"+t+"/"+i;return s&&(o+="?"+Pe.param(s)),o}};t.mm_x||(i.units="pixels",i.spacing=[1,1]),e(i)}))}}}}))}async openMedia(e){if(!this.viewer)return;this.$spinner.show(),this.items=[];let t=await this.extension.getExternalResources(e),i=this.extension.format===ri.MediaType.GIRDER;try{this.viewer.close(),t=this.getPagePositions(t);for(let e=0;e<t.length;e++){let n,s=t[e];n=s.hasServiceDescriptor?s:i?await this.getGirderTileSource():{type:"image",url:s.id,buildPyramid:!1},this.viewer.addTiledImage({tileSource:n,x:s.x,y:s.y,width:s.width,success:e=>{this.items.push(e),this.items.length===t.length&&this.openPagesHandler(),this.resize(),this.goHome()}})}}catch{}}getPagePositions(e){let t,i,n,s,o,r;if(e.length>1)if(2===e.length)this.extension.helper.isVerticallyAligned()?(n=e[0],n.y=0,s=e[1],s.y=n.height+this.config.options.pageGap):(t=e[0],t.x=0,i=e[1],i.x=t.width+this.config.options.pageGap);else if(this.extension.helper.isVerticallyAligned())if(this.extension.helper.isTopToBottom())for(let a=0;a<e.length-1;a++)o=e[a],r=e[a+1],r.y=(o.y||0)+o.height;else for(let a=e.length;a>0;a--)o=e[a],r=e[a-1],r.y=(o.y||0)-o.height;else if(this.extension.helper.isLeftToRight())for(let a=0;a<e.length-1;a++)o=e[a],r=e[a+1],r.x=(o.x||0)+o.width;else for(let a=e.length-1;a>0;a--)o=e[a],r=e[a-1],r.x=(o.x||0)-o.width;return e}openPagesHandler(){this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_OPEN),this.extension.helper.isMultiCanvas()&&!this.extension.helper.isContinuous()&&(this.showPrevButton(),this.showNextButton(),Pe(".navigator").addClass("extraMargin"),(this.extension.helper.getViewingDirection()||ve.LEFT_TO_RIGHT)===ve.RIGHT_TO_LEFT?(this.extension.helper.isFirstCanvas()?this.disableNextButton():this.enableNextButton(),this.extension.helper.isLastCanvas()?this.disablePrevButton():this.enablePrevButton()):(this.extension.helper.isFirstCanvas()?this.disablePrevButton():this.enablePrevButton(),this.extension.helper.isLastCanvas()?this.disableNextButton():this.enableNextButton())),this.setNavigatorVisible(),this.overlayAnnotations(),this.updateBounds(),this.navigatedFromSearch&&(this.navigatedFromSearch=!1,this.zoomToInitialAnnotation()),this.isFirstLoad=!1}zoomToInitialAnnotation(){let e=this.getInitialAnnotationRect();this.extension.previousAnnotationRect=null,this.extension.currentAnnotationRect=null,e&&this.isZoomToSearchResultEnabled()&&this.zoomToAnnotation(e)}overlayAnnotations(){let e=this.getAnnotationsForCurrentImages();this.clearAnnotations();for(let t=0;t<e.length;t++){let i=e[t],n=this.getAnnotationOverlayRects(i);for(let e=0;e<n.length;e++){let t=n[e],i=document.createElement("DIV");if(i.id="annotation-"+t.canvasIndex+"-"+t.resultIndex,i.title=(0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.b)(t.chars),1===t.width&&1===t.height){i.className="annotationPin",i.onclick=t=>{t.preventDefault(),this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.PINPOINT_ANNOTATION_CLICKED,e)};let t=document.createElement("SPAN");t.innerText=String(e+1),i.appendChild(t)}else i.className="annotationRect";this.viewer.addOverlay(i,t)}}}updateBounds(){let e=this.extension.getSettings();if(this.isFirstLoad){this.initialRotation=this.extension.data.rotation,this.initialRotation&&this.viewer.viewport.setRotation(parseInt(this.initialRotation));let e=this.extension.data.xywh;e&&(this.initialBounds=Se.fromString(e),this.currentBounds=this.initialBounds,this.fitToBounds(this.currentBounds))}else e.preserveViewport&&this.currentBounds?this.fitToBounds(this.currentBounds):this.goHome()}goHome(){this.viewer.viewport.goHome(!0)}disablePrevButton(){this.prevButtonEnabled=!1,this.$prevButton.addClass("disabled")}enablePrevButton(){this.prevButtonEnabled=!0,this.$prevButton.removeClass("disabled")}hidePrevButton(){this.disablePrevButton(),this.$prevButton.hide()}showPrevButton(){this.enablePrevButton(),this.$prevButton.show()}disableNextButton(){this.nextButtonEnabled=!1,this.$nextButton.addClass("disabled")}enableNextButton(){this.nextButtonEnabled=!0,this.$nextButton.removeClass("disabled")}hideNextButton(){this.disableNextButton(),this.$nextButton.hide()}showNextButton(){this.enableNextButton(),this.$nextButton.show()}fitToBounds(e,t=!0){let i=new Ae.default.Rect;i.x=Number(e.x),i.y=Number(e.y),i.width=Number(e.w),i.height=Number(e.h),setTimeout((()=>{this.viewer.viewport.fitBoundsWithConstraints(i,t)}),100)}getCroppedImageBounds(){if(!this.viewer||!this.viewer.viewport)return null;let e=this.extension.helper.getCurrentCanvas(),t=this.extension.getCroppedImageDimensions(e,this.viewer);return t?new Se(t.regionPos.x,t.regionPos.y,t.region.width,t.region.height).toString():null}getViewportBounds(){if(!this.viewer||!this.viewer.viewport)return null;let e=this.viewer.viewport.getBounds(!0);return new Se(Math.floor(e.x),Math.floor(e.y),Math.floor(e.width),Math.floor(e.height))}viewerResize(e){if(!e.viewport)return;let t=e.viewport.getCenter(!0);!t||setTimeout((function(){e.viewport.panTo(t,!0)}),1)}clearAnnotations(){this.viewer.clearOverlays()}getAnnotationsForCurrentImages(){let e=[],t=this.extension.annotations;if(!t||!t.length)return e;let i=this.extension.getPagedIndices();for(let n=0;n<i.length;n++){let s=i[n];for(let i=0;i<t.length;i++)if(t[i].canvasIndex===s){e.push(t[i]);break}}return e}getAnnotationRectsForCurrentImages(){let e=this.getAnnotationsForCurrentImages();return e.length?e.map((e=>e.rects)).reduce(((e,t)=>e.concat(t))):[]}updateVisibleAnnotationRects(){let e=this.getAnnotationRectsForCurrentImages();for(let t=0;t<e.length;t++){let i=e[t],n=this.viewer.viewport.getBounds();i.isVisible=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.i.hitRect(n.x,n.y,n.width,n.height,i.viewportX,i.viewportY)}}getAnnotationRectIndex(e){return this.getAnnotationRectsForCurrentImages().indexOf(e)}isZoomToSearchResultEnabled(){return _chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)}prevAnnotation(){let e=this.getAnnotationRectsForCurrentImages(),t=this.extension.currentAnnotationRect,i=null;for(let n=(t?this.getAnnotationRectIndex(t):e.length)-1;n>=0;n--){i=e[n];break}i&&this.isZoomToSearchResultEnabled()?i.canvasIndex<this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=i,this.navigatedFromSearch=!0,this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATION_CANVAS_CHANGE,[i])):this.zoomToAnnotation(i):(this.navigatedFromSearch=!0,this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE))}nextAnnotation(){let e=this.getAnnotationRectsForCurrentImages(),t=this.extension.currentAnnotationRect,i=null;for(let n=(t?this.getAnnotationRectIndex(t):-1)+1;n<e.length;n++){i=e[n];break}i&&this.isZoomToSearchResultEnabled()?i.canvasIndex>this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=i,this.navigatedFromSearch=!0,this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATION_CANVAS_CHANGE,[i])):this.zoomToAnnotation(i):(this.navigatedFromSearch=!0,this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE))}getAnnotationRectByIndex(e){let t=this.getAnnotationRectsForCurrentImages();return t.length?t[e]:null}getInitialAnnotationRect(){let e=this.getAnnotationRectsForCurrentImages();if(!e.length)return null;if(!this.extension.previousAnnotationRect&&this.extension.lastCanvasIndex>this.extension.helper.canvasIndex){let t=e.filter((e=>e.canvasIndex===this.extension.helper.canvasIndex));return t[t.length-1]}return e.filter((e=>e.canvasIndex===this.extension.helper.canvasIndex))[0]}zoomToAnnotation(e){if(this.extension.previousAnnotationRect=this.extension.currentAnnotationRect||e,this.extension.currentAnnotationRect=e,_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.extension.data.config.options.zoomToBoundsEnabled,!1))this.fitToBounds(new Se(e.viewportX,e.viewportY,e.width,e.height),!1);else if(this.currentBounds){let t=e.viewportX-(.5*this.currentBounds.w-.5*e.width),i=e.viewportY-(.5*this.currentBounds.h-.5*e.height),n=this.currentBounds.w,s=this.currentBounds.h,o=new Se(t,i,n,s);this.fitToBounds(o)}this.highlightAnnotationRect(e),this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATION_CHANGE)}highlightAnnotationRect(e){let t=Pe("#annotation-"+e.canvasIndex+"-"+e.index);t.addClass("current"),Pe(".annotationRect").not(t).removeClass("current")}getAnnotationOverlayRects(e){let t=[];if(!this.extension.resources)return t;let i=this.extension.resources.filter((t=>t.index===e.canvasIndex))[0],n=this.extension.resources.indexOf(i),s=0;n>0&&(s=this.extension.resources[n-1].width);for(let o=0;o<e.rects.length;o++){let i=e.rects[o],r=i.x+s+(n>0?this.config.options.pageGap:0),a=i.y,l=i.width,h=i.height,c=new Ae.default.Rect(r,a,l,h);i.viewportX=r,i.viewportY=a,c.canvasIndex=i.canvasIndex,c.resultIndex=i.index,c.chars=i.chars,t.push(c)}return t}resize(){if(super.resize(),this.$viewer.height(this.$content.height()-this.$viewer.verticalMargins()),this.$viewer.width(this.$content.width()-this.$viewer.horizontalMargins()),!this.isCreated)return;this.title&&this.$title.text((0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.b)(this.title)),this.$spinner.css("top",this.$content.height()/2-this.$spinner.height()/2),this.$spinner.css("left",this.$content.width()/2-this.$spinner.width()/2);let e=this.extension.helper.getViewingDirection()||ve.LEFT_TO_RIGHT;if(this.extension.helper.isMultiCanvas()&&this.$prevButton&&this.$nextButton){let t=Math.floor(this.$content.width()/2);switch(e){case ve.BOTTOM_TO_TOP:this.$prevButton.addClass("down"),this.$nextButton.addClass("up"),this.$prevButton.css("left",t-this.$prevButton.outerWidth()/2),this.$prevButton.css("top",this.$content.height()-this.$prevButton.height()),this.$nextButton.css("left",-1*t-this.$nextButton.outerWidth()/2);break;case ve.TOP_TO_BOTTOM:this.$prevButton.css("left",t-this.$prevButton.outerWidth()/2),this.$nextButton.css("left",-1*t-this.$nextButton.outerWidth()/2),this.$nextButton.css("top",this.$content.height()-this.$nextButton.height());break;default:this.$prevButton.css("top",(this.$content.height()-this.$prevButton.height())/2),this.$nextButton.css("top",(this.$content.height()-this.$nextButton.height())/2)}}setTimeout((()=>{if(this.extension.helper.isContinuous())if(this.extension.helper.isHorizontallyAligned()){let e=this.$viewer.width()-this.$viewer.rightMargin();this.$navigator.width(e)}else this.$navigator.height(this.$viewer.height())}),100)}setFocus(){this.$canvas&&!this.$canvas.is(":focus")&&this.extension.data.config.options.allowStealFocus&&this.$canvas.focus()}setNavigatorVisible(){let e=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.extension.getSettings().navigatorEnabled,!0)&&this.extension.isDesktopMetric();this.viewer&&this.viewer.navigator&&(this.viewer.navigator.setVisible(e),e?this.$navigator.show():this.$navigator.hide())}},Ee=(0,_chunk_2OYNMPAF_js__WEBPACK_IMPORTED_MODULE_8__.a)(),Ct=class extends _chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.l{constructor(e){super(e)}create(){this.setConfig("settingsDialogue"),super.create(),this.$navigatorEnabled=Ee('<div class="setting navigatorEnabled"></div>'),this.$scroll.append(this.$navigatorEnabled),this.$navigatorEnabledCheckbox=Ee('<input id="navigatorEnabled" type="checkbox" tabindex="0" />'),this.$navigatorEnabled.append(this.$navigatorEnabledCheckbox),this.$navigatorEnabledLabel=Ee('<label for="navigatorEnabled">'+this.content.navigatorEnabled+"</label>"),this.$navigatorEnabled.append(this.$navigatorEnabledLabel),this.$pagingEnabled=Ee('<div class="setting pagingEnabled"></div>'),this.$scroll.append(this.$pagingEnabled),this.$pagingEnabledCheckbox=Ee('<input id="pagingEnabled" type="checkbox" tabindex="0" />'),this.$pagingEnabled.append(this.$pagingEnabledCheckbox),this.$pagingEnabledLabel=Ee('<label for="pagingEnabled">'+this.content.pagingEnabled+"</label>"),this.$pagingEnabled.append(this.$pagingEnabledLabel),this.$clickToZoomEnabled=Ee('<div class="setting clickToZoom"></div>'),this.$scroll.append(this.$clickToZoomEnabled),this.$clickToZoomEnabledCheckbox=Ee('<input id="clickToZoomEnabled" type="checkbox" />'),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledCheckbox),this.$clickToZoomEnabledLabel=Ee('<label for="clickToZoomEnabled">'+this.content.clickToZoomEnabled+"</label>"),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledLabel),this.$preserveViewport=Ee('<div class="setting preserveViewport"></div>'),this.$scroll.append(this.$preserveViewport),this.$preserveViewportCheckbox=Ee('<input id="preserveViewport" type="checkbox" tabindex="0" />'),this.$preserveViewport.append(this.$preserveViewportCheckbox),this.$preserveViewportLabel=Ee('<label for="preserveViewport">'+this.content.preserveViewport+"</label>"),this.$preserveViewport.append(this.$preserveViewportLabel),this.$navigatorEnabledCheckbox.change((()=>{let e={};this.$navigatorEnabledCheckbox.is(":checked")?e.navigatorEnabled=!0:e.navigatorEnabled=!1,this.updateSettings(e)})),this.$clickToZoomEnabledCheckbox.change((()=>{let e={};this.$clickToZoomEnabledCheckbox.is(":checked")?e.clickToZoomEnabled=!0:e.clickToZoomEnabled=!1,this.updateSettings(e)})),this.$pagingEnabledCheckbox.change((()=>{let e={};this.$pagingEnabledCheckbox.is(":checked")?e.pagingEnabled=!0:e.pagingEnabled=!1,this.updateSettings(e)})),this.$preserveViewportCheckbox.change((()=>{let e={};this.$preserveViewportCheckbox.is(":checked")?e.preserveViewport=!0:e.preserveViewport=!1,this.updateSettings(e)}))}open(){super.open();let e=this.getSettings();e.navigatorEnabled?this.$navigatorEnabledCheckbox.prop("checked",!0):this.$navigatorEnabledCheckbox.removeAttr("checked"),e.clickToZoomEnabled?this.$clickToZoomEnabledCheckbox.prop("checked",!0):this.$clickToZoomEnabledCheckbox.removeAttr("checked"),this.extension.helper.isPagingAvailable()?e.pagingEnabled?this.$pagingEnabledCheckbox.prop("checked",!0):this.$pagingEnabledCheckbox.removeAttr("checked"):this.$pagingEnabled.hide(),e.preserveViewport?this.$preserveViewportCheckbox.prop("checked",!0):this.$preserveViewportCheckbox.removeAttr("checked")}},_t=class extends _chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.m{constructor(e){super(e),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_OPEN,(()=>{this.update()})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_ANIMATION_FINISH,(()=>{this.update()}))}create(){this.setConfig("shareDialogue"),super.create()}update(){super.update();let e=this.extension.getViewportBounds(),t=this.extension.getViewerRotation();this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight,e,t),this.$code.val(this.code)}resize(){super.resize()}},Be=(0,_chunk_YAXTLTJC_js__WEBPACK_IMPORTED_MODULE_10__.c)((0,_chunk_76YR7XP2_js__WEBPACK_IMPORTED_MODULE_6__.a)()),Te=(0,_chunk_YAXTLTJC_js__WEBPACK_IMPORTED_MODULE_10__.c)((0,_chunk_76YR7XP2_js__WEBPACK_IMPORTED_MODULE_6__.c)()),di={allowStealFocus:!1,authAPIVersion:1,bookmarkThumbHeight:150,bookmarkThumbWidth:90,dropEnabled:!0,footerPanelEnabled:!0,headerPanelEnabled:!0,leftPanelEnabled:!0,limitLocales:!1,doubleClickAnnotationEnabled:!1,metrics:[{type:"sm",minWidth:0},{type:"md",minWidth:768},{type:"lg",minWidth:1024},{type:"xl",minWidth:1280}],multiSelectionMimeType:"application/zip",navigatorEnabled:!0,openTemplate:"http://universalviewer.io?manifest={0}",overrideFullScreen:!1,pagingEnabled:!0,pagingOptionEnabled:!0,pessimisticAccessControl:!1,preserveViewport:!1,rightPanelEnabled:!0,saveUserSettings:!1,clickToZoomEnabled:!0,searchWithinEnabled:!0,termsOfUseEnabled:!0,theme:"uv-en-GB-theme",tokenStorage:"session",useArrowKeysToNavigate:!1,zoomToSearchResultEnabled:!0,zoomToBoundsEnabled:!0},pi={contentLeftPanel:{options:{autoExpandTreeEnabled:!1,autoExpandTreeIfFewerThan:20,branchNodesExpandOnClick:!0,branchNodesSelectable:!1,defaultToTreeEnabled:!1,defaultToTreeIfGreaterThan:0,elideCount:40,expandFullEnabled:!0,galleryThumbChunkedResizingThreshold:400,galleryThumbHeight:320,galleryThumbLoadPadding:3,galleryThumbWidth:200,oneColThumbHeight:320,oneColThumbWidth:200,pageModeEnabled:!0,panelAnimationDuration:250,panelCollapsedWidth:30,panelExpandedWidth:255,panelOpen:!0,tabOrder:"",thumbsCacheInvalidation:{enabled:!0,paramType:"?"},thumbsEnabled:!0,thumbsExtraHeight:8,thumbsImageFadeInDuration:300,thumbsLoadRange:15,treeEnabled:!0,twoColThumbHeight:150,twoColThumbWidth:90},content:{collapse:"Collapse Contents",collapseFull:"Collapse Gallery",date:"date",expand:"Expand Contents",expandFull:"Expand Gallery",index:"Index",manifestRanges:"Manifest Ranges",searchResult:"{0} search result",searchResults:"{0} search results",sortBy:"Sort By:",thumbnails:"Thumbnails",title:"Contents",volume:"volume"}},dialogue:{topCloseButtonEnabled:!1,content:{close:"Close"}},downloadDialogue:{options:{confinedImageSize:1e3,currentViewDisabledPercentage:90,maxImageWidth:5e3,optionsExplanatoryTextEnabled:!1,selectionEnabled:!1},content:{currentViewAsJpg:"Current view {0} x {1}px (jpg)",currentViewAsJpgExplanation:"Opens in a new window",download:"Download",downloadSelection:"Download Selection",downloadSelectionExplanation:"Opens a dialogue to select which pages to download.",editSettings:"Edit Settings",entireDocument:"Entire document ({0})",entireFileAsOriginal:"Entire file",noneAvailable:"No download options are available.",pagingNote:"Please turn off Two Page View for additional options.",preview:"Preview",title:"Download",wholeImageHighRes:"Whole image {0} x {1}px ({2})",wholeImageHighResExplanation:"Opens in a new window.",wholeImagesHighRes:"Whole images ({0})",wholeImagesHighResExplanation:"Opens in two new windows.",wholeImageLowResAsJpg:"Whole image {0} x {1}px (jpg)",wholeImageLowResAsJpgExplanation:"Opens in a new window."}},footerPanel:{options:{autocompleteAllowWords:!1,bookmarkEnabled:!1,downloadEnabled:!0,embedEnabled:!1,feedbackEnabled:!1,fullscreenEnabled:!0,minimiseButtons:!0,moreInfoEnabled:!0,openEnabled:!1,printEnabled:!1,shareEnabled:!0},content:{bookmark:"Add to bookmarks",download:"Download",embed:"Embed",exitFullScreen:"Exit Full Screen",feedback:"Feedback",fullScreen:"Full Screen",moreInfo:"More Information",open:"Open",share:"Share"}},genericDialogue:{content:{emptyValue:"please enter a value.",invalidNumber:"Please enter a valid number.",noMatches:"No matches were found.",ok:"OK",pageNotFound:"This item does not contain a page with the number you entered. Try switching the numbering mode to 'image'.",refresh:"Refresh"}},headerPanel:{options:{centerOptionsEnabled:!0,localeToggleEnabled:!1,settingsButtonEnabled:!0}},helpDialogue:{content:{text:"placeholder text",title:"Help"}},moreInfoRightPanel:{options:{canvasDisplayOrder:"",canvasExclude:"",copyToClipboardEnabled:!1,manifestDisplayOrder:"",manifestExclude:"",panelAnimationDuration:250,panelCollapsedWidth:30,panelExpandedWidth:255,panelOpen:!1,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",showAllLanguages:!1,textLimit:4,textLimitType:"lines"},content:{attribution:"Attribution",canvasHeader:"About the image",collapse:"Collapse Information",collapseFull:"Collapse Gallery",copiedToClipboard:"Copied to clipboard",copyToClipboard:"Copy to clipboard",description:"Description",expand:"Expand Information",expandFull:"Expand Gallery",holdingText:"Your module goes here!",less:"less",license:"License",logo:"Logo",manifestHeader:"About the item",more:"more",noData:"No data to display",page:"Page",rangeHeader:"About this section",title:"More Information"}},multiSelectDialogue:{options:{galleryThumbChunkedResizingEnabled:!0,galleryThumbChunkedResizingThreshold:400,galleryThumbHeight:320,galleryThumbLoadPadding:3,galleryThumbWidth:200,pageModeEnabled:!0},content:{select:"Download",selectAll:"Select All",title:"Select Pages for Download"}},pagingHeaderPanel:{options:{autoCompleteBoxEnabled:!0,autocompleteAllowWords:!1,galleryButtonEnabled:!0,imageSelectionBoxEnabled:!1,pageModeEnabled:!1,pagingToggleEnabled:!0},content:{close:"Close",emptyValue:"Please enter a value",first:"First",firstImage:"First Image",firstPage:"First Page",folio:"Folio",gallery:"Gallery",go:"Go",help:"Help",image:"Image",last:"Last",lastImage:"Last Image",lastPage:"Last Page",next:"Next",nextImage:"Next Image",nextPage:"Next Page",of:"of {0}",oneUp:"Single page view",page:"Page",pageSearchLabel:"Search by Page Number",previous:"Previous",previousImage:"Previous Image",previousPage:"Previous Page",settings:"Settings",twoUp:"Two page view"}},openSeadragonCenterPanel:{options:{animationTime:.15,autoHideControls:!0,requiredStatementEnabled:!0,blendTime:0,constrainDuringPan:!1,controlsFadeAfterInactive:1500,controlsFadeDelay:250,controlsFadeLength:250,defaultZoomLevel:0,immediateRender:!1,maxZoomPixelRatio:1.25,navigatorPosition:"BOTTOM_RIGHT",pageGap:50,showHomeControl:!1,trimAttributionCount:150,visibilityRatio:.5},content:{attribution:"Attribution",goHome:"Go Home",imageUnavailable:"Image Unavailable",next:"Next",previous:"Previous",rotateRight:"Rotate Right",zoomIn:"Zoom In",zoomOut:"Zoom Out"}},searchFooterPanel:{options:{elideDetailsTermsCount:20,elideResultsTermsCount:10,forceImageMode:!1,pageModeEnabled:!0,positionMarkerEnabled:!0},content:{clearSearch:"Clear",defaultLabel:"-",displaying:"{0} {1} of {2}",enterKeyword:"Enter Keyword",image:"image",imageCaps:"Image",instanceFound:"1 instance of '{0}' found",instancesFound:"{0} instances of '{1}' found",nextResult:"Next Result",page:"page",pageCaps:"Page",previousResult:"Previous Result",print:"Print",resultFoundFor:"result found for",resultsFoundFor:"results found for",searchWithin:"Search within this item:"}},settingsDialogue:{content:{locale:"Locale",navigatorEnabled:"Navigator Enabled",clickToZoomEnabled:"Mouse Click To Zoom",pagingEnabled:"Two Page View",reducedMotion:"Reduce motion (disables animations)",preserveViewport:"Preserve Zoom",title:"Settings",website:"<a href='https://github.com/universalviewer/universalviewer#contributors'>more info</a>"}},shareDialogue:{options:{embedTemplate:'<iframe src="{0}" width="{1}" height="{2}" allowfullscreen frameborder="0"></iframe>',instructionsEnabled:!1,shareFrameEnabled:!0,shareManifestsEnabled:!0},content:{customSize:"custom",embed:"Embed",embedInstructions:"To embed this item in your own website, copy and paste the code below.",height:"Height",iiif:"IIIF Manifest",share:"Share",shareInstructions:"To share this item, copy the URL below.",size:"Size:",width:"Width"}},authDialogue:{content:{cancel:"Cancel",confirm:"Confirm"}},clickThroughDialogue:{content:{viewTerms:"Read Full Terms and Conditions"}},loginDialogue:{content:{login:"Login",logout:"Logout",cancel:"Cancel"}},mobileFooterPanel:{content:{rotateRight:"Rotate Right",moreInfo:"More Information",zoomIn:"Zoom In",zoomOut:"Zoom Out"}},restrictedDialogue:{content:{cancel:"Cancel"}}},gi={label:"English (GB)",locales:[{name:"cy-GB",label:"Cymraeg"},{name:"en-GB",label:"English (GB)"},{name:"fr-FR",label:"Fran\xe7ais (FR)"},{name:"pl-PL",label:"Polski"},{name:"sv-SE",label:"Svenska"}]},fi={authCORSError:"Your browser does not support CORS, please upgrade to view this content.",authorisationFailedMessage:"Your log-in attempt did not appear to be successful. Please try again.",canvasIndexOutOfRange:"Canvas index out of range.",fallbackDegradedLabel:"Login",fallbackDegradedMessage:"Please log in to view this content at full resolution.",forbiddenResourceMessage:"Your current access rights are insufficient to view this image",mediaViewer:"Media Viewer",skipToDownload:"Skip to downloads and alternative formats",termsOfUse:"Terms of Use"},Pt={options:di,modules:pi,localisation:gi,content:fi},ai=class extends _chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.f{constructor(){super(...arguments),this.currentRotation=0,this.isAnnotating=!1,this.defaultConfig=Pt,this.locales={"en-GB":Pt,"cy-GB":()=>__webpack_require__.e(6989).then(__webpack_require__.bind(__webpack_require__,76989)),"fr-FR":()=>__webpack_require__.e(1103).then(__webpack_require__.bind(__webpack_require__,81103)),"pl-PL":()=>__webpack_require__.e(3407).then(__webpack_require__.bind(__webpack_require__,3407)),"sv-SE":()=>__webpack_require__.e(2212).then(__webpack_require__.bind(__webpack_require__,32212))}}create(){super.create(),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.METRIC_CHANGE,(()=>{if(!this.isDesktopMetric()){let e={pagingEnabled:!1};this.updateSettings(e),this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.UPDATE_SETTINGS)}})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,(e=>{this.previousAnnotationRect=null,this.currentAnnotationRect=null,this.changeCanvas(e)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CLEAR_ANNOTATIONS,(()=>{this.clearAnnotations(),this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATIONS_CLEARED),this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CLEAR_ANNOTATIONS)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.DOWN_ARROW,(()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus()})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.END,(()=>{this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,this.helper.getLastPageIndex())})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.FIRST,(()=>{this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.FIRST),this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,this.helper.getFirstPageIndex())})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.GALLERY_DECREASE_SIZE,(()=>{this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.GALLERY_DECREASE_SIZE)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.GALLERY_INCREASE_SIZE,(()=>{this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.GALLERY_INCREASE_SIZE)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.GALLERY_THUMB_SELECTED,(()=>{this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.GALLERY_THUMB_SELECTED)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.HOME,(()=>{this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,this.helper.getFirstPageIndex())})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.IMAGE_SEARCH,(e=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.IMAGE_SEARCH,e),this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,e)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.LAST,(()=>{this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.LAST),this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,this.helper.getLastPageIndex())})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.LEFT_ARROW,(()=>{this.useArrowKeysToNavigate()?this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,this.getPrevPageIndex()):this.centerPanel.setFocus()})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.LEFTPANEL_COLLAPSE_FULL_START,(()=>{this.isDesktopMetric()&&this.shell.$rightPanel.show()})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.LEFTPANEL_COLLAPSE_FULL_FINISH,(()=>{this.shell.$centerPanel.show(),this.resize()})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.LEFTPANEL_EXPAND_FULL_START,(()=>{this.shell.$centerPanel.hide(),this.shell.$rightPanel.hide()})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.MINUS,(()=>{this.centerPanel.setFocus()})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.MODE_CHANGE,(e=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.MODE_CHANGE,e),this.mode=new _chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.b(e);let t=this.getSettings();this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.SETTINGS_CHANGE,t)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.MULTISELECTION_MADE,(e=>{let t=new Tt;t.manifestUri=this.helper.manifestUri,t.allCanvases=e.length===this.helper.getCanvases().length,t.canvases=e,t.format=this.data.config.options.multiSelectionMimeType,t.sequence=this.helper.getCurrentSequence().id,this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.MULTISELECTION_MADE,t)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.NEXT,(()=>{this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.NEXT),this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,this.getNextPageIndex())})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.NEXT_SEARCH_RESULT,(()=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.NEXT_SEARCH_RESULT)})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE,(()=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE),this.nextSearchResult()})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE,(()=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE),this.prevSearchResult()})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.OPEN_THUMBS_VIEW,(()=>{this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.OPEN_THUMBS_VIEW)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.OPEN_TREE_VIEW,(()=>{this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.OPEN_TREE_VIEW)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.PAGE_DOWN,(()=>{this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,this.getNextPageIndex())})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PAGE_SEARCH,(e=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PAGE_SEARCH,e),this.viewLabel(e)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.PAGE_UP,(()=>{this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,this.getPrevPageIndex())})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PAGING_TOGGLED,(e=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PAGING_TOGGLED,e)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.PLUS,(()=>{this.centerPanel.setFocus()})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.PREV,(()=>{this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.PREV),this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,this.getPrevPageIndex())})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PREV_SEARCH_RESULT,(()=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PREV_SEARCH_RESULT)})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PRINT,(()=>{this.print()})),this.extensionHost.subscribe(_chunk_RPOSMM7Q_js__WEBPACK_IMPORTED_MODULE_9__.a.RELOAD,(()=>{this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CLEAR_ANNOTATIONS)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.RIGHT_ARROW,(()=>{this.useArrowKeysToNavigate()?this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,this.getNextPageIndex()):this.centerPanel.setFocus()})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_ANIMATION,(()=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_ANIMATION)})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_ROTATION,(e=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_ROTATION,e)})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_ANIMATION_FINISH,(e=>{let t=this.centerPanel.getViewportBounds(),i=this.helper.getCurrentCanvas();this.centerPanel&&t&&i&&(this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.XYWH_CHANGE,t.toString()),this.data.target=i.id+"#xywh="+t.toString(),this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.TARGET_CHANGE,this.data.target)),this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.CURRENT_VIEW_URI,{cropUri:this.getCroppedImageUri(i,this.getViewer()),fullUri:this.getConfinedImageUri(i,i.getWidth())})})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_ANIMATION_START,(()=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_ANIMATION_START)})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_OPEN,(()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus(),this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_OPEN)})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_RESIZE,(()=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_RESIZE)})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_ROTATION,(e=>{this.data.rotation=e,this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.OPENSEADRAGON_ROTATION,this.data.rotation),this.currentRotation=e})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.SEARCH,(e=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.SEARCH,e),this.search(e)})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.SEARCH_PREVIEW_FINISH,(()=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.SEARCH_PREVIEW_FINISH)})),this.extensionHost.subscribe(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.SEARCH_PREVIEW_START,(()=>{this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.SEARCH_PREVIEW_START)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATIONS,(e=>{this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATIONS,e)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATION_CANVAS_CHANGE,(e=>{this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,e[0].canvasIndex)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATIONS_EMPTY,(()=>{this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATIONS_EMPTY)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.THUMB_SELECTED,(e=>{this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,e.index)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.TREE_NODE_SELECTED,(e=>{this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.TREE_NODE_SELECTED,e.data.path),this.treeNodeSelected(e)})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.UP_ARROW,(()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus()})),this.extensionHost.subscribe(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.UPDATE_SETTINGS,(()=>{this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,this.helper.canvasIndex);let e=this.getSettings();this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.SETTINGS_CHANGE,e)}))}createModules(){super.createModules(),this.isHeaderPanelEnabled()?this.headerPanel=new bt(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()?this.leftPanel=new _chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.d(this.shell.$leftPanel):this.shell.$leftPanel.hide(),this.centerPanel=new Rt(this.shell.$centerPanel),this.isRightPanelEnabled()?this.rightPanel=new _chunk_3B47SJQJ_js__WEBPACK_IMPORTED_MODULE_5__.k(this.shell.$rightPanel):this.shell.$rightPanel.hide(),this.isFooterPanelEnabled()?(this.footerPanel=new yt(this.shell.$footerPanel),this.mobileFooterPanel=new wt(this.shell.$mobileFooterPanel)):this.shell.$footerPanel.hide(),this.$helpDialogue=$('<div class="overlay help" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$helpDialogue),this.helpDialogue=new _chunk_NROV7LWX_js__WEBPACK_IMPORTED_MODULE_1__.a(this.$helpDialogue),this.$moreInfoDialogue=$('<div class="overlay moreInfo" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$moreInfoDialogue),this.moreInfoDialogue=new _chunk_IDHCAN6N_js__WEBPACK_IMPORTED_MODULE_0__.a(this.$moreInfoDialogue),this.$multiSelectDialogue=$('<div class="overlay multiSelect" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$multiSelectDialogue),this.multiSelectDialogue=new Et(this.$multiSelectDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new _t(this.$shareDialogue),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new ft(this.$downloadDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new Ct(this.$settingsDialogue),this.$externalContentDialogue=$('<div class="overlay externalContent" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$externalContentDialogue),this.externalContentDialogue=new mt(this.$externalContentDialogue),this.isHeaderPanelEnabled()&&this.headerPanel.init(),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init(),this.isFooterPanelEnabled()&&this.footerPanel.init()}render(){super.render(),this.checkForTarget(),this.checkForAnnotations(),this.checkForSearchParam(),this.checkForRotationParam()}checkForTarget(){if(this.data.target){let e=this.data.target.split("#"),t=e[0],i=this.helper.getCanvasIndexById(t);null!==i&&this.helper.canvasIndex!==i&&this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,i);let n=e[1];this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.SET_TARGET,Se.fromString(n))}}checkForAnnotations(){if(this.data.annotations){let e=[],t=this.data.annotations;Array.isArray(t)?e=this.groupWebAnnotationsByTarget(this.data.annotations):t.resources.length&&(e=this.groupOpenAnnotationsByTarget(this.data.annotations),this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CLEAR_ANNOTATIONS)),this.annotate(e)}}annotate(e,t){this.annotations=e,this.annotations=e.sort(((e,t)=>e.canvasIndex-t.canvasIndex));let i=new _chunk_3UUJB7QR_js__WEBPACK_IMPORTED_MODULE_11__.a;i.terms=t,i.annotations=this.annotations,this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATIONS,i)}groupWebAnnotationsByTarget(e){let t=[];for(let i=0;i<e.length;i++){let n=e[i],s=n.target.match(/(.*)#/)[1],o=this.helper.getCanvasIndexById(s),r=new _chunk_76YR7XP2_js__WEBPACK_IMPORTED_MODULE_6__.b(s);r.canvasIndex=o;let a=t.filter((e=>e.canvasId===r.canvasId))[0];a?a.addRect(n):(r.addRect(n),t.push(r))}return t}groupOpenAnnotationsByTarget(e){let t=[];for(let i=0;i<e.resources.length;i++){let n=e.resources[i],s=n.on.match(/(.*)#/)[1],o=this.helper.getCanvasIndexById(s),r=new _chunk_76YR7XP2_js__WEBPACK_IMPORTED_MODULE_6__.b(s);r.canvasIndex=o;let a=t.filter((e=>e.canvasId===r.canvasId))[0];a?a.addRect(n):(r.addRect(n),t.push(r))}return t.sort(((e,t)=>e.canvasIndex-t.canvasIndex)),t}checkForSearchParam(){let e=this.data.highlight;e&&(e.replace(/\+/g," ").replace(/"/g,""),this.extensionHost.publish(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.SEARCH,e))}checkForRotationParam(){let e=this.data.rotation;e&&this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.SET_ROTATION,e)}changeCanvas(e){if(-1===e)return;let t=!1;e===this.helper.canvasIndex&&(t=!0),this.helper.isCanvasIndexOutOfRange(e)&&(this.showMessage(this.data.config.content.canvasIndexOutOfRange),e=0),this.isPagingSettingEnabled()&&!t&&this.getPagedIndices(e).includes(this.helper.canvasIndex),this.viewCanvas(e)}getViewer(){return this.centerPanel.viewer}getMode(){if(this.mode)return this.mode;switch(this.helper.getManifestType()){case Te.ManifestType.MONOGRAPH:case Te.ManifestType.MANUSCRIPT:return _chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.b.page;default:return _chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.b.image}}getViewportBounds(){if(!this.centerPanel)return null;let e=this.centerPanel.getViewportBounds();return e?e.toString():null}getViewerRotation(){return this.centerPanel?this.currentRotation:null}viewRange(e){let t=this.helper.getRangeByPath(e);if(!t)return;let i=t.getCanvasIds()[0],n=this.helper.getCanvasIndexById(i);this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,n),this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.RANGE_CHANGE,t)}viewLabel(e){if(!e)return this.showMessage(this.data.config.modules.genericDialogue.content.emptyValue),void this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE_FAILED);let t=this.helper.getCanvasIndexByLabel(e);-1!=t?this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,t):(this.showMessage(this.data.config.modules.genericDialogue.content.pageNotFound),this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE_FAILED))}treeNodeSelected(e){let t=e.data;if(t.type)switch(t.type){case Be.IIIFResourceType.MANIFEST:this.viewManifest(t);break;case Be.IIIFResourceType.COLLECTION:this.viewCollection(t);break;default:this.viewRange(t.path)}}clearAnnotations(){this.annotations=[],this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,this.helper.canvasIndex)}prevSearchResult(){let e;if(this.annotations)for(let t=this.annotations.length-1;t>=0;t--){let i=this.annotations[t];if(i.canvasIndex<=this.getPrevPageIndex()){e=i,this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,e.canvasIndex);break}}}nextSearchResult(){if(this.annotations)for(let e=0;e<this.annotations.length;e++){let t=this.annotations[e];if(t&&t.canvasIndex>=this.getNextPageIndex()){this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.CANVAS_INDEX_CHANGE,t.canvasIndex);break}}}bookmark(){super.bookmark();let e=this.helper.getCurrentCanvas(),t=new _chunk_CHPN5XCG_js__WEBPACK_IMPORTED_MODULE_12__.a;t.index=this.helper.canvasIndex,t.label=Te.LanguageMap.getValue(e.getLabel()),t.path=this.getCroppedImageUri(e,this.getViewer()),t.thumb=e.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth),t.title=this.helper.getLabel(),t.trackingLabel=window.trackingLabel,t.type=Be.ExternalResourceType.IMAGE,this.fire(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.BOOKMARK,t)}print(){window.print(),this.fire(_chunk_YJC225NB_js__WEBPACK_IMPORTED_MODULE_2__.c.PRINT)}getCroppedImageDimensions(e,t){if(!t||!t.viewport)return null;let i,n;if(i=e.getWidth()?e.getWidth():e.externalResource.width,n=e.getHeight()?e.getHeight():e.externalResource.height,!i||!n)return null;let s=t.viewport.getBounds(!0),o=new gt,r=Math.floor(s.width),a=Math.floor(s.height),l=Math.floor(s.x),h=Math.floor(s.y);l+r>i?r=i-l:l<0&&(r+=l),l<0&&(l=0),h+a>n?a=n-h:h<0&&(a+=h),h<0&&(h=0),r=Math.min(r,i),a=Math.min(a,n);let c=r,u=a,d=e.getMaxDimensions();if(d){if(r>d.width){let e=d.width;a=Math.round(e*(a/r)),r=e}if(a>d.height){let e=d.height;r=Math.round(r/a*e),a=e}}return o.region=new Te.Size(c,u),o.regionPos=new Ge(l,h),o.size=new Te.Size(r,a),o}getCroppedImageUri(e,t){if(!t||!t.viewport)return null;let i=this.getCroppedImageDimensions(e,t);if(!i)return null;let n=this.getImageBaseUri(e),s=this.getImageId(e);return s?`${n}/${s}/${i.regionPos.x+","+i.regionPos.y+","+i.region.width+","+i.region.height}/${i.size.width+","+i.size.height}/${this.getViewerRotation()}/default.jpg`:null}getConfinedImageDimensions(e,t){let i=e.getWidth();i||(i=e.externalResource.width);let n=e.getHeight();n||(n=e.externalResource.height);let s=new Te.Size(0,0);s.width=t;let o=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.g.normalise(t,0,i);return s.height=Math.floor(n*o),s}getConfinedImageUri(e,t){let i=this.getImageBaseUri(e),n=this.getImageId(e);if(!n)return null;let s=this.getConfinedImageDimensions(e,t);return`${i}/${n}/full/${s.width+","+s.height}/${this.getViewerRotation()}/default.jpg`}getImageId(e){if(e.externalResource){let t=e.externalResource.data["@id"];if(t)return t.substr(t.lastIndexOf("/")+1)}return null}getImageBaseUri(e){let t=this.getInfoUri(e);return t=t.substr(0,t.lastIndexOf("/")),t.substr(0,t.lastIndexOf("/"))}getInfoUri(e){let t=null,i=e.getImages();if(i&&i.length){let e=i[0].getResource().getServices();for(let i=0;i<e.length;i++){let n=e[i],s=n.id;s.endsWith("/")||(s+="/"),Te.Utils.isImageProfile(n.getProfile())&&(t=s+"info.json")}}else{i=e.getContent();let n=i[0].getBody();if(n.length){let e=n[0].getServices();for(let i=0;i<e.length;i++){let n=e[i],s=n.id;s.endsWith("/")||(s+="/"),Te.Utils.isImageProfile(n.getProfile())&&(t=s+"info.json")}}}return t||(t="lib/imageunavailable.json"),t}getEmbedScript(e,t,i,n,s){let o=this.data.config.uri||"",r=this.getSerializedLocales(),a=`${this.getAppUri()}#?manifest=${this.helper.manifestUri}&c=${this.helper.collectionIndex}&m=${this.helper.manifestIndex}&cv=${this.helper.canvasIndex}&config=${o}&locales=${r}&xywh=${n}&r=${s}`;return _chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(e,a,t.toString(),i.toString())}getPrevPageIndex(e=this.helper.canvasIndex){let t;if(this.isPagingSettingEnabled()){let i=this.getPagedIndices(e);t=this.helper.isRightToLeft()?i[i.length-1]-1:i[0]-1}else t=e-1;return t}isSearchEnabled(){return!(!_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.b.getBool(this.data.config.options.searchWithinEnabled,!1)||!this.helper.getSearchService())}isPagingSettingEnabled(){return!!this.helper.isPagingAvailable()&&this.getSettings().pagingEnabled}getNextPageIndex(e=this.helper.canvasIndex){let t;if(this.isPagingSettingEnabled()){let i=this.getPagedIndices(e);t=this.helper.isRightToLeft()?i[0]+1:i[i.length-1]+1}else t=e+1;return t>this.helper.getTotalCanvases()-1?-1:t}getAutoCompleteService(){let e=this.helper.getSearchService();return e?e.getService(Be.ServiceProfile.SEARCH_0_AUTO_COMPLETE)||e.getService(Be.ServiceProfile.SEARCH_1_AUTO_COMPLETE):null}getAutoCompleteUri(){let e=this.getAutoCompleteService();return e?e.id+"?q={0}":null}getSearchServiceUri(){let e=this.helper.getSearchService();if(!e)return null;let t=e.id;return t+="?q={0}",t}search(e){if(this.isAnnotating)return;this.isAnnotating=!0,this.annotations=[];let t=this,i=this.getSearchServiceUri();!i||(i=_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.n.format(i,encodeURIComponent(e)),this.getSearchResults(i,e,this.annotations,(i=>{t.isAnnotating=!1,i.length?t.annotate(i,e):t.showMessage(t.data.config.modules.genericDialogue.content.noMatches,(()=>{this.extensionHost.publish(_chunk_OEMHC5TT_js__WEBPACK_IMPORTED_MODULE_7__.p.ANNOTATIONS_EMPTY)}))})))}getSearchResults(e,t,i,n){fetch(e).then((e=>e.json())).then((e=>{e.resources&&e.resources.length&&(i=i.concat(this.groupOpenAnnotationsByTarget(e))),e.next?this.getSearchResults(e.next,t,i,n):n(i)}))}getAnnotationRects(){return this.annotations.length?this.annotations.map((e=>e.rects)).reduce(((e,t)=>e.concat(t))):[]}getCurrentAnnotationRectIndex(){let e=this.getAnnotationRects();return this.currentAnnotationRect?e.indexOf(this.currentAnnotationRect):-1}getTotalAnnotationRects(){return this.getAnnotationRects().length}isFirstAnnotationRect(){return 0===this.getCurrentAnnotationRectIndex()}getLastAnnotationRectIndex(){return this.getTotalAnnotationRects()-1}getPagedIndices(e=this.helper.canvasIndex){let t=[];return this.helper.isContinuous()?t=$.map(this.helper.getCanvases(),((e,t)=>t)):this.isPagingSettingEnabled()?(t=this.helper.isFirstCanvas(e)||this.helper.isLastCanvas(e)&&this.helper.isTotalCanvasesEven()?[e]:e%2?[e,e+1]:[e-1,e],this.helper.isRightToLeft()&&(t=t.reverse())):t.push(this.helper.canvasIndex),t}}}}]);