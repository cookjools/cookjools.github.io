"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8386],{48386:function(t,e,i){i.d(e,{a:function(){return S},b:function(){return j},c:function(){return at},d:function(){return L},e:function(){return C},f:function(){return K},g:function(){return lt},h:function(){return X},i:function(){return Z},j:function(){return u},k:function(){return ot},l:function(){return ct},m:function(){return pt}});var n,s,o=i(47903),r=i(78853),a=i(58262),l=i(47891),h=i(75285),c=i(34155),u=(0,h.b)(((t,e)=>{var n,s;n="undefined"!=typeof self?self:t,s=function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e||4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o,r,a=i(2),l=i(3),h=i(4);(r=o=e.LimitType||(e.LimitType={})).LINES="lines",r.CHARS="chars";var c=function(t){function e(e){var i=t.call(this,e)||this;return i._data=i.data(),i._data=i.options.data,i._init(),i._resize(),i}return s(e,t),e.prototype._init=function(){return t.prototype._init.call(this),this._$element=$(this.el),this._$metadataGroupTemplate=$('<div class="group">          <div class="header"></div>          <div class="items"></div>      </div>'),this._$metadataItemTemplate=$('<div class="item">          <div class="label"></div>          <div class="values"></div>      </div>'),this._$metadataItemValueTemplate=$('<div class="value"></div>'),this._$metadataItemURIValueTemplate=$('<a class="value" href="" target="_blank"></a>'),this._$copyTextTemplate=$('<div class="copyText" alt="'+this.options.data.content.copyToClipboard+'" title="'+this.options.data.content.copyToClipboard+'">        <div class="copiedText">'+this.options.data.content.copiedToClipboard+" </div>        </div>"),this._$metadataGroups=$('<div class="groups"></div>'),this._$element.append(this._$metadataGroups),this._$noData=$('<div class="noData">'+this.options.data.content.noData+"</div>"),this._$element.append(this._$noData),!0},e.prototype.data=function(){return{aggregateValues:"",canvases:null,canvasDisplayOrder:"",metadataGroupOrder:"",canvasExclude:"",canvasLabels:"",content:{attribution:"Attribution",canvasHeader:"About the canvas",copiedToClipboard:"Copied to clipboard",copyToClipboard:"Copy to clipboard",description:"Description",imageHeader:"About the image",less:"less",license:"License",logo:"Logo",manifestHeader:"About the item",more:"more",noData:"No data to display",rangeHeader:"About the range",sequenceHeader:"About the sequence"},copiedMessageDuration:2e3,copyToClipboardEnabled:!1,helper:null,licenseFormatter:null,limit:4,limitType:o.LINES,limitToRange:!1,manifestDisplayOrder:"",manifestExclude:"",range:null,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",sanitizer:function(t){return t},showAllLanguages:!1}},e.prototype._getManifestGroup=function(){return this._metadataGroups.filter((function(t){return t.resource.isManifest()}))[0]},e.prototype._getCanvasGroups=function(){return this._metadataGroups.filter((function(t){return t.resource.isCanvas()}))},e.prototype.set=function(t){var e=this;if(this._data=Object.assign(this._data,t),this._data&&this._data.helper){var i,n={canvases:this._data.canvases,licenseFormatter:this._data.licenseFormatter,range:this._data.range};if(this._metadataGroups=this._data.helper.getMetadata(n),this._data.manifestDisplayOrder&&((i=this._getManifestGroup()).items=this._sortItems(i.items,this._readCSV(this._data.manifestDisplayOrder))),this._data.canvasDisplayOrder&&this._getCanvasGroups().forEach((function(t,i){t.items=e._sortItems(t.items,e._readCSV(e._data.canvasDisplayOrder))})),this._data.metadataGroupOrder&&(this._metadataGroups=this._sortGroups(this._metadataGroups,this._readCSV(this._data.metadataGroupOrder))),this._data.canvasLabels&&this._label(this._getCanvasGroups(),this._readCSV(this._data.canvasLabels,!1)),this._data.manifestExclude&&((i=this._getManifestGroup()).items=this._exclude(i.items,this._readCSV(this._data.manifestExclude))),this._data.canvasExclude&&this._getCanvasGroups().forEach((function(t,i){t.items=e._exclude(t.items,e._readCSV(e._data.canvasExclude))})),this._data.limitToRange){var s=[];this._metadataGroups.forEach((function(t,e){t.resource.isRange()&&s.push(t)})),s.length&&(this._metadataGroups=s)}this._render()}},e.prototype._sortItems=function(t,e){var i=this,n=[],s=t.slice(0);return e.forEach((function(t,e){var o=s.filter((function(e){return i._normalise(e.getLabel())===t}))[0];if(o){n.push(o);var r=s.indexOf(o);r>-1&&s.splice(r,1)}})),s.forEach((function(t,e){n.push(t)})),n},e.prototype._sortGroups=function(t,e){var i=[],n=t.slice(0);return e.forEach((function(t,e){var s=n.filter((function(e){return e.resource.getIIIFResourceType().toLowerCase()==t.toLowerCase()}))[0];if(s){i.push(s);var o=n.indexOf(s);o>-1&&n.splice(o,1)}})),i},e.prototype._label=function(t,e){t.forEach((function(t,i){t.label=e[i]}))},e.prototype._exclude=function(t,e){var i=this;return e.forEach((function(e,n){var s=t.filter((function(t){return i._normalise(t.getLabel())===e}))[0];if(s){var o=t.indexOf(s);o>-1&&t.splice(o,1)}})),t},e.prototype._normalise=function(t){return t?t.toLowerCase().replace(/ /g,""):null},e.prototype._render=function(){var t=this;this._metadataGroups.length?(this._$noData.hide(),this._$metadataGroups.empty(),this._metadataGroups.forEach((function(e,i){var n=t._buildMetadataGroup(e);t._$metadataGroups.append(n);var s=n.find(".value");t._data.limit&&t._data.content&&(t._data.limitType===o.LINES?s.toggleExpandTextByLines(t._data.limit,t._data.content.less,t._data.content.more,(function(){})):t._data.limitType===o.CHARS&&s.ellipsisHtmlFixed(t._data.limit,(function(){})))}))):this._$noData.show()},e.prototype._buildMetadataGroup=function(t){var e=this._$metadataGroupTemplate.clone(),i=e.find(">.header");if(this._data.content)if(t.resource.isManifest()&&this._data.content.manifestHeader)(s=this._sanitize(this._data.content.manifestHeader))&&i.html(s);else if(t.resource.isSequence()&&this._data.content.sequenceHeader)(s=this._sanitize(this._data.content.sequenceHeader))&&i.html(s);else if(t.resource.isRange()&&this._data.content.rangeHeader)(s=this._sanitize(this._data.content.rangeHeader))&&i.html(s);else if(t.resource.isCanvas()&&(t.label||this._data.content.canvasHeader)){var n=t.label||this._data.content.canvasHeader;i.html(this._sanitize(n))}else if(t.resource.isAnnotation()&&this._data.content.imageHeader){var s;(s=this._sanitize(this._data.content.imageHeader))&&i.html(s)}i.text()||i.hide();for(var o=e.find(".items"),r=0;r<t.items.length;r++){var a=t.items[r],l=this._buildMetadataItem(a);o.append(l)}return e},e.prototype._buildMetadataItem=function(t){var e,i=this._$metadataItemTemplate.clone(),n=i.find(".label"),s=i.find(".values"),o=t.getLabel(),r=o,a=new RegExp("/w+:(/?/?)[^s]+/gm","i");if(this._data.content&&r&&t.isRootLevel)switch(r.toLowerCase()){case"attribution":r=this._data.content.attribution;break;case"description":r=this._data.content.description;break;case"license":r=this._data.content.license;break;case"logo":r=this._data.content.logo}if(r=this._sanitize(r),n.html(r),this._addReadingDirection(n,this._getLabelLocale(t)),i.addClass(h.Strings.toCssClass(r)),o&&"license"===o.toLowerCase()&&null!==a.exec(t.value[0].value))e=this._buildMetadataItemURIValue(t.value[0].value),s.append(e);else if(this._data.showAllLanguages&&t.value&&t.value.length>1)for(var l=0;l<t.value.length;l++){var c=t.value[l];e=this._buildMetadataItemValue(c.value,c.locale),s.append(e)}else{var p=this._getValueLocale(t),d=!1;for(l=0;l<t.value.length;l++)c=t.value[l],p.toLowerCase()===c.locale.toLowerCase()&&(d=!0,e=this._buildMetadataItemValue(c.value,c.locale),s.append(e));d||(c=t.value[0])&&(e=this._buildMetadataItemValue(c.value,c.locale),s.append(e))}this._data.copyToClipboardEnabled&&h.Clipboard.supportsCopy()&&n.text()&&this._addCopyButton(i,n,s);var f=this;return i.on("click","a.iiif-viewer-link",(function(t){t.preventDefault();var e=$(t.target),i=e.attr("data-uv-navigate")||e.prop("href");f.fire(u.IIIF_VIEWER_LINK_CLICKED,i)})),i.on("click","[data-uv-navigate]",(function(t){t.preventDefault();var e=$(t.target).attr("data-uv-navigate")||null;e&&f.fire(u.IIIF_VIEWER_LINK_CLICKED,e)})),i},e.prototype._getLabelLocale=function(t){if(!this._data||!this._data.helper)return"";var e=this._data.helper.options.locale;if(t.label.length){var i=t.label[0].locale;if(i.toLowerCase()!==e.toLowerCase())return i}return e},e.prototype._getValueLocale=function(t){return this._data&&this._data.helper?this._data.helper.options.locale:""},e.prototype._buildMetadataItemValue=function(t,e){t=(t=this._sanitize(t)).replace("\n","<br>");var i=this._$metadataItemValueTemplate.clone();return i.html(t),i.find("a").each((function(){var t=$(this);t.hasClass("iiif-viewer-link")||t.prop("target","_blank")})),e&&this._addReadingDirection(i,e),i},e.prototype._buildMetadataItemURIValue=function(t){t=this._sanitize(t);var e=this._$metadataItemURIValueTemplate.clone();return e.prop("href",t),e.text(t),e},e.prototype._addReadingDirection=function(t,e){e=a.Utils.getInexactLocale(e),this._readCSV(this._data.rtlLanguageCodes).filter((function(t){return t===e})).length>0&&(t.prop("dir","rtl"),t.addClass("rtl"))},e.prototype._addCopyButton=function(t,e,i){var n=this._$copyTextTemplate.clone(),s=n.children();e.append(n),h.Device.isTouch()?n.show():(t.on("mouseenter",(function(){n.show()})),t.on("mouseleave",(function(){n.hide()})),n.on("mouseleave",(function(){s.hide()})));var o=this,r=i.text();n.on("click",(function(t){o._copyItemValues(n,r)}))},e.prototype._copyItemValues=function(t,e){h.Clipboard.copy(e);var i=t.find(".copiedText");i.show(),setTimeout((function(){i.hide()}),this._data.copiedMessageDuration)},e.prototype._readCSV=function(t,e){void 0===e&&(e=!0);var i=[];if(t&&(i=t.split(","),e))for(var n=0;n<i.length;n++)i[n]=this._normalise(i[n]);return i},e.prototype._sanitize=function(t){return this._data.sanitizer?this._data.sanitizer(t):null},e.prototype._resize=function(){},e}(l.BaseComponent);e.MetadataComponent=c;var u=function(){function t(){}return t.IIIF_VIEWER_LINK_CLICKED="iiifViewerLinkClicked",t}();e.Events=u},function(t,e,i){t.exports=function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e||4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(t,e,i){function n(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),n(i(6)),n(i(7)),n(i(8)),n(i(9)),n(i(10)),n(i(11)),n(i(12)),n(i(13)),n(i(14)),n(i(15)),n(i(16)),n(i(17)),n(i(18)),n(i(19)),n(i(20)),n(i(21)),n(i(22)),n(i(23)),n(i(24)),n(i(25)),n(i(26)),n(i(27)),n(i(28)),n(i(29)),n(i(30)),n(i(31)),n(i(32)),n(i(2))},function(t,e,i){var n;Object.defineProperty(e,"__esModule",{value:!0}),(n=e.AnnotationMotivation||(e.AnnotationMotivation={})).BOOKMARKING="oa:bookmarking",n.CLASSIFYING="oa:classifying",n.COMMENTING="oa:commenting",n.DESCRIBING="oa:describing",n.EDITING="oa:editing",n.HIGHLIGHTING="oa:highlighting",n.IDENTIFYING="oa:identifying",n.LINKING="oa:linking",n.MODERATING="oa:moderating",n.PAINTING="sc:painting",n.QUESTIONING="oa:questioning",n.REPLYING="oa:replying",n.TAGGING="oa:tagging",n.TRANSCRIBING="oad:transcribing",function(t){t.AUTO_ADVANCE="auto-advance",t.CONTINUOUS="continuous",t.FACING_PAGES="facing-pages",t.HIDDEN="hidden",t.INDIVIDUALS="individuals",t.MULTI_PART="multi-part",t.NO_NAV="no-nav",t.NON_PAGED="non-paged",t.PAGED="paged",t.REPEAT="repeat",t.SEQUENCE="sequence",t.THUMBNAIL_NAV="thumbnail-nav",t.TOGETHER="together",t.UNORDERED="unordered"}(e.Behavior||(e.Behavior={})),function(t){t.CANVAS="canvas",t.CHOICE="choice",t.CONTENT_AS_TEXT="contentastext",t.DOCUMENT="document",t.IMAGE="image",t.MOVING_IMAGE="movingimage",t.PDF="pdf",t.PHYSICAL_OBJECT="physicalobject",t.SOUND="sound",t.TEXTUALBODY="textualbody",t.VIDEO="video"}(e.ExternalResourceType||(e.ExternalResourceType={})),function(t){t.ANNOTATION="annotation",t.CANVAS="canvas",t.COLLECTION="collection",t.MANIFEST="manifest",t.RANGE="range",t.SEQUENCE="sequence"}(e.IIIFResourceType||(e.IIIFResourceType={})),function(t){t.AUDIO_MP4="audio/mp4",t.CORTO="application/corto",t.DRACO="application/draco",t.GLTF="model/gltf+json",t.JPG="image/jpeg",t.M3U8="application/vnd.apple.mpegurl",t.MP3="audio/mp3",t.MPEG_DASH="application/dash+xml",t.OBJ="text/plain",t.PDF="application/pdf",t.PLY="application/ply",t.THREEJS="application/vnd.threejs+json",t.VIDEO_MP4="video/mp4",t.WEBM="video/webm"}(e.MediaType||(e.MediaType={})),function(t){t.DOC="application/msword",t.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",t.PDF="application/pdf"}(e.RenderingFormat||(e.RenderingFormat={})),function(t){t.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",t.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",t.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",t.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",t.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",t.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",t.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",t.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",t.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",t.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",t.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",t.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",t.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",t.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",t.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",t.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",t.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",t.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",t.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",t.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",t.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",t.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",t.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",t.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",t.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",t.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",t.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",t.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",t.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",t.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",t.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",t.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",t.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",t.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",t.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",t.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",t.SEARCH_0="http://iiif.io/api/search/0/search",t.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",t.SEARCH_1="http://iiif.io/api/search/1/search",t.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",t.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",t.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",t.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",t.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",t.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",t.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(e.ServiceProfile||(e.ServiceProfile={})),function(t){t.BOTTOM_TO_TOP="bottom-to-top",t.LEFT_TO_RIGHT="left-to-right",t.RIGHT_TO_LEFT="right-to-left",t.TOP_TO_BOTTOM="top-to-bottom"}(e.ViewingDirection||(e.ViewingDirection={})),function(t){t.CONTINUOUS="continuous",t.INDIVIDUALS="individuals",t.NON_PAGED="non-paged",t.PAGED="paged",t.TOP="top"}(e.ViewingHint||(e.ViewingHint={}))},function(t,e,i){var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{l(n.next(t))}catch(e){o(e)}}function a(t){try{l(n.throw(t))}catch(e){o(e)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var i,n,s,o,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,n=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(s=(s=r.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){r=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){r.label=o[1];break}if(6===o[0]&&r.label<s[1]){r.label=s[1],s=o;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(o);break}s[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(a){o=[6,a],n=0}finally{i=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=i(1),a=i(33);i(34);var l=function(){function t(){}return t.getMediaType=function(t){return(t=(t=t.toLowerCase()).split(";")[0]).trim()},t.getImageQuality=function(t){return t===r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||t===r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||t===r.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||t===r.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||t===r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||t===r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||t===r.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||t===r.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||t===r.ServiceProfile.IMAGE_1_LEVEL_1||t===r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||t===r.ServiceProfile.IMAGE_1_LEVEL_2||t===r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},t.getInexactLocale=function(t){return-1!==t.indexOf("-")?t.substr(0,t.indexOf("-")):t},t.getLocalisedValue=function(t,e){if(!Array.isArray(t))return t;for(var i=0;i<t.length;i++){var n=t[i];if(e===n["@language"])return n["@value"]}var s=e.substr(0,e.indexOf("-"));for(i=0;i<t.length;i++){var o=t[i];if(o["@language"]===s)return o["@value"]}return null},t.generateTreeNodeIds=function(e,i){var n;void 0===i&&(i=0),n=e.parentNode?e.parentNode.id+"-"+i:"0",e.id=n;for(var s=0;s<e.nodes.length;s++){var o=e.nodes[s];t.generateTreeNodeIds(o,s)}},t.normaliseType=function(t){return-1!==(t=t.toLowerCase()).indexOf(":")?t.split(":")[1]:t},t.normaliseUrl=function(t){return-1!==(t=t.substr(t.indexOf("://"))).indexOf("#")&&(t=t.split("#")[0]),t},t.normalisedUrlsMatch=function(e,i){return t.normaliseUrl(e)===t.normaliseUrl(i)},t.isImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_LEVEL_0)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_LEVEL_1)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_LEVEL_2)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_2_LEVEL_0)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_2_LEVEL_1)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_2_LEVEL_2)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},t.isLevel0ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_LEVEL_0)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_2_LEVEL_0)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},t.isLevel1ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_LEVEL_1)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_2_LEVEL_1)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},t.isLevel2ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_LEVEL_2)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_2_LEVEL_2)||t.normalisedUrlsMatch(e,r.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},t.parseManifest=function(t,e){return o.Deserialiser.parse(t,e)},t.checkStatus=function(t){if(t.ok)return t;var e=new Error(t.statusText);return e.response=t,Promise.reject(e)},t.loadManifest=function(e){return new Promise((function(i){fetch(e).then(t.checkStatus).then((function(t){return t.json()})).then((function(t){i(t)}))}))},t.loadExternalResourcesAuth1=function(e,i,n,s,o,r,a,l){return new Promise((function(h,c){var u=e.map((function(e){return t.loadExternalResourceAuth1(e,i,n,s,o,r,a,l)}));Promise.all(u).then((function(){h(e)})).catch((function(t){c(t)}))}))},t.loadExternalResourceAuth1=function(e,i,o,r,l,h,c,u){return n(this,void 0,void 0,(function(){var n;return s(this,(function(s){switch(s.label){case 0:return[4,r(e)];case 1:return(n=s.sent())?[4,e.getData(n)]:[3,6];case 2:return s.sent(),e.status!==a.OK?[3,3]:[2,e];case 3:return[4,t.doAuthChain(e,i,o,l,h,c,u)];case 4:s.sent(),s.label=5;case 5:if(e.status===a.OK||e.status===a.MOVED_TEMPORARILY)return[2,e];throw t.createAuthorizationFailedError();case 6:return[4,e.getData()];case 7:return s.sent(),e.status!==a.MOVED_TEMPORARILY&&e.status!==a.UNAUTHORIZED?[3,9]:[4,t.doAuthChain(e,i,o,l,h,c,u)];case 8:s.sent(),s.label=9;case 9:if(e.status===a.OK||e.status===a.MOVED_TEMPORARILY)return[2,e];throw t.createAuthorizationFailedError()}}))}))},t.doAuthChain=function(e,i,o,r,l,h,c){return n(this,void 0,void 0,(function(){var n,u,p,d,f,g,m,_;return s(this,(function(s){switch(s.label){case 0:return e.isAccessControlled()?((n=e.externalService)&&(n.options=e.options),(u=e.kioskService)&&(u.options=e.options),(p=e.clickThroughService)&&(p.options=e.options),(d=e.loginService)&&(d.options=e.options),e.isResponseHandled||e.status!==a.MOVED_TEMPORARILY?[3,2]:[4,h(e)]):[2,e];case 1:case 3:case 6:case 10:case 14:return s.sent(),[2,e];case 2:return f=null,g=null,(f=n)?(g=f,[4,t.attemptResourceWithToken(e,o,f)]):[3,4];case 4:return(f=u)?(g=f,(m=i(f))?[4,r(m)]:[3,7]):[3,7];case 5:case 9:case 13:return s.sent(),[4,t.attemptResourceWithToken(e,o,f)];case 7:return(f=p)?(g=f,[4,l(e,f)]):[3,11];case 8:return(_=s.sent())?[4,r(_)]:[3,11];case 11:return(f=d)?(g=f,[4,l(e,f)]):[3,15];case 12:return(_=s.sent())?[4,r(_)]:[3,15];case 15:return g&&c(e,g),[2]}}))}))},t.attemptResourceWithToken=function(t,e,i){return n(this,void 0,void 0,(function(){var n,o;return s(this,(function(s){switch(s.label){case 0:return(n=i.getService(r.ServiceProfile.AUTH_1_TOKEN))?[4,e(t,n)]:[3,3];case 1:return(o=s.sent())&&o.accessToken?[4,t.getData(o)]:[3,3];case 2:return s.sent(),[2,t];case 3:return[2]}}))}))},t.loadExternalResourcesAuth09=function(e,i,n,s,o,r,a,l,h,c){return new Promise((function(u,p){var d=e.map((function(e){return t.loadExternalResourceAuth09(e,i,n,s,o,r,a,l,h,c)}));Promise.all(d).then((function(){u(e)})).catch((function(t){p(t)}))}))},t.loadExternalResourceAuth09=function(e,i,n,s,o,r,l,h,c,u){return new Promise((function(p,d){u&&u.pessimisticAccessControl?e.getData().then((function(){e.isAccessControlled()?e.clickThroughService?(p(n(e)),p(s(e))):o(e).then((function(){r(e,!0).then((function(i){e.getData(i).then((function(){p(c(e))})).catch((function(e){d(t.createInternalServerError(e))}))})).catch((function(e){d(t.createInternalServerError(e))}))})).catch((function(e){d(t.createInternalServerError(e))})):p(e)})).catch((function(e){d(t.createInternalServerError(e))})):h(e,i).then((function(u){u?e.getData(u).then((function(){e.status===a.OK?p(c(e)):t.authorize(e,i,n,s,o,r,l,h).then((function(){p(c(e))})).catch((function(e){d(t.createAuthorizationFailedError())}))})).catch((function(e){d(t.createAuthorizationFailedError())})):t.authorize(e,i,n,s,o,r,l,h).then((function(){p(c(e))})).catch((function(e){d(t.createAuthorizationFailedError())}))})).catch((function(e){d(t.createAuthorizationFailedError())}))}))},t.createError=function(t,e){var i=new Error;return i.message=e,i.name=String(t),i},t.createAuthorizationFailedError=function(){return t.createError(o.StatusCode.AUTHORIZATION_FAILED,"Authorization failed")},t.createRestrictedError=function(){return t.createError(o.StatusCode.RESTRICTED,"Restricted")},t.createInternalServerError=function(e){return t.createError(o.StatusCode.INTERNAL_SERVER_ERROR,e)},t.authorize=function(e,i,n,s,o,r,l,h){return new Promise((function(c,u){e.getData().then((function(){e.isAccessControlled()?h(e,i).then((function(h){h?e.getData(h).then((function(){e.status===a.OK?c(e):t.showAuthInteraction(e,i,n,s,o,r,l,c,u)})).catch((function(e){u(t.createInternalServerError(e))})):r(e,!1).then((function(h){h?l(e,h,i).then((function(){e.getData(h).then((function(){e.status===a.OK?c(e):t.showAuthInteraction(e,i,n,s,o,r,l,c,u)})).catch((function(e){u(t.createInternalServerError(e))}))})).catch((function(e){u(t.createInternalServerError(e))})):t.showAuthInteraction(e,i,n,s,o,r,l,c,u)}))})).catch((function(e){u(t.createInternalServerError(e))})):c(e)}))}))},t.showAuthInteraction=function(e,i,n,s,o,r,l,h,c){e.status!==a.MOVED_TEMPORARILY||e.isResponseHandled?e.clickThroughService&&!e.isResponseHandled?n(e).then((function(){r(e,!0).then((function(n){l(e,n,i).then((function(){e.getData(n).then((function(){h(e)})).catch((function(e){c(t.createInternalServerError(e))}))})).catch((function(e){c(t.createInternalServerError(e))}))})).catch((function(e){c(t.createInternalServerError(e))}))})):o(e).then((function(){r(e,!0).then((function(n){l(e,n,i).then((function(){e.getData(n).then((function(){h(e)})).catch((function(e){c(t.createInternalServerError(e))}))})).catch((function(e){c(t.createInternalServerError(e))}))})).catch((function(e){c(t.createInternalServerError(e))}))})):h(e)},t.getService=function(t,e){for(var i=this.getServices(t),n=0;n<i.length;n++){var s=i[n];if(s.getProfile()===e)return s}return null},t.getResourceById=function(e,i){return t.traverseAndFind(e.__jsonld,"@id",i)},t.traverseAndFind=function(e,i,n){if(e.hasOwnProperty(i)&&e[i]===n)return e;for(var s=0;s<Object.keys(e).length;s++)if("object"==typeof e[Object.keys(e)[s]]){var o=t.traverseAndFind(e[Object.keys(e)[s]],i,n);if(null!=o)return o}},t.getServices=function(t){var e,i=[];if(!(e=t.__jsonld?t.__jsonld.service:t.service))return i;Array.isArray(e)||(e=[e]);for(var n=0;n<e.length;n++){var s=e[n];if("string"==typeof s){var r=this.getResourceById(t.options.resource,s);r&&i.push(new o.Service(r.__jsonld||r,t.options))}else i.push(new o.Service(s,t.options))}return i},t.getTemporalComponent=function(t){var e=/t=([^&]+)/g.exec(t),i=null;return e&&e[1]&&(i=e[1].split(",")),i},t}();e.Utils=l},function(t,e,i){i.r(e),e.default=function(t,e){return e=e||{},new Promise((function(i,n){var s=new XMLHttpRequest,o=[],r=[],a={},l=function(){return{ok:2==(s.status/100|0),statusText:s.statusText,status:s.status,url:s.responseURL,text:function(){return Promise.resolve(s.responseText)},json:function(){return Promise.resolve(JSON.parse(s.responseText))},blob:function(){return Promise.resolve(new Blob([s.response]))},clone:l,headers:{keys:function(){return o},entries:function(){return r},get:function(t){return a[t.toLowerCase()]},has:function(t){return t.toLowerCase()in a}}}};for(var h in s.open(e.method||"get",t,!0),s.onload=function(){s.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(t,e,i){o.push(e=e.toLowerCase()),r.push([e,i]),a[e]=a[e]?a[e]+","+i:i})),i(l())},s.onerror=n,s.withCredentials="include"==e.credentials,e.headers)s.setRequestHeader(h,e.headers[h]);s.send(e.body||null)}))}},function(t,e,i){t.exports=i(5)},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}(i(0));var n=i(2);e.loadManifest=function(t){return n.Utils.loadManifest(t)},e.parseManifest=function(t,e){return n.Utils.parseManifest(t,e)}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.__jsonld=t,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return t.prototype.getProperty=function(t){var e=null;return this.__jsonld&&((e=this.__jsonld[t])||(e=this.__jsonld["@"+t])),e},t}();e.JSONLDResource=n},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=i(1),a=function(t){function e(e,i){var n=t.call(this,e)||this;return n.options=i,n}return s(e,t),e.prototype.getIIIFResourceType=function(){return o.Utils.normaliseType(this.getProperty("type"))},e.prototype.getLabel=function(){var t=this.getProperty("label");return t?o.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getDefaultLabel=function(){return o.LanguageMap.getValue(this.getLabel())},e.prototype.getMetadata=function(){var t=this.getProperty("metadata"),e=[];if(!t)return e;for(var i=0;i<t.length;i++){var n=t[i],s=new o.LabelValuePair(this.options.locale);s.parse(n),e.push(s)}return e},e.prototype.getRendering=function(t){for(var e=this.getRenderings(),i=0;i<e.length;i++){var n=e[i];if(n.getFormat()===t)return n}return null},e.prototype.getRenderings=function(){var t,e=[];if(!(t=this.__jsonld?this.__jsonld.rendering:this.rendering))return e;Array.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){var n=t[i];e.push(new o.Rendering(n,this.options))}return e},e.prototype.getService=function(t){return o.Utils.getService(this,t)},e.prototype.getServices=function(){return o.Utils.getServices(this)},e.prototype.getThumbnail=function(){var t=this.getProperty("thumbnail");return Array.isArray(t)&&(t=t[0]),t?new o.Thumbnail(t,this.options):null},e.prototype.isAnnotation=function(){return this.getIIIFResourceType()===r.IIIFResourceType.ANNOTATION},e.prototype.isCanvas=function(){return this.getIIIFResourceType()===r.IIIFResourceType.CANVAS},e.prototype.isCollection=function(){return this.getIIIFResourceType()===r.IIIFResourceType.COLLECTION},e.prototype.isManifest=function(){return this.getIIIFResourceType()===r.IIIFResourceType.MANIFEST},e.prototype.isRange=function(){return this.getIIIFResourceType()===r.IIIFResourceType.RANGE},e.prototype.isSequence=function(){return this.getIIIFResourceType()===r.IIIFResourceType.SEQUENCE},e}(o.JSONLDResource);e.ManifestResource=a},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=function(t){function e(e,i){return t.call(this,e,i)||this}return s(e,t),e.prototype.getFormat=function(){var t=this.getProperty("format");return t?t.toLowerCase():null},e.prototype.getResources=function(){var t=[];if(!this.__jsonld.resources)return t;for(var e=0;e<this.__jsonld.resources.length;e++){var i=this.__jsonld.resources[e],n=new o.Annotation(i,this.options);t.push(n)}return t},e.prototype.getType=function(){var t=this.getProperty("type");return t?o.Utils.normaliseType(t):null},e.prototype.getWidth=function(){return this.getProperty("width")},e.prototype.getHeight=function(){return this.getProperty("height")},e.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},e.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},e}(o.ManifestResource);e.Resource=r},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=i(1),a=function(t){function e(e,i){var n=t.call(this,e,i)||this;n.index=-1,n.isLoaded=!1;var s={defaultLabel:"-",locale:"en-GB",resource:n,pessimisticAccessControl:!1};return n.options=Object.assign(s,i),n}return s(e,t),e.prototype.getAttribution=function(){var t=this.getProperty("attribution");return t?o.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getDescription=function(){var t=this.getProperty("description");return t?o.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getIIIFResourceType=function(){return o.Utils.normaliseType(this.getProperty("type"))},e.prototype.getLogo=function(){var t=this.getProperty("logo");return t?"string"==typeof t?t:(Array.isArray(t)&&t.length&&(t=t[0]),t["@id"]||t.id):null},e.prototype.getLicense=function(){return o.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},e.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},e.prototype.getRelated=function(){return this.getProperty("related")},e.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},e.prototype.getTrackingLabel=function(){var t=this.getService(r.ServiceProfile.TRACKING_EXTENSIONS);return t?t.getProperty("trackingLabel"):""},e.prototype.getDefaultTree=function(){return this.defaultTree=new o.TreeNode("root"),this.defaultTree.data=this,this.defaultTree},e.prototype.getRequiredStatement=function(){var t=null,e=this.getProperty("requiredStatement");if(e)(t=new o.LabelValuePair(this.options.locale)).parse(e);else{var i=this.getAttribution();i&&((t=new o.LabelValuePair(this.options.locale)).value=i)}return t},e.prototype.isCollection=function(){return this.getIIIFResourceType()===r.IIIFResourceType.COLLECTION},e.prototype.isManifest=function(){return this.getIIIFResourceType()===r.IIIFResourceType.MANIFEST},e.prototype.load=function(){var t=this;return new Promise((function(e){if(t.isLoaded)e(t);else{var i=t.options;i.navDate=t.getNavDate();var n=t.__jsonld.id;n||(n=t.__jsonld["@id"]),o.Utils.loadManifest(n).then((function(n){t.parentLabel=o.LanguageMap.getValue(t.getLabel(),i.locale);var s=o.Deserialiser.parse(n,i);(t=Object.assign(t,s)).index=i.index,e(t)}))}}))},e}(o.ManifestResource);e.IIIFResource=a},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=function(t){function e(e,i){return t.call(this,e,i)||this}return s(e,t),e.prototype.getBody=function(){var t=[],e=this.getProperty("body");if(e)if(Array.isArray(e))for(var i=0;i<e.length;i++)if((r=e[i]).items)for(var n=0;n<r.items.length;n++){var s=r.items[n];t.push(new o.AnnotationBody(s,this.options))}else t.push(new o.AnnotationBody(r,this.options));else if(e.items)for(i=0;i<e.items.length;i++){var r=e.items[i];t.push(new o.AnnotationBody(r,this.options))}else t.push(new o.AnnotationBody(e,this.options));return t},e.prototype.getMotivation=function(){return this.getProperty("motivation")||null},e.prototype.getOn=function(){return this.getProperty("on")},e.prototype.getTarget=function(){return this.getProperty("target")},e.prototype.getResource=function(){return new o.Resource(this.getProperty("resource"),this.options)},e}(o.ManifestResource);e.Annotation=r},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=function(t){function e(e,i){return t.call(this,e,i)||this}return s(e,t),e.prototype.getFormat=function(){var t=this.getProperty("format");return t?o.Utils.getMediaType(t):null},e.prototype.getType=function(){return this.getProperty("type")?o.Utils.normaliseType(this.getProperty("type")):null},e.prototype.getWidth=function(){return this.getProperty("width")},e.prototype.getHeight=function(){return this.getProperty("height")},e}(o.ManifestResource);e.AnnotationBody=r},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=function(t){function e(e,i,n){var s=t.call(this,i)||this;return s.label=e,s.options=n,s}return s(e,t),e.prototype.getIIIFResourceType=function(){return o.Utils.normaliseType(this.getProperty("type"))},e.prototype.getLabel=function(){return this.label},e.prototype.getResources=function(){var t=this;return this.getProperty("resources").map((function(e){return new o.Annotation(e,t.options)}))},e.prototype.load=function(){var t=this;return new Promise((function(e,i){if(t.isLoaded)e(t);else{var n=t.__jsonld.id;n||(n=t.__jsonld["@id"]),o.Utils.loadManifest(n).then((function(i){t.__jsonld=i,t.context=t.getProperty("context"),t.id=t.getProperty("id"),t.isLoaded=!0,e(t)})).catch(i)}}))},e}(o.JSONLDResource);e.AnnotationList=r},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,i){return t.call(this,e,i)||this}return s(e,t),e.prototype.getItems=function(){return this.getProperty("items")},e}(i(0).ManifestResource);e.AnnotationPage=o},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=function(t){function e(e,i){return t.call(this,e,i)||this}return s(e,t),e.prototype.getCanonicalImageUri=function(t){var e,i=null,n="default",s=t;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])i=this.externalResource.data["@id"],s||(s=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(n="native");else{var r=this.getImages();if(r&&r.length){var a=r[0].getResource(),l=a.getServices();if(s||(s=a.getWidth()),l.length){var h=l[0];i=h.id,n=o.Utils.getImageQuality(h.getProfile())}else if(s===a.getWidth())return a.id}if(!i){var c=this.getProperty("thumbnail");if(c){if("string"==typeof c)return c;if(c["@id"])return c["@id"];if(c.length)return c[0].id}}}return e=s+",",i&&i.endsWith("/")&&(i=i.substr(0,i.length-1)),[i,"full",e,0,n+".jpg"].join("/")},e.prototype.getMaxDimensions=function(){var t,e=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(t=this.externalResource.data.profile,Array.isArray(t)&&(t=t.filter((function(t){return t.maxWidth}))[0])&&(e=new o.Size(t.maxWidth,t.maxHeight?t.maxHeight:t.maxWidth))),e},e.prototype.getContent=function(){var t=[],e=this.__jsonld.items||this.__jsonld.content;if(!e)return t;var i=null;if(e.length&&(i=new o.AnnotationPage(e[0],this.options)),!i)return t;for(var n=i.getItems(),s=0;s<n.length;s++){var r=n[s],a=new o.Annotation(r,this.options);t.push(a)}return t},e.prototype.getDuration=function(){return this.getProperty("duration")},e.prototype.getImages=function(){var t=[];if(!this.__jsonld.images)return t;for(var e=0;e<this.__jsonld.images.length;e++){var i=this.__jsonld.images[e],n=new o.Annotation(i,this.options);t.push(n)}return t},e.prototype.getIndex=function(){return this.getProperty("index")},e.prototype.getOtherContent=function(){var t=this,e=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter((function(t){return t&&"string"==typeof(e=t["@type"])&&e.toLowerCase()==e.toLowerCase();var e})).map((function(e,i){return new o.AnnotationList(e.label||"Annotation list "+i,e,t.options)})).map((function(t){return t.load()}));return Promise.all(e)},e.prototype.getWidth=function(){return this.getProperty("width")},e.prototype.getHeight=function(){return this.getProperty("height")},e}(o.Resource);e.Canvas=r},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),r=i(0),a=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.items=[],n._collections=null,n._manifests=null,e.__collection=n,n}return s(e,t),e.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter((function(t){return t.isCollection()}))},e.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter((function(t){return t.isManifest()}))},e.prototype.getCollectionByIndex=function(t){for(var e,i=this.getCollections(),n=0;n<i.length;n++){var s=i[n];s.index===t&&(e=s)}if(e)return e.options.index=t,e.load();throw new Error("Collection index not found")},e.prototype.getManifestByIndex=function(t){for(var e,i=this.getManifests(),n=0;n<i.length;n++){var s=i[n];s.index===t&&(e=s)}if(e)return e.options.index=t,e.load();throw new Error("Manifest index not found")},e.prototype.getTotalCollections=function(){return this.getCollections().length},e.prototype.getTotalManifests=function(){return this.getManifests().length},e.prototype.getTotalItems=function(){return this.items.length},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):o.ViewingDirection.LEFT_TO_RIGHT},e.prototype.getDefaultTree=function(){return t.prototype.getDefaultTree.call(this),this.defaultTree.data.type=r.Utils.normaliseType(r.TreeNodeType.COLLECTION),this._parseManifests(this),this._parseCollections(this),r.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},e.prototype._parseManifests=function(t){if(t.getManifests()&&t.getManifests().length)for(var e=0;e<t.getManifests().length;e++){var i=t.getManifests()[e],n=i.getDefaultTree();n.label=i.parentLabel||r.LanguageMap.getValue(i.getLabel(),this.options.locale)||"manifest "+(e+1),n.navDate=i.getNavDate(),n.data.id=i.id,n.data.type=r.Utils.normaliseType(r.TreeNodeType.MANIFEST),t.defaultTree.addNode(n)}},e.prototype._parseCollections=function(t){if(t.getCollections()&&t.getCollections().length)for(var e=0;e<t.getCollections().length;e++){var i=t.getCollections()[e],n=i.getDefaultTree();n.label=i.parentLabel||r.LanguageMap.getValue(i.getLabel(),this.options.locale)||"collection "+(e+1),n.navDate=i.getNavDate(),n.data.id=i.id,n.data.type=r.Utils.normaliseType(r.TreeNodeType.COLLECTION),t.defaultTree.addNode(n)}},e}(r.IIIFResource);e.Collection=a},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.start=t,this.end=e}return t.prototype.getLength=function(){return this.end-this.start},t}();e.Duration=n},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),s=function(){function t(t){this.defaultLocale=t}return t.prototype.parse=function(t){this.resource=t,this.label=n.LanguageMap.parse(this.resource.label,this.defaultLocale),this.value=n.LanguageMap.parse(this.resource.value,this.defaultLocale)},t.prototype.getLabel=function(){return this.label?n.LanguageMap.getValue(this.label,this.defaultLocale):null},t.prototype.setLabel=function(t){var e=this;if(this.label&&this.label.length){var i=this.label.filter((function(t){return t.locale===e.defaultLocale||t.locale===n.Utils.getInexactLocale(e.defaultLocale)}))[0];i&&(i.value=t)}},t.prototype.getValue=function(){if(this.value){var t=this.defaultLocale;return this.label&&this.label.length&&this.label[0].locale&&(t=this.label[0].locale),n.LanguageMap.getValue(this.value,t)}return null},t.prototype.setValue=function(t){var e=this;if(this.value&&this.value.length){var i=this.value.filter((function(t){return t.locale===e.defaultLocale||t.locale===n.Utils.getInexactLocale(e.defaultLocale)}))[0];i&&(i.value=t)}},t}();e.LabelValuePair=s},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Language=function(t,e){Array.isArray(t)?1===t.length?this.value=t[0]:this.value=t.join("<br/>"):this.value=t,this.locale=e}},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.parse=function(t,e){var i,n=[];if(!t)return n;if(Array.isArray(t))for(var s=0;s<t.length;s++){var r=t[s];i="string"==typeof r?new o.Language(r,e):new o.Language(r["@value"],r["@language"]||e),n.push(i)}else{if("string"==typeof t)return i=new o.Language(t,e),n.push(i),n;t["@value"]?(i=new o.Language(t["@value"],t["@language"]||e),n.push(i)):Object.keys(t).forEach((function(e){if(!t[e].length)throw new Error("language must have a value");i=new o.Language(t[e],e),n.push(i)}))}return n},e.getValue=function(t,e){if(t.length){if(e){var i=t.filter((function(t){return t.locale===e||o.Utils.getInexactLocale(t.locale)===o.Utils.getInexactLocale(e)}))[0];if(i)return i.value}return t[0].value}return null},e}(Array);e.LanguageMap=r},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),r=i(0),a=function(t){function e(e,i){var n=t.call(this,e,i)||this;if(n.index=0,n._allRanges=null,n.items=[],n._topRanges=[],n.__jsonld.structures&&n.__jsonld.structures.length)for(var s=n._getTopRanges(),o=0;o<s.length;o++){var r=s[o];n._parseRanges(r,String(o))}return n}return s(e,t),e.prototype.getPosterCanvas=function(){var t=this.getProperty("posterCanvas");return t&&(t=new r.Canvas(t,this.options)),t},e.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},e.prototype.getDefaultTree=function(){if(t.prototype.getDefaultTree.call(this),this.defaultTree.data.type=r.Utils.normaliseType(r.TreeNodeType.MANIFEST),!this.isLoaded)return this.defaultTree;var e=this.getTopRanges();return e.length&&e[0].getTree(this.defaultTree),r.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},e.prototype._getTopRanges=function(){var t=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var e=0;e<this.__jsonld.structures.length;e++){var i=this.__jsonld.structures[e];i.viewingHint===o.ViewingHint.TOP&&t.push(i)}if(!t.length){var n={};n.ranges=this.__jsonld.structures,t.push(n)}}return t},e.prototype.getTopRanges=function(){return this._topRanges},e.prototype._getRangeById=function(t){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var e=0;e<this.__jsonld.structures.length;e++){var i=this.__jsonld.structures[e];if(i["@id"]===t||i.id===t)return i}return null},e.prototype._parseRanges=function(t,e,i){var n,s=null;if("string"==typeof t&&(s=t,t=this._getRangeById(s)),t){(n=new r.Range(t,this.options)).parentRange=i,n.path=e,i?i.items.push(n):this._topRanges.push(n);var o=t.items||t.members;if(o)for(var a=0;a<o.length;a++){var l=o[a];if(l["@type"]&&"sc:range"===l["@type"].toLowerCase()||l.type&&"range"===l.type.toLowerCase())this._parseRanges(l,e+"/"+a,n);else if(l["@type"]&&"sc:canvas"===l["@type"].toLowerCase()||l.type&&"canvas"===l.type.toLowerCase()){n.canvases||(n.canvases=[]);var h=l.id||l["@id"];n.canvases.push(h)}}else if(t.ranges)for(a=0;a<t.ranges.length;a++)this._parseRanges(t.ranges[a],e+"/"+a,n)}else console.warn("Range:",s,"does not exist")},e.prototype.getAllRanges=function(){if(null!=this._allRanges)return this._allRanges;this._allRanges=[];for(var t=this.getTopRanges(),e=function(e){var n=t[e];n.id&&i._allRanges.push(n);var s=function(t,e){t.add(e);var i=e.getRanges();return i.length?i.reduce(s,t):t},o=Array.from(n.getRanges().reduce(s,new Set));i._allRanges=i._allRanges.concat(o)},i=this,n=0;n<t.length;n++)e(n);return this._allRanges},e.prototype.getRangeById=function(t){for(var e=this.getAllRanges(),i=0;i<e.length;i++){var n=e[i];if(n.id===t)return n}return null},e.prototype.getRangeByPath=function(t){for(var e=this.getAllRanges(),i=0;i<e.length;i++){var n=e[i];if(n.path===t)return n}return null},e.prototype.getSequences=function(){if(this.items.length)return this.items;var t=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(t)for(var e=0;e<t.length;e++){var i=t[e],n=new r.Sequence(i,this.options);this.items.push(n)}else this.__jsonld.items&&(n=new r.Sequence(this.__jsonld.items,this.options),this.items.push(n));return this.items},e.prototype.getSequenceByIndex=function(t){return this.getSequences()[t]},e.prototype.getTotalSequences=function(){return this.getSequences().length},e.prototype.getManifestType=function(){var t=this.getService(o.ServiceProfile.UI_EXTENSIONS);return t?t.getProperty("manifestType"):r.ManifestType.EMPTY},e.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},e.prototype.isPagingEnabled=function(){var t=this.getViewingHint();if(t)return t===o.ViewingHint.PAGED;var e=this.getBehavior();return!!e&&e===o.Behavior.PAGED},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e}(r.IIIFResource);e.Manifest=a},function(t,e,i){var n;Object.defineProperty(e,"__esModule",{value:!0}),(n=e.ManifestType||(e.ManifestType={})).EMPTY="",n.MANUSCRIPT="manuscript",n.MONOGRAPH="monograph"},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=i(1),a=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._ranges=null,n.canvases=null,n.items=[],n}return s(e,t),e.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},e.prototype.getDuration=function(){var t,e;if(this.canvases&&this.canvases.length)for(var i=0;i<this.canvases.length;i++){var n=this.canvases[i],s=o.Utils.getTemporalComponent(n);s&&s.length>1&&(0===i&&(t=Number(s[0])),i===this.canvases.length-1&&(e=Number(s[1])))}else{var r=this.getRanges();for(i=0;i<r.length;i++){var a=r[i].getDuration();a&&(0===i&&(t=a.start),i===r.length-1&&(e=a.end))}}if(void 0!==t&&void 0!==e)return new o.Duration(t,e)},e.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter((function(t){return t.isRange()}))},e.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e.prototype.getTree=function(t){t.data=this,this.treeNode=t;var e=this.getRanges();if(e&&e.length)for(var i=0;i<e.length;i++){var n=e[i],s=new o.TreeNode;t.addNode(s),this._parseTreeNode(s,n)}return o.Utils.generateTreeNodeIds(t),t},e.prototype.spansTime=function(t){var e=this.getDuration();return!!(e&&t>=e.start&&t<=e.end)},e.prototype._parseTreeNode=function(t,e){t.label=o.LanguageMap.getValue(e.getLabel(),this.options.locale),t.data=e,t.data.type=o.Utils.normaliseType(o.TreeNodeType.RANGE),e.treeNode=t;var i=e.getRanges();if(i&&i.length)for(var n=0;n<i.length;n++){var s=i[n];if(s.getBehavior()!==r.Behavior.NO_NAV){var a=new o.TreeNode;t.addNode(a),this._parseTreeNode(a,s)}}},e}(o.ManifestResource);e.Range=a},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,i){return t.call(this,e,i)||this}return s(e,t),e.prototype.getFormat=function(){return this.getProperty("format")},e}(i(0).ManifestResource);e.Rendering=o},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),r=i(0),a=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.items=[],n._thumbnails=null,n}return s(e,t),e.prototype.getCanvases=function(){if(this.items.length)return this.items;var t=this.__jsonld.canvases||this.__jsonld.elements;if(t)for(var e=0;e<t.length;e++){var i=t[e];(n=new r.Canvas(i,this.options)).index=e,this.items.push(n)}else if(this.__jsonld)for(e=0;e<this.__jsonld.length;e++){var n;i=this.__jsonld[e],(n=new r.Canvas(i,this.options)).index=e,this.items.push(n)}return this.items},e.prototype.getCanvasById=function(t){for(var e=0;e<this.getTotalCanvases();e++){var i=this.getCanvasByIndex(e),n=r.Utils.normaliseUrl(i.id);if(r.Utils.normaliseUrl(t)===n)return i}return null},e.prototype.getCanvasByIndex=function(t){return this.getCanvases()[t]},e.prototype.getCanvasIndexById=function(t){for(var e=0;e<this.getTotalCanvases();e++)if(this.getCanvasByIndex(e).id===t)return e;return null},e.prototype.getCanvasIndexByLabel=function(t,e){t=t.trim(),isNaN(t)||(t=parseInt(t,10).toString(),e&&(t+="r"));for(var i,n,s,o=/(\d*)\D+(\d*)/,a=0;a<this.getTotalCanvases();a++){var l=this.getCanvasByIndex(a);if(r.LanguageMap.getValue(l.getLabel(),this.options.locale)===t||(i=o.exec(t))&&(n=i[1],(s=i[2])&&new RegExp("^"+n+"\\D+"+s+"$").test(l.getLabel().toString())))return a}return-1},e.prototype.getLastCanvasLabel=function(t){for(var e=this.getTotalCanvases()-1;e>=0;e--){var i=this.getCanvasByIndex(e),n=r.LanguageMap.getValue(i.getLabel(),this.options.locale);if(t){if(/^[a-zA-Z0-9]*$/.test(n))return n}else if(n)return n}return this.options.defaultLabel},e.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},e.prototype.getNextPageIndex=function(t,e){var i;if(e){var n=this.getPagedIndices(t),s=this.getViewingDirection();i=s&&s===o.ViewingDirection.RIGHT_TO_LEFT?n[0]+1:n[n.length-1]+1}else i=t+1;return i>this.getLastPageIndex()?-1:i},e.prototype.getPagedIndices=function(t,e){var i=[];if(e){i=this.isFirstCanvas(t)||this.isLastCanvas(t)?[t]:t%2?[t,t+1]:[t-1,t];var n=this.getViewingDirection();n&&n===o.ViewingDirection.RIGHT_TO_LEFT&&(i=i.reverse())}else i.push(t);return i},e.prototype.getPrevPageIndex=function(t,e){var i;if(e){var n=this.getPagedIndices(t),s=this.getViewingDirection();i=s&&s===o.ViewingDirection.RIGHT_TO_LEFT?n[n.length-1]-1:n[0]-1}else i=t-1;return i},e.prototype.getStartCanvasIndex=function(){var t=this.getStartCanvas();if(t)for(var e=0;e<this.getTotalCanvases();e++)if(this.getCanvasByIndex(e).id===t)return e;return 0},e.prototype.getThumbs=function(t,e){for(var i=[],n=this.getTotalCanvases(),s=0;s<n;s++){var o=this.getCanvasByIndex(s),a=new r.Thumb(t,o);i.push(a)}return i},e.prototype.getThumbnails=function(){if(null!=this._thumbnails)return this._thumbnails;this._thumbnails=[];for(var t=this.getCanvases(),e=0;e<t.length;e++){var i=t[e].getThumbnail();i&&this._thumbnails.push(i)}return this._thumbnails},e.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},e.prototype.getTotalCanvases=function(){return this.getCanvases().length},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e.prototype.isCanvasIndexOutOfRange=function(t){return t>this.getTotalCanvases()-1},e.prototype.isFirstCanvas=function(t){return 0===t},e.prototype.isLastCanvas=function(t){return t===this.getTotalCanvases()-1},e.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},e.prototype.isPagingEnabled=function(){var t=this.getViewingHint();return!!t&&t===o.ViewingHint.PAGED},e.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},e}(r.ManifestResource);e.Sequence=a},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),s=function(){function t(){}return t.parse=function(t,e){return"string"==typeof t&&(t=JSON.parse(t)),this.parseJson(t,e)},t.parseJson=function(t,e){var i;if(e&&e.navDate&&!isNaN(e.navDate.getTime())&&(t.navDate=e.navDate.toString()),t["@type"])switch(t["@type"]){case"sc:Collection":i=this.parseCollection(t,e);break;case"sc:Manifest":i=this.parseManifest(t,e);break;default:return null}else switch(t.type){case"Collection":i=this.parseCollection(t,e);break;case"Manifest":i=this.parseManifest(t,e);break;default:return null}return i.isLoaded=!0,i},t.parseCollection=function(t,e){var i=new n.Collection(t,e);return e?(i.index=e.index||0,e.resource&&(i.parentCollection=e.resource.parentCollection)):i.index=0,this.parseCollections(i,e),this.parseManifests(i,e),this.parseItems(i,e),i},t.parseCollections=function(t,e){var i;if(t.__jsonld.collections?i=t.__jsonld.collections:t.__jsonld.items&&(i=t.__jsonld.items.filter((function(t){return"collection"===t.type.toLowerCase()}))),i)for(var n=0;n<i.length;n++){e&&(e.index=n);var s=this.parseCollection(i[n],e);s.index=n,s.parentCollection=t,t.items.push(s)}},t.parseManifest=function(t,e){return new n.Manifest(t,e)},t.parseManifests=function(t,e){var i;if(t.__jsonld.manifests?i=t.__jsonld.manifests:t.__jsonld.items&&(i=t.__jsonld.items.filter((function(t){return"manifest"===t.type.toLowerCase()}))),i)for(var n=0;n<i.length;n++){var s=this.parseManifest(i[n],e);s.index=n,s.parentCollection=t,t.items.push(s)}},t.parseItem=function(t,e){if(t["@type"]){if("sc:manifest"===t["@type"].toLowerCase())return this.parseManifest(t,e);if("sc:collection"===t["@type"].toLowerCase())return this.parseCollection(t,e)}else if(t.type){if("manifest"===t.type.toLowerCase())return this.parseManifest(t,e);if("collection"===t.type.toLowerCase())return this.parseCollection(t,e)}return null},t.parseItems=function(t,e){var i=t.__jsonld.members||t.__jsonld.items;if(i)for(var n=function(n){e&&(e.index=n);var o=s.parseItem(i[n],e);return o?t.items.filter((function(t){return t.id===o.id}))[0]?"continue":(o.index=n,o.parentCollection=t,void t.items.push(o)):{value:void 0}},s=this,o=0;o<i.length;o++){var r=n(o);if("object"==typeof r)return r.value}},t}();e.Deserialiser=s},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=function(t){function e(e,i){return t.call(this,e,i)||this}return s(e,t),e.prototype.getProfile=function(){var t=this.getProperty("profile");return t||(t=this.getProperty("dcterms:conformsTo")),Array.isArray(t)?t[0]:t},e.prototype.getConfirmLabel=function(){return o.Utils.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},e.prototype.getDescription=function(){return o.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},e.prototype.getFailureDescription=function(){return o.Utils.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},e.prototype.getFailureHeader=function(){return o.Utils.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},e.prototype.getHeader=function(){return o.Utils.getLocalisedValue(this.getProperty("header"),this.options.locale)},e.prototype.getServiceLabel=function(){return o.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},e.prototype.getInfoUri=function(){var t=this.id;return t.endsWith("/")||(t+="/"),t+"info.json"},e}(o.ManifestResource);e.Service=r},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Size=function(t,e){this.width=t,this.height=e}},function(t,e,i){var n;Object.defineProperty(e,"__esModule",{value:!0}),(n=e.StatusCode||(e.StatusCode={}))[n.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",n[n.FORBIDDEN=2]="FORBIDDEN",n[n.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",n[n.RESTRICTED=4]="RESTRICTED"},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=i(0);e.Thumb=function(t,e){this.data=e,this.index=e.index,this.width=t;var i=e.getHeight()/e.getWidth();this.height=i?Math.floor(this.width*i):t,this.uri=e.getCanonicalImageUri(t),this.label=n.LanguageMap.getValue(e.getLabel())}},function(t,e,i){var n,s=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,i){return t.call(this,e,i)||this}return s(e,t),e}(i(0).Resource);e.Thumbnail=o},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),s=function(){function t(t,e){this.label=t,this.data=e||{},this.nodes=[]}return t.prototype.addNode=function(t){this.nodes.push(t),t.parentNode=this},t.prototype.isCollection=function(){return this.data.type===n.Utils.normaliseType(n.TreeNodeType.COLLECTION)},t.prototype.isManifest=function(){return this.data.type===n.Utils.normaliseType(n.TreeNodeType.MANIFEST)},t.prototype.isRange=function(){return this.data.type===n.Utils.normaliseType(n.TreeNodeType.RANGE)},t}();e.TreeNode=s},function(t,e,i){var n;Object.defineProperty(e,"__esModule",{value:!0}),(n=e.TreeNodeType||(e.TreeNodeType={})).COLLECTION="collection",n.MANIFEST="manifest",n.RANGE="range"},function(t,e,i){t.exports=function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e||4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.CONTINUE=100,e.SWITCHING_PROTOCOLS=101,e.PROCESSING=102,e.OK=200,e.CREATED=201,e.ACCEPTED=202,e.NON_AUTHORITATIVE_INFORMATION=203,e.NO_CONTENT=204,e.RESET_CONTENT=205,e.PARTIAL_CONTENT=206,e.MULTI_STATUS=207,e.MULTIPLE_CHOICES=300,e.MOVED_PERMANENTLY=301,e.MOVED_TEMPORARILY=302,e.SEE_OTHER=303,e.NOT_MODIFIED=304,e.USE_PROXY=305,e.TEMPORARY_REDIRECT=307,e.BAD_REQUEST=400,e.UNAUTHORIZED=401,e.PAYMENT_REQUIRED=402,e.FORBIDDEN=403,e.NOT_FOUND=404,e.METHOD_NOT_ALLOWED=405,e.NOT_ACCEPTABLE=406,e.PROXY_AUTHENTICATION_REQUIRED=407,e.REQUEST_TIME_OUT=408,e.CONFLICT=409,e.GONE=410,e.LENGTH_REQUIRED=411,e.PRECONDITION_FAILED=412,e.REQUEST_ENTITY_TOO_LARGE=413,e.REQUEST_URI_TOO_LARGE=414,e.UNSUPPORTED_MEDIA_TYPE=415,e.REQUESTED_RANGE_NOT_SATISFIABLE=416,e.EXPECTATION_FAILED=417,e.IM_A_TEAPOT=418,e.UNPROCESSABLE_ENTITY=422,e.LOCKED=423,e.FAILED_DEPENDENCY=424,e.UNORDERED_COLLECTION=425,e.UPGRADE_REQUIRED=426,e.PRECONDITION_REQUIRED=428,e.TOO_MANY_REQUESTS=429,e.REQUEST_HEADER_FIELDS_TOO_LARGE=431,e.INTERNAL_SERVER_ERROR=500,e.NOT_IMPLEMENTED=501,e.BAD_GATEWAY=502,e.SERVICE_UNAVAILABLE=503,e.GATEWAY_TIME_OUT=504,e.HTTP_VERSION_NOT_SUPPORTED=505,e.VARIANT_ALSO_NEGOTIATES=506,e.INSUFFICIENT_STORAGE=507,e.BANDWIDTH_LIMIT_EXCEEDED=509,e.NOT_EXTENDED=510,e.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(t,e,i){t.exports=window.fetch||(window.fetch=i(3).default||i(3))}])},function(t,e,i){i.r(e),i.d(e,"BaseComponent",(function(){return n}));var n=function(){function t(t){this.options=t,this.options.data=Object.assign({},this.data(),t.data)}return t.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},t.prototype.data=function(){return{}},t.prototype.on=function(t,e,i){var n=this._e||(this._e={});(n[t]||(n[t]=[])).push({fn:e,ctx:i})},t.prototype.fire=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var n=[].slice.call(arguments,1),s=((this._e||(this._e={}))[t]||[]).slice(),o=0,r=s.length;o<r;o++)s[o].fn.apply(s[o].ctx,n)},t.prototype._resize=function(){},t.prototype.set=function(t){},t}()},function(t,e,i){i.r(e),i.d(e,"Async",(function(){return o})),i.d(e,"Bools",(function(){return r})),i.d(e,"Clipboard",(function(){return a})),i.d(e,"Colors",(function(){return l})),i.d(e,"Dates",(function(){return h})),i.d(e,"Device",(function(){return c})),i.d(e,"Documents",(function(){return u})),i.d(e,"Events",(function(){return p})),i.d(e,"Files",(function(){return d})),i.d(e,"Keyboard",(function(){return f})),i.d(e,"Maths",(function(){return g})),i.d(e,"Size",(function(){return m})),i.d(e,"Dimensions",(function(){return _})),i.d(e,"Numbers",(function(){return v})),i.d(e,"Objects",(function(){return E})),i.d(e,"Storage",(function(){return b})),i.d(e,"StorageItem",(function(){return y})),i.d(e,"StorageType",(function(){return n})),i.d(e,"Strings",(function(){return I})),i.d(e,"Urls",(function(){return C}));var n,s,o=function(){function t(){}return t.waitFor=function(e,i,n,s,o,r){s||(s=200),o||(o=100),r||(r=0),(r+=1)>o?n&&n():e()?i():setTimeout((function(){t.waitFor(e,i,n,s,o,r)}),s)},t}(),r=function(){function t(){}return t.getBool=function(t,e){return t??e},t}(),a=function(){function t(){}return t.supportsCopy=function(){return document.queryCommandSupported&&document.queryCommandSupported("copy")},t.copy=function(e){e=t.convertBrToNewLine(e);var i=document.createElement("textarea");i.value=e,t.hideButKeepEnabled(i),document.body.appendChild(i),i.focus(),i.select(),document.execCommand("copy"),document.body.removeChild(i)},t.hideButKeepEnabled=function(t){t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="2em",t.style.height="2em",t.style.padding="0",t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent"},t.convertBrToNewLine=function(t){return t.replace(/<br\s*[\/]?>/gi,"\n")},t}(),l=function(){function t(){}return t.float32ColorToARGB=function(t){return[(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},t._componentToHex=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},t.rgbToHexString=function(e){return t.coalesce(e),"#"+t._componentToHex(e[0])+t._componentToHex(e[1])+t._componentToHex(e[2])},t.argbToHexString=function(e){return"#"+t._componentToHex(e[0])+t._componentToHex(e[1])+t._componentToHex(e[2])+t._componentToHex(e[3])},t.coalesce=function(t){for(var e=1;e<t.length;e++)void 0===t[e]&&(t[e]=t[e-1])},t}(),h=function(){function t(){}return t.getTimeStamp=function(){return(new Date).getTime()},t}(),c=function(){function t(){}return t.getPixelRatio=function(t){return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)},t.isTouch=function(){return"ontouchstart"in window||window.navigator.msMaxTouchPoints>0},t}(),u=function(){function t(){}return t.isInIFrame=function(){try{return window.self!==window.top}catch{return!0}},t.supportsFullscreen=function(){var t=document.documentElement;return void 0!==(t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen)},t.isHidden=function(){return!!t.getHiddenProp()},t.getHiddenProp=function(){var t=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var e=0;e<t.length;e++)if(t[e]+"Hidden"in document)return t[e]+"Hidden";return null},t}(),p=function(){function t(){}return t.debounce=function(t,e){return e=e||100,function(){if(!t.debouncing){var i=Array.prototype.slice.apply(arguments);t.lastReturnVal=t.apply(window,i),t.debouncing=!0}return clearTimeout(t.debounceTimeout),t.debounceTimeout=setTimeout((function(){t.debouncing=!1}),e),t.lastReturnVal}},t}(),d=function(){function t(){}return t.simplifyMimeType=function(t){switch(t){case"text/plain":return"txt";case"image/jpeg":return"jpg";case"application/msword":return"doc";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"docx";default:var e=t.split("/");return e[e.length-1]}},t}(),f=function(){function t(){}return t.getCharCode=function(t){return"number"==typeof t.which?t.which:t.keyCode},t}(),g=function(){function t(){}return t.normalise=function(t,e,i){return(t-e)/(i-e)},t.median=function(t){t.sort((function(t,e){return t-e}));var e=Math.floor(t.length/2);return t.length%2?t[e]:(t[e-1]+t[e])/2},t.clamp=function(t,e,i){return Math.min(Math.max(t,e),i)},t}(),m=function(t,e){this.width=t,this.height=e},_=function(){function t(){}return t.fitRect=function(t,e,i,n){var s,o=0,r=0;return e/t<n/i?(o=t*(s=i/t),r=e*s):(o=t*(s=n/e),r=e*s),new m(Math.floor(o),Math.floor(r))},t.hitRect=function(t,e,i,n,s,o){return s>t&&s<t+i&&o>e&&o<e+n},t}(),v=function(){function t(){}return t.numericalInput=function(t){return 46==t.keyCode||8==t.keyCode||9==t.keyCode||27==t.keyCode||65==t.keyCode&&!0===t.ctrlKey||t.keyCode>=35&&t.keyCode<=39||!(t.shiftKey||(t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105))||(t.preventDefault(),!1)},t}(),E=function(){function t(){}return t.toPlainObject=function(t){t=Object(t);var e={};for(var i in t)e[i]=t[i];return e},t}(),b=function(){function t(){}return t.clear=function(t){switch(void 0===t&&(t=n.MEMORY),t){case n.MEMORY:this._memoryStorage={};break;case n.SESSION:sessionStorage.clear();break;case n.LOCAL:localStorage.clear()}},t.clearExpired=function(t){void 0===t&&(t=n.MEMORY);for(var e=this.getItems(t),i=0;i<e.length;i++){var s=e[i];this._isExpired(s)&&this.remove(s.key)}},t.get=function(t,e){void 0===e&&(e=n.MEMORY);var i=null;switch(e){case n.MEMORY:i=this._memoryStorage[t];break;case n.SESSION:i=sessionStorage.getItem(t);break;case n.LOCAL:i=localStorage.getItem(t)}if(!i)return null;var s=null;try{s=JSON.parse(i)}catch{return null}return s?this._isExpired(s)?null:(s.key=t,s):null},t._isExpired=function(t){return!((new Date).getTime()<t.expiresAt)},t.getItems=function(t){void 0===t&&(t=n.MEMORY);var e=[];switch(t){case n.MEMORY:for(var i=Object.keys(this._memoryStorage),s=0;s<i.length;s++)(r=this.get(i[s],n.MEMORY))&&e.push(r);break;case n.SESSION:for(s=0;s<sessionStorage.length;s++)(o=sessionStorage.key(s))&&(r=this.get(o,n.SESSION))&&e.push(r);break;case n.LOCAL:for(s=0;s<localStorage.length;s++){var o,r;(o=localStorage.key(s))&&(r=this.get(o,n.LOCAL))&&e.push(r)}}return e},t.remove=function(t,e){switch(void 0===e&&(e=n.MEMORY),e){case n.MEMORY:delete this._memoryStorage[t];break;case n.SESSION:sessionStorage.removeItem(t);break;case n.LOCAL:localStorage.removeItem(t)}},t.set=function(t,e,i,s){void 0===s&&(s=n.MEMORY);var o=1e3*i,r=new y;switch(r.value=e,r.expiresAt=(new Date).getTime()+o,s){case n.MEMORY:this._memoryStorage[t]=JSON.stringify(r);break;case n.SESSION:sessionStorage.setItem(t,JSON.stringify(r));break;case n.LOCAL:localStorage.setItem(t,JSON.stringify(r))}return r},t._memoryStorage={},t}(),y=function(){};(s=n||(n={})).MEMORY="memory",s.SESSION="session",s.LOCAL="local";var I=function(){function t(){}return t.ellipsis=function(t,e){if(t.length<=e)return t;var i=t.substr(0,e),n=i.lastIndexOf(" ");return-1!=n&&(i=i.substr(0,Math.min(i.length,n))),i+"&hellip;"},t.htmlDecode=function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild.nodeValue},t.format=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var n=0;n<e.length;n++){var s=new RegExp("\\{"+n+"\\}","gm");t=t.replace(s,e[n])}return t},t.isAlphanumeric=function(t){return/^[a-zA-Z0-9]*$/.test(t)},t.toCssClass=function(t){return t.replace(/[^a-z0-9]/g,(function(t){var e=t.charCodeAt(0);return 32==e?"-":e>=65&&e<=90?"_"+t.toLowerCase():"__"+("000"+e.toString(16)).slice(-4)}))},t.toFileName=function(t){return t.replace(/[^a-z0-9]/gi,"_").toLowerCase()},t.utf8_to_b64=function(t){return window.btoa(unescape(encodeURIComponent(t)))},t}(),C=function(){function t(){}return t.getHashParameter=function(t,e){return e||(e=window.document),e&&e.location?this.getHashParameterFromString(t,e.location.hash):null},t.getHashParameterFromString=function(t,e){var i=new RegExp("#.*[?&]"+t+"=([^&]+)(&|$)").exec(e);return i?decodeURIComponent(i[1].replace(/\+/g," ")):null},t.setHashParameter=function(t,e,i){if(i||(i=window.document),i&&i.location){var n="#?"+this.updateURIKeyValuePair(i.location.hash.replace("#?",""),t,e),s=i.URL;-1!=s.indexOf("#")&&(s=s.substr(0,s.indexOf("#"))),i.location.replace(s+n)}},t.getQuerystringParameter=function(t,e){return e||(e=window),this.getQuerystringParameterFromString(t,e.location.search)},t.getQuerystringParameterFromString=function(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return i?decodeURIComponent(i[1].replace(/\+/g," ")):null},t.setQuerystringParameter=function(t,e,i){if(i||(i=window.document),i&&i.location){var n=this.updateURIKeyValuePair(i.location.hash.replace("#?",""),t,e);window.location.search=n}},t.updateURIKeyValuePair=function(t,e,i){e=encodeURIComponent(e),i=encodeURIComponent(i);var n=t.split("&");""==n[0]&&n.shift();for(var s,o=n.length;o--;)if((s=n[o].split("="))[0]==e){s[1]=i,n[o]=s.join("=");break}return o<0&&(n[n.length]=[e,i].join("=")),n.join("&")},t.getUrlParts=function(t){var e=document.createElement("a");return e.href=t,e},t.convertToRelativeUrl=function(t){var e=this.getUrlParts(t),i=e.pathname+e.searchWithin;return i.startsWith("/")||(i="/"+i),i},t}()}])},"object"==typeof t&&"object"==typeof e?e.exports=s():"function"==typeof define&&i.amdO?define("IIIFMetadataComponent",[],s):"object"==typeof t?t.IIIFMetadataComponent=s():n.IIIFMetadataComponent=s()})),p=class{constructor(t,e){this.informationType=t,this.param=e}};(s=n||(n={}))[s.AUTH_CORS_ERROR=0]="AUTH_CORS_ERROR",s[s.DEGRADED_RESOURCE=1]="DEGRADED_RESOURCE";var d=class{};d.FORBIDDEN="forbiddenResourceMessage";var f=(0,h.c)((0,o.c)()),g=(0,h.c)((0,o.e)()),m=(0,a.a)(),_=class{static loadExternalResources(t,e){return new Promise((i=>{f.Utils.loadExternalResourcesAuth09(t,e,_.clickThrough,_.restricted,_.login,_.getAccessToken,_.storeAccessToken,_.getStoredAccessToken,_.handleExternalResourceResponse).then((t=>{i(t)})).catch((t=>{switch(t.name){case f.StatusCode.AUTHORIZATION_FAILED.toString():_.publish(r.p.LOGIN_FAILED);break;case f.StatusCode.FORBIDDEN.toString():_.publish(r.p.FORBIDDEN);break;case f.StatusCode.RESTRICTED.toString():break;default:_.publish(r.p.SHOW_MESSAGE,[t.message||t])}}))}))}static clickThrough(t){return new Promise((e=>{_.publish(r.p.SHOW_CLICKTHROUGH_DIALOGUE,[{resource:t,acceptCallback:()=>{if(t.clickThroughService){let i=window.open(t.clickThroughService.id),n=window.setInterval((()=>{i&&i.closed&&(window.clearInterval(n),_.publish(r.p.CLICKTHROUGH),e())}),500)}}}])}))}static restricted(t){return new Promise(((e,i)=>{_.publish(r.p.SHOW_RESTRICTED_DIALOGUE,[{resource:t,acceptCallback:()=>{_.publish(l.a.LOAD_FAILED),i(t)}}])}))}static login(t){return new Promise((e=>{let i={};t.status===g.FORBIDDEN&&(i.warningMessage=d.FORBIDDEN,i.showCancelButton=!0),_.publish(r.p.SHOW_LOGIN_DIALOGUE,[{resource:t,loginCallback:()=>{if(t.loginService){let i=window.open(t.loginService.id+"?t="+(new Date).getTime()),n=window.setInterval((function(){i&&i.closed&&(window.clearInterval(n),_.publish(r.p.LOGIN),e())}),500)}},logoutCallback:()=>{if(t.logoutService){let i=window.open(t.logoutService.id+"?t="+(new Date).getTime()),n=window.setInterval((function(){i&&i.closed&&(window.clearInterval(n),_.publish(r.p.LOGOUT),e())}),500)}},options:i}])}))}static getAccessToken(t,e){return new Promise(((i,n)=>{if(t.tokenService){let s=t.tokenService.id,o=s+"|"+(new Date).getTime(),r=t=>{window.removeEventListener("message",r);let s=t.data;s.error?n(e?s.errorDescription:void 0):i(s)};window.addEventListener("message",r,!1);let a=s+"?messageId="+o;m("#commsFrame").prop("src",a)}else n("Token service not found")}))}static storeAccessToken(t,e,i){return new Promise(((n,s)=>{t.tokenService?(r.l.set(t.tokenService.id,e,e.expiresIn,i),n()):s("Token service not found")}))}static getStoredAccessToken(t,e){return new Promise(((i,n)=>{let s,o=[],a=null;if(t.tokenService&&(a=r.l.get(t.tokenService.id,e)),a)o.push(a);else{let i=r.o.getUrlParts(t.dataUri).hostname,n=r.l.getItems(e);for(let t=0;t<n.length;t++)a=n[t],a.key.includes(i)&&o.push(a)}o=o.sort(((t,e)=>t.expiresAt-e.expiresAt)),o.length&&(s=o[o.length-1].value,i(s))}))}static handleExternalResourceResponse(t){return new Promise(((e,i)=>{if(t.isResponseHandled=!0,t.status===g.OK)e(t);else if(t.status===g.MOVED_TEMPORARILY)e(t),_.publish(r.p.RESOURCE_DEGRADED,[t]);else if(t.error.status===g.UNAUTHORIZED||t.error.status===g.INTERNAL_SERVER_ERROR)i(t.error.statusText);else if(t.error.status===g.FORBIDDEN){let t=new Error;t.message="Forbidden",t.name=f.StatusCode.FORBIDDEN.toString(),i(t)}else i(t.error.statusText)}))}static handleDegraded(t){let e=new p(n.DEGRADED_RESOURCE,t);_.publish(r.p.SHOW_INFORMATION,[e])}},v=(0,h.c)((0,o.c)()),E=(0,h.c)((0,o.e)()),b=(0,a.a)(),y=class{static loadExternalResources(t,e,i){return new Promise((n=>{y.storageStrategy=e,t=t.map((t=>(t.authAPIVersion=1,t.options=i,t))),v.Utils.loadExternalResourcesAuth1(t,y.openContentProviderInteraction,y.openTokenService,y.getStoredAccessToken,y.userInteractedWithContentProvider,y.getContentProviderInteraction,y.handleMovedTemporarily,y.showOutOfOptionsMessages).then((t=>{n(t)})).catch((t=>{switch(t.name){case v.StatusCode.AUTHORIZATION_FAILED.toString():y.publish(r.p.LOGIN_FAILED);break;case v.StatusCode.FORBIDDEN.toString():y.publish(r.p.FORBIDDEN);break;case v.StatusCode.RESTRICTED.toString():break;default:y.publish(r.p.SHOW_MESSAGE,[t.message||t])}}))}))}static getCookieServiceUrl(t){return t.id+"?origin="+y.getOrigin()}static openContentProviderInteraction(t){let e=y.getCookieServiceUrl(t);return window.open(e)}static getOrigin(t){let e=window.location;return t&&(e=document.createElement("a"),e.href=t),e.protocol+"//"+e.hostname+(e.port?":"+e.port:"")}static userInteractedWithContentProvider(t){return new Promise((e=>{let i=window.setInterval((()=>{t.closed&&(window.clearInterval(i),e(!0))}),500)}))}static handleMovedTemporarily(t){return new Promise((e=>{y.showDegradedMessage(t),t.isResponseHandled=!0,e()}))}static showDegradedMessage(t){let e=new p(n.DEGRADED_RESOURCE,t);y.publish(r.p.SHOW_INFORMATION,[e])}static storeAccessToken(t,e){return new Promise(((i,n)=>{t.tokenService?(r.l.set(t.tokenService.id,e,e.expiresIn,y.storageStrategy),i()):n("Token service not found")}))}static getStoredAccessToken(t){return new Promise(((e,i)=>{let n=[],s=null;if(t.tokenService&&(s=r.l.get(t.tokenService.id,y.storageStrategy)),s)n.push(s);else{let e=r.o.getUrlParts(t.dataUri).hostname,i=r.l.getItems(y.storageStrategy);for(let t=0;t<i.length;t++)s=i[t],s.key.includes(e)&&n.push(s)}n=n.sort(((t,e)=>t.expiresAt-e.expiresAt));let o=null;n.length&&(o=n[n.length-1].value),e(o)}))}static getContentProviderInteraction(t,e){return new Promise((i=>{t.isResponseHandled&&!t.authHoldingPage?(y.showDegradedMessage(t),i(null)):t.authHoldingPage?(t.authHoldingPage.location.href=y.getCookieServiceUrl(e),i(t.authHoldingPage)):y.publish(r.p.SHOW_AUTH_DIALOGUE,[{service:e,closeCallback:()=>{i(null)},confirmCallback:()=>{let t=y.openContentProviderInteraction(e);i(t)},cancelCallback:()=>{i(null)}}])}))}static openTokenService(t,e){return new Promise(((i,n)=>{let s=y.getOrigin(e.id),o=(new Date).getTime();y.messages[o]={resolve:i,reject:n,serviceOrigin:s,resource:t},window.addEventListener("message",y.receiveToken,!1);let r=e.id+"?messageId="+o+"&origin="+y.getOrigin();b("#commsFrame").prop("src",r);setTimeout((()=>{y.messages[o]&&(y.messages[o].reject("Message unhandled after 5000ms, rejecting"),delete y.messages[o])}),5e3)}))}static receiveToken(t){if(t.data.hasOwnProperty("messageId")){let e=y.messages[t.data.messageId];e&&t.origin==e.serviceOrigin&&y.storeAccessToken(e.resource,t.data).then((()=>{e.resolve(t.data),delete y.messages[t.data.messageId]}))}}static showOutOfOptionsMessages(t,e){if(t.status==E.MOVED_TEMPORARILY)return;let i="";e.getFailureHeader()&&(i+="<p>"+e.getFailureHeader()+"</p>"),e.getFailureDescription()&&(i+=e.getFailureDescription()),y.publish(r.p.SHOW_MESSAGE,[(0,a.b)(i)])}},I=y;I.messages={};var C,O,T,x=(0,a.a)(),S=class extends class{constructor(t,e,i){this.isResized=!1,this.$element=t,this.fitToParentWidth=e||!1,this.fitToParentHeight=i||!1,this.create()}create(){this.extensionHost?.subscribe(l.a.RESIZE,(()=>{this.resize()}))}whenResized(t){r.a.waitFor((()=>this.isResized),t)}onAccessibleClick(t,e,i=!0){i&&t.on("click",(t=>{e(t)})),t.on("keyup",(t=>{32===t.keyCode&&e(t)}))}resize(){let t=this.$element.parent();this.fitToParentWidth&&this.$element.width(t.width()),this.fitToParentHeight&&this.$element.height(t.height()),this.isResized=!0}}{constructor(t,e,i){super(t,e,i)}create(){this.extensionHost=this.$element.closest(".uv-iiif-extension-host").data("component"),super.create(),this.extension=this.extensionHost.extension,this.config={},this.config.content={},this.config.options={};var t=this;t.modules&&t.modules.length&&(t.modules=t.modules.reverse(),t.modules.forEach((e=>{t.config=x.extend(!0,t.config,t.extension.data.config.modules[e])}))),this.content=this.config.content,this.options=this.config.options}init(){}setConfig(t){this.modules||(this.modules=[]),this.modules.push(t)}resize(){super.resize()}},A=(0,a.a)(),L=class extends S{constructor(t){super(t,!1,!1),this.allowClose=!0,this.isActive=!1,this.isUnopened=!0}create(){this.setConfig("dialogue"),super.create(),this.extensionHost.subscribe(r.p.CLOSE_ACTIVE_DIALOGUE,(()=>{this.isActive&&this.allowClose&&this.close()})),this.extensionHost.subscribe(r.p.ESCAPE,(()=>{this.isActive&&this.allowClose&&this.close()})),this.$top=A('<div class="top"></div>'),this.$element.append(this.$top),this.$closeButton=A('<button type="button" class="btn btn-default close" tabindex="0">'+this.content.close+"</button>"),this.$middle=A('<div class="middle"></div>'),this.$element.append(this.$middle),this.$content=A('<div class="content"></div>'),this.$middle.append(this.$content),this.$buttons=A('<div class="buttons"></div>'),this.$middle.append(this.$buttons),this.$bottom=A('<div class="bottom"></div>'),this.$element.append(this.$bottom),this.config.topCloseButtonEnabled?this.$top.append(this.$closeButton):this.$buttons.append(this.$closeButton),this.$closeButton.on("click",(t=>{t.preventDefault(),this.close()})),this.returnFunc=this.close}enableClose(){this.allowClose=!0,this.$closeButton.show()}disableClose(){this.allowClose=!1,this.$closeButton.hide()}setDockedPosition(){let t=Math.floor(this.extension.height()-this.$element.outerHeight(!0)),e=0,i=0,n=0;if(this.$triggerButton){let s=4,o=2;t=this.$triggerButton.offset().top-this.extension.$element.offset().top-this.$element.outerHeight(!0)+s;let a=this.$triggerButton.offset().left-this.extension.$element.offset().left;n=r.g.normalise(a,0,this.extension.width()),e=Math.floor(this.extension.width()*n-this.$element.width()*n)+o,i=Math.floor(this.$element.width()*n)}this.$bottom.css("backgroundPosition",i+"px 0px"),this.$element.css({top:t,left:e})}open(t){this.$element.attr("aria-hidden","false"),this.$element.show(),t?(this.$triggerButton=A(t),this.$bottom.show()):this.$bottom.hide(),this.isActive=!0,setTimeout((()=>{let t=this.$element.find(".default");if(t.length)t.focus();else{let t=this.$element.find("input:visible").first();t.length?t.focus():this.$closeButton.focus()}}),1),this.extensionHost.publish(r.p.SHOW_OVERLAY),this.isUnopened&&(this.isUnopened=!1,this.afterFirstOpen()),this.resize()}afterFirstOpen(){}close(){!this.isActive||(this.$element.attr("aria-hidden","true"),this.$element.hide(),this.isActive=!1,this.extensionHost.publish(this.closeCommand),this.extensionHost.publish(r.p.HIDE_OVERLAY))}resize(){super.resize(),this.$element.css({top:Math.floor(this.extension.height()/2-this.$element.height()/2),left:Math.floor(this.extension.width()/2-this.$element.width()/2)})}},w=(0,a.a)(),R=class extends L{constructor(t){super(t)}create(){this.setConfig("authDialogue"),super.create(),this.openCommand=r.p.SHOW_AUTH_DIALOGUE,this.closeCommand=r.p.HIDE_AUTH_DIALOGUE,this.extensionHost.subscribe(this.openCommand,(t=>{this.closeCallback=t.closeCallback,this.confirmCallback=t.confirmCallback,this.cancelCallback=t.cancelCallback,this.service=t.service,this.open()})),this.extensionHost.subscribe(this.closeCommand,(()=>{this.close()})),this.$title=w('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>            </div>'),this.$buttons.prepend(this._buttonsToAdd()),this.$message=this.$content.find(".message"),this.$confirmButton=this.$buttons.find(".confirm"),this.$confirmButton.text(this.content.confirm),this.$cancelButton=this.$buttons.find(".close"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$confirmButton.on("click",(t=>{t.preventDefault(),this.confirmCallback&&this.confirmCallback(),this.close()})),this.$cancelButton.on("click",(t=>{t.preventDefault(),this.cancelCallback&&this.cancelCallback(),this.close()}))}open(){super.open();let t=this.service.getHeader(),e=this.service.getDescription(),i=this.service.getConfirmLabel();t&&this.$title.text((0,a.b)(t)),e&&(this.$message.html((0,a.b)(e)),this.$message.targetBlank(),this.$message.find("a").on("click",(function(){let t=w(this).attr("href");this.extensionHost.publish(r.p.EXTERNAL_LINK_CLICKED,t)}))),i&&this.$confirmButton.text((0,a.b)(i)),this.resize()}resize(){super.resize()}_buttonsToAdd(){var t='<a class="confirm btn btn-primary" href="#" target="_parent"></a>';return this.config.topCloseButtonEnabled&&(t+='<button class="close btn btn-default"></button>'),t}},P=(0,a.a)(),M=class extends L{constructor(t){super(t)}create(){this.setConfig("clickThroughDialogue"),super.create(),this.openCommand=r.p.SHOW_CLICKTHROUGH_DIALOGUE,this.closeCommand=r.p.HIDE_CLICKTHROUGH_DIALOGUE,this.extensionHost.subscribe(this.openCommand,(t=>{this.acceptCallback=t.acceptCallback,this.resource=t.resource,this.open()})),this.extensionHost.subscribe(this.closeCommand,(()=>{this.close()})),this.$title=P('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="acceptTerms btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$acceptTermsButton=this.$content.find(".acceptTerms"),this.$acceptTermsButton.text("Accept Terms and Open"),this.$element.hide(),this.$acceptTermsButton.on("click",(t=>{t.preventDefault(),this.close(),this.extensionHost.publish(r.p.ACCEPT_TERMS),this.acceptCallback&&this.acceptCallback()}))}open(){super.open(),this.resource.clickThroughService&&(this.$title.text(this.resource.clickThroughService.getProperty("label")),this.$message.html(this.resource.clickThroughService.getProperty("description")),this.$message.targetBlank()),this.$message.find("a").on("click",(function(){var t=P(this).attr("href");this.extensionHost.publish(r.p.EXTERNAL_LINK_CLICKED,t)})),this.resize()}resize(){super.resize()}},N=(0,a.a)(),D=class extends L{constructor(t){super(t)}create(){this.setConfig("loginDialogue"),super.create(),this.openCommand=r.p.SHOW_LOGIN_DIALOGUE,this.closeCommand=r.p.HIDE_LOGIN_DIALOGUE,this.extensionHost.subscribe(this.openCommand,(t=>{this.loginCallback=t.loginCallback,this.logoutCallback=t.logoutCallback,this.options=t.options,this.resource=t.resource,this.open()})),this.extensionHost.subscribe(this.closeCommand,(()=>{this.close()})),this.$title=N('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="logout btn btn-primary" href="#" target="_parent"></a>                    <a class="login btn btn-primary" href="#" target="_parent"></a>                    <a class="cancel btn btn-primary" href="#"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$loginButton=this.$content.find(".login"),this.$loginButton.text(this.content.login),this.$logoutButton=this.$content.find(".logout"),this.$logoutButton.text(this.content.logout),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$loginButton.on("click",(t=>{t.preventDefault(),this.close(),this.loginCallback&&this.loginCallback()})),this.$logoutButton.on("click",(t=>{t.preventDefault(),this.close(),this.logoutCallback&&this.logoutCallback()})),this.$cancelButton.on("click",(t=>{t.preventDefault(),this.close()})),this.updateLogoutButton()}open(){super.open();let t="";this.resource.loginService&&(this.$title.text(this.resource.loginService.getProperty("label")),t=this.resource.loginService.getProperty("description")),this.options.warningMessage&&(t='<span class="warning">'+this.extension.data.config.content[this.options.warningMessage]+'</span><span class="description">'+t+"</span>"),this.updateLogoutButton(),this.$message.html(t),this.$message.targetBlank(),this.$message.find("a").on("click",(function(){var t=N(this).attr("href");this.extensionHost.publish(r.p.EXTERNAL_LINK_CLICKED,t)})),this.options.showCancelButton?this.$cancelButton.show():this.$cancelButton.hide(),this.resize()}updateLogoutButton(){this.extension.isLoggedIn?this.$logoutButton.show():this.$logoutButton.hide()}resize(){super.resize()}},H=(0,a.a)(),B=class extends L{constructor(t){super(t)}create(){this.setConfig("restrictedDialogue"),super.create(),this.openCommand=r.p.SHOW_RESTRICTED_DIALOGUE,this.closeCommand=r.p.HIDE_RESTRICTED_DIALOGUE,this.extensionHost.subscribe(this.openCommand,(t=>{this.acceptCallback=t.acceptCallback,this.options=t.options,this.resource=t.resource,this.open()})),this.extensionHost.subscribe(this.closeCommand,(()=>{this.close()})),this.$title=H('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="cancel btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$message.targetBlank(),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$cancelButton.on("click",(t=>{t.preventDefault(),this.close()}))}open(){super.open(),this.isAccepted=!1;let t="";this.resource.restrictedService&&(this.$title.text(this.resource.restrictedService.getProperty("label")),t=this.resource.restrictedService.getProperty("description")),this.$message.html(t),this.$message.targetBlank(),this.$message.find("a").on("click",(function(){var t=H(this).attr("href");this.extensionHost.publish(r.p.EXTERNAL_LINK_CLICKED,t)})),this.resize()}close(){super.close(),!this.isAccepted&&this.acceptCallback&&(this.isAccepted=!0,this.acceptCallback())}resize(){super.resize()}},k=(0,a.a)(),F=class extends L{constructor(t){super(t)}create(){this.setConfig("genericDialogue"),super.create(),this.openCommand=r.p.SHOW_GENERIC_DIALOGUE,this.closeCommand=r.p.HIDE_GENERIC_DIALOGUE,this.extensionHost.subscribe(this.openCommand,(t=>{this.acceptCallback=t.acceptCallback,this.showMessage(t)})),this.extensionHost.subscribe(this.closeCommand,(()=>{this.close()})),this.$message=k("<p></p>"),this.$content.append(this.$message),this.$acceptButton=k(`\n          <button class="btn btn-primary accept default">\n            ${this.content.ok}\n          </button>\n        `),this.$buttons.append(this.$acceptButton),this.$buttons.find(".close").hide(),this.$acceptButton.onPressed((()=>{this.accept()})),this.returnFunc=()=>{this.isActive&&this.accept()},this.$element.hide()}accept(){this.extensionHost.publish(r.p.CLOSE_ACTIVE_DIALOGUE),this.acceptCallback&&this.acceptCallback()}showMessage(t){this.$message.html(t.message),t.buttonText?this.$acceptButton.text(t.buttonText):this.$acceptButton.text(this.content.ok),!1===t.allowClose&&this.disableClose(),this.open()}resize(){super.resize()}},U=(0,a.a)(),G=class extends S{constructor(t){super(t,!0,!0)}create(){super.create(),this.extensionHost.subscribe(r.p.SHOW_OVERLAY,(()=>{this.$overlays.show()})),this.extensionHost.subscribe(r.p.HIDE_OVERLAY,(()=>{this.$overlays.hide()})),this.$element.append('<a class="sr-only" href="#download-btn">'+this.extension.data.config.content.skipToDownload+"</a>"),this.$headerPanel=U('<div class="headerPanel"></div>'),this.$element.append(this.$headerPanel),this.$mainPanel=U('<div class="mainPanel"></div>'),this.$element.append(this.$mainPanel),this.$centerPanel=U('<div class="centerPanel"></div>'),this.$centerPanel.append('<h2 class="sr-only">'+this.extension.data.config.content.mediaViewer+"</h2>"),this.$mainPanel.append(this.$centerPanel),this.$leftPanel=U('<div class="leftPanel"></div>'),this.$mainPanel.append(this.$leftPanel),this.$rightPanel=U('<div class="rightPanel"></div>'),this.$mainPanel.append(this.$rightPanel),this.$footerPanel=U('<div class="footerPanel"></div>'),this.$element.append(this.$footerPanel),this.$mobileFooterPanel=U('<div class="mobileFooterPanel"></div>'),this.$element.append(this.$mobileFooterPanel),this.$overlays=U('<div class="overlays"></div>'),this.$element.append(this.$overlays),this.$overlays.hide(),this.$genericDialogue=U('<div class="overlay genericDialogue" aria-hidden="true"></div>'),this.$overlays.append(this.$genericDialogue),this.$overlays.on("click",(t=>{U(t.target).hasClass("overlays")&&(t.preventDefault(),this.extensionHost.publish(r.p.CLOSE_ACTIVE_DIALOGUE))})),new F(this.$genericDialogue)}resize(){super.resize(),setTimeout((()=>{this.$overlays.width(this.extension.width()),this.$overlays.height(this.extension.height())}),1);let t=this.$element.height()-parseInt(this.$mainPanel.css("paddingTop"))-((0,a.d)(this.$headerPanel)?this.$headerPanel.height():0)-((0,a.d)(this.$footerPanel)?this.$footerPanel.height():0)-((0,a.d)(this.$mobileFooterPanel)?this.$mobileFooterPanel.height():0);this.$mainPanel.height(t)}},V=(0,h.c)((0,o.a)());(O=C||(C={}))[O.Backspace=8]="Backspace",O[O.Tab=9]="Tab",O[O.Enter=13]="Enter",O[O.Shift=16]="Shift",O[O.Ctrl=17]="Ctrl",O[O.Alt=18]="Alt",O[O.PauseBreak=19]="PauseBreak",O[O.CapsLock=20]="CapsLock",O[O.Escape=27]="Escape",O[O.Spacebar=32]="Spacebar",O[O.PageUp=33]="PageUp",O[O.PageDown=34]="PageDown",O[O.End=35]="End",O[O.Home=36]="Home",O[O.LeftArrow=37]="LeftArrow",O[O.UpArrow=38]="UpArrow",O[O.RightArrow=39]="RightArrow",O[O.DownArrow=40]="DownArrow",O[O.PrintScrn=44]="PrintScrn",O[O.Insert=45]="Insert",O[O.Delete=46]="Delete",O[O.Zero=48]="Zero",O[O.One=49]="One",O[O.Two=50]="Two",O[O.Three=51]="Three",O[O.Four=52]="Four",O[O.Five=53]="Five",O[O.Six=54]="Six",O[O.Seven=55]="Seven",O[O.Eight=56]="Eight",O[O.Nine=57]="Nine",O[O.a=65]="a",O[O.b=66]="b",O[O.c=67]="c",O[O.d=68]="d",O[O.e=69]="e",O[O.f=70]="f",O[O.g=71]="g",O[O.h=72]="h",O[O.i=73]="i",O[O.j=74]="j",O[O.k=75]="k",O[O.l=76]="l",O[O.m=77]="m",O[O.n=78]="n",O[O.o=79]="o",O[O.p=80]="p",O[O.q=81]="q",O[O.r=82]="r",O[O.s=83]="s",O[O.t=84]="t",O[O.u=85]="u",O[O.v=86]="v",O[O.w=87]="w",O[O.x=88]="x",O[O.y=89]="y",O[O.z=90]="z",O[O.LeftWindowKey=91]="LeftWindowKey",O[O.RightWindowKey=92]="RightWindowKey",O[O.SelectKey=93]="SelectKey",O[O.Numpad0=96]="Numpad0",O[O.Numpad1=97]="Numpad1",O[O.Numpad2=98]="Numpad2",O[O.Numpad3=99]="Numpad3",O[O.Numpad4=100]="Numpad4",O[O.Numpad5=101]="Numpad5",O[O.Numpad6=102]="Numpad6",O[O.Numpad7=103]="Numpad7",O[O.Numpad8=104]="Numpad8",O[O.Numpad9=105]="Numpad9",O[O.Multiply=106]="Multiply",O[O.NumpadPlus=107]="NumpadPlus",O[O.NumpadMinus=109]="NumpadMinus",O[O.DecimalPoint=110]="DecimalPoint",O[O.Divide=111]="Divide",O[O.F1=112]="F1",O[O.F2=113]="F2",O[O.F3=114]="F3",O[O.F4=115]="F4",O[O.F5=116]="F5",O[O.F6=117]="F6",O[O.F7=118]="F7",O[O.F8=119]="F8",O[O.F9=120]="F9",O[O.F10=121]="F10",O[O.F11=122]="F11",O[O.F12=123]="F12",O[O.NumLock=144]="NumLock",O[O.ScrollLock=145]="ScrollLock",O[O.Semicolon=186]="Semicolon",O[O.Equals=187]="Equals",O[O.Comma=188]="Comma",O[O.LessThan=188]="LessThan",O[O.Dash=189]="Dash",O[O.Period=190]="Period",O[O.GreaterThan=190]="GreaterThan",O[O.ForwardSlash=191]="ForwardSlash",O[O.QuestionMark=191]="QuestionMark",O[O.GraveAccent=192]="GraveAccent",O[O.Tilde=192]="Tilde",O[O.OpenCurlyBracket=219]="OpenCurlyBracket",O[O.OpenSquareBracket=219]="OpenSquareBracket",O[O.BackSlash=220]="BackSlash",O[O.VerticalPipe=220]="VerticalPipe",O[O.CloseCurlyBracket=221]="CloseCurlyBracket",O[O.CloseSquareBracket=221]="CloseSquareBracket",O[O.Quote=222]="Quote",O[O.CommandFF=224]="CommandFF",function(t){t[t.Backspace=8]="Backspace",t[t.Enter=13]="Enter",t[t.Spacebar=32]="Spacebar",t[t.Hash=35]="Hash",t[t.GraveAccent=39]="GraveAccent",t[t.DoubleQuote=34]="DoubleQuote",t[t.Asterisk=42]="Asterisk",t[t.Plus=43]="Plus",t[t.Comma=44]="Comma",t[t.Minus=45]="Minus",t[t.Period=46]="Period",t[t.ForwardSlash=47]="ForwardSlash",t[t.Zero=48]="Zero",t[t.One=49]="One",t[t.Two=50]="Two",t[t.Three=51]="Three",t[t.Four=52]="Four",t[t.Five=53]="Five",t[t.Six=54]="Six",t[t.Seven=55]="Seven",t[t.Eight=56]="Eight",t[t.Nine=57]="Nine",t[t.Colon=58]="Colon",t[t.Semicolon=59]="Semicolon",t[t.LessThan=60]="LessThan",t[t.Equals=61]="Equals",t[t.GreaterThan=62]="GreaterThan",t[t.QuestionMark=63]="QuestionMark",t[t.At=64]="At",t[t.OpenSquareBracket=91]="OpenSquareBracket",t[t.BackSlash=92]="BackSlash",t[t.CloseSquareBracket=93]="CloseSquareBracket",t[t.a=97]="a",t[t.b=98]="b",t[t.c=99]="c",t[t.d=100]="d",t[t.e=101]="e",t[t.f=102]="f",t[t.g=103]="g",t[t.h=104]="h",t[t.i=105]="i",t[t.j=106]="j",t[t.k=107]="k",t[t.l=108]="l",t[t.m=109]="m",t[t.n=110]="n",t[t.o=111]="o",t[t.p=112]="p",t[t.q=113]="q",t[t.r=114]="r",t[t.s=115]="s",t[t.t=116]="t",t[t.u=117]="u",t[t.v=118]="v",t[t.w=119]="w",t[t.x=120]="x",t[t.y=121]="y",t[t.z=122]="z",t[t.OpenCurlyBracket=123]="OpenCurlyBracket",t[t.VerticalPipe=124]="VerticalPipe",t[t.CloseCurlyBracket=125]="CloseCurlyBracket",t[t.Tilde=126]="Tilde"}(T||(T={}));var j,z,W=(0,a.a)(),K=class{constructor(){this.annotations=[],this.isCreated=!1,this.isLoggedIn=!1,this.metrics=[],this.shifted=!1,this.tabbing=!1,this.locales={}}create(){let t=this;if(this.browserDetect=new q,this.browserDetect.init(),_.publish=this.extensionHost.publish.bind(this.extensionHost),I.publish=this.extensionHost.publish.bind(this.extensionHost),this.$element=W(this.extensionHost.options.target),this.$element.data("component",this.extensionHost),this._parseMetrics(),this._initLocales(),this.$element.empty(),this.$element.removeClass(),this.$element.addClass("uv-iiif-extension-host"),this.$element.addClass("loading"),this.data.locales&&this.$element.addClass(this.data.locales[0].name.toLowerCase()),this.$element.addClass(this.type.name),this.$element.addClass("browser-"+this.browserDetect.browser),this.$element.addClass("browser-version-"+this.browserDetect.version),this.$element.prop("tabindex",-1),this.data.embedded&&this.$element.addClass("embedded"),this.isMobile()&&this.$element.addClass("mobile"),r.d.supportsFullscreen()&&this.$element.addClass("fullscreen-supported"),this.isFullScreen()&&this.$element.addClass("fullscreen"),this.$element.on("mousemove",(t=>{this.mouseX=t.pageX,this.mouseY=t.pageY})),!this.data.isReload){let e=r.d.getHiddenProp();if(e){let t=e.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(t,(()=>{r.d.isHidden()||this.resize()}))}r.b.getBool(this.data.config.options.dropEnabled,!0)&&this.$element.on("drop",(t=>{t.preventDefault();let e=t.originalEvent.dataTransfer.getData("URL"),i=r.o.getUrlParts(e),n=r.o.getQuerystringParameterFromString("manifest",i.search);if(n||(n=r.o.getQuerystringParameterFromString("collection",i.search)),n){this.fire(l.a.DROP,n);let t={};t.iiifManifestId=n,this.reload(t)}})),this.$element.on("dragover",(t=>{t.preventDefault()})),this.$element.on("keyup keydown",(t=>{this.shifted=t.shiftKey,this.tabbing=t.keyCode===C.Tab})),this.$element.on("keydown",(e=>{let i=null,n=!0;!e.ctrlKey&&!e.altKey&&!e.shiftKey&&(e.keyCode===C.Enter&&(i=r.p.RETURN,n=!1),e.keyCode===C.Escape&&(i=r.p.ESCAPE),e.keyCode===C.PageUp&&(i=r.p.PAGE_UP),e.keyCode===C.PageDown&&(i=r.p.PAGE_DOWN),e.keyCode===C.End&&(i=r.p.END),e.keyCode===C.Home&&(i=r.p.HOME),(e.keyCode===C.NumpadPlus||171===e.keyCode||e.keyCode===C.Equals)&&(i=r.p.PLUS,n=!1),(e.keyCode===C.NumpadMinus||173===e.keyCode||e.keyCode===C.Dash)&&(i=r.p.MINUS,n=!1),t.useArrowKeysToNavigate()&&(e.keyCode===C.LeftArrow&&(i=r.p.LEFT_ARROW),e.keyCode===C.UpArrow&&(i=r.p.UP_ARROW),e.keyCode===C.RightArrow&&(i=r.p.RIGHT_ARROW),e.keyCode===C.DownArrow&&(i=r.p.DOWN_ARROW))),i&&(n&&e.preventDefault(),this.extensionHost.publish(i))}))}this.extensionHost.subscribe(l.a.EXIT_FULLSCREEN,(()=>{this.isOverlayActive()&&this.extensionHost.publish(r.p.ESCAPE),this.extensionHost.publish(r.p.ESCAPE),this.extensionHost.publish(l.a.RESIZE)})),this.$element.append('<iframe id="commsFrame" style="display:none"></iframe>'),this.extensionHost.subscribeAll(((t,e)=>{[l.a.LOAD,l.a.DROP,l.a.TOGGLE_FULLSCREEN,l.a.EXTERNAL_RESOURCE_OPENED,l.a.RELOAD].includes(t)||this.fire(t,e)})),this.extensionHost.subscribe(l.a.EXTERNAL_RESOURCE_OPENED,(()=>{this.fire(l.a.EXTERNAL_RESOURCE_OPENED)})),this.extensionHost.subscribe(r.p.LOGIN_FAILED,(()=>{this.showMessage(this.data.config.content.authorisationFailedMessage)})),this.extensionHost.subscribe(r.p.LOGIN,(()=>{this.isLoggedIn=!0})),this.extensionHost.subscribe(r.p.LOGOUT,(()=>{this.isLoggedIn=!1})),this.extensionHost.subscribe(r.p.BOOKMARK,(()=>{this.bookmark()})),this.extensionHost.subscribe(r.p.CANVAS_INDEX_CHANGE,(t=>{this.data.canvasIndex=t,this.lastCanvasIndex=this.helper.canvasIndex,this.helper.canvasIndex=t})),this.extensionHost.subscribe(r.p.CLOSE_LEFT_PANEL,(()=>{this.resize()})),this.extensionHost.subscribe(r.p.CLOSE_RIGHT_PANEL,(()=>{this.resize()})),this.extensionHost.subscribe(r.p.COLLECTION_INDEX_CHANGE,(t=>{this.data.collectionIndex=t})),this.extensionHost.subscribe(l.a.CREATED,(()=>{this.isCreated=!0})),this.extensionHost.subscribe(r.p.ESCAPE,(()=>{this.isFullScreen()&&!this.isOverlayActive()&&this.extensionHost.publish(l.a.TOGGLE_FULLSCREEN)})),this.extensionHost.subscribe(l.a.LOAD,(()=>{setTimeout((()=>{this.extensionHost.publish(l.a.RESIZE),this.fire(l.a.LOAD,this.helper.getCurrentCanvas().id),this.$element.removeClass("loading")}),100)})),this.extensionHost.subscribe(r.p.FEEDBACK,(()=>{this.feedback()})),this.extensionHost.subscribe(r.p.FORBIDDEN,(()=>{this.extensionHost.publish(r.p.OPEN_EXTERNAL_RESOURCE)})),this.extensionHost.subscribe(l.a.LOAD_FAILED,(()=>{null==!t.lastCanvasIndex&&t.lastCanvasIndex!==t.helper.canvasIndex&&this.extensionHost.publish(r.p.CANVAS_INDEX_CHANGE,t.lastCanvasIndex)})),this.extensionHost.subscribe(r.p.MANIFEST_INDEX_CHANGE,(t=>{this.data.manifestIndex=t})),this.extensionHost.subscribe(r.p.OPEN,(()=>{let t=r.n.format(this.data.config.options.openTemplate,this.helper.manifestUri);window.open(t)})),this.extensionHost.subscribe(r.p.OPEN_LEFT_PANEL,(()=>{this.$element.hasClass("loading")||this.resize()})),this.extensionHost.subscribe(r.p.OPEN_RIGHT_PANEL,(()=>{this.$element.hasClass("loading")||this.resize()})),this.extensionHost.subscribe(r.p.RANGE_CHANGE,(t=>{t?(this.data.rangeId=t.id,this.helper.rangeId=t.id):(this.data.rangeId=void 0,this.helper.rangeId=void 0)})),this.extensionHost.subscribe(r.p.RESOURCE_DEGRADED,(t=>{_.handleDegraded(t)})),this.extensionHost.subscribe(r.p.SHOW_MESSAGE,(t=>{this.showMessage(t)})),this.extensionHost.subscribe(r.p.SHOW_TERMS_OF_USE,(()=>{let t=this.helper.getLicense();if(!t){let e=this.helper.getRequiredStatement();e&&e.value&&(t=e.value)}t&&this.showMessage(t)})),this.extensionHost.subscribe(l.a.TOGGLE_FULLSCREEN,(()=>{let t=this.data.config.options.overrideFullScreen;this.extensionHost.isFullScreen=!this.extensionHost.isFullScreen,t||(W("#top").focus(),this.extensionHost.isFullScreen?this.$element.addClass("fullscreen"):this.$element.removeClass("fullscreen")),this.fire(l.a.TOGGLE_FULLSCREEN,{isFullScreen:this.extensionHost.isFullScreen,overrideFullScreen:t})})),this.shell=new G(this.$element),this.createModules(),this.extensionHost.publish(l.a.RESIZE),setTimeout((()=>{this.render(),this.extensionHost.publish(l.a.CREATED),this._setDefaultFocus()}),1)}async loadConfig(t){let e=this.locales[t];if(!e)throw new Error("Unable to load config");return"object"==typeof e?e=JSON.parse(JSON.stringify(e)):"function"==typeof e&&(e=await e(),e=JSON.parse(JSON.stringify(e))),e}createModules(){this.$authDialogue=W('<div class="overlay auth" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$authDialogue),this.authDialogue=new R(this.$authDialogue),this.$clickThroughDialogue=W('<div class="overlay clickthrough" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$clickThroughDialogue),this.clickThroughDialogue=new M(this.$clickThroughDialogue),this.$restrictedDialogue=W('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$restrictedDialogue),this.restrictedDialogue=new B(this.$restrictedDialogue),this.$loginDialogue=W('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$loginDialogue),this.loginDialogue=new D(this.$loginDialogue)}_setDefaultFocus(){setTimeout((()=>{this.data.config.options.allowStealFocus&&W("[tabindex=0]").focus()}),1)}width(){return this.$element.width()}height(){return this.$element.height()}exitFullScreen(){this.extensionHost.publish(l.a.EXIT_FULLSCREEN)}fire(t,...e){this.data.debug&&console.log(t,arguments[1]),this.extensionHost.fire(t,arguments[1])}redirect(t){this.fire(r.p.REDIRECT,t)}refresh(){this.fire(r.p.REFRESH,null)}render(){if((!this.isCreated||this.data.collectionIndex!==this.helper.collectionIndex)&&this.extensionHost.publish(r.p.COLLECTION_INDEX_CHANGE,this.data.collectionIndex),(!this.isCreated||this.data.manifestIndex!==this.helper.manifestIndex)&&void 0!==this.data.iiifManifestId&&this.extensionHost.publish(r.p.MANIFEST_INDEX_CHANGE,this.data.manifestIndex),(!this.isCreated||this.data.canvasIndex!==this.helper.canvasIndex)&&(void 0===this.data.canvasIndex&&(this.data.canvasIndex=0),this.extensionHost.publish(r.p.CANVAS_INDEX_CHANGE,this.data.canvasIndex)),(!this.isCreated||this.data.rangeId!==this.helper.rangeId)&&this.data.rangeId){let t=this.helper.getRangeById(this.data.rangeId);t?this.extensionHost.publish(r.p.RANGE_CHANGE,t):console.warn("range id not found:",this.data.rangeId)}}_initLocales(){let t=this.data.config.localisation.locales.slice(0),e=this.data.locales,i=[];e?(e.forEach((e=>{let n=t.filter((t=>t.name===e.name));if(n.length){var s=n[0];e.label&&(s.label=e.label),s.added=!0,i.push(s)}})),r.b.getBool(this.data.config.options.limitLocales,!1)||t.forEach((t=>{t.added||i.push(t),delete t.added})),this.data.locales=i):console.warn("No locales configured")}_parseMetrics(){let t=this.data.config.options.metrics;if(t)for(let e=0;e<t.length;e++){let i=t[e];this.metrics.push(i)}}_updateMetric(){setTimeout((()=>{for(let e=this.metrics.length-1;e>=0;e--){let i=this.metrics[e];if(window.innerWidth>=i.minWidth){if(this.metric!==i.type){this.metric=i.type;for(var t=0;t<this.metrics.length;t++)this.$element.removeClass(this.metrics[t].type);this.$element.addClass(i.type),this.extensionHost.publish(r.p.METRIC_CHANGE)}break}}}),1)}resize(){this._updateMetric(),this.extensionHost.publish(l.a.RESIZE)}reload(t){this.extensionHost.publish(l.a.RELOAD,t)}isSeeAlsoEnabled(){return!1!==this.data.config.options.seeAlsoEnabled}getShareUrl(){if(!this.data.embedded)return r.d.isInIFrame()?parent.document.location.href:document.location.href;if(this.helper.hasRelatedPage()){var t=this.helper.getRelated();return t&&t.length&&(t=t[0]),t["@id"]}return null}getIIIFShareUrl(t=!1){let e;return t&&(e=this.helper.manifest?this.helper.manifest.id:this.helper.manifestUri),`${e}?manifest=${e}`}getDomain(){return r.o.getUrlParts(this.helper.manifestUri).host}getAppUri(){return window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/uv.html"}getSettings(){if(r.b.getBool(this.data.config.options.saveUserSettings,!1)){let t=r.l.get("uv.settings",r.m.LOCAL);if(t)return W.extend(this.data.config.options,t.value)}return this.data.config.options}updateSettings(t){if(r.b.getBool(this.data.config.options.saveUserSettings,!1)){let e=r.l.get("uv.settings",r.m.LOCAL);e&&(t=W.extend(e.value,t)),r.l.set("uv.settings",t,31536e4,r.m.LOCAL)}this.data.config.options=W.extend(this.data.config.options,t)}getLocale(){return this.helper.options.locale}getSharePreview(){let t=this.helper.getLabel(),e=this.helper.getCurrentCanvas(),i=e.getProperty("thumbnail");return(!i||"string"!=typeof i)&&(i=e.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth)),{title:t,image:i}}getPagedIndices(t=this.helper.canvasIndex){return[t]}getCurrentCanvases(){let t=this.getPagedIndices(this.helper.canvasIndex),e=[];for(let i=0;i<t.length;i++){let n=t[i],s=this.helper.getCanvasByIndex(n);e.push(s)}return e}getCanvasLabels(t){let e=this.getPagedIndices(),i="";if(1===e.length)i=t;else for(let n=1;n<=e.length;n++)i.length&&(i+=","),i+=t+" "+n;return i}getCurrentCanvasRange(){return this.helper.getCanvasRange(this.helper.getCurrentCanvas())}getExternalResources(t){let e=this.getPagedIndices(),i=[];e.forEach((e=>{let n,s=this.helper.getCanvasByIndex(e);if(n=s.externalResource?s.externalResource:new o.f(s,{authApiVersion:this.data.config.options.authAPIVersion}),t){let e=t.find((t=>t.dataUri===n.dataUri));e?i.push(e):i.push(n)}else i.push(n)}));let n=this.data.config.options.tokenStorage;return 1===this.data.config.options.authAPIVersion?new Promise((t=>{let e={locale:this.helper.options.locale};I.loadExternalResources(i,n,e).then((e=>{this.resources=e.map((t=>this._prepareResourceData(t))),t(this.resources)}))})):new Promise((t=>{_.loadExternalResources(i,n).then((e=>{this.resources=e.map((t=>this._prepareResourceData(t))),t(this.resources)}))}))}_prepareResourceData(t){return t.data.hasServiceDescriptor=t.hasServiceDescriptor(),t.hasServiceDescriptor()||(t.data.id=t.dataUri,t.data.width=t.width,t.data.height=t.height),t.data.index=t.index,r.k.toPlainObject(t.data)}getMediaFormats(t){let e=t.getContent();return e&&e.length?e[0].getBody():[{id:t.id,type:t.getType(),getFormat:function(){return""}}]}viewCanvas(t){this.helper.isCanvasIndexOutOfRange(t)?this.showMessage(this.data.config.content.canvasIndexOutOfRange):this.extensionHost.publish(r.p.OPEN_EXTERNAL_RESOURCE)}showMessage(t,e,i,n){this.closeActiveDialogue(),this.extensionHost.publish(r.p.SHOW_GENERIC_DIALOGUE,{message:t,acceptCallback:e,buttonText:i,allowClose:n})}closeActiveDialogue(){this.extensionHost.publish(r.p.CLOSE_ACTIVE_DIALOGUE)}isOverlayActive(){return(0,a.d)(this.shell.$overlays)}isDesktopMetric(){return"lg"===this.metric||"xl"===this.metric}isMobileMetric(){return"sm"===this.metric||"md"===this.metric}viewManifest(t){let e={};e.iiifManifestId=this.helper.manifestUri,e.collectionIndex=this.helper.getCollectionIndex(t),e.manifestIndex=t.index,e.canvasIndex=0,this.reload(e)}viewCollection(t){let e={};e.iiifManifestId=t.parentCollection?t.parentCollection.id:this.helper.manifestUri,e.collectionIndex=t.index,e.manifestIndex=0,e.canvasIndex=0,this.reload(e)}isFullScreen(){return this.extensionHost.isFullScreen}isHeaderPanelEnabled(){return r.b.getBool(this.data.config.options.headerPanelEnabled,!0)}isLeftPanelEnabled(){if(r.b.getBool(this.data.config.options.leftPanelEnabled,!0)){if(this.helper.hasParentCollection())return!0;if(this.helper.isMultiCanvas()){let t=this.helper.getViewingHint();if(!t||t&&t!==V.ViewingHint.CONTINUOUS)return!0}}return!1}isRightPanelEnabled(){return r.b.getBool(this.data.config.options.rightPanelEnabled,!0)}isFooterPanelEnabled(){return r.b.getBool(this.data.config.options.footerPanelEnabled,!0)}isMobile(){let t=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|android|ipad|playbook|silk|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}useArrowKeysToNavigate(){return r.b.getBool(this.data.config.options.useArrowKeysToNavigate,!0)}bookmark(){}feedback(){this.fire(r.p.FEEDBACK,this.data)}getAlternateLocale(){let t=null;return this.data.locales&&this.data.locales.length>1&&(t=this.data.locales[1]),t}getSerializedLocales(){return this.data.locales?this.serializeLocales(this.data.locales):null}serializeLocales(t){let e="";for(let i=0;i<t.length;i++){let n=t[i];i>0&&(e+=","),e+=n.name,n.label&&(e+=":"+n.label)}return e}changeLocale(t){let e={};if(this.data.locales){e.locales=this.data.locales.slice(0);let i=e.locales.findIndex((e=>e.name===t)),n=0;e.locales.splice(n,0,e.locales.splice(i,1)[0]),this.reload(e)}}},q=class{constructor(){this.dataBrowser=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"}]}init(){this.browser=this.searchString(this.dataBrowser)||"Other",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown","Explorer"==this.browser&&"7"==this.version&&navigator.userAgent.match(/Trident/i)&&(this.version=this.searchVersionIE())}searchString(t){for(var e=0;e<t.length;e++){var i=t[e].string;if(this.versionSearchString=t[e].subString,-1!=i.indexOf(t[e].subString))return t[e].identity}}searchVersion(t){var e=t.indexOf(this.versionSearchString);if(-1!=e)return parseFloat(t.substring(e+this.versionSearchString.length+1))}searchVersionIE(){var t=navigator.userAgent.toString().toLowerCase(),e=/(trident)(?:.*rv:([\w.]+))?/.exec(t)||/(msie) ([\w.]+)/.exec(t)||["",null,-1],i="unknown";return null!==e&&3===e.length&&e[2]&&(i=e[2].split(".")[0]),i}},Y=(0,a.a)(),X=class extends S{constructor(t){super(t)}create(){this.setConfig("footerPanel"),super.create(),this.extensionHost.subscribe(l.a.TOGGLE_FULLSCREEN,(()=>{this.updateFullScreenButton(),this.extensionHost.isFullScreen||setTimeout((()=>{this.resize()}),1001)})),this.extensionHost.subscribe(r.p.METRIC_CHANGE,(()=>{this.updateMinimisedButtons(),this.updateMoreInfoButton()})),this.extensionHost.subscribe(r.p.SETTINGS_CHANGE,(()=>{this.updateDownloadButton()})),this.$options=Y('<div class="options"></div>'),this.$element.append(this.$options),this.$feedbackButton=Y(`\n          <button class="feedback btn imageBtn" title="${this.content.feedback}">\n            <i class="uv-icon uv-icon-feedback" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.feedback}</span>\n          </button>\n        `),this.$options.prepend(this.$feedbackButton),this.$openButton=Y(`\n          <button class="open btn imageBtn" title="${this.content.open}">\n            <i class="uv-icon-open" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.open}</span>\n          </button>\n        `),this.$options.prepend(this.$openButton),this.$bookmarkButton=Y(`\n          <button class="bookmark btn imageBtn" title="${this.content.bookmark}">\n            <i class="uv-icon uv-icon-bookmark" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.bookmark}</span>\n          </button>\n        `),this.$options.prepend(this.$bookmarkButton),this.$shareButton=Y(`\n          <button class="share btn imageBtn" title="${this.content.share}">\n            <i class="uv-icon uv-icon-share" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.share}</span>\n          </button>\n        `),this.$options.append(this.$shareButton),this.$embedButton=Y(`\n          <button class="embed btn imageBtn" title="${this.content.embed}">\n            <i class="uv-icon uv-icon-embed" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.embed}</span>\n          </button>\n        `),this.$options.append(this.$embedButton),this.$downloadButton=Y(`\n          <button class="download btn imageBtn" title="${this.content.download}" id="download-btn">\n            <i class="uv-icon uv-icon-download" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.download}</span>\n          </button>\n        `),this.$options.prepend(this.$downloadButton),this.$moreInfoButton=Y(`\n          <button class="moreInfo btn imageBtn" title="${this.content.moreInfo}">\n            <i class="uv-icon uv-icon-more-info" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.moreInfo}</span>\n          </button>\n        `),this.$options.prepend(this.$moreInfoButton),this.$fullScreenBtn=Y(`\n          <button class="fullScreen btn imageBtn" title="${this.content.fullScreen}">\n            <i class="uv-icon uv-icon-fullscreen" aria-hidden="true"></i>\n            <span class="sr-only">${this.content.fullScreen}</span>\n          </button>\n        `),this.$options.append(this.$fullScreenBtn),this.$openButton.onPressed((()=>{this.extensionHost.publish(r.p.OPEN)})),this.$feedbackButton.onPressed((()=>{this.extensionHost.publish(r.p.FEEDBACK)})),this.$bookmarkButton.onPressed((()=>{this.extensionHost.publish(r.p.BOOKMARK)})),this.$shareButton.onPressed((()=>{this.extensionHost.publish(r.p.SHOW_SHARE_DIALOGUE,this.$shareButton)})),this.$embedButton.onPressed((()=>{this.extensionHost.publish(r.p.SHOW_EMBED_DIALOGUE,this.$embedButton)})),this.$downloadButton.onPressed((()=>{this.extensionHost.publish(r.p.SHOW_DOWNLOAD_DIALOGUE,this.$downloadButton)})),this.$moreInfoButton.onPressed((()=>{this.extensionHost.publish(r.p.SHOW_MOREINFO_DIALOGUE,this.$moreInfoButton)})),this.onAccessibleClick(this.$fullScreenBtn,(t=>{t.preventDefault(),this.extensionHost.publish(l.a.TOGGLE_FULLSCREEN)}),!0),r.b.getBool(this.options.embedEnabled,!0)||this.$embedButton.hide(),this.updateMoreInfoButton(),this.updateOpenButton(),this.updateFeedbackButton(),this.updateBookmarkButton(),this.updateEmbedButton(),this.updateDownloadButton(),this.updateFullScreenButton(),this.updateShareButton(),this.updateMinimisedButtons()}updateMinimisedButtons(){r.b.getBool(this.options.minimiseButtons,!1)?this.$options.addClass("minimiseButtons"):this.extension.isDesktopMetric()?this.$options.removeClass("minimiseButtons"):this.$options.addClass("minimiseButtons")}updateMoreInfoButton(){}updateOpenButton(){r.b.getBool(this.options.openEnabled,!1)&&r.d.isInIFrame()?this.$openButton.show():this.$openButton.hide()}updateFullScreenButton(){r.b.getBool(this.options.fullscreenEnabled,!0)&&r.d.supportsFullscreen()?this.extension.isFullScreen()?(this.$fullScreenBtn.switchClass("fullScreen","exitFullscreen"),this.$fullScreenBtn.find("i").switchClass("uv-icon-fullscreen","uv-icon-exit-fullscreen"),this.$fullScreenBtn.attr("title",this.content.exitFullScreen),Y(this.$fullScreenBtn[0].firstChild.nextSibling.nextSibling).replaceWith(this.content.exitFullScreen)):(this.$fullScreenBtn.switchClass("exitFullscreen","fullScreen"),this.$fullScreenBtn.find("i").switchClass("uv-icon-exit-fullscreen","uv-icon-fullscreen"),this.$fullScreenBtn.attr("title",this.content.fullScreen),Y(this.$fullScreenBtn[0].firstChild.nextSibling.nextSibling).replaceWith(this.content.fullScreen)):this.$fullScreenBtn.hide()}updateEmbedButton(){this.extension.helper.isUIEnabled("embed")&&r.b.getBool(this.options.embedEnabled,!1)?this.extension.isMobile()||this.$embedButton.show():this.$embedButton.hide()}updateShareButton(){this.extension.helper.isUIEnabled("share")&&r.b.getBool(this.options.shareEnabled,!0)?this.$shareButton.show():this.$shareButton.hide()}updateDownloadButton(){r.b.getBool(this.options.downloadEnabled,!0)?this.$downloadButton.show():this.$downloadButton.hide()}updateFeedbackButton(){r.b.getBool(this.options.feedbackEnabled,!1)?this.$feedbackButton.show():this.$feedbackButton.hide()}updateBookmarkButton(){r.b.getBool(this.options.bookmarkEnabled,!1)?this.$bookmarkButton.show():this.$bookmarkButton.hide()}resize(){super.resize()}},Q=class{constructor(t,e){this.message=t,this.actions=e}},J=(0,a.a)(),Z=class extends S{constructor(t){super(t,!1,!1)}create(){this.setConfig("headerPanel"),super.create(),this.extensionHost.subscribe(r.p.SHOW_INFORMATION,(t=>{this.showInformation(t)})),this.extensionHost.subscribe(r.p.HIDE_INFORMATION,(()=>{this.hideInformation()})),this.$options=J('<div class="options"></div>'),this.$element.append(this.$options),this.$centerOptions=J('<div class="centerOptions"></div>'),this.$options.append(this.$centerOptions),this.$rightOptions=J('<div class="rightOptions"></div>'),this.$options.append(this.$rightOptions),this.$localeToggleButton=J('<a class="localeToggle" tabindex="0"></a>'),this.$rightOptions.append(this.$localeToggleButton),this.$settingsButton=J(`\n          <button class="btn imageBtn settings" tabindex="0" title="${this.content.settings}">\n            <i class="uv-icon-settings" aria-hidden="true"></i>\n          </button>\n        `),this.$settingsButton.attr("title",this.content.settings),this.$rightOptions.append(this.$settingsButton),this.$informationBox=J('<div class="informationBox" aria-hidden="true">                                     <div class="message"></div>                                     <div class="actions"></div>                                     <button type="button" class="close" aria-label="Close">                                         <span aria-hidden="true">&#215;</span>                                    </button>                                   </div>'),this.$element.append(this.$informationBox),this.$informationBox.hide(),this.$informationBox.find(".close").attr("title",this.content.close),this.$informationBox.find(".close").on("click",(t=>{t.preventDefault(),this.extensionHost.publish(r.p.HIDE_INFORMATION)})),this.$localeToggleButton.on("click",(()=>{this.extension.changeLocale(String(this.$localeToggleButton.data("locale")))})),this.$settingsButton.onPressed((()=>{this.extensionHost.publish(r.p.SHOW_SETTINGS_DIALOGUE,this.$settingsButton)})),r.b.getBool(this.options.centerOptionsEnabled,!0)||this.$centerOptions.hide(),this.updateLocaleToggle(),this.updateSettingsButton()}updateLocaleToggle(){if(!this.localeToggleIsVisible())return void this.$localeToggleButton.hide();let t=this.extension.getAlternateLocale(),e=t.name.split("-")[0].toUpperCase();this.$localeToggleButton.data("locale",t.name),this.$localeToggleButton.attr("title",t.label),this.$localeToggleButton.text(e)}updateSettingsButton(){r.b.getBool(this.options.settingsButtonEnabled,!0)?this.$settingsButton.show():this.$settingsButton.hide()}localeToggleIsVisible(){let t=this.extension.data.locales;return!!t&&(t.length>1&&r.b.getBool(this.options.localeToggleEnabled,!1))}showInformation(t){let e=new class{constructor(t){this.extension=t}Get(t){switch(t.informationType){case n.AUTH_CORS_ERROR:return new Q(this.extension.data.config.content.authCORSError,[]);case n.DEGRADED_RESOURCE:let e=[],i=new class{constructor(){}},s=t.param.loginService.getConfirmLabel();s||(s=this.extension.data.config.content.fallbackDegradedLabel),i.label=s;let o=t.param;i.action=()=>{o.authHoldingPage=window.open("","_blank"),this.extension.extensionHost.publish(r.p.HIDE_INFORMATION),this.extension.extensionHost.publish(r.p.OPEN_EXTERNAL_RESOURCE,[[o]])},e.push(i);let a=t.param.loginService.getServiceLabel();return a||(a=this.extension.data.config.content.fallbackDegradedMessage),new Q(a,e)}}}(this.extension);this.information=e.Get(t),this.$informationBox.find(".message").html(this.information.message).find("a").attr("target","_top");var i=this.$informationBox.find(".actions");i.empty();for(let n=0;n<this.information.actions.length;n++){let t=this.information.actions[n],e=J('<a href="#" class="btn btn-default">'+t.label+"</a>");e.on("click",t.action),i.append(e)}this.$informationBox.attr("aria-hidden","false"),this.$informationBox.show(),this.$element.addClass("showInformation"),this.extension.resize()}hideInformation(){this.$element.removeClass("showInformation"),this.$informationBox.attr("aria-hidden","true"),this.$informationBox.hide(),this.extension.resize()}getSettings(){return this.extension.getSettings()}updateSettings(t){this.extension.updateSettings(t),this.extensionHost.publish(r.p.UPDATE_SETTINGS,t)}resize(){super.resize();let t=this.$element.width()/2-this.$centerOptions.outerWidth()/2;if(this.$centerOptions.css({left:t}),(0,a.d)(this.$informationBox)){let t=this.$informationBox.find(".actions"),e=this.$informationBox.find(".message");e.width(Math.floor(this.$element.width())-Math.ceil(e.horizontalMargins())-Math.ceil(t.outerWidth(!0))-Math.ceil(this.$informationBox.find(".close").outerWidth(!0))-2),this.information&&e.text(this.information.message)}this.extension.width()<this.extension.data.config.options.minWidthBreakPoint?this.localeToggleIsVisible()&&this.$localeToggleButton.hide():this.localeToggleIsVisible()&&this.$localeToggleButton.show()}},tt=(0,a.a)(),et=class extends S{constructor(t){super(t,!1,!0),this.isExpanded=!1,this.isFullyExpanded=!1,this.isUnopened=!0,this.autoToggled=!1,this.expandFullEnabled=!0,this.reducedAnimation=!1}create(){super.create(),this.$top=tt('<div class="top"></div>'),this.$element.append(this.$top),this.$title=tt('<h2 class="title"></h2>'),this.$top.append(this.$title),this.$expandFullButton=tt('<a class="expandFullButton" tabindex="0"></a>'),this.$top.append(this.$expandFullButton),r.b.getBool(this.config.options.expandFullEnabled,!0)||this.$expandFullButton.hide(),this.$collapseButton=tt('<div role="button" class="collapseButton" tabindex="0"></div>'),this.$collapseButton.prop("title",this.content.collapse),this.$top.append(this.$collapseButton),this.$closed=tt('<div class="closed"></div>'),this.$element.append(this.$closed),this.$expandButton=tt('<a role="button" class="expandButton" tabindex="0"></a>'),this.$expandButton.prop("title",this.content.expand),this.$closed.append(this.$expandButton),this.$closedTitle=tt('<a class="title"></a>'),this.$closed.append(this.$closedTitle),this.$main=tt('<div class="main"></div>'),this.$element.append(this.$main),this.onAccessibleClick(this.$expandButton,(()=>{this.toggle()})),this.$expandFullButton.on("click",(()=>{this.expandFull()})),this.$closedTitle.on("click",(()=>{this.toggle()})),this.$title.on("click",(()=>{this.isFullyExpanded?this.collapseFull():this.toggle()})),this.onAccessibleClick(this.$collapseButton,(()=>{this.isFullyExpanded?this.collapseFull():this.toggle()})),this.$top.hide(),this.$main.hide(),this.extensionHost.subscribe(r.p.SETTINGS_CHANGE,(t=>{this.reducedAnimation=t.reducedAnimation||!1}))}init(){super.init()}setTitle(t){this.$title.text(t),this.$closedTitle.text(t)}toggle(t){this.autoToggled=!!t,this.isExpanded&&(this.$top.attr("aria-hidden","true"),this.$main.attr("aria-hidden","true"),this.$closed.attr("aria-hidden","false"),this.$top.hide(),this.$main.hide(),this.$closed.show()),this.reducedAnimation?(this.$element.css("width",this.getTargetWidth()),this.$element.css("left",this.getTargetLeft()),this.toggled()):this.$element.stop().animate({width:this.getTargetWidth(),left:this.getTargetLeft()},this.options.panelAnimationDuration,(()=>{this.toggled()}))}toggled(){this.toggleStart(),this.isExpanded=!this.isExpanded,this.isExpanded&&(this.$top.attr("aria-hidden","false"),this.$main.attr("aria-hidden","false"),this.$closed.attr("aria-hidden","true"),this.$closed.hide(),this.$top.show(),this.$main.show()),this.toggleFinish(),this.isUnopened=!1}expandFull(){this.isExpanded||this.toggled();var t=this.getFullTargetWidth(),e=this.getFullTargetLeft();this.expandFullStart(),this.$element.stop().animate({width:t,left:e},this.options.panelAnimationDuration,(()=>{this.expandFullFinish()}))}collapseFull(){var t=this.getTargetWidth(),e=this.getTargetLeft();this.collapseFullStart(),this.$element.stop().animate({width:t,left:e},this.options.panelAnimationDuration,(()=>{this.collapseFullFinish()}))}getTargetWidth(){return 0}getTargetLeft(){return 0}getFullTargetWidth(){return 0}getFullTargetLeft(){return 0}toggleStart(){}toggleFinish(){this.isExpanded&&!this.autoToggled?this.focusCollapseButton():this.focusExpandButton()}expandFullStart(){}expandFullFinish(){this.isFullyExpanded=!0,this.$expandFullButton.hide(),this.focusCollapseButton()}collapseFullStart(){}collapseFullFinish(){this.isFullyExpanded=!1,this.expandFullEnabled&&this.$expandFullButton.show(),this.focusExpandFullButton()}focusExpandButton(){setTimeout((()=>{this.$expandButton.focus()}),1)}focusExpandFullButton(){setTimeout((()=>{this.$expandFullButton.focus()}),1)}focusCollapseButton(){setTimeout((()=>{this.$collapseButton.focus()}),1)}resize(){super.resize(),this.$main.height(this.$element.parent().height()-this.$top.outerHeight(!0))}},it=class extends et{constructor(t){super(t)}create(){super.create(),this.$element.width(this.options.panelCollapsedWidth)}init(){super.init(),r.b.getBool(this.extension.getSettings().rightPanelOpen,this.options.panelOpen)&&this.toggle(!0),this.extensionHost.subscribe(r.p.TOGGLE_EXPAND_RIGHT_PANEL,(()=>{this.isFullyExpanded?this.collapseFull():this.expandFull()}))}getTargetWidth(){return this.isExpanded?this.options.panelCollapsedWidth:this.options.panelExpandedWidth}getTargetLeft(){return this.isExpanded?this.$element.parent().width()-this.options.panelCollapsedWidth:this.$element.parent().width()-this.options.panelExpandedWidth}toggleFinish(){super.toggleFinish(),this.isExpanded?this.extensionHost.publish(r.p.OPEN_RIGHT_PANEL):this.extensionHost.publish(r.p.CLOSE_RIGHT_PANEL),this.extension.updateSettings({rightPanelOpen:this.isExpanded})}resize(){super.resize(),this.$element.css({left:Math.floor(this.$element.parent().width()-this.$element.outerWidth())})}},nt=(0,h.c)(u()),st=(0,a.a)(),ot=class extends it{constructor(t){super(t)}create(){this.setConfig("moreInfoRightPanel"),super.create(),this.extensionHost.subscribe(r.p.CANVAS_INDEX_CHANGE,(()=>{this.databind()})),this.extensionHost.subscribe(r.p.RANGE_CHANGE,(()=>{this.databind()})),this.setTitle(this.config.content.title),this.$metadata=st('<div class="iiif-metadata-component"></div>'),this.$main.append(this.$metadata),this.metadataComponent=new nt.MetadataComponent({target:this.$metadata[0],data:this._getData()}),this.metadataComponent.on("iiifViewerLinkClicked",(t=>{let e=r.o.getHashParameterFromString("rid",t);if(e){let t=this.extension.helper.getRangeById(e);t&&this.extensionHost.publish(r.p.RANGE_CHANGE,t)}}),!1)}toggleFinish(){super.toggleFinish(),this.databind()}databind(){this.metadataComponent.set(this._getData())}_getCurrentRange(){return this.extension.helper.getCurrentRange()}_getData(){let t=this.extension.getCurrentCanvases();return{canvasDisplayOrder:this.config.options.canvasDisplayOrder,canvases:t,canvasExclude:this.config.options.canvasExclude,canvasLabels:this.extension.getCanvasLabels(this.content.page),content:this.config.content,copiedMessageDuration:2e3,copyToClipboardEnabled:r.b.getBool(this.config.options.copyToClipboardEnabled,!1),helper:this.extension.helper,licenseFormatter:new o.g(this.config.license?this.config.license:{}),limit:this.config.options.textLimit||4,limitType:nt.LimitType.LINES,limitToRange:r.b.getBool(this.config.options.limitToRange,!1),manifestDisplayOrder:this.config.options.manifestDisplayOrder,manifestExclude:this.config.options.manifestExclude,range:this._getCurrentRange(),rtlLanguageCodes:this.config.options.rtlLanguageCodes,sanitizer:t=>(0,a.b)(t),showAllLanguages:this.config.options.showAllLanguages}}resize(){super.resize(),this.$main.height(this.$element.height()-this.$top.height()-this.$main.verticalMargins())}};(z=j||(j={}))[z.TOP_LEFT=0]="TOP_LEFT",z[z.TOP_CENTER=1]="TOP_CENTER",z[z.TOP_RIGHT=2]="TOP_RIGHT",z[z.CENTER_LEFT=3]="CENTER_LEFT",z[z.CENTER=4]="CENTER",z[z.CENTER_RIGHT=5]="CENTER_RIGHT",z[z.BOTTOM_LEFT=6]="BOTTOM_LEFT",z[z.BOTTOM_CENTER=7]="BOTTOM_CENTER",z[z.BOTTOM_RIGHT=8]="BOTTOM_RIGHT";var rt=(0,a.a)(),at=class extends S{constructor(t){super(t,!1,!0),this.subtitleExpanded=!1,this.isAttributionOpen=!1,this.attributionPosition=j.BOTTOM_LEFT,this.isAttributionLoaded=!1}create(){super.create(),this.$title=rt('<h1 class="title"></h1>'),this.$element.append(this.$title),this.$subtitle=rt('<div class="subtitle">\n                                <div class="wrapper">\n                                    <button type="button" class="expand-btn" aria-label="Expand">\n                                        <span aria-hidden="true">+</span>\n                                    </button>\n                                    <span class="text"></span>\n                                </div>\n                            </div>'),this.$element.append(this.$subtitle),this.$subtitleWrapper=this.$subtitle.find(".wrapper"),this.$subtitleExpand=this.$subtitle.find(".expand-btn"),this.$subtitleText=this.$subtitle.find(".text"),this.$content=rt('<div id="content" class="content"></div>'),this.$element.append(this.$content),this.$attribution=rt('\n                                <div class="attribution">\n                                  <div class="header">\n                                    <div class="title"></div>\n                                    <button type="button" class="close" aria-label="Close">\n                                      <span aria-hidden="true">&#215;</span>\n                                    </button>\n                                  </div>\n                                  <div class="main">\n                                    <div class="attribution-text"></div>\n                                    <div class="license"></div>\n                                    <div class="logo"></div>\n                                  </div>\n                                </div>\n        '),this.$attribution.find(".header .title").text(this.content.attribution),this.$content.append(this.$attribution),this.closeAttribution(),this.$closeAttributionButton=this.$attribution.find(".header .close"),this.$closeAttributionButton.on("click",(t=>{t.preventDefault(),this.closeAttribution()})),this.$subtitleExpand.on("click",(t=>{t.preventDefault(),this.subtitleExpanded=!this.subtitleExpanded,this.subtitleExpanded?(this.$subtitleWrapper.addClass("expanded"),this.$subtitleExpand.text("-")):(this.$subtitleWrapper.removeClass("expanded"),this.$subtitleExpand.text("+")),this.resize()})),r.b.getBool(this.options.titleEnabled,!0)?this.$title.show():this.$title.hide(),r.b.getBool(this.options.subtitleEnabled,!1)?this.$subtitle.show():this.$subtitle.hide(),this.whenResized((()=>{this.updateRequiredStatement()})),this.extensionHost.subscribe(r.p.RANGE_CHANGE,(()=>{this.updateRequiredStatement()})),this.extensionHost.subscribe(r.p.CANVAS_INDEX_CHANGE,(()=>{this.updateRequiredStatement()})),this.extensionHost.subscribe(r.p.MANIFEST_INDEX_CHANGE,(()=>{this.updateRequiredStatement()}))}openAttribution(){this.$attribution.show(),this.isAttributionOpen=!0}closeAttribution(){this.$attribution.hide(),this.isAttributionOpen=!1}updateRequiredStatement(){if(this.isAttributionLoaded)return;let t=r.b.getBool(this.config.options.mostSpecificRequiredStatement,!1),e=t?this.extension.helper.getMostSpecificRequiredStatement():this.extension.helper.getRequiredStatement(),i=r.b.getBool(this.options.requiredStatementEnabled,!0);if(!e||!e.value||!i)return;this.openAttribution();let n=this.$attribution.find(".title"),s=this.$attribution.find(".attribution-text"),o=this.$attribution.find(".license"),l=this.$attribution.find(".logo");if(e.label){let t=(0,a.b)(e.label);n.html(t)}else n.text(this.content.attribution);if(e.value){let t=(0,a.b)(e.value);s.html(t),s.find("img").one("load",(()=>{this.resize()})).each((function(){this.complete&&rt(this).load()})),s.targetBlank()}o.hide(),l.hide(),this.resize(),t||(this.isAttributionLoaded=!0)}resize(){super.resize();let t,e,i=(0,a.d)(this.extension.shell.$leftPanel)?Math.floor(this.extension.shell.$leftPanel.width()):0,n=(0,a.d)(this.extension.shell.$rightPanel)?Math.floor(this.extension.shell.$rightPanel.width()):0,s=Math.floor(this.$element.parent().width()-i-n);if(this.$element.css({left:i,width:s}),t=this.options&&!1===this.options.titleEnabled||!(0,a.d)(this.$title)?0:this.$title.outerHeight(!0),e=this.options&&!1===this.options.subtitleEnabled||!(0,a.d)(this.$subtitle)?0:this.$subtitle.outerHeight(!0),this.$content.height(this.$element.height()-t-e),this.$content.width(this.$element.width()),this.$attribution&&this.isAttributionOpen){switch(this.attributionPosition){case j.BOTTOM_LEFT:this.$attribution.css("top",this.$content.height()-this.$attribution.outerHeight()-this.$attribution.verticalMargins()),this.$attribution.css("left",0);break;case j.BOTTOM_RIGHT:this.$attribution.css("top",this.$content.height()-this.$attribution.outerHeight()-this.$attribution.verticalMargins()),this.$attribution.css("left",this.$content.width()-this.$attribution.outerWidth()-this.$attribution.horizontalMargins())}this.$content.width()<=this.$attribution.width()?this.$attribution.hide():this.$attribution.show()}this.subtitle&&this.options.subtitleEnabled?(this.$subtitleText.html((0,a.b)(this.subtitle.replace(/<br\s*[\/]?>/gi,"; "))),this.$subtitleText.removeClass("elided"),this.$subtitle.show(),this.$subtitleWrapper.css("max-height",this.$content.height()+this.$subtitle.outerHeight()),this.$subtitleWrapper.width(this.$content.width()),this.subtitleExpanded?this.$subtitleText.width(this.$content.width()-this.$subtitleText.horizontalMargins()-2):(this.$subtitleText.width("auto"),this.$subtitleWrapper.width("auto"),this.$subtitleExpand.hide(),this.$subtitleText.width()>this.$content.width()&&(this.$subtitleExpand.show(),this.$subtitleText.addClass("elided"),this.$subtitleText.width(this.$content.width()-(this.$subtitleExpand.outerWidth()+this.$subtitleText.horizontalMargins()))))):this.$subtitle.hide()}},lt=class extends et{constructor(t){super(t)}create(){super.create(),this.$element.width(this.options.panelCollapsedWidth),this.extensionHost.subscribe(r.p.TOGGLE_EXPAND_LEFT_PANEL,(()=>{this.isFullyExpanded?this.collapseFull():this.expandFull()}))}init(){super.init(),r.b.getBool(this.extension.getSettings().leftPanelOpen,this.options.panelOpen)&&this.toggle(!0)}getTargetWidth(){return this.isFullyExpanded||!this.isExpanded?this.options.panelExpandedWidth:this.options.panelCollapsedWidth}getFullTargetWidth(){return this.$element.parent().width()}toggleFinish(){super.toggleFinish(),this.isExpanded?this.extensionHost.publish(r.p.OPEN_LEFT_PANEL):this.extensionHost.publish(r.p.CLOSE_LEFT_PANEL),this.extension.updateSettings({leftPanelOpen:this.isExpanded})}resize(){super.resize(),this.isFullyExpanded&&this.$element.width(this.$element.parent().width())}},ht=(0,a.a)(),ct=class extends L{constructor(t){super(t)}create(){let t;this.setConfig("settingsDialogue"),super.create(),this.openCommand=r.p.SHOW_SETTINGS_DIALOGUE,this.closeCommand=r.p.HIDE_SETTINGS_DIALOGUE,this.extensionHost.subscribe(this.openCommand,(e=>{t=e,this.open()})),this.extensionHost.subscribe(this.closeCommand,(()=>{t&&t.focus(),this.close()})),this.$title=ht('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$scroll=ht('<div class="scroll"></div>'),this.$content.append(this.$scroll),this.$version=ht('<div class="version"></div>'),this.$content.append(this.$version),this.$website=ht('<div class="website"></div>'),this.$content.append(this.$website),this.$locale=ht('<div class="setting locale"></div>'),this.$scroll.append(this.$locale),this.$localeLabel=ht('<label for="locale">'+this.content.locale+"</label>"),this.$locale.append(this.$localeLabel),this.$localeDropDown=ht('<select id="locale"></select>'),this.$locale.append(this.$localeDropDown),this.$title.text(this.content.title),this.$website.html(this.content.website),this.$website.targetBlank(),this._createLocalesMenu(),this._createAccessibilityMenu(),this.$element.hide()}getSettings(){return this.extension.getSettings()}updateSettings(t){this.extension.updateSettings(t),this.extensionHost.publish(r.p.UPDATE_SETTINGS,t)}open(){super.open(),this.$version.text("v"+c.env.PACKAGE_VERSION)}_createLocalesMenu(){let t=this.extension.data.locales;if(t&&t.length>1){for(let e=0;e<t.length;e++){let i=t[e];this.$localeDropDown.append('<option value="'+i.name+'">'+i.label+"</option>")}this.$localeDropDown.val(t[0].name)}else this.$locale.hide();this.$localeDropDown.change((()=>{this.extension.changeLocale(this.$localeDropDown.val())}))}resize(){super.resize()}_createAccessibilityMenu(){this.$reducedAnimation=ht('<div class="setting reducedAnimation"></div>'),this.$scroll.append(this.$reducedAnimation),this.$reducedAnimationCheckbox=ht('<input id="reducedAnimation" type="checkbox" tabindex="0" />'),this.$reducedAnimation.append(this.$reducedAnimationCheckbox),this.$reducedAnimationLabel=ht('<label for="reducedAnimation">'+this.content.reducedMotion+"</label>"),this.$reducedAnimation.append(this.$reducedAnimationLabel),this.$reducedAnimationCheckbox.change((()=>{let t={};this.$reducedAnimationCheckbox.is(":checked")?t.reducedAnimation=!0:t.reducedAnimation=!1,this.updateSettings(t)}))}},ut=(0,a.a)(),pt=class extends L{constructor(t){super(t),this.aspectRatio=.75,this.isEmbedViewVisible=!1,this.isShareViewVisible=!1,this.maxWidth=8e3,this.maxHeight=this.maxWidth*this.aspectRatio,this.minWidth=200,this.minHeight=this.minWidth*this.aspectRatio,this.shareManifestsEnabled=!1}create(){let t;this.setConfig("shareDialogue"),super.create(),this.openCommand=r.p.SHOW_SHARE_DIALOGUE,this.closeCommand=r.p.HIDE_SHARE_DIALOGUE,this.shareManifestsEnabled=this.options.shareManifestsEnabled||!1,this.extensionHost.subscribe(this.openCommand,(e=>{t=e,this.open(e),this.isShareAvailable()?this.openShareView():this.openEmbedView()})),this.extensionHost.subscribe(this.closeCommand,(()=>{t&&t.focus(),this.close()})),this.extensionHost.subscribe(r.p.SHOW_EMBED_DIALOGUE,(t=>{this.open(t),this.openEmbedView()})),this.$tabs=ut('<div class="tabs"></div>'),this.$content.append(this.$tabs),this.$shareButton=ut('<a class="share tab default" tabindex="0">'+this.content.share+"</a>"),this.$tabs.append(this.$shareButton),this.$embedButton=ut('<a class="embed tab" tabindex="0">'+this.content.embed+"</a>"),this.$tabs.append(this.$embedButton),this.$tabsContent=ut('<div class="tabsContent"></div>'),this.$content.append(this.$tabsContent),this.$footer=ut('<div class="footer"></div>'),this.$content.append(this.$footer),this.$shareView=ut('<div class="shareView view"></div>'),this.$tabsContent.append(this.$shareView),this.$shareHeader=ut('<div class="header"></div>'),this.$shareView.append(this.$shareHeader),this.$shareLink=ut('<a class="shareLink" onclick="return false;"></a>'),this.$shareView.append(this.$shareLink),this.$shareInput=ut(`<input class="shareInput" type="text" readonly="readonly" aria-label="${this.content.shareUrl}"/>`),this.$shareView.append(this.$shareInput),this.$shareFrame=ut('<iframe class="shareFrame"></iframe>'),this.$shareView.append(this.$shareFrame),this.$embedView=ut('<div class="embedView view"></div>'),this.$tabsContent.append(this.$embedView),this.$embedHeader=ut('<div class="header"></div>'),this.$embedView.append(this.$embedHeader),this.$code=ut(`<input class="code" type="text" readonly="readonly" aria-label="${this.content.embed}"/>`),this.$embedView.append(this.$code),this.$customSize=ut('<div class="customSize"></div>'),this.$embedView.append(this.$customSize),this.$size=ut('<span class="size">'+this.content.size+"</span>"),this.$customSize.append(this.$size),this.$customSizeDropDown=ut('<select id="size" aria-label="'+this.content.size+'"></select>'),this.$customSize.append(this.$customSizeDropDown),this.$customSizeDropDown.append('<option value="small" data-width="560" data-height="420">560 x 420</option>'),this.$customSizeDropDown.append('<option value="medium" data-width="640" data-height="480">640 x 480</option>'),this.$customSizeDropDown.append('<option value="large" data-width="800" data-height="600">800 x 600</option>'),this.$customSizeDropDown.append('<option value="custom">'+this.content.customSize+"</option>"),this.$widthInput=ut('<input class="width" type="text" maxlength="10" aria-label="'+this.content.width+'"/>'),this.$customSize.append(this.$widthInput),this.$x=ut('<span class="x">x</span>'),this.$customSize.append(this.$x),this.$heightInput=ut('<input class="height" type="text" maxlength="10" aria-label="'+this.content.height+'"/>'),this.$customSize.append(this.$heightInput);let e=this.extension.getIIIFShareUrl(this.shareManifestsEnabled);this.shareManifestsEnabled&&(this.$iiifButton=ut('<a class="imageBtn iiif" href="'+e+'" title="'+this.content.iiif+'" target="_blank"></a>'),this.$footer.append(this.$iiifButton)),this.$termsOfUseButton=ut('<a href="#">'+this.extension.data.config.content.termsOfUse+"</a>"),this.$footer.append(this.$termsOfUseButton),this.$widthInput.on("keydown",(t=>r.j.numericalInput(t))),this.$heightInput.on("keydown",(t=>r.j.numericalInput(t))),this.$shareInput.focus((function(){ut(this).select()})),this.$code.focus((function(){ut(this).select()})),this.onAccessibleClick(this.$shareButton,(()=>{this.openShareView()})),this.onAccessibleClick(this.$embedButton,(()=>{this.openEmbedView()})),this.$customSizeDropDown.change((()=>{this.update()})),this.$widthInput.change((()=>{this.updateHeightRatio(),this.update()})),this.$heightInput.change((()=>{this.updateWidthRatio(),this.update()})),this.onAccessibleClick(this.$termsOfUseButton,(()=>{this.extensionHost.publish(r.p.SHOW_TERMS_OF_USE)})),this.$element.hide(),this.update()}open(t){super.open(t),this.update()}getShareUrl(){return this.extension.getShareUrl()}isShareAvailable(){return!!this.getShareUrl()}update(){this.isShareAvailable()?this.$shareButton.show():this.$shareButton.hide();let t=this.getSelectedSize();"custom"===t.val()?(this.$widthInput.show(),this.$x.show(),this.$heightInput.show()):(this.$widthInput.hide(),this.$x.hide(),this.$heightInput.hide(),this.currentWidth=Number(t.data("width")),this.currentHeight=Number(t.data("height")),this.$widthInput.val(String(this.currentWidth)),this.$heightInput.val(String(this.currentHeight))),this.updateInstructions(),this.updateShareOptions(),this.updateShareFrame(),this.updateTermsOfUseButton()}updateShareOptions(){let t=this.getShareUrl();t&&(this.$shareInput.val(t),this.$shareLink.prop("href",t),this.$shareLink.text(t)),this.extension.isMobile()?(this.$shareInput.hide(),this.$shareLink.show()):(this.$shareInput.show(),this.$shareLink.hide())}updateInstructions(){r.b.getBool(this.options.instructionsEnabled,!1)?(this.$shareHeader.show(),this.$embedHeader.show(),this.$shareHeader.text(this.content.shareInstructions),this.$embedHeader.text(this.content.embedInstructions)):(this.$shareHeader.hide(),this.$embedHeader.hide())}getSelectedSize(){return this.$customSizeDropDown.find(":selected")}updateWidthRatio(){this.currentHeight=Number(this.$heightInput.val()),this.currentHeight<this.minHeight?(this.currentHeight=this.minHeight,this.$heightInput.val(String(this.currentHeight))):this.currentHeight>this.maxHeight&&(this.currentHeight=this.maxHeight,this.$heightInput.val(String(this.currentHeight))),this.currentWidth=Math.floor(this.currentHeight/this.aspectRatio),this.$widthInput.val(String(this.currentWidth))}updateHeightRatio(){this.currentWidth=Number(this.$widthInput.val()),this.currentWidth<this.minWidth?(this.currentWidth=this.minWidth,this.$widthInput.val(String(this.currentWidth))):this.currentWidth>this.maxWidth&&(this.currentWidth=this.maxWidth,this.$widthInput.val(String(this.currentWidth))),this.currentHeight=Math.floor(this.currentWidth*this.aspectRatio),this.$heightInput.val(String(this.currentHeight))}updateShareFrame(){let t=this.extension.helper.getShareServiceUrl();!t||(r.b.getBool(this.config.options.shareFrameEnabled,!0)&&t?(this.$shareFrame.prop("src",t),this.$shareFrame.show()):this.$shareFrame.hide())}updateTermsOfUseButton(){let t=this.extension.helper.getRequiredStatement();r.b.getBool(this.extension.data.config.options.termsOfUseEnabled,!1)&&t&&t.value?this.$termsOfUseButton.show():this.$termsOfUseButton.hide()}openShareView(){this.isShareViewVisible=!0,this.isEmbedViewVisible=!1,this.$embedView.hide(),this.$shareView.show(),this.$shareButton.addClass("on default"),this.$embedButton.removeClass("on default"),this.resize()}openEmbedView(){this.isShareViewVisible=!1,this.isEmbedViewVisible=!0,this.$embedView.show(),this.$shareView.hide(),this.$shareButton.removeClass("on default"),this.$embedButton.addClass("on default"),this.resize()}close(){super.close()}getViews(){return this.$tabsContent.find(".view")}equaliseViewHeights(){this.getViews().equaliseHeight(!0)}resize(){this.equaliseViewHeights(),this.setDockedPosition()}}}}]);