"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5615],{60181:function(e,t,i){i.d(t,{a:function(){return n},b:function(){return p}});var n,r,o=i(48386),s=i(47903),a=i(78853),l=i(58262),u=i(75285);(r=n||(n={})).CANVAS_RENDERINGS="canvasRenderings",r.CURRENT_VIEW="currentView",r.ENTIRE_DOCUMENT_AS_PDF="entireDocumentAsPdf",r.ENTIRE_DOCUMENT_AS_TEXT="entireDocumentAsText",r.ENTIRE_FILE_AS_ORIGINAL="entireFileAsOriginal",r.IMAGE_RENDERINGS="imageRenderings",r.MANIFEST_RENDERINGS="manifestRenderings",r.RANGE_RENDERINGS="rangeRenderings",r.SELECTION="selection",r.UNKNOWN="unknown",r.WHOLE_IMAGE_HIGH_RES="wholeImageHighRes",r.WHOLE_IMAGE_LOW_RES="wholeImageLowRes",r.WHOLE_IMAGES_HIGH_RES="wholeImagesHighRes";var h=(0,u.c)((0,s.c)()),c=(0,l.a)(),p=class extends o.d{constructor(e){super(e)}create(){let e;this.setConfig("downloadDialogue"),super.create(),this.$element.attr("role","region"),this.$element.attr("aria-label",this.content.title),this.openCommand=a.p.SHOW_DOWNLOAD_DIALOGUE,this.closeCommand=a.p.HIDE_DOWNLOAD_DIALOGUE,this.extensionHost.subscribe(this.openCommand,(t=>{e=t,this.open(t)})),this.extensionHost.subscribe(this.closeCommand,(()=>{e&&e.focus(),this.close()})),this.$title=c(`<div role="heading" class="heading">${this.content.title}</div>`),this.$content.append(this.$title),this.$noneAvailable=c('<div class="noneAvailable">'+this.content.noneAvailable+"</div>"),this.$content.append(this.$noneAvailable),this.$downloadOptions=c('<ol class="options"></ol>'),this.$content.append(this.$downloadOptions),this.$footer=c('<div class="footer"></div>'),this.$content.append(this.$footer),this.$termsOfUseButton=c('<a href="#">'+this.extension.data.config.content.termsOfUse+"</a>"),this.$footer.append(this.$termsOfUseButton),this.$termsOfUseButton.onPressed((()=>{this.extensionHost.publish(a.p.SHOW_TERMS_OF_USE)})),this.$element.hide(),this.updateTermsOfUseButton()}addEntireFileDownloadOptions(){if(this.isDownloadOptionAvailable(n.ENTIRE_FILE_AS_ORIGINAL)){this.$downloadOptions.empty();let e=this.extension.helper.getCurrentCanvas(),t=!1,i=e.getRenderings();for(let n=0;n<i.length;n++){let e=i[n],r=e.getFormat(),o="";r&&(o=r.toString()),this.addEntireFileDownloadOption(e.id,h.LanguageMap.getValue(e.getLabel()),o),t=!0}if(!t){let t=!1,i=e.getContent();for(let e=0;e<i.length;e++){let n=i[e].getBody();if(n.length){let e=n[0].getFormat();e&&(this.addEntireFileDownloadOption(n[0].id,"",e.toString()),t=!0)}}t||this.addEntireFileDownloadOption(e.id,"","")}}}addEntireFileDownloadOption(e,t,i){let n;n=i?a.e.simplifyMimeType(i):this.getFileExtension(e),t||(t=this.content.entireFileAsOriginal),n&&(t+=" ("+n+")"),this.$downloadOptions.append('<li><a href="'+e+'" target="_blank" download tabindex="0">'+t+"</li>")}resetDynamicDownloadOptions(){this.renderingUrls=[],this.renderingUrlsCount=0,this.$downloadOptions.find("li.dynamic").remove()}getDownloadOptionsForRenderings(e,t,i){let n=e.getRenderings(),r=[];for(let o=0;o<n.length;o++){let e=n[o];if(e){let n=h.LanguageMap.getValue(e.getLabel(),this.extension.getLocale()),o="downloadOption"+ ++this.renderingUrlsCount;n?n+=" ({0})":n=t;let s=a.e.simplifyMimeType(e.getFormat().toString());n=a.n.format(n,s),this.renderingUrls[o]=e.id;let l=c('<li class="option dynamic"><input id="'+o+'" data-mime="'+s+'" title="'+n+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+o+'">'+n+"</label></li>");r.push({type:i,button:l})}}return r}getSelectedOption(){return this.$downloadOptions.find("li.option input:checked")}getCurrentResourceId(){return this.extension.helper.getCurrentCanvas().externalResource.data.id}getCurrentResourceFormat(){let e=this.getCurrentResourceId();return e.substr(e.lastIndexOf(".")+1).toLowerCase()}updateNoneAvailable(){this.$downloadOptions.find("li:visible").length?this.$noneAvailable.hide():this.$noneAvailable.show()}updateTermsOfUseButton(){let e=this.extension.helper.getRequiredStatement();a.b.getBool(this.extension.data.config.options.termsOfUseEnabled,!1)&&e&&e.value?this.$termsOfUseButton.show():this.$termsOfUseButton.hide()}getFileExtension(e){let t=e.split(".").pop();return t.length>5||-1!==t.indexOf("/")?null:t}isMediaDownloadEnabled(){return this.extension.helper.isUIEnabled("mediaDownload")}isDownloadOptionAvailable(e){return e!==n.ENTIRE_FILE_AS_ORIGINAL||this.isMediaDownloadEnabled()}close(){super.close()}resize(){this.setDockedPosition()}}},80741:function(e,t,i){i.d(t,{a:function(){return u}});var n=i(48386),r=i(47903),o=i(78853),s=i(58262),a=(0,i(75285).c)((0,r.a)()),l=(0,s.a)(),u=class extends n.a{constructor(e){super(e,!0,!0),this.isCreated=!1,this.isOpen=!1}create(){super.create(),this.extensionHost.subscribe(o.p.CANVAS_INDEX_CHANGE,(e=>{this.selectIndex(parseInt(e))})),this.extensionHost.subscribe(o.p.LOGIN,(()=>{this.loadThumbs()})),this.extensionHost.subscribe(o.p.CLICKTHROUGH,(()=>{this.loadThumbs()})),this.$thumbs=l('<div class="thumbs"></div>'),this.$element.append(this.$thumbs);let e=this.extension.helper.getViewingDirection()||a.ViewingDirection.LEFT_TO_RIGHT;this.$thumbs.addClass(e);let t=this;l.templates({thumbsTemplate:'<a id="thumb{{>index}}" class="{{:~className()}}" data-src="{{>uri}}" data-visible="{{>visible}}" data-index="{{>index}}" tabindex="0">                                <div class="wrap" style="height:{{>height + ~extraHeight()}}px"></div>                                <div class="info">                                    <span class="index">{{:#index + 1}}</span>                                    <span class="label" title="{{>label}}">{{>label}}&nbsp;</span>                                    <span class="searchResults" title="{{:~searchResultsTitle()}}">{{>data.searchResults}}</span>                                </div>                             </a>                             {{if ~separator()}}                                  <div class="separator"></div>                              {{/if}}'});let i=this.options.thumbsExtraHeight;l.views.helpers({separator:function(){return!1},extraHeight:function(){return i},className:function(){let e="thumb";0===this.data.index&&(e+=" first"),this.data.uri||(e+=" placeholder");let i=t.extension.helper.getViewingDirection();return i&&(i===a.ViewingDirection.LEFT_TO_RIGHT||i===a.ViewingDirection.RIGHT_TO_LEFT)||t.extension.helper.isPaged()?e+=" twoCol":e+=" oneCol",e},searchResultsTitle:function(){let e=Number(this.data.data.searchResults);return e?e>1?o.n.format(t.content.searchResults,e.toString()):o.n.format(t.content.searchResult,e.toString()):""}}),this.$element.on("scroll",(()=>{this.scrollStop()}),100),this.resize()}databind(){!this.thumbs||(this._$thumbsCache=null,this.createThumbs(),this.loadThumbs(0),this.selectIndex(this.extension.helper.canvasIndex))}createThumbs(){let e=this;if(!this.thumbs)return;let t=[];for(let n=0;n<this.thumbs.length;n++){let e=this.thumbs[n];t.push(e.height)}let i=o.g.median(t);for(let n=0;n<this.thumbs.length;n++){this.thumbs[n].height=i}this.$thumbs.link(l.templates.thumbsTemplate,this.thumbs),this.$thumbs.undelegate(".thumb","click"),this.$thumbs.delegate(".thumb","click",(function(t){t.preventDefault();let i=l.view(this).data;return e.lastThumbClickedIndex=i.index,e.extensionHost.publish(o.p.THUMB_SELECTED,i),!1})),this.$thumbs.delegate(".thumb","keydown",(function(t){let i=t.originalEvent,r=o.f.getCharCode(i);if(r===n.e.Spacebar||r===n.e.Enter){t.preventDefault();let i=l.view(this).data;e.lastThumbClickedIndex=i.index,e.extensionHost.publish(o.p.THUMB_SELECTED,i)}})),this.setLabel(),this.isCreated=!0}scrollStop(){let e=1/((this.$thumbs.height()-this.$element.height())/this.$element.scrollTop());e>1&&(e=1);let t=Math.floor((this.thumbs.length-1)*e);this.loadThumbs(t)}loadThumbs(e=this.extension.helper.canvasIndex){if(!this.thumbs||!this.thumbs.length)return;let t,i=this.extension.helper.getCanvasByIndex(e).getContent();if(i.length){let e=i[0].getBody();if(e.length){let i=e[0].getType();i&&(t=i.toString().toLowerCase())}}let n=e,r=this.options.thumbsLoadRange,s={start:n>r?n-r:0,end:n<this.thumbs.length-1-r?n+r:this.thumbs.length-1},a=this.options.thumbsImageFadeInDuration,u=this;for(let h=s.start;h<=s.end;h++){let e=this.getThumbByIndex(h),i=e.find(".wrap");if(!i.hasClass("loading")&&!i.hasClass("loaded"))if("false"!==e.attr("data-visible")){i.removeClass("loadingFailed"),i.addClass("loading"),t&&i.addClass(t);let n=e.attr("data-src");u.config.options.thumbsCacheInvalidation&&u.config.options.thumbsCacheInvalidation.enabled&&(n+=`${u.config.options.thumbsCacheInvalidation.paramType}t=${o.c.getTimeStamp()}`);let r=l('<img src="'+n+'" alt=""/>');r.hide(),r.on("load",(function(){l(this).fadeIn(a,(function(){l(this).parent().switchClass("loading","loaded")}))})),r.on("error",(function(){l(this).parent().switchClass("loading","loadingFailed")})),i.append(r)}else i.hide()}}show(){this.isOpen=!0,this.$element.show(),setTimeout((()=>{this.selectIndex(this.extension.helper.canvasIndex)}),1)}hide(){this.isOpen=!1,this.$element.hide()}isPDF(){let e=this.extension.helper.getCurrentCanvas().getType();return!!e&&e.toString().includes("pdf")}setLabel(){l(this.$thumbs).find("span.index").hide(),l(this.$thumbs).find("span.label").show()}addSelectedClassToThumbs(e){this.getThumbByIndex(e).addClass("selected")}selectIndex(e){-1!==e&&this.thumbs&&this.thumbs.length&&(this.getAllThumbs().removeClass("selected"),this.$selectedThumb=this.getThumbByIndex(e),this.addSelectedClassToThumbs(e),~this.extension.getPagedIndices(e).indexOf(this.lastThumbClickedIndex)||this.$element.scrollTop(this.$selectedThumb.position().top),this.loadThumbs(e))}getAllThumbs(){return this._$thumbsCache||(this._$thumbsCache=this.$thumbs.find(".thumb")),this._$thumbsCache}getThumbByIndex(e){return this.$thumbs.find('[data-index="'+e+'"]')}scrollToThumb(e){let t=this.getThumbByIndex(e);this.$element.scrollTop(t.position().top)}resize(){super.resize()}}},41228:function(e,t,i){i.d(t,{a:function(){return A},b:function(){return c},c:function(){return O},d:function(){return H}});var n=i(80741),r=i(48386),o=i(47903),s=i(78853),a=i(58262),l=i(75285),u=(0,l.b)(((e,t)=>{var n,r;n="undefined"!=typeof self?self:e,r=function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)}([function(e,t,i){e.exports=function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=4)}([function(e,t,i){function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i(6)),n(i(7)),n(i(8)),n(i(9)),n(i(10)),n(i(11)),n(i(12)),n(i(13)),n(i(14)),n(i(15)),n(i(16)),n(i(17)),n(i(18)),n(i(19)),n(i(20)),n(i(21)),n(i(22)),n(i(23)),n(i(24)),n(i(25)),n(i(26)),n(i(27)),n(i(28)),n(i(29)),n(i(30)),n(i(31)),n(i(32)),n(i(2))},function(e,t,i){var n;Object.defineProperty(t,"__esModule",{value:!0}),(n=t.AnnotationMotivation||(t.AnnotationMotivation={})).BOOKMARKING="oa:bookmarking",n.CLASSIFYING="oa:classifying",n.COMMENTING="oa:commenting",n.DESCRIBING="oa:describing",n.EDITING="oa:editing",n.HIGHLIGHTING="oa:highlighting",n.IDENTIFYING="oa:identifying",n.LINKING="oa:linking",n.MODERATING="oa:moderating",n.PAINTING="sc:painting",n.QUESTIONING="oa:questioning",n.REPLYING="oa:replying",n.TAGGING="oa:tagging",n.TRANSCRIBING="oad:transcribing",function(e){e.AUTO_ADVANCE="auto-advance",e.CONTINUOUS="continuous",e.FACING_PAGES="facing-pages",e.HIDDEN="hidden",e.INDIVIDUALS="individuals",e.MULTI_PART="multi-part",e.NO_NAV="no-nav",e.NON_PAGED="non-paged",e.PAGED="paged",e.REPEAT="repeat",e.SEQUENCE="sequence",e.THUMBNAIL_NAV="thumbnail-nav",e.TOGETHER="together",e.UNORDERED="unordered"}(t.Behavior||(t.Behavior={})),function(e){e.CANVAS="canvas",e.CHOICE="choice",e.CONTENT_AS_TEXT="contentastext",e.DOCUMENT="document",e.IMAGE="image",e.MOVING_IMAGE="movingimage",e.PDF="pdf",e.PHYSICAL_OBJECT="physicalobject",e.SOUND="sound",e.TEXTUALBODY="textualbody",e.VIDEO="video"}(t.ExternalResourceType||(t.ExternalResourceType={})),function(e){e.ANNOTATION="annotation",e.CANVAS="canvas",e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range",e.SEQUENCE="sequence"}(t.IIIFResourceType||(t.IIIFResourceType={})),function(e){e.AUDIO_MP4="audio/mp4",e.CORTO="application/corto",e.DRACO="application/draco",e.GLTF="model/gltf+json",e.JPG="image/jpeg",e.M3U8="application/vnd.apple.mpegurl",e.MP3="audio/mp3",e.MPEG_DASH="application/dash+xml",e.OBJ="text/plain",e.PDF="application/pdf",e.PLY="application/ply",e.THREEJS="application/vnd.threejs+json",e.VIDEO_MP4="video/mp4",e.WEBM="video/webm"}(t.MediaType||(t.MediaType={})),function(e){e.DOC="application/msword",e.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.PDF="application/pdf"}(t.RenderingFormat||(t.RenderingFormat={})),function(e){e.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",e.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",e.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",e.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",e.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",e.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",e.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",e.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",e.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",e.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",e.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",e.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",e.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",e.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",e.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",e.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",e.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",e.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",e.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",e.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",e.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",e.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",e.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",e.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",e.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",e.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",e.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",e.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",e.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",e.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",e.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",e.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",e.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",e.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",e.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",e.SEARCH_0="http://iiif.io/api/search/0/search",e.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",e.SEARCH_1="http://iiif.io/api/search/1/search",e.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",e.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",e.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",e.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",e.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",e.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",e.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(t.ServiceProfile||(t.ServiceProfile={})),function(e){e.BOTTOM_TO_TOP="bottom-to-top",e.LEFT_TO_RIGHT="left-to-right",e.RIGHT_TO_LEFT="right-to-left",e.TOP_TO_BOTTOM="top-to-bottom"}(t.ViewingDirection||(t.ViewingDirection={})),function(e){e.CONTINUOUS="continuous",e.INDIVIDUALS="individuals",e.NON_PAGED="non-paged",e.PAGED="paged",e.TOP="top"}(t.ViewingHint||(t.ViewingHint={}))},function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,o){function s(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(a){o=[6,a],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=i(1),a=i(33);i(34);var l=function(){function e(){}return e.getMediaType=function(e){return(e=(e=e.toLowerCase()).split(";")[0]).trim()},e.getImageQuality=function(e){return e===s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_LEVEL_1||e===s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_LEVEL_2||e===s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},e.getInexactLocale=function(e){return-1!==e.indexOf("-")?e.substr(0,e.indexOf("-")):e},e.getLocalisedValue=function(e,t){if(!Array.isArray(e))return e;for(var i=0;i<e.length;i++){var n=e[i];if(t===n["@language"])return n["@value"]}var r=t.substr(0,t.indexOf("-"));for(i=0;i<e.length;i++){var o=e[i];if(o["@language"]===r)return o["@value"]}return null},e.generateTreeNodeIds=function(t,i){var n;void 0===i&&(i=0),n=t.parentNode?t.parentNode.id+"-"+i:"0",t.id=n;for(var r=0;r<t.nodes.length;r++){var o=t.nodes[r];e.generateTreeNodeIds(o,r)}},e.normaliseType=function(e){return-1!==(e=e.toLowerCase()).indexOf(":")?e.split(":")[1]:e},e.normaliseUrl=function(e){return-1!==(e=e.substr(e.indexOf("://"))).indexOf("#")&&(e=e.split("#")[0]),e},e.normalisedUrlsMatch=function(t,i){return e.normaliseUrl(t)===e.normaliseUrl(i)},e.isImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.isLevel0ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},e.isLevel1ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},e.isLevel2ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.parseManifest=function(e,t){return o.Deserialiser.parse(e,t)},e.checkStatus=function(e){if(e.ok)return e;var t=new Error(e.statusText);return t.response=e,Promise.reject(t)},e.loadManifest=function(t){return new Promise((function(i){fetch(t).then(e.checkStatus).then((function(e){return e.json()})).then((function(e){i(e)}))}))},e.loadExternalResourcesAuth1=function(t,i,n,r,o,s,a,l){return new Promise((function(u,h){var c=t.map((function(t){return e.loadExternalResourceAuth1(t,i,n,r,o,s,a,l)}));Promise.all(c).then((function(){u(t)})).catch((function(e){h(e)}))}))},e.loadExternalResourceAuth1=function(t,i,o,s,l,u,h,c){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,s(t)];case 1:return(n=r.sent())?[4,t.getData(n)]:[3,6];case 2:return r.sent(),t.status!==a.OK?[3,3]:[2,t];case 3:return[4,e.doAuthChain(t,i,o,l,u,h,c)];case 4:r.sent(),r.label=5;case 5:if(t.status===a.OK||t.status===a.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError();case 6:return[4,t.getData()];case 7:return r.sent(),t.status!==a.MOVED_TEMPORARILY&&t.status!==a.UNAUTHORIZED?[3,9]:[4,e.doAuthChain(t,i,o,l,u,h,c)];case 8:r.sent(),r.label=9;case 9:if(t.status===a.OK||t.status===a.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError()}}))}))},e.doAuthChain=function(t,i,o,s,l,u,h){return n(this,void 0,void 0,(function(){var n,c,p,d,f,g,_,E;return r(this,(function(r){switch(r.label){case 0:return t.isAccessControlled()?((n=t.externalService)&&(n.options=t.options),(c=t.kioskService)&&(c.options=t.options),(p=t.clickThroughService)&&(p.options=t.options),(d=t.loginService)&&(d.options=t.options),t.isResponseHandled||t.status!==a.MOVED_TEMPORARILY?[3,2]:[4,u(t)]):[2,t];case 1:case 3:case 6:case 10:case 14:return r.sent(),[2,t];case 2:return f=null,g=null,(f=n)?(g=f,[4,e.attemptResourceWithToken(t,o,f)]):[3,4];case 4:return(f=c)?(g=f,(_=i(f))?[4,s(_)]:[3,7]):[3,7];case 5:case 9:case 13:return r.sent(),[4,e.attemptResourceWithToken(t,o,f)];case 7:return(f=p)?(g=f,[4,l(t,f)]):[3,11];case 8:return(E=r.sent())?[4,s(E)]:[3,11];case 11:return(f=d)?(g=f,[4,l(t,f)]):[3,15];case 12:return(E=r.sent())?[4,s(E)]:[3,15];case 15:return g&&h(t,g),[2]}}))}))},e.attemptResourceWithToken=function(e,t,i){return n(this,void 0,void 0,(function(){var n,o;return r(this,(function(r){switch(r.label){case 0:return(n=i.getService(s.ServiceProfile.AUTH_1_TOKEN))?[4,t(e,n)]:[3,3];case 1:return(o=r.sent())&&o.accessToken?[4,e.getData(o)]:[3,3];case 2:return r.sent(),[2,e];case 3:return[2]}}))}))},e.loadExternalResourcesAuth09=function(t,i,n,r,o,s,a,l,u,h){return new Promise((function(c,p){var d=t.map((function(t){return e.loadExternalResourceAuth09(t,i,n,r,o,s,a,l,u,h)}));Promise.all(d).then((function(){c(t)})).catch((function(e){p(e)}))}))},e.loadExternalResourceAuth09=function(t,i,n,r,o,s,l,u,h,c){return new Promise((function(p,d){c&&c.pessimisticAccessControl?t.getData().then((function(){t.isAccessControlled()?t.clickThroughService?(p(n(t)),p(r(t))):o(t).then((function(){s(t,!0).then((function(i){t.getData(i).then((function(){p(h(t))})).catch((function(t){d(e.createInternalServerError(t))}))})).catch((function(t){d(e.createInternalServerError(t))}))})).catch((function(t){d(e.createInternalServerError(t))})):p(t)})).catch((function(t){d(e.createInternalServerError(t))})):u(t,i).then((function(c){c?t.getData(c).then((function(){t.status===a.OK?p(h(t)):e.authorize(t,i,n,r,o,s,l,u).then((function(){p(h(t))})).catch((function(t){d(e.createAuthorizationFailedError())}))})).catch((function(t){d(e.createAuthorizationFailedError())})):e.authorize(t,i,n,r,o,s,l,u).then((function(){p(h(t))})).catch((function(t){d(e.createAuthorizationFailedError())}))})).catch((function(t){d(e.createAuthorizationFailedError())}))}))},e.createError=function(e,t){var i=new Error;return i.message=t,i.name=String(e),i},e.createAuthorizationFailedError=function(){return e.createError(o.StatusCode.AUTHORIZATION_FAILED,"Authorization failed")},e.createRestrictedError=function(){return e.createError(o.StatusCode.RESTRICTED,"Restricted")},e.createInternalServerError=function(t){return e.createError(o.StatusCode.INTERNAL_SERVER_ERROR,t)},e.authorize=function(t,i,n,r,o,s,l,u){return new Promise((function(h,c){t.getData().then((function(){t.isAccessControlled()?u(t,i).then((function(u){u?t.getData(u).then((function(){t.status===a.OK?h(t):e.showAuthInteraction(t,i,n,r,o,s,l,h,c)})).catch((function(t){c(e.createInternalServerError(t))})):s(t,!1).then((function(u){u?l(t,u,i).then((function(){t.getData(u).then((function(){t.status===a.OK?h(t):e.showAuthInteraction(t,i,n,r,o,s,l,h,c)})).catch((function(t){c(e.createInternalServerError(t))}))})).catch((function(t){c(e.createInternalServerError(t))})):e.showAuthInteraction(t,i,n,r,o,s,l,h,c)}))})).catch((function(t){c(e.createInternalServerError(t))})):h(t)}))}))},e.showAuthInteraction=function(t,i,n,r,o,s,l,u,h){t.status!==a.MOVED_TEMPORARILY||t.isResponseHandled?t.clickThroughService&&!t.isResponseHandled?n(t).then((function(){s(t,!0).then((function(n){l(t,n,i).then((function(){t.getData(n).then((function(){u(t)})).catch((function(t){h(e.createInternalServerError(t))}))})).catch((function(t){h(e.createInternalServerError(t))}))})).catch((function(t){h(e.createInternalServerError(t))}))})):o(t).then((function(){s(t,!0).then((function(n){l(t,n,i).then((function(){t.getData(n).then((function(){u(t)})).catch((function(t){h(e.createInternalServerError(t))}))})).catch((function(t){h(e.createInternalServerError(t))}))})).catch((function(t){h(e.createInternalServerError(t))}))})):u(t)},e.getService=function(e,t){for(var i=this.getServices(e),n=0;n<i.length;n++){var r=i[n];if(r.getProfile()===t)return r}return null},e.getResourceById=function(t,i){return e.traverseAndFind(t.__jsonld,"@id",i)},e.traverseAndFind=function(t,i,n){if(t.hasOwnProperty(i)&&t[i]===n)return t;for(var r=0;r<Object.keys(t).length;r++)if("object"==typeof t[Object.keys(t)[r]]){var o=e.traverseAndFind(t[Object.keys(t)[r]],i,n);if(null!=o)return o}},e.getServices=function(e){var t,i=[];if(!(t=e.__jsonld?e.__jsonld.service:e.service))return i;Array.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++){var r=t[n];if("string"==typeof r){var s=this.getResourceById(e.options.resource,r);s&&i.push(new o.Service(s.__jsonld||s,e.options))}else i.push(new o.Service(r,e.options))}return i},e.getTemporalComponent=function(e){var t=/t=([^&]+)/g.exec(e),i=null;return t&&t[1]&&(i=t[1].split(",")),i},e}();t.Utils=l},function(e,t,i){i.r(t),t.default=function(e,t){return t=t||{},new Promise((function(i,n){var r=new XMLHttpRequest,o=[],s=[],a={},l=function(){return{ok:2==(r.status/100|0),statusText:r.statusText,status:r.status,url:r.responseURL,text:function(){return Promise.resolve(r.responseText)},json:function(){return Promise.resolve(JSON.parse(r.responseText))},blob:function(){return Promise.resolve(new Blob([r.response]))},clone:l,headers:{keys:function(){return o},entries:function(){return s},get:function(e){return a[e.toLowerCase()]},has:function(e){return e.toLowerCase()in a}}}};for(var u in r.open(t.method||"get",e,!0),r.onload=function(){r.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,i){o.push(t=t.toLowerCase()),s.push([t,i]),a[t]=a[t]?a[t]+","+i:i})),i(l())},r.onerror=n,r.withCredentials="include"==t.credentials,t.headers)r.setRequestHeader(u,t.headers[u]);r.send(t.body||null)}))}},function(e,t,i){e.exports=i(5)},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i(0));var n=i(2);t.loadManifest=function(e){return n.Utils.loadManifest(e)},t.parseManifest=function(e,t){return n.Utils.parseManifest(e,t)}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.__jsonld=e,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return e.prototype.getProperty=function(e){var t=null;return this.__jsonld&&((t=this.__jsonld[e])||(t=this.__jsonld["@"+e])),t},e}();t.JSONLDResource=n},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=i(1),a=function(e){function t(t,i){var n=e.call(this,t)||this;return n.options=i,n}return r(t,e),t.prototype.getIIIFResourceType=function(){return o.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){var e=this.getProperty("label");return e?o.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getDefaultLabel=function(){return o.LanguageMap.getValue(this.getLabel())},t.prototype.getMetadata=function(){var e=this.getProperty("metadata"),t=[];if(!e)return t;for(var i=0;i<e.length;i++){var n=e[i],r=new o.LabelValuePair(this.options.locale);r.parse(n),t.push(r)}return t},t.prototype.getRendering=function(e){for(var t=this.getRenderings(),i=0;i<t.length;i++){var n=t[i];if(n.getFormat()===e)return n}return null},t.prototype.getRenderings=function(){var e,t=[];if(!(e=this.__jsonld?this.__jsonld.rendering:this.rendering))return t;Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){var n=e[i];t.push(new o.Rendering(n,this.options))}return t},t.prototype.getService=function(e){return o.Utils.getService(this,e)},t.prototype.getServices=function(){return o.Utils.getServices(this)},t.prototype.getThumbnail=function(){var e=this.getProperty("thumbnail");return Array.isArray(e)&&(e=e[0]),e?new o.Thumbnail(e,this.options):null},t.prototype.isAnnotation=function(){return this.getIIIFResourceType()===s.IIIFResourceType.ANNOTATION},t.prototype.isCanvas=function(){return this.getIIIFResourceType()===s.IIIFResourceType.CANVAS},t.prototype.isCollection=function(){return this.getIIIFResourceType()===s.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===s.IIIFResourceType.MANIFEST},t.prototype.isRange=function(){return this.getIIIFResourceType()===s.IIIFResourceType.RANGE},t.prototype.isSequence=function(){return this.getIIIFResourceType()===s.IIIFResourceType.SEQUENCE},t}(o.JSONLDResource);t.ManifestResource=a},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=function(e){function t(t,i){return e.call(this,t,i)||this}return r(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?e.toLowerCase():null},t.prototype.getResources=function(){var e=[];if(!this.__jsonld.resources)return e;for(var t=0;t<this.__jsonld.resources.length;t++){var i=this.__jsonld.resources[t],n=new o.Annotation(i,this.options);e.push(n)}return e},t.prototype.getType=function(){var e=this.getProperty("type");return e?o.Utils.normaliseType(e):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},t.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},t}(o.ManifestResource);t.Resource=s},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=i(1),a=function(e){function t(t,i){var n=e.call(this,t,i)||this;n.index=-1,n.isLoaded=!1;var r={defaultLabel:"-",locale:"en-GB",resource:n,pessimisticAccessControl:!1};return n.options=Object.assign(r,i),n}return r(t,e),t.prototype.getAttribution=function(){var e=this.getProperty("attribution");return e?o.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getDescription=function(){var e=this.getProperty("description");return e?o.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getIIIFResourceType=function(){return o.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLogo=function(){var e=this.getProperty("logo");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getLicense=function(){return o.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},t.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},t.prototype.getRelated=function(){return this.getProperty("related")},t.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},t.prototype.getTrackingLabel=function(){var e=this.getService(s.ServiceProfile.TRACKING_EXTENSIONS);return e?e.getProperty("trackingLabel"):""},t.prototype.getDefaultTree=function(){return this.defaultTree=new o.TreeNode("root"),this.defaultTree.data=this,this.defaultTree},t.prototype.getRequiredStatement=function(){var e=null,t=this.getProperty("requiredStatement");if(t)(e=new o.LabelValuePair(this.options.locale)).parse(t);else{var i=this.getAttribution();i&&((e=new o.LabelValuePair(this.options.locale)).value=i)}return e},t.prototype.isCollection=function(){return this.getIIIFResourceType()===s.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===s.IIIFResourceType.MANIFEST},t.prototype.load=function(){var e=this;return new Promise((function(t){if(e.isLoaded)t(e);else{var i=e.options;i.navDate=e.getNavDate();var n=e.__jsonld.id;n||(n=e.__jsonld["@id"]),o.Utils.loadManifest(n).then((function(n){e.parentLabel=o.LanguageMap.getValue(e.getLabel(),i.locale);var r=o.Deserialiser.parse(n,i);(e=Object.assign(e,r)).index=i.index,t(e)}))}}))},t}(o.ManifestResource);t.IIIFResource=a},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=function(e){function t(t,i){return e.call(this,t,i)||this}return r(t,e),t.prototype.getBody=function(){var e=[],t=this.getProperty("body");if(t)if(Array.isArray(t))for(var i=0;i<t.length;i++)if((s=t[i]).items)for(var n=0;n<s.items.length;n++){var r=s.items[n];e.push(new o.AnnotationBody(r,this.options))}else e.push(new o.AnnotationBody(s,this.options));else if(t.items)for(i=0;i<t.items.length;i++){var s=t.items[i];e.push(new o.AnnotationBody(s,this.options))}else e.push(new o.AnnotationBody(t,this.options));return e},t.prototype.getMotivation=function(){return this.getProperty("motivation")||null},t.prototype.getOn=function(){return this.getProperty("on")},t.prototype.getTarget=function(){return this.getProperty("target")},t.prototype.getResource=function(){return new o.Resource(this.getProperty("resource"),this.options)},t}(o.ManifestResource);t.Annotation=s},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=function(e){function t(t,i){return e.call(this,t,i)||this}return r(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?o.Utils.getMediaType(e):null},t.prototype.getType=function(){return this.getProperty("type")?o.Utils.normaliseType(this.getProperty("type")):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t}(o.ManifestResource);t.AnnotationBody=s},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=function(e){function t(t,i,n){var r=e.call(this,i)||this;return r.label=t,r.options=n,r}return r(t,e),t.prototype.getIIIFResourceType=function(){return o.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){return this.label},t.prototype.getResources=function(){var e=this;return this.getProperty("resources").map((function(t){return new o.Annotation(t,e.options)}))},t.prototype.load=function(){var e=this;return new Promise((function(t,i){if(e.isLoaded)t(e);else{var n=e.__jsonld.id;n||(n=e.__jsonld["@id"]),o.Utils.loadManifest(n).then((function(i){e.__jsonld=i,e.context=e.getProperty("context"),e.id=e.getProperty("id"),e.isLoaded=!0,t(e)})).catch(i)}}))},t}(o.JSONLDResource);t.AnnotationList=s},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,i){return e.call(this,t,i)||this}return r(t,e),t.prototype.getItems=function(){return this.getProperty("items")},t}(i(0).ManifestResource);t.AnnotationPage=o},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=function(e){function t(t,i){return e.call(this,t,i)||this}return r(t,e),t.prototype.getCanonicalImageUri=function(e){var t,i=null,n="default",r=e;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])i=this.externalResource.data["@id"],r||(r=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(n="native");else{var s=this.getImages();if(s&&s.length){var a=s[0].getResource(),l=a.getServices();if(r||(r=a.getWidth()),l.length){var u=l[0];i=u.id,n=o.Utils.getImageQuality(u.getProfile())}else if(r===a.getWidth())return a.id}if(!i){var h=this.getProperty("thumbnail");if(h){if("string"==typeof h)return h;if(h["@id"])return h["@id"];if(h.length)return h[0].id}}}return t=r+",",i&&i.endsWith("/")&&(i=i.substr(0,i.length-1)),[i,"full",t,0,n+".jpg"].join("/")},t.prototype.getMaxDimensions=function(){var e,t=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(e=this.externalResource.data.profile,Array.isArray(e)&&(e=e.filter((function(e){return e.maxWidth}))[0])&&(t=new o.Size(e.maxWidth,e.maxHeight?e.maxHeight:e.maxWidth))),t},t.prototype.getContent=function(){var e=[],t=this.__jsonld.items||this.__jsonld.content;if(!t)return e;var i=null;if(t.length&&(i=new o.AnnotationPage(t[0],this.options)),!i)return e;for(var n=i.getItems(),r=0;r<n.length;r++){var s=n[r],a=new o.Annotation(s,this.options);e.push(a)}return e},t.prototype.getDuration=function(){return this.getProperty("duration")},t.prototype.getImages=function(){var e=[];if(!this.__jsonld.images)return e;for(var t=0;t<this.__jsonld.images.length;t++){var i=this.__jsonld.images[t],n=new o.Annotation(i,this.options);e.push(n)}return e},t.prototype.getIndex=function(){return this.getProperty("index")},t.prototype.getOtherContent=function(){var e=this,t=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter((function(e){return e&&"string"==typeof(t=e["@type"])&&t.toLowerCase()==t.toLowerCase();var t})).map((function(t,i){return new o.AnnotationList(t.label||"Annotation list "+i,t,e.options)})).map((function(e){return e.load()}));return Promise.all(t)},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t}(o.Resource);t.Canvas=s},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(1),s=i(0),a=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.items=[],n._collections=null,n._manifests=null,t.__collection=n,n}return r(t,e),t.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter((function(e){return e.isCollection()}))},t.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter((function(e){return e.isManifest()}))},t.prototype.getCollectionByIndex=function(e){for(var t,i=this.getCollections(),n=0;n<i.length;n++){var r=i[n];r.index===e&&(t=r)}if(t)return t.options.index=e,t.load();throw new Error("Collection index not found")},t.prototype.getManifestByIndex=function(e){for(var t,i=this.getManifests(),n=0;n<i.length;n++){var r=i[n];r.index===e&&(t=r)}if(t)return t.options.index=e,t.load();throw new Error("Manifest index not found")},t.prototype.getTotalCollections=function(){return this.getCollections().length},t.prototype.getTotalManifests=function(){return this.getManifests().length},t.prototype.getTotalItems=function(){return this.items.length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):o.ViewingDirection.LEFT_TO_RIGHT},t.prototype.getDefaultTree=function(){return e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=s.Utils.normaliseType(s.TreeNodeType.COLLECTION),this._parseManifests(this),this._parseCollections(this),s.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._parseManifests=function(e){if(e.getManifests()&&e.getManifests().length)for(var t=0;t<e.getManifests().length;t++){var i=e.getManifests()[t],n=i.getDefaultTree();n.label=i.parentLabel||s.LanguageMap.getValue(i.getLabel(),this.options.locale)||"manifest "+(t+1),n.navDate=i.getNavDate(),n.data.id=i.id,n.data.type=s.Utils.normaliseType(s.TreeNodeType.MANIFEST),e.defaultTree.addNode(n)}},t.prototype._parseCollections=function(e){if(e.getCollections()&&e.getCollections().length)for(var t=0;t<e.getCollections().length;t++){var i=e.getCollections()[t],n=i.getDefaultTree();n.label=i.parentLabel||s.LanguageMap.getValue(i.getLabel(),this.options.locale)||"collection "+(t+1),n.navDate=i.getNavDate(),n.data.id=i.id,n.data.type=s.Utils.normaliseType(s.TreeNodeType.COLLECTION),e.defaultTree.addNode(n)}},t}(s.IIIFResource);t.Collection=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.start=e,this.end=t}return e.prototype.getLength=function(){return this.end-this.start},e}();t.Duration=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),r=function(){function e(e){this.defaultLocale=e}return e.prototype.parse=function(e){this.resource=e,this.label=n.LanguageMap.parse(this.resource.label,this.defaultLocale),this.value=n.LanguageMap.parse(this.resource.value,this.defaultLocale)},e.prototype.getLabel=function(){return this.label?n.LanguageMap.getValue(this.label,this.defaultLocale):null},e.prototype.setLabel=function(e){var t=this;if(this.label&&this.label.length){var i=this.label.filter((function(e){return e.locale===t.defaultLocale||e.locale===n.Utils.getInexactLocale(t.defaultLocale)}))[0];i&&(i.value=e)}},e.prototype.getValue=function(){if(this.value){var e=this.defaultLocale;return this.label&&this.label.length&&this.label[0].locale&&(e=this.label[0].locale),n.LanguageMap.getValue(this.value,e)}return null},e.prototype.setValue=function(e){var t=this;if(this.value&&this.value.length){var i=this.value.filter((function(e){return e.locale===t.defaultLocale||e.locale===n.Utils.getInexactLocale(t.defaultLocale)}))[0];i&&(i.value=e)}},e}();t.LabelValuePair=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Language=function(e,t){Array.isArray(e)?1===e.length?this.value=e[0]:this.value=e.join("<br/>"):this.value=e,this.locale=t}},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.parse=function(e,t){var i,n=[];if(!e)return n;if(Array.isArray(e))for(var r=0;r<e.length;r++){var s=e[r];i="string"==typeof s?new o.Language(s,t):new o.Language(s["@value"],s["@language"]||t),n.push(i)}else{if("string"==typeof e)return i=new o.Language(e,t),n.push(i),n;e["@value"]?(i=new o.Language(e["@value"],e["@language"]||t),n.push(i)):Object.keys(e).forEach((function(t){if(!e[t].length)throw new Error("language must have a value");i=new o.Language(e[t],t),n.push(i)}))}return n},t.getValue=function(e,t){if(e.length){if(t){var i=e.filter((function(e){return e.locale===t||o.Utils.getInexactLocale(e.locale)===o.Utils.getInexactLocale(t)}))[0];if(i)return i.value}return e[0].value}return null},t}(Array);t.LanguageMap=s},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(1),s=i(0),a=function(e){function t(t,i){var n=e.call(this,t,i)||this;if(n.index=0,n._allRanges=null,n.items=[],n._topRanges=[],n.__jsonld.structures&&n.__jsonld.structures.length)for(var r=n._getTopRanges(),o=0;o<r.length;o++){var s=r[o];n._parseRanges(s,String(o))}return n}return r(t,e),t.prototype.getPosterCanvas=function(){var e=this.getProperty("posterCanvas");return e&&(e=new s.Canvas(e,this.options)),e},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getDefaultTree=function(){if(e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=s.Utils.normaliseType(s.TreeNodeType.MANIFEST),!this.isLoaded)return this.defaultTree;var t=this.getTopRanges();return t.length&&t[0].getTree(this.defaultTree),s.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._getTopRanges=function(){var e=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var t=0;t<this.__jsonld.structures.length;t++){var i=this.__jsonld.structures[t];i.viewingHint===o.ViewingHint.TOP&&e.push(i)}if(!e.length){var n={};n.ranges=this.__jsonld.structures,e.push(n)}}return e},t.prototype.getTopRanges=function(){return this._topRanges},t.prototype._getRangeById=function(e){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var t=0;t<this.__jsonld.structures.length;t++){var i=this.__jsonld.structures[t];if(i["@id"]===e||i.id===e)return i}return null},t.prototype._parseRanges=function(e,t,i){var n,r=null;if("string"==typeof e&&(r=e,e=this._getRangeById(r)),e){(n=new s.Range(e,this.options)).parentRange=i,n.path=t,i?i.items.push(n):this._topRanges.push(n);var o=e.items||e.members;if(o)for(var a=0;a<o.length;a++){var l=o[a];if(l["@type"]&&"sc:range"===l["@type"].toLowerCase()||l.type&&"range"===l.type.toLowerCase())this._parseRanges(l,t+"/"+a,n);else if(l["@type"]&&"sc:canvas"===l["@type"].toLowerCase()||l.type&&"canvas"===l.type.toLowerCase()){n.canvases||(n.canvases=[]);var u=l.id||l["@id"];n.canvases.push(u)}}else if(e.ranges)for(a=0;a<e.ranges.length;a++)this._parseRanges(e.ranges[a],t+"/"+a,n)}else console.warn("Range:",r,"does not exist")},t.prototype.getAllRanges=function(){if(null!=this._allRanges)return this._allRanges;this._allRanges=[];for(var e=this.getTopRanges(),t=function(t){var n=e[t];n.id&&i._allRanges.push(n);var r=function(e,t){e.add(t);var i=t.getRanges();return i.length?i.reduce(r,e):e},o=Array.from(n.getRanges().reduce(r,new Set));i._allRanges=i._allRanges.concat(o)},i=this,n=0;n<e.length;n++)t(n);return this._allRanges},t.prototype.getRangeById=function(e){for(var t=this.getAllRanges(),i=0;i<t.length;i++){var n=t[i];if(n.id===e)return n}return null},t.prototype.getRangeByPath=function(e){for(var t=this.getAllRanges(),i=0;i<t.length;i++){var n=t[i];if(n.path===e)return n}return null},t.prototype.getSequences=function(){if(this.items.length)return this.items;var e=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(e)for(var t=0;t<e.length;t++){var i=e[t],n=new s.Sequence(i,this.options);this.items.push(n)}else this.__jsonld.items&&(n=new s.Sequence(this.__jsonld.items,this.options),this.items.push(n));return this.items},t.prototype.getSequenceByIndex=function(e){return this.getSequences()[e]},t.prototype.getTotalSequences=function(){return this.getSequences().length},t.prototype.getManifestType=function(){var e=this.getService(o.ServiceProfile.UI_EXTENSIONS);return e?e.getProperty("manifestType"):s.ManifestType.EMPTY},t.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();if(e)return e===o.ViewingHint.PAGED;var t=this.getBehavior();return!!t&&t===o.Behavior.PAGED},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t}(s.IIIFResource);t.Manifest=a},function(e,t,i){var n;Object.defineProperty(t,"__esModule",{value:!0}),(n=t.ManifestType||(t.ManifestType={})).EMPTY="",n.MANUSCRIPT="manuscript",n.MONOGRAPH="monograph"},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=i(1),a=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._ranges=null,n.canvases=null,n.items=[],n}return r(t,e),t.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},t.prototype.getDuration=function(){var e,t;if(this.canvases&&this.canvases.length)for(var i=0;i<this.canvases.length;i++){var n=this.canvases[i],r=o.Utils.getTemporalComponent(n);r&&r.length>1&&(0===i&&(e=Number(r[0])),i===this.canvases.length-1&&(t=Number(r[1])))}else{var s=this.getRanges();for(i=0;i<s.length;i++){var a=s[i].getDuration();a&&(0===i&&(e=a.start),i===s.length-1&&(t=a.end))}}if(void 0!==e&&void 0!==t)return new o.Duration(e,t)},t.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter((function(e){return e.isRange()}))},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getTree=function(e){e.data=this,this.treeNode=e;var t=this.getRanges();if(t&&t.length)for(var i=0;i<t.length;i++){var n=t[i],r=new o.TreeNode;e.addNode(r),this._parseTreeNode(r,n)}return o.Utils.generateTreeNodeIds(e),e},t.prototype.spansTime=function(e){var t=this.getDuration();return!!(t&&e>=t.start&&e<=t.end)},t.prototype._parseTreeNode=function(e,t){e.label=o.LanguageMap.getValue(t.getLabel(),this.options.locale),e.data=t,e.data.type=o.Utils.normaliseType(o.TreeNodeType.RANGE),t.treeNode=e;var i=t.getRanges();if(i&&i.length)for(var n=0;n<i.length;n++){var r=i[n];if(r.getBehavior()!==s.Behavior.NO_NAV){var a=new o.TreeNode;e.addNode(a),this._parseTreeNode(a,r)}}},t}(o.ManifestResource);t.Range=a},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,i){return e.call(this,t,i)||this}return r(t,e),t.prototype.getFormat=function(){return this.getProperty("format")},t}(i(0).ManifestResource);t.Rendering=o},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(1),s=i(0),a=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.items=[],n._thumbnails=null,n}return r(t,e),t.prototype.getCanvases=function(){if(this.items.length)return this.items;var e=this.__jsonld.canvases||this.__jsonld.elements;if(e)for(var t=0;t<e.length;t++){var i=e[t];(n=new s.Canvas(i,this.options)).index=t,this.items.push(n)}else if(this.__jsonld)for(t=0;t<this.__jsonld.length;t++){var n;i=this.__jsonld[t],(n=new s.Canvas(i,this.options)).index=t,this.items.push(n)}return this.items},t.prototype.getCanvasById=function(e){for(var t=0;t<this.getTotalCanvases();t++){var i=this.getCanvasByIndex(t),n=s.Utils.normaliseUrl(i.id);if(s.Utils.normaliseUrl(e)===n)return i}return null},t.prototype.getCanvasByIndex=function(e){return this.getCanvases()[e]},t.prototype.getCanvasIndexById=function(e){for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return null},t.prototype.getCanvasIndexByLabel=function(e,t){e=e.trim(),isNaN(e)||(e=parseInt(e,10).toString(),t&&(e+="r"));for(var i,n,r,o=/(\d*)\D+(\d*)/,a=0;a<this.getTotalCanvases();a++){var l=this.getCanvasByIndex(a);if(s.LanguageMap.getValue(l.getLabel(),this.options.locale)===e||(i=o.exec(e))&&(n=i[1],(r=i[2])&&new RegExp("^"+n+"\\D+"+r+"$").test(l.getLabel().toString())))return a}return-1},t.prototype.getLastCanvasLabel=function(e){for(var t=this.getTotalCanvases()-1;t>=0;t--){var i=this.getCanvasByIndex(t),n=s.LanguageMap.getValue(i.getLabel(),this.options.locale);if(e){if(/^[a-zA-Z0-9]*$/.test(n))return n}else if(n)return n}return this.options.defaultLabel},t.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},t.prototype.getNextPageIndex=function(e,t){var i;if(t){var n=this.getPagedIndices(e),r=this.getViewingDirection();i=r&&r===o.ViewingDirection.RIGHT_TO_LEFT?n[0]+1:n[n.length-1]+1}else i=e+1;return i>this.getLastPageIndex()?-1:i},t.prototype.getPagedIndices=function(e,t){var i=[];if(t){i=this.isFirstCanvas(e)||this.isLastCanvas(e)?[e]:e%2?[e,e+1]:[e-1,e];var n=this.getViewingDirection();n&&n===o.ViewingDirection.RIGHT_TO_LEFT&&(i=i.reverse())}else i.push(e);return i},t.prototype.getPrevPageIndex=function(e,t){var i;if(t){var n=this.getPagedIndices(e),r=this.getViewingDirection();i=r&&r===o.ViewingDirection.RIGHT_TO_LEFT?n[n.length-1]-1:n[0]-1}else i=e-1;return i},t.prototype.getStartCanvasIndex=function(){var e=this.getStartCanvas();if(e)for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return 0},t.prototype.getThumbs=function(e,t){for(var i=[],n=this.getTotalCanvases(),r=0;r<n;r++){var o=this.getCanvasByIndex(r),a=new s.Thumb(e,o);i.push(a)}return i},t.prototype.getThumbnails=function(){if(null!=this._thumbnails)return this._thumbnails;this._thumbnails=[];for(var e=this.getCanvases(),t=0;t<e.length;t++){var i=e[t].getThumbnail();i&&this._thumbnails.push(i)}return this._thumbnails},t.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},t.prototype.getTotalCanvases=function(){return this.getCanvases().length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.isCanvasIndexOutOfRange=function(e){return e>this.getTotalCanvases()-1},t.prototype.isFirstCanvas=function(e){return 0===e},t.prototype.isLastCanvas=function(e){return e===this.getTotalCanvases()-1},t.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();return!!e&&e===o.ViewingHint.PAGED},t.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},t}(s.ManifestResource);t.Sequence=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),r=function(){function e(){}return e.parse=function(e,t){return"string"==typeof e&&(e=JSON.parse(e)),this.parseJson(e,t)},e.parseJson=function(e,t){var i;if(t&&t.navDate&&!isNaN(t.navDate.getTime())&&(e.navDate=t.navDate.toString()),e["@type"])switch(e["@type"]){case"sc:Collection":i=this.parseCollection(e,t);break;case"sc:Manifest":i=this.parseManifest(e,t);break;default:return null}else switch(e.type){case"Collection":i=this.parseCollection(e,t);break;case"Manifest":i=this.parseManifest(e,t);break;default:return null}return i.isLoaded=!0,i},e.parseCollection=function(e,t){var i=new n.Collection(e,t);return t?(i.index=t.index||0,t.resource&&(i.parentCollection=t.resource.parentCollection)):i.index=0,this.parseCollections(i,t),this.parseManifests(i,t),this.parseItems(i,t),i},e.parseCollections=function(e,t){var i;if(e.__jsonld.collections?i=e.__jsonld.collections:e.__jsonld.items&&(i=e.__jsonld.items.filter((function(e){return"collection"===e.type.toLowerCase()}))),i)for(var n=0;n<i.length;n++){t&&(t.index=n);var r=this.parseCollection(i[n],t);r.index=n,r.parentCollection=e,e.items.push(r)}},e.parseManifest=function(e,t){return new n.Manifest(e,t)},e.parseManifests=function(e,t){var i;if(e.__jsonld.manifests?i=e.__jsonld.manifests:e.__jsonld.items&&(i=e.__jsonld.items.filter((function(e){return"manifest"===e.type.toLowerCase()}))),i)for(var n=0;n<i.length;n++){var r=this.parseManifest(i[n],t);r.index=n,r.parentCollection=e,e.items.push(r)}},e.parseItem=function(e,t){if(e["@type"]){if("sc:manifest"===e["@type"].toLowerCase())return this.parseManifest(e,t);if("sc:collection"===e["@type"].toLowerCase())return this.parseCollection(e,t)}else if(e.type){if("manifest"===e.type.toLowerCase())return this.parseManifest(e,t);if("collection"===e.type.toLowerCase())return this.parseCollection(e,t)}return null},e.parseItems=function(e,t){var i=e.__jsonld.members||e.__jsonld.items;if(i)for(var n=function(n){t&&(t.index=n);var o=r.parseItem(i[n],t);return o?e.items.filter((function(e){return e.id===o.id}))[0]?"continue":(o.index=n,o.parentCollection=e,void e.items.push(o)):{value:void 0}},r=this,o=0;o<i.length;o++){var s=n(o);if("object"==typeof s)return s.value}},e}();t.Deserialiser=r},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=function(e){function t(t,i){return e.call(this,t,i)||this}return r(t,e),t.prototype.getProfile=function(){var e=this.getProperty("profile");return e||(e=this.getProperty("dcterms:conformsTo")),Array.isArray(e)?e[0]:e},t.prototype.getConfirmLabel=function(){return o.Utils.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},t.prototype.getDescription=function(){return o.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},t.prototype.getFailureDescription=function(){return o.Utils.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},t.prototype.getFailureHeader=function(){return o.Utils.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},t.prototype.getHeader=function(){return o.Utils.getLocalisedValue(this.getProperty("header"),this.options.locale)},t.prototype.getServiceLabel=function(){return o.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},t.prototype.getInfoUri=function(){var e=this.id;return e.endsWith("/")||(e+="/"),e+"info.json"},t}(o.ManifestResource);t.Service=s},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Size=function(e,t){this.width=e,this.height=t}},function(e,t,i){var n;Object.defineProperty(t,"__esModule",{value:!0}),(n=t.StatusCode||(t.StatusCode={}))[n.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",n[n.FORBIDDEN=2]="FORBIDDEN",n[n.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",n[n.RESTRICTED=4]="RESTRICTED"},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var n=i(0);t.Thumb=function(e,t){this.data=t,this.index=t.index,this.width=e;var i=t.getHeight()/t.getWidth();this.height=i?Math.floor(this.width*i):e,this.uri=t.getCanonicalImageUri(e),this.label=n.LanguageMap.getValue(t.getLabel())}},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,i){return e.call(this,t,i)||this}return r(t,e),t}(i(0).Resource);t.Thumbnail=o},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),r=function(){function e(e,t){this.label=e,this.data=t||{},this.nodes=[]}return e.prototype.addNode=function(e){this.nodes.push(e),e.parentNode=this},e.prototype.isCollection=function(){return this.data.type===n.Utils.normaliseType(n.TreeNodeType.COLLECTION)},e.prototype.isManifest=function(){return this.data.type===n.Utils.normaliseType(n.TreeNodeType.MANIFEST)},e.prototype.isRange=function(){return this.data.type===n.Utils.normaliseType(n.TreeNodeType.RANGE)},e}();t.TreeNode=r},function(e,t,i){var n;Object.defineProperty(t,"__esModule",{value:!0}),(n=t.TreeNodeType||(t.TreeNodeType={})).COLLECTION="collection",n.MANIFEST="manifest",n.RANGE="range"},function(e,t,i){e.exports=function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.CONTINUE=100,t.SWITCHING_PROTOCOLS=101,t.PROCESSING=102,t.OK=200,t.CREATED=201,t.ACCEPTED=202,t.NON_AUTHORITATIVE_INFORMATION=203,t.NO_CONTENT=204,t.RESET_CONTENT=205,t.PARTIAL_CONTENT=206,t.MULTI_STATUS=207,t.MULTIPLE_CHOICES=300,t.MOVED_PERMANENTLY=301,t.MOVED_TEMPORARILY=302,t.SEE_OTHER=303,t.NOT_MODIFIED=304,t.USE_PROXY=305,t.TEMPORARY_REDIRECT=307,t.BAD_REQUEST=400,t.UNAUTHORIZED=401,t.PAYMENT_REQUIRED=402,t.FORBIDDEN=403,t.NOT_FOUND=404,t.METHOD_NOT_ALLOWED=405,t.NOT_ACCEPTABLE=406,t.PROXY_AUTHENTICATION_REQUIRED=407,t.REQUEST_TIME_OUT=408,t.CONFLICT=409,t.GONE=410,t.LENGTH_REQUIRED=411,t.PRECONDITION_FAILED=412,t.REQUEST_ENTITY_TOO_LARGE=413,t.REQUEST_URI_TOO_LARGE=414,t.UNSUPPORTED_MEDIA_TYPE=415,t.REQUESTED_RANGE_NOT_SATISFIABLE=416,t.EXPECTATION_FAILED=417,t.IM_A_TEAPOT=418,t.UNPROCESSABLE_ENTITY=422,t.LOCKED=423,t.FAILED_DEPENDENCY=424,t.UNORDERED_COLLECTION=425,t.UPGRADE_REQUIRED=426,t.PRECONDITION_REQUIRED=428,t.TOO_MANY_REQUESTS=429,t.REQUEST_HEADER_FIELDS_TOO_LARGE=431,t.INTERNAL_SERVER_ERROR=500,t.NOT_IMPLEMENTED=501,t.BAD_GATEWAY=502,t.SERVICE_UNAVAILABLE=503,t.GATEWAY_TIME_OUT=504,t.HTTP_VERSION_NOT_SUPPORTED=505,t.VARIANT_ALSO_NEGOTIATES=506,t.INSUFFICIENT_STORAGE=507,t.BANDWIDTH_LIMIT_EXCEEDED=509,t.NOT_EXTENDED=510,t.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(e,t,i){e.exports=window.fetch||(window.fetch=i(3).default||i(3))}])},function(e,t,i){e.exports=function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.CONTINUE=100,t.SWITCHING_PROTOCOLS=101,t.PROCESSING=102,t.OK=200,t.CREATED=201,t.ACCEPTED=202,t.NON_AUTHORITATIVE_INFORMATION=203,t.NO_CONTENT=204,t.RESET_CONTENT=205,t.PARTIAL_CONTENT=206,t.MULTI_STATUS=207,t.MULTIPLE_CHOICES=300,t.MOVED_PERMANENTLY=301,t.MOVED_TEMPORARILY=302,t.SEE_OTHER=303,t.NOT_MODIFIED=304,t.USE_PROXY=305,t.TEMPORARY_REDIRECT=307,t.BAD_REQUEST=400,t.UNAUTHORIZED=401,t.PAYMENT_REQUIRED=402,t.FORBIDDEN=403,t.NOT_FOUND=404,t.METHOD_NOT_ALLOWED=405,t.NOT_ACCEPTABLE=406,t.PROXY_AUTHENTICATION_REQUIRED=407,t.REQUEST_TIME_OUT=408,t.CONFLICT=409,t.GONE=410,t.LENGTH_REQUIRED=411,t.PRECONDITION_FAILED=412,t.REQUEST_ENTITY_TOO_LARGE=413,t.REQUEST_URI_TOO_LARGE=414,t.UNSUPPORTED_MEDIA_TYPE=415,t.REQUESTED_RANGE_NOT_SATISFIABLE=416,t.EXPECTATION_FAILED=417,t.IM_A_TEAPOT=418,t.UNPROCESSABLE_ENTITY=422,t.LOCKED=423,t.FAILED_DEPENDENCY=424,t.UNORDERED_COLLECTION=425,t.UPGRADE_REQUIRED=426,t.PRECONDITION_REQUIRED=428,t.TOO_MANY_REQUESTS=429,t.REQUEST_HEADER_FIELDS_TOO_LARGE=431,t.INTERNAL_SERVER_ERROR=500,t.NOT_IMPLEMENTED=501,t.BAD_GATEWAY=502,t.SERVICE_UNAVAILABLE=503,t.GATEWAY_TIME_OUT=504,t.HTTP_VERSION_NOT_SUPPORTED=505,t.VARIANT_ALSO_NEGOTIATES=506,t.INSUFFICIENT_STORAGE=507,t.BANDWIDTH_LIMIT_EXCEEDED=509,t.NOT_EXTENDED=510,t.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(e,t,i){e.exports=i(3)},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=i(5),a=function(e){function t(t){var i=e.call(this,t)||this;return i._data=i.data(),i._data=i.options.data,i._init(),i._resize(),i}return r(t,e),t.prototype._init=function(){e.prototype._init.call(this),this._$element=$(this.el);var t=this;return this._$tree=$('<ul class="tree"></ul>'),this._$element.append(this._$tree),$.templates({pageTemplate:"{^{for nodes}}\t\t\t\t\t{^{tree/}}\t\t\t\t{{/for}}",treeTemplate:'<li>\t\t\t\t\t\t{^{if nodes && nodes.length}}\t\t\t\t\t\t\t<div class="toggle" data-link="class{merge:expanded toggle=\'expanded\'}"></div>\t\t\t\t\t\t{{else}}\t\t\t\t\t\t<div class="spacer"></div>\t\t\t\t\t\t{{/if}}\t\t\t\t\t\t{^{if multiSelectEnabled}}\t\t\t\t\t\t\t<input id="tree-checkbox-{{>id}}" type="checkbox" data-link="checked{:multiSelected ? \'checked\' : \'\'}" class="multiSelect" />\t\t\t\t\t\t{{/if}}\t\t\t\t\t\t{^{if selected}}\t\t\t\t\t\t\t<a id="tree-link-{{>id}}" href="#" title="{{>label}}" class="selected">{{>label}}</a>\t\t\t\t\t\t{{else}}\t\t\t\t\t\t\t<a id="tree-link-{{>id}}" href="#" title="{{>label}}">{{>label}}</a>\t\t\t\t\t\t{{/if}}\t\t\t\t</li>\t\t\t\t{^{if expanded}}\t\t\t\t\t<li>\t\t\t\t\t\t\t<ul>\t\t\t\t\t\t\t\t\t{^{for nodes}}\t\t\t\t\t\t\t\t\t\t{^{tree/}}\t\t\t\t\t\t\t\t\t{{/for}}\t\t\t\t\t\t\t</ul>\t\t\t\t\t</li>\t\t\t\t{{/if}}'}),$.views.tags({tree:{toggleExpanded:function(){var e=this.data;t._setNodeExpanded(e,!e.expanded)},toggleMultiSelect:function(){var e=this.data;if(t._setNodeMultiSelected(e,!e.multiSelected),e.isRange()){var i=t._getMultiSelectState();i&&i.selectRange(e.data,e.multiSelected)}t.fire(l.TREE_NODE_MULTISELECTED,e)},init:function(e,t,i){this.data=e.view.data},onAfterLink:function(){var e=this;e.contents("li").first().on("click",".toggle",(function(){e.toggleExpanded()})).on("click","a",(function(i){i.preventDefault();var n=e.data;n.nodes.length&&t._data.branchNodesExpandOnClick&&e.toggleExpanded(),n.multiSelectEnabled?e.toggleMultiSelect():n.nodes.length?t._data.branchNodesSelectable&&(t.fire(l.TREE_NODE_SELECTED,n),t.selectNode(n)):(t.fire(l.TREE_NODE_SELECTED,n),t.selectNode(n))})).on("click","input.multiSelect",(function(t){e.toggleMultiSelect()}))},template:$.templates.treeTemplate}}),!0},t.prototype.set=function(e){var t=this;if(this._data=Object.assign(this._data,e),this._data.helper){this._rootNode=this._data.helper.getTree(this._data.topRangeIndex,this._data.treeSortType),this._flattenedTree=null,this._multiSelectableNodes=null,this._$tree.link($.templates.pageTemplate,this._rootNode);var i=this._getMultiSelectState();if(i)for(var n=function(e){var t=i.ranges[e],n=r._getMultiSelectableNodes().filter((function(e){return e.data.id===t.id}))[0];n&&(r._setNodeMultiSelectEnabled(n,t.multiSelectEnabled),r._setNodeMultiSelected(n,t.multiSelected))},r=this,o=0;o<i.ranges.length;o++)n(o);this._data.autoExpand&&this.getAllNodes().forEach((function(e,i){t._setNodeExpanded(e,!0)}))}},t.prototype._getMultiSelectState=function(){return this._data.helper?this._data.helper.getMultiSelectState():null},t.prototype.data=function(){return{autoExpand:!1,branchNodesExpandOnClick:!0,branchNodesSelectable:!0,helper:null,topRangeIndex:0,treeSortType:s.TreeSortType.NONE}},t.prototype.allNodesSelected=function(){var e=this._getMultiSelectableNodes(),t=this.getMultiSelectedNodes();return e.length===t.length},t.prototype._getMultiSelectableNodes=function(){var e=this;if(this._multiSelectableNodes)return this._multiSelectableNodes;var t=this.getAllNodes();return t?this._multiSelectableNodes=t.filter((function(t){return e._nodeIsMultiSelectable(t)})):[]},t.prototype._nodeIsMultiSelectable=function(e){return!!(e.data.type===o.TreeNodeType.MANIFEST&&e.nodes&&e.nodes.length>0||e.data.type===o.TreeNodeType.RANGE)},t.prototype.getAllNodes=function(){return this._flattenedTree?this._flattenedTree:this._data.helper?this._flattenedTree=this._data.helper.getFlattenedTree(this._rootNode):[]},t.prototype.getMultiSelectedNodes=function(){var e=this;return this.getAllNodes().filter((function(t){return e._nodeIsMultiSelectable(t)&&t.multiSelected}))},t.prototype.getNodeById=function(e){return this.getAllNodes().filter((function(t){return t.id===e}))[0]},t.prototype.expandParents=function(e,t){e&&e.parentNode&&(this._setNodeExpanded(e.parentNode,t),this.expandParents(e.parentNode,t))},t.prototype._setNodeSelected=function(e,t){$.observable(e).setProperty("selected",t)},t.prototype._setNodeExpanded=function(e,t){$.observable(e).setProperty("expanded",t)},t.prototype._setNodeMultiSelected=function(e,t){$.observable(e).setProperty("multiSelected",t)},t.prototype._setNodeMultiSelectEnabled=function(e,t){$.observable(e).setProperty("multiSelectEnabled",t)},t.prototype.selectPath=function(e){if(this._rootNode){var t=e.split("/");t.length>=1&&t.shift();var i=this.getNodeByPath(this._rootNode,t);this.selectNode(i)}},t.prototype.deselectCurrentNode=function(){this.selectedNode&&this._setNodeSelected(this.selectedNode,!1)},t.prototype.selectNode=function(e){this._rootNode&&(this.deselectCurrentNode(),this.selectedNode=e,this._setNodeSelected(this.selectedNode,!0))},t.prototype.expandNode=function(e,t){this._rootNode&&this._setNodeExpanded(e,t)},t.prototype.getNodeByPath=function(e,t){if(0===t.length)return e;var i=Number(t.shift()),n=e.nodes[i];return this.getNodeByPath(n,t)},t.prototype.show=function(){this._$element.show()},t.prototype.hide=function(){this._$element.hide()},t.prototype._resize=function(){},t}(i(4).BaseComponent);t.TreeComponent=a;var l=function(){function e(){}return e.TREE_NODE_MULTISELECTED="treeNodeMultiSelected",e.TREE_NODE_SELECTED="treeNodeSelected",e}();t.Events=l},function(e,t,i){i.r(t),i.d(t,"BaseComponent",(function(){return n}));var n=function(){function e(e){this.options=e,this.options.data=Object.assign({},this.data(),e.data)}return e.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},e.prototype.data=function(){return{}},e.prototype.on=function(e,t,i){var n=this._e||(this._e={});(n[e]||(n[e]=[])).push({fn:t,ctx:i})},e.prototype.fire=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];for(var n=[].slice.call(arguments,1),r=((this._e||(this._e={}))[e]||[]).slice(),o=0,s=r.length;o<s;o++)r[o].fn.apply(r[o].ctx,n)},e.prototype._resize=function(){},e.prototype.set=function(e){},e}()},function(e,t,i){i.r(t);var n,r,o,s,a,l,u,h,c,p,d,f=function(e){this.isVisible=!0;var t=e.on.match(/.*xywh=(\d*),(\d*),(\d*),(\d*)/);this.x=Number(t[1]),this.y=Number(t[2]),this.width=Number(t[3]),this.height=Number(t[4]),this.chars=e.resource.chars},g=function(){function e(e,t){this.rects=[],this.canvasIndex=t,this.addRect(e)}return e.prototype.addRect=function(e){var t=new f(e);t.canvasIndex=this.canvasIndex,t.index=this.rects.length,this.rects.push(t),this.rects.sort((function(e,t){return e.index-t.index}))},e}(),_=i(0),E=function(){function e(){this.isEnabled=!1,this.ranges=[],this.canvases=[]}return e.prototype.allCanvasesSelected=function(){return this.canvases.length>0&&this.getAllSelectedCanvases().length===this.canvases.length},e.prototype.allRangesSelected=function(){return this.ranges.length>0&&this.getAllSelectedRanges().length===this.ranges.length},e.prototype.allSelected=function(){return this.allRangesSelected()&&this.allCanvasesSelected()},e.prototype.getAll=function(){return this.canvases.concat(this.ranges)},e.prototype.getAllSelectedCanvases=function(){return this.canvases.filter((function(e){return e.multiSelected}))},e.prototype.getAllSelectedRanges=function(){return this.ranges.filter((function(e){return e.multiSelected}))},e.prototype.getCanvasById=function(e){return this.canvases.filter((function(t){return _.Utils.normaliseUrl(t.id)===_.Utils.normaliseUrl(e)}))[0]},e.prototype.getCanvasesByIds=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];t.push(this.getCanvasById(n))}return t},e.prototype.getRangeCanvases=function(e){var t=e.getCanvasIds();return this.getCanvasesByIds(t)},e.prototype.selectAll=function(e){this.selectRanges(this.ranges,e),this.selectCanvases(this.canvases,e)},e.prototype.selectCanvas=function(e,t){this.canvases.filter((function(t){return t.id===e.id}))[0].multiSelected=t},e.prototype.selectAllCanvases=function(e){this.selectCanvases(this.canvases,e)},e.prototype.selectCanvases=function(e,t){for(var i=0;i<e.length;i++)e[i].multiSelected=t},e.prototype.selectRange=function(e,t){var i=this.ranges.filter((function(t){return t.id===e.id}))[0];i.multiSelected=t;var n=this.getRangeCanvases(i);this.selectCanvases(n,t)},e.prototype.selectAllRanges=function(e){this.selectRanges(this.ranges,e)},e.prototype.selectRanges=function(e,t){for(var i=0;i<e.length;i++){var n=e[i];n.multiSelected=t;var r=this.getCanvasesByIds(n.getCanvasIds());this.selectCanvases(r,t)}},e.prototype.setEnabled=function(e){this.isEnabled=e;for(var t=this.getAll(),i=0;i<t.length;i++){var n=t[i];n.multiSelectEnabled=this.isEnabled,e||(n.multiSelected=!1)}},e}(),v=function(){function e(e,t){this.items=[],this.resource=e,this.label=t}return e.prototype.addItem=function(e){this.items.push(e)},e.prototype.addMetadata=function(e,t){void 0===t&&(t=!1);for(var i=0;i<e.length;i++){var n=e[i];n.isRootLevel=t,this.addItem(n)}},e}();(d=n||(n={})).DATE="date",d.NONE="none",function(e){e.BOOKMARKING="oa:bookmarking",e.CLASSIFYING="oa:classifying",e.COMMENTING="oa:commenting",e.DESCRIBING="oa:describing",e.EDITING="oa:editing",e.HIGHLIGHTING="oa:highlighting",e.IDENTIFYING="oa:identifying",e.LINKING="oa:linking",e.MODERATING="oa:moderating",e.PAINTING="sc:painting",e.QUESTIONING="oa:questioning",e.REPLYING="oa:replying",e.TAGGING="oa:tagging",e.TRANSCRIBING="oad:transcribing"}(r||(r={})),function(e){e.AUTO_ADVANCE="auto-advance",e.CONTINUOUS="continuous",e.FACING_PAGES="facing-pages",e.HIDDEN="hidden",e.INDIVIDUALS="individuals",e.MULTI_PART="multi-part",e.NO_NAV="no-nav",e.NON_PAGED="non-paged",e.PAGED="paged",e.REPEAT="repeat",e.SEQUENCE="sequence",e.THUMBNAIL_NAV="thumbnail-nav",e.TOGETHER="together",e.UNORDERED="unordered"}(o||(o={})),function(e){e.CANVAS="canvas",e.CHOICE="choice",e.CONTENT_AS_TEXT="contentastext",e.DATASET="dataset",e.DOCUMENT="document",e.IMAGE="image",e.MODEL="model",e.MOVING_IMAGE="movingimage",e.PDF="pdf",e.PHYSICAL_OBJECT="physicalobject",e.SOUND="sound",e.TEXT="text",e.TEXTUALBODY="textualbody",e.VIDEO="video"}(s||(s={})),function(e){e.ANNOTATION="annotation",e.CANVAS="canvas",e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range",e.SEQUENCE="sequence"}(a||(a={})),function(e){e.AUDIO_MP4="audio/mp4",e.CORTO="application/corto",e.DRACO="application/draco",e.EPUB="application/epub+zip",e.GLTF="model/gltf+json",e.JPG="image/jpeg",e.M3U8="application/vnd.apple.mpegurl",e.MP3="audio/mp3",e.MPEG_DASH="application/dash+xml",e.OBJ="text/plain",e.OPF="application/oebps-package+xml",e.PDF="application/pdf",e.PLY="application/ply",e.THREEJS="application/vnd.threejs+json",e.VIDEO_MP4="video/mp4",e.WEBM="video/webm"}(l||(l={})),function(e){e.DOC="application/msword",e.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.PDF="application/pdf"}(u||(u={})),function(e){e.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",e.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",e.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",e.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",e.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",e.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",e.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",e.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",e.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",e.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",e.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",e.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",e.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",e.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",e.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",e.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",e.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",e.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",e.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",e.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",e.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",e.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",e.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",e.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",e.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",e.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",e.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",e.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",e.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",e.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",e.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",e.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",e.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",e.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",e.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",e.SEARCH_0="http://iiif.io/api/search/0/search",e.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",e.SEARCH_1="http://iiif.io/api/search/1/search",e.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",e.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",e.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",e.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",e.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",e.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",e.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(h||(h={})),function(e){e.BOTTOM_TO_TOP="bottom-to-top",e.LEFT_TO_RIGHT="left-to-right",e.RIGHT_TO_LEFT="right-to-left",e.TOP_TO_BOTTOM="top-to-bottom"}(c||(c={})),function(e){e.CONTINUOUS="continuous",e.INDIVIDUALS="individuals",e.NON_PAGED="non-paged",e.PAGED="paged",e.TOP="top"}(p||(p={}));var T=function(){function e(){}return e.manifestNotLoaded="Manifest has not loaded yet",e}(),m=function(){function e(e){this.options=e,this.iiifResource=this.options.iiifResource,this.manifestUri=this.options.manifestUri,this.manifest=this.options.manifest,this.collectionIndex=this.options.collectionIndex||0,this.manifestIndex=this.options.manifestIndex||0,this.sequenceIndex=this.options.sequenceIndex||0,this.canvasIndex=this.options.canvasIndex||0}return e.prototype.getAutoCompleteService=function(){var e=this.getSearchService(),t=null;return e&&((t=e.getService(h.SEARCH_0_AUTO_COMPLETE))||(t=e.getService(h.SEARCH_1_AUTO_COMPLETE))),t},e.prototype.getAttribution=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);var e=this.manifest.getAttribution();return e?_.LanguageMap.getValue(e,this.options.locale):null},e.prototype.getCanvases=function(){return this.getCurrentSequence().getCanvases()},e.prototype.getCanvasById=function(e){return this.getCurrentSequence().getCanvasById(e)},e.prototype.getCanvasesById=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],r=this.getCanvasById(n);r&&t.push(r)}return t},e.prototype.getCanvasByIndex=function(e){return this.getCurrentSequence().getCanvasByIndex(e)},e.prototype.getCanvasIndexById=function(e){return this.getCurrentSequence().getCanvasIndexById(e)},e.prototype.getCanvasIndexByLabel=function(e){var t=this.getManifestType()===_.ManifestType.MANUSCRIPT;return this.getCurrentSequence().getCanvasIndexByLabel(e,t)},e.prototype.getCanvasRange=function(e,t){var i=this.getCanvasRanges(e);if(t){for(var n=0;n<i.length;n++){var r=i[n];if(r.path===t)return r}return null}return i[0]},e.prototype.getCanvasRanges=function(e){if(!this.manifest)throw new Error(T.manifestNotLoaded);return e.ranges||(e.ranges=this.manifest.getAllRanges().filter((function(t){return t.getCanvasIds().some((function(t){return _.Utils.normaliseUrl(t)===_.Utils.normaliseUrl(e.id)}))}))),e.ranges},e.prototype.getCollectionIndex=function(e){if(!e.parentCollection||e.parentCollection.parentCollection)return e.parentCollection?e.parentCollection.index:void 0},e.prototype.getCurrentCanvas=function(){return this.getCurrentSequence().getCanvasByIndex(this.canvasIndex)},e.prototype.getCurrentSequence=function(){return this.getSequenceByIndex(this.sequenceIndex)},e.prototype.getDescription=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);var e=this.manifest.getDescription();return e?_.LanguageMap.getValue(e,this.options.locale):null},e.prototype.getLabel=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);var e=this.manifest.getLabel();return e?_.LanguageMap.getValue(e,this.options.locale):null},e.prototype.getLastCanvasLabel=function(e){return this.getCurrentSequence().getLastCanvasLabel(e)},e.prototype.getFirstPageIndex=function(){return 0},e.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},e.prototype.getLicense=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);return this.manifest.getLicense()},e.prototype.getLogo=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);return this.manifest.getLogo()},e.prototype.getManifestType=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);var e=this.manifest.getManifestType();return e===_.ManifestType.EMPTY&&(e=_.ManifestType.MONOGRAPH),e},e.prototype.getMetadata=function(e){if(!this.manifest)throw new Error(T.manifestNotLoaded);var t=[],i=this.manifest.getMetadata(),n=new v(this.manifest),r=this.options.locale;i&&i.length&&n.addMetadata(i,!0),this.manifest.getDescription().length&&((o=new _.LabelValuePair(r)).label=[new _.Language("description",r)],o.value=this.manifest.getDescription(),o.isRootLevel=!0,n.addItem(o)),this.manifest.getAttribution().length&&((o=new _.LabelValuePair(r)).label=[new _.Language("attribution",r)],o.value=this.manifest.getAttribution(),o.isRootLevel=!0,n.addItem(o));var o,s=this.manifest.getLicense();if(s){var a={label:"license",value:e&&e.licenseFormatter?e.licenseFormatter.format(s):s};(o=new _.LabelValuePair(r)).parse(a),o.isRootLevel=!0,n.addItem(o)}return this.manifest.getLogo()&&(a={label:"logo",value:'<img src="'+this.manifest.getLogo()+'"/>'},(o=new _.LabelValuePair(r)).parse(a),o.isRootLevel=!0,n.addItem(o)),t.push(n),e?this._parseMetadataOptions(e,t):t},e.prototype.getRequiredStatement=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);var e=this.manifest.getRequiredStatement();return e?{label:e.getLabel(),value:e.getValue()}:null},e.prototype._parseMetadataOptions=function(e,t){var i=this.getCurrentSequence(),n=i.getMetadata();if(n&&n.length){var r=new v(i);r.addMetadata(n),t.push(r)}if(e.range){var o=this._getRangeMetadata([],e.range);o=o.reverse(),t=t.concat(o)}if(e.canvases&&e.canvases.length)for(var s=0;s<e.canvases.length;s++){var a=e.canvases[s],l=a.getMetadata();if(l&&l.length){var u=new v(a);u.addMetadata(a.getMetadata()),t.push(u)}for(var h=a.getImages(),c=0;c<h.length;c++){var p=h[c],d=p.getMetadata();if(d&&d.length){var f=new v(p);f.addMetadata(d),t.push(f)}}}return t},e.prototype._getRangeMetadata=function(e,t){var i=t.getMetadata();if(i&&i.length){var n=new v(t);n.addMetadata(i),e.push(n)}else if(t.parentRange)return this._getRangeMetadata(e,t.parentRange);return e},e.prototype.getMultiSelectState=function(){return this._multiSelectState||(this._multiSelectState=new E,this._multiSelectState.ranges=this.getRanges().slice(0),this._multiSelectState.canvases=this.getCurrentSequence().getCanvases().slice(0)),this._multiSelectState},e.prototype.getCurrentRange=function(){return this.rangeId?this.getRangeById(this.rangeId):null},e.prototype.getPosterCanvas=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);return this.manifest.getPosterCanvas()},e.prototype.getPosterImage=function(){var e=this.getPosterCanvas();if(e){var t=e.getContent();if(t&&t.length)return t[0].getBody()[0].id}return null},e.prototype.getPreviousRange=function(e){var t;if(t=e||this.getCurrentRange()){var i=this.getFlattenedTree();if(i)for(var n=0;n<i.length;n++){var r=i[n];if(r&&r.data.id===t.id){for(;n>0;)return i[--n].data;break}}}return null},e.prototype.getNextRange=function(e){var t;if(t=e||this.getCurrentRange()){var i=this.getFlattenedTree();if(i)for(var n=0;n<i.length;n++){var r=i[n];if(r&&r.data.id===t.id){for(;n<i.length-1;){var o=i[++n];if(o.data.canvases&&o.data.canvases.length)return o.data}break}}}return null},e.prototype.getFlattenedTree=function(e){var t;return(t=e||this.getTree())?this._flattenTree(t,"nodes"):null},e.prototype._flattenTree=function(e,t){var i=this,n=[e];return e[t]&&e[t].length>0?n.concat(e[t].map((function(e){return i._flattenTree(e,t)})).reduce((function(e,t){return e.concat(t)}),[])):n},e.prototype.getRanges=function(){return this.manifest.getAllRanges()},e.prototype.getRangeByPath=function(e){if(!this.manifest)throw new Error(T.manifestNotLoaded);return this.manifest.getRangeByPath(e)},e.prototype.getRangeById=function(e){if(!this.manifest)throw new Error(T.manifestNotLoaded);return this.manifest.getRangeById(e)},e.prototype.getRangeCanvases=function(e){var t=e.getCanvasIds();return this.getCanvasesById(t)},e.prototype.getRelated=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);return this.manifest.getRelated()},e.prototype.getSearchService=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);var e=this.manifest.getService(h.SEARCH_0);return e||(e=this.manifest.getService(h.SEARCH_1)),e},e.prototype.getSeeAlso=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);return this.manifest.getSeeAlso()},e.prototype.getSequenceByIndex=function(e){if(!this.manifest)throw new Error(T.manifestNotLoaded);return this.manifest.getSequenceByIndex(e)},e.prototype.getShareServiceUrl=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);var e=null,t=this.manifest.getService(h.SHARE_EXTENSIONS);return t&&(t.length&&(t=t[0]),e=t.__jsonld.shareUrl),e},e.prototype._getSortedTreeNodesByDate=function(e,t){var i=this.getFlattenedTree(t);if(i){var n=i.filter((function(e){return e.data.type===_.TreeNodeType.MANIFEST}));this.createDecadeNodes(e,i),this.sortDecadeNodes(e),this.createYearNodes(e,i),this.sortYearNodes(e),this.createMonthNodes(e,n),this.sortMonthNodes(e),this.createDateNodes(e,n),this.pruneDecadeNodes(e)}},e.prototype.getStartCanvasIndex=function(){return this.getCurrentSequence().getStartCanvasIndex()},e.prototype.getThumbs=function(e,t){return this.getCurrentSequence().getThumbs(e,t)},e.prototype.getTopRanges=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);return this.manifest.getTopRanges()},e.prototype.getTotalCanvases=function(){return this.getCurrentSequence().getTotalCanvases()},e.prototype.getTrackingLabel=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);return this.manifest.getTrackingLabel()},e.prototype._getTopRanges=function(){return this.iiifResource.getTopRanges()},e.prototype.getTree=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=n.NONE),!this.iiifResource)return null;var i;if(this.iiifResource.isCollection())i=this.iiifResource.getDefaultTree();else{var r=this._getTopRanges(),o=new _.TreeNode;if(o.label="root",o.data=this.iiifResource,!r.length)return o;i=r[e].getTree(o)}var s=new _.TreeNode;switch(t.toString()){case n.DATE.toString():if(this.treeHasNavDates(i)){this._getSortedTreeNodesByDate(s,i);break}default:s=i}return s},e.prototype.treeHasNavDates=function(e){var t=this.getFlattenedTree(e);return!!t&&t.some((function(e){return!isNaN(e.navDate)}))},e.prototype.getViewingDirection=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);var e=this.getCurrentSequence().getViewingDirection();return e||(e=this.manifest.getViewingDirection()),e},e.prototype.getViewingHint=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);var e=this.getCurrentSequence().getViewingHint();return e||(e=this.manifest.getViewingHint()),e},e.prototype.hasParentCollection=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);return!!this.manifest.parentCollection},e.prototype.hasRelatedPage=function(){var e=this.getRelated();return!!e&&(e.length&&(e=e[0]),"text/html"===e.format)},e.prototype.hasResources=function(){return this.getCurrentCanvas().getResources().length>0},e.prototype.isBottomToTop=function(){var e=this.getViewingDirection();return!!e&&e===c.BOTTOM_TO_TOP},e.prototype.isCanvasIndexOutOfRange=function(e){return this.getCurrentSequence().isCanvasIndexOutOfRange(e)},e.prototype.isContinuous=function(){var e=this.getViewingHint();return!!e&&e===p.CONTINUOUS},e.prototype.isFirstCanvas=function(e){return void 0!==e?this.getCurrentSequence().isFirstCanvas(e):this.getCurrentSequence().isFirstCanvas(this.canvasIndex)},e.prototype.isHorizontallyAligned=function(){return this.isLeftToRight()||this.isRightToLeft()},e.prototype.isLastCanvas=function(e){return void 0!==e?this.getCurrentSequence().isLastCanvas(e):this.getCurrentSequence().isLastCanvas(this.canvasIndex)},e.prototype.isLeftToRight=function(){var e=this.getViewingDirection();return!!e&&e===c.LEFT_TO_RIGHT},e.prototype.isMultiCanvas=function(){return this.getCurrentSequence().isMultiCanvas()},e.prototype.isMultiSequence=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);return this.manifest.isMultiSequence()},e.prototype.isPaged=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);var e=this.getViewingHint();return e?e===p.PAGED:this.manifest.isPagingEnabled()},e.prototype.isPagingAvailable=function(){return this.isPagingEnabled()&&this.getTotalCanvases()>2},e.prototype.isPagingEnabled=function(){if(!this.manifest)throw new Error(T.manifestNotLoaded);return this.manifest.isPagingEnabled()||this.getCurrentSequence().isPagingEnabled()},e.prototype.isRightToLeft=function(){var e=this.getViewingDirection();return!!e&&e===c.RIGHT_TO_LEFT},e.prototype.isTopToBottom=function(){var e=this.getViewingDirection();return!!e&&e===c.TOP_TO_BOTTOM},e.prototype.isTotalCanvasesEven=function(){return this.getCurrentSequence().isTotalCanvasesEven()},e.prototype.isUIEnabled=function(e){if(!this.manifest)throw new Error(T.manifestNotLoaded);var t=this.manifest.getService(h.UI_EXTENSIONS);if(t){var i=t.getProperty("disableUI");if(i&&(-1!==i.indexOf(e)||-1!==i.indexOf(e.toLowerCase())))return!1}return!0},e.prototype.isVerticallyAligned=function(){return this.isTopToBottom()||this.isBottomToTop()},e.prototype.createDateNodes=function(e,t){for(var i=0;i<t.length;i++){var n=t[i],r=this.getNodeYear(n),o=this.getNodeMonth(n),s=new _.TreeNode;s.id=n.id,s.label=this.getNodeDisplayDate(n),s.data=n.data,s.data.type=_.TreeNodeType.MANIFEST,s.data.year=r,s.data.month=o;var a=this.getDecadeNode(e,r);if(a){var l=this.getYearNode(a,r);if(l){var u=this.getMonthNode(l,o);u&&u.addNode(s)}}}},e.prototype.createDecadeNodes=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];if(n.navDate){var r=this.getNodeYear(n),o=Number(r.toString().substr(0,3)+"9");if(!this.getDecadeNode(e,r)){var s=new _.TreeNode;s.label=r+" - "+o,s.navDate=n.navDate,s.data.startYear=r,s.data.endYear=o,e.addNode(s)}}}},e.prototype.createMonthNodes=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];if(n.navDate){var r=this.getNodeYear(n),o=this.getNodeMonth(n),s=this.getDecadeNode(e,r),a=null;if(s&&(a=this.getYearNode(s,r)),s&&a&&!this.getMonthNode(a,o)){var l=new _.TreeNode;l.label=this.getNodeDisplayMonth(n),l.navDate=n.navDate,l.data.year=r,l.data.month=o,a.addNode(l)}}}},e.prototype.createYearNodes=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];if(n.navDate){var r=this.getNodeYear(n),o=this.getDecadeNode(e,r);if(o&&!this.getYearNode(o,r)){var s=new _.TreeNode;s.label=r.toString(),s.navDate=n.navDate,s.data.year=r,o.addNode(s)}}}},e.prototype.getDecadeNode=function(e,t){for(var i=0;i<e.nodes.length;i++){var n=e.nodes[i];if(t>=n.data.startYear&&t<=n.data.endYear)return n}return null},e.prototype.getMonthNode=function(e,t){for(var i=0;i<e.nodes.length;i++){var n=e.nodes[i];if(t===this.getNodeMonth(n))return n}return null},e.prototype.getNodeDisplayDate=function(e){return e.navDate.toDateString()},e.prototype.getNodeDisplayMonth=function(e){return["January","February","March","April","May","June","July","August","September","October","November","December"][e.navDate.getMonth()]},e.prototype.getNodeMonth=function(e){return e.navDate.getMonth()},e.prototype.getNodeYear=function(e){return e.navDate.getFullYear()},e.prototype.getYearNode=function(e,t){for(var i=0;i<e.nodes.length;i++){var n=e.nodes[i];if(t===this.getNodeYear(n))return n}return null},e.prototype.pruneDecadeNodes=function(e){for(var t=[],i=0;i<e.nodes.length;i++){var n=e.nodes[i];n.nodes.length||t.push(n)}for(var r=0;r<t.length;r++){var o=t[r],s=e.nodes.indexOf(o);s>-1&&e.nodes.splice(s,1)}},e.prototype.sortDecadeNodes=function(e){e.nodes=e.nodes.sort((function(e,t){return e.data.startYear-t.data.startYear}))},e.prototype.sortMonthNodes=function(e){for(var t=this,i=0;i<e.nodes.length;i++)for(var n=e.nodes[i],r=0;r<n.nodes.length;r++){var o=n.nodes[r];o.nodes=o.nodes.sort((function(e,i){return t.getNodeMonth(e)-t.getNodeMonth(i)}))}},e.prototype.sortYearNodes=function(e){for(var t=this,i=0;i<e.nodes.length;i++){var n=e.nodes[i];n.nodes=n.nodes.sort((function(e,i){return t.getNodeYear(e)-t.getNodeYear(i)}))}},e}(),y=function(){function e(e){this._options=e,this._options.locale=this._options.locale||"en-GB"}return e.prototype.bootstrap=function(e,t){var i=this;return new Promise((function(n,r){e&&t&&(n=e,r=t),_.Utils.loadManifest(i._options.manifestUri).then((function(e){i._loaded(i,e,n,r)}))}))},e.prototype._loaded=function(e,t,i,n){var r=_.Utils.parseManifest(t,{locale:e._options.locale});if(r){e._options.iiifResource||(e._options.iiifResource=r);var o=e._options.collectionIndex,s=e._options.manifestIndex;if(r.getIIIFResourceType()===a.COLLECTION){var l=r.getManifests(),u=r.getCollections();l.length||void 0!==o||(o=0),void 0!==o&&u&&u.length?r.getCollectionByIndex(o).then((function(t){t||n("Collection index not found"),0===t.getTotalManifests()&&0===s&&t.getTotalCollections()>0?(e._options.collectionIndex=0,e._options.manifestUri=t.id,e.bootstrap(i,n)):void 0!==s&&t.getManifestByIndex(s).then((function(t){e._options.manifest=t;var n=new m(e._options);i(n)}))})):r.getManifestByIndex(e._options.manifestIndex).then((function(t){e._options.manifest=t;var n=new m(e._options);i(n)}))}else{e._options.manifest=r;var h=new m(e._options);i(h)}}else console.error("Unable to load IIIF resource")},e}(),I=i(1),O=function(){function e(e,t){this.authHoldingPage=null,this.clickThroughService=null,this.externalService=null,this.isProbed=!1,this.isResponseHandled=!1,this.kioskService=null,this.loginService=null,this.logoutService=null,this.probeService=null,this.restrictedService=null,this.tokenService=null,e.externalResource=this,this.dataUri=this._getDataUri(e),this.index=e.index,this.authAPIVersion=t.authApiVersion,this._parseAuthServices(e),this._parseCanvasDimensions(e)}return e.prototype._getImageServiceDescriptor=function(e){for(var t=null,i=0;i<e.length;i++){var n=e[i],r=n.id;r.endsWith("/")||(r+="/"),_.Utils.isImageProfile(n.getProfile())&&(t=r+"info.json")}return t},e.prototype._getDataUri=function(e){var t=e.getContent(),i=e.getImages(),n=null;if(t&&t.length){var r=t[0].getBody();return r.length?(o=r[0].getServices()).length&&(n=this._getImageServiceDescriptor(o))?n:r[0].id:null}if(i&&i.length){var o,s=i[0].getResource();return(o=s.getServices()).length&&(n=this._getImageServiceDescriptor(o))?n:s.id}var a=e.getService(h.IXIF);return a?a.getInfoUri():e.id},e.prototype._parseAuthServices=function(e){if(.9===this.authAPIVersion)this.clickThroughService=_.Utils.getService(e,h.AUTH_0_CLICK_THROUGH),this.loginService=_.Utils.getService(e,h.AUTH_0_LOGIN),this.restrictedService=_.Utils.getService(e,h.AUTH_0_RESTRICTED),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(h.AUTH_0_LOGOUT),this.tokenService=this.clickThroughService.getService(h.AUTH_0_TOKEN)):this.loginService?(this.logoutService=this.loginService.getService(h.AUTH_0_LOGOUT),this.tokenService=this.loginService.getService(h.AUTH_0_TOKEN)):this.restrictedService&&(this.logoutService=this.restrictedService.getService(h.AUTH_0_LOGOUT),this.tokenService=this.restrictedService.getService(h.AUTH_0_TOKEN));else{if(void 0!==e.isCanvas&&e.isCanvas()){var t=e.getContent();if(t&&t.length){var i=t[0].getBody();i&&i.length&&(e=i[0])}}this.clickThroughService=_.Utils.getService(e,h.AUTH_1_CLICK_THROUGH),this.loginService=_.Utils.getService(e,h.AUTH_1_LOGIN),this.externalService=_.Utils.getService(e,h.AUTH_1_EXTERNAL),this.kioskService=_.Utils.getService(e,h.AUTH_1_KIOSK),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(h.AUTH_1_LOGOUT),this.tokenService=this.clickThroughService.getService(h.AUTH_1_TOKEN),this.probeService=this.clickThroughService.getService(h.AUTH_1_PROBE)):this.loginService?(this.logoutService=this.loginService.getService(h.AUTH_1_LOGOUT),this.tokenService=this.loginService.getService(h.AUTH_1_TOKEN),this.probeService=this.loginService.getService(h.AUTH_1_PROBE)):this.externalService?(this.logoutService=this.externalService.getService(h.AUTH_1_LOGOUT),this.tokenService=this.externalService.getService(h.AUTH_1_TOKEN),this.probeService=this.externalService.getService(h.AUTH_1_PROBE)):this.kioskService&&(this.logoutService=this.kioskService.getService(h.AUTH_1_LOGOUT),this.tokenService=this.kioskService.getService(h.AUTH_1_TOKEN),this.probeService=this.kioskService.getService(h.AUTH_1_PROBE))}},e.prototype._parseCanvasDimensions=function(e){var t=e.getImages();if(t&&t.length){var i=t[0].getResource();this.width=i.getWidth(),this.height=i.getHeight()}else if((t=e.getContent()).length){var n=t[0].getBody();n.length&&(this.width=n[0].getWidth(),this.height=n[0].getHeight())}},e.prototype._parseDescriptorDimensions=function(e){void 0!==e.width&&(this.width=e.width),void 0!==e.height&&(this.height=e.height)},e.prototype.isAccessControlled=function(){return!!(this.clickThroughService||this.loginService||this.externalService||this.kioskService||this.probeService)},e.prototype.hasServiceDescriptor=function(){return!!this.dataUri&&this.dataUri.endsWith("info.json")},e.prototype.getData=function(e){var t=this;return t.data={},new Promise((function(i,n){if(t.dataUri)if(t.probeService){t.isProbed=!0;var r=new XMLHttpRequest;r.open("GET",t.probeService.id,!0),r.withCredentials=!0,r.onload=function(){var e=JSON.parse(r.responseText);unescape(e.contentLocation)!==t.dataUri?t.status=I.MOVED_TEMPORARILY:t.status=I.OK,i(t)},r.onerror=function(){t.status=r.status,i(t)},r.send()}else{var o="GET";if(!t.hasServiceDescriptor()){if(!t.isAccessControlled())return t.status=I.OK,void i(t);o="HEAD"}var s=new XMLHttpRequest;s.open(o,t.dataUri,!0),e&&s.setRequestHeader("Authorization","Bearer "+e.accessToken),s.onload=function(){var e=JSON.parse(s.responseText);if(e){var n=unescape(e["@id"]);t.data=e,t._parseAuthServices(t.data),t._parseDescriptorDimensions(t.data),n.endsWith("/info.json")&&(n=n.substr(0,n.lastIndexOf("/")));var r=t.dataUri;r&&r.endsWith("/info.json")&&(r=r.substr(0,r.lastIndexOf("/"))),n!==r&&t.loginService?t.status=I.MOVED_TEMPORARILY:t.status=I.OK,i(t)}else t.status=I.OK,i(t)},s.onerror=function(){t.status=s.status,s.responseText&&t._parseAuthServices(JSON.parse(s.responseText)),i(t)},s.send()}else n("There is no dataUri to fetch")}))},e}(),b=function(){},N=function(){},A=function(e,t){this.value=e,this.locale=t},S=function(){function e(e){this.labels=e}return e.prototype.format=function(e){return-1!=e.indexOf("<a")?e:'<a href="'+e+'">'+(this.labels[e]?this.labels[e]:e)+"</a>"},e}();i.d(t,"loadManifest",(function(){return L})),i.d(t,"AnnotationGroup",(function(){return g})),i.d(t,"AnnotationRect",(function(){return f})),i.d(t,"Bootstrapper",(function(){return y})),i.d(t,"ExternalResource",(function(){return O})),i.d(t,"Helper",(function(){return m})),i.d(t,"ILabelValuePair",(function(){return b})),i.d(t,"MetadataGroup",(function(){return v})),i.d(t,"MetadataOptions",(function(){return N})),i.d(t,"MultiSelectState",(function(){return E})),i.d(t,"Translation",(function(){return A})),i.d(t,"TreeSortType",(function(){return n})),i.d(t,"UriLabeller",(function(){return S}));var L=function(e){return new y(e).bootstrap()}}])},"object"==typeof e&&"object"==typeof t?t.exports=r():"function"==typeof define&&i.amdO?define("IIIFTreeComponent",[],r):"object"==typeof e?e.IIIFTreeComponent=r():n.IIIFTreeComponent=r()})),h=class{constructor(e){this.value=e}toString(){return this.value}},c=h;c.image=new h("image"),c.page=new h("page");var p,d,f,g,_,E,v,T,m,y,I=class{},O=I;O.namespace="openseadragonExtension.",O.CURRENT_VIEW_URI=I.namespace+"currentViewUri",O.DOUBLECLICK=I.namespace+"doubleClick",O.IMAGE_SEARCH=I.namespace+"imageSearch",O.MODE_CHANGE=I.namespace+"modeChange",O.NEXT_SEARCH_RESULT=I.namespace+"nextSearchResult",O.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE=I.namespace+"nextImagesSearchResultUnavailable",O.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE=I.namespace+"prevImagesSearchResultUnavailable",O.PAGE_SEARCH=I.namespace+"pageSearch",O.PAGING_TOGGLED=I.namespace+"pagingToggled",O.PREV_SEARCH_RESULT=I.namespace+"prevSearchResult",O.PRINT=I.namespace+"print",O.ROTATE=I.namespace+"rotate",O.OPENSEADRAGON_ANIMATION_FINISH=I.namespace+"animationFinish",O.OPENSEADRAGON_ANIMATION_START=I.namespace+"animationStart",O.OPENSEADRAGON_ANIMATION=I.namespace+"animation",O.OPENSEADRAGON_OPEN=I.namespace+"open",O.OPENSEADRAGON_RESIZE=I.namespace+"resize",O.OPENSEADRAGON_ROTATION=I.namespace+"rotationChange",O.SEARCH_PREVIEW_FINISH=I.namespace+"searchPreviewFinish",O.SEARCH_PREVIEW_START=I.namespace+"searchPreviewStart",O.SEARCH=I.namespace+"search",O.XYWH_CHANGE=I.namespace+"xywhChange",O.ZOOM_IN=I.namespace+"zoomIn",O.ZOOM_OUT=I.namespace+"zoomOut",(d=p||(p={})).BOOKMARKING="oa:bookmarking",d.CLASSIFYING="oa:classifying",d.COMMENTING="oa:commenting",d.DESCRIBING="oa:describing",d.EDITING="oa:editing",d.HIGHLIGHTING="oa:highlighting",d.IDENTIFYING="oa:identifying",d.LINKING="oa:linking",d.MODERATING="oa:moderating",d.PAINTING="sc:painting",d.QUESTIONING="oa:questioning",d.REPLYING="oa:replying",d.TAGGING="oa:tagging",d.TRANSCRIBING="oad:transcribing",function(e){e.AUTO_ADVANCE="auto-advance",e.CONTINUOUS="continuous",e.FACING_PAGES="facing-pages",e.HIDDEN="hidden",e.INDIVIDUALS="individuals",e.MULTI_PART="multi-part",e.NO_NAV="no-nav",e.NON_PAGED="non-paged",e.PAGED="paged",e.REPEAT="repeat",e.SEQUENCE="sequence",e.THUMBNAIL_NAV="thumbnail-nav",e.TOGETHER="together",e.UNORDERED="unordered"}(f||(f={})),function(e){e.CANVAS="canvas",e.CHOICE="choice",e.CONTENT_AS_TEXT="contentastext",e.DOCUMENT="document",e.IMAGE="image",e.MOVING_IMAGE="movingimage",e.PDF="pdf",e.PHYSICAL_OBJECT="physicalobject",e.SOUND="sound",e.TEXTUALBODY="textualbody",e.VIDEO="video"}(g||(g={})),function(e){e.ANNOTATION="annotation",e.CANVAS="canvas",e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range",e.SEQUENCE="sequence"}(_||(_={})),function(e){e.AUDIO_MP4="audio/mp4",e.CORTO="application/corto",e.DRACO="application/draco",e.GLTF="model/gltf+json",e.JPG="image/jpeg",e.M3U8="application/vnd.apple.mpegurl",e.MP3="audio/mp3",e.MPEG_DASH="application/dash+xml",e.OBJ="text/plain",e.PDF="application/pdf",e.PLY="application/ply",e.THREEJS="application/vnd.threejs+json",e.VIDEO_MP4="video/mp4",e.WEBM="video/webm"}(E||(E={})),function(e){e.DOC="application/msword",e.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.PDF="application/pdf"}(v||(v={})),function(e){e.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",e.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",e.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",e.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",e.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",e.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",e.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",e.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",e.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",e.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",e.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",e.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",e.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",e.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",e.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",e.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",e.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",e.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",e.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",e.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",e.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",e.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",e.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",e.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",e.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",e.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",e.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",e.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",e.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",e.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",e.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",e.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",e.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",e.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",e.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",e.SEARCH_0="http://iiif.io/api/search/0/search",e.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",e.SEARCH_1="http://iiif.io/api/search/1/search",e.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",e.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",e.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",e.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",e.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",e.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",e.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(T||(T={})),function(e){e.BOTTOM_TO_TOP="bottom-to-top",e.LEFT_TO_RIGHT="left-to-right",e.RIGHT_TO_LEFT="right-to-left",e.TOP_TO_BOTTOM="top-to-bottom"}(m||(m={})),function(e){e.CONTINUOUS="continuous",e.INDIVIDUALS="individuals",e.NON_PAGED="non-paged",e.PAGED="paged",e.TOP="top"}(y||(y={}));var b=function(){function e(e){this.options=e,this.options.data=Object.assign({},this.data(),e.data)}return e.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},e.prototype.data=function(){return{}},e.prototype.on=function(e,t,i){var n=this._e||(this._e={});(n[e]||(n[e]=[])).push({fn:t,ctx:i})},e.prototype.fire=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];for(var n=[].slice.call(arguments,1),r=((this._e||(this._e={}))[e]||[]).slice(),o=0,s=r.length;o<s;o++)r[o].fn.apply(r[o].ctx,n)},e.prototype._resize=function(){},e.prototype.set=function(e){},e}(),N=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),A=function(e){function t(t){var i=e.call(this,t)||this;return i._data=i.data(),i._data=i.options.data,i._init(),i._resize(),i}return N(t,e),t.prototype._init=function(){var t=this;e.prototype._init.call(this),this._$element=$(this.el),this._$header=$('<div class="header"></div>'),this._$element.append(this._$header),this._$leftOptions=$('<div class="left"></div>'),this._$header.append(this._$leftOptions),this._$rightOptions=$('<div class="right"></div>'),this._$header.append(this._$rightOptions),this._$sizeDownButton=$('<input class="btn btn-default size-down" type="button" value="-" />'),this._$leftOptions.append(this._$sizeDownButton),this._$sizeRange=$('<input type="range" name="size" min="1" max="10" value="'+this.options.data.initialZoom+'" />'),this._$leftOptions.append(this._$sizeRange),this._$sizeUpButton=$('<input class="btn btn-default size-up" type="button" value="+" />'),this._$leftOptions.append(this._$sizeUpButton),this._$multiSelectOptions=$('<div class="multiSelectOptions"></div>'),this._$rightOptions.append(this._$multiSelectOptions),this._$selectAllButton=$('<div class="multiSelectAll"><input id="multiSelectAll" type="checkbox" tabindex="0" /><label for="multiSelectAll">'+this.options.data.content.selectAll+"</label></div>"),this._$multiSelectOptions.append(this._$selectAllButton),this._$selectAllButtonCheckbox=$(this._$selectAllButton.find("input:checkbox")),this._$selectButton=$('<a class="select" href="#">'+this.options.data.content.select+"</a>"),this._$multiSelectOptions.append(this._$selectButton),this._$main=$('<div class="main"></div>'),this._$element.append(this._$main),this._$thumbs=$('<div class="thumbs"></div>'),this._$main.append(this._$thumbs),this._$sizeDownButton.on("click",(function(){var e=Number(t._$sizeRange.val())-1;e>=Number(t._$sizeRange.attr("min"))&&(t._$sizeRange.val(e.toString()),t._$sizeRange.trigger("change"),t.fire(S.DECREASE_SIZE))})),this._$sizeUpButton.on("click",(function(){var e=Number(t._$sizeRange.val())+1;e<=Number(t._$sizeRange.attr("max"))&&(t._$sizeRange.val(e.toString()),t._$sizeRange.trigger("change"),t.fire(S.INCREASE_SIZE))})),this._$sizeRange.on("change",(function(){t._updateThumbs(),t._scrollToThumb(t._getSelectedThumbIndex())})),this._$selectAllButton.checkboxButton((function(e){var i=t._getMultiSelectState();i&&(e?i.selectAll(!0):i.selectAll(!1)),t.set(t.options.data)})),this._$selectButton.on("click",(function(){var e=t._getMultiSelectState();if(e){var i=e.getAllSelectedCanvases().map((function(e){return e.id}));t.fire(S.MULTISELECTION_MADE,i)}})),this._setRange(),$.templates({galleryThumbsTemplate:'\t\t\t\t<div class="{{:~galleryThumbClassName()}}" data-src="{{>uri}}" data-index="{{>index}}" data-visible="{{>visible}}" data-width="{{>width}}" data-height="{{>height}}" data-initialwidth="{{>initialWidth}}" data-initialheight="{{>initialHeight}}">\t\t\t\t\t\t<div class="wrap" style="width:{{>initialWidth}}px; height:{{>initialHeight}}px" data-link="class{merge:multiSelected toggle=\'multiSelected\'}">\t\t\t\t\t\t{^{if multiSelectEnabled}}\t\t\t\t\t\t\t\t<input id="thumb-checkbox-{{>id}}" type="checkbox" data-link="checked{:multiSelected ? \'checked\' : \'\'}" class="multiSelect" />\t\t\t\t\t\t{{/if}}\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="info">\t\t\t\t\t\t\t\t<span class="index" style="width:{{>initialWidth}}px">{{:#index + 1}}</span>\t\t\t\t\t\t\t\t<span class="label" style="width:{{>initialWidth}}px" title="{{>label}}">{{>label}}&nbsp;</span>\t\t\t\t\t\t\t\t<span class="searchResults" title="{{:~galleryThumbSearchResultsTitle()}}">{{>data.searchResults}}</span>\t\t\t\t\t\t</div>\t\t\t\t</div>'});var i=this;return $.views.helpers({galleryThumbClassName:function(){var e="thumb preLoad";return 0===this.data.index&&(e+=" first"),this.data.uri||(e+=" placeholder"),e},galleryThumbSearchResultsTitle:function(){var e=Number(this.data.data.searchResults);return e?e>1?s.n.format(i.options.data.content.searchResults,e.toString()):s.n.format(i.options.data.content.searchResult,e.toString()):null}}),this._$main.on("scroll",(function(){t._updateThumbs()}),this.options.data.scrollStopDuration),this.options.data.sizingEnabled||this._$sizeRange.hide(),!0},t.prototype.data=function(){return{chunkedResizingThreshold:400,content:{searchResult:"{0} search result",searchResults:"{0} search results",select:"Select",selectAll:"Select All"},debug:!1,helper:null,imageFadeInDuration:300,initialZoom:6,minLabelWidth:20,pageModeEnabled:!1,scrollStopDuration:100,searchResults:[],sizingEnabled:!0,thumbHeight:320,thumbLoadPadding:3,thumbWidth:200,viewingDirection:m.LEFT_TO_RIGHT}},t.prototype.set=function(e){if(this._data=Object.assign(this._data,e),this._data.helper&&void 0!==this._data.thumbWidth&&void 0!==this._data.thumbHeight&&(this._thumbs=this._data.helper.getThumbs(this._data.thumbWidth,this._data.thumbHeight)),this._data.viewingDirection&&(this._data.viewingDirection===m.BOTTOM_TO_TOP&&this._thumbs.reverse(),this._$thumbs.addClass(this._data.viewingDirection)),this._data.searchResults&&this._data.searchResults.length)for(var t=0;t<this._data.searchResults.length;t++){var i=this._data.searchResults[t],n=this._thumbs.filter((function(e){return e.index===i.canvasIndex}))[0],r=$.extend(!0,{},n.data);r.searchResults=i.rects.length,n.data=r}this._thumbsCache=null,this._createThumbs(),this._data.helper&&this.selectIndex(this._data.helper.canvasIndex);var o=this._getMultiSelectState();if(o&&o.isEnabled){this._$multiSelectOptions.show(),this._$thumbs.addClass("multiSelect");for(t=0;t<o.canvases.length;t++){var s=o.canvases[t];n=this._getThumbByCanvas(s);this._setThumbMultiSelected(n,s.multiSelected)}for(t=0;t<o.ranges.length;t++)for(var a=o.ranges[t],l=this._getThumbsByRange(a),u=0;u<l.length;u++){n=l[u];this._setThumbMultiSelected(n,a.multiSelected)}}else this._$multiSelectOptions.hide(),this._$thumbs.removeClass("multiSelect");this._update()},t.prototype._update=function(){var e=this._getMultiSelectState();e&&e.isEnabled&&(this._$selectAllButtonCheckbox.prop("checked",e.allSelected()),e.getAll().filter((function(e){return e.multiSelected})).length>0?this._$selectButton.show():this._$selectButton.hide())},t.prototype._getMultiSelectState=function(){return this._data.helper?this._data.helper.getMultiSelectState():null},t.prototype._createThumbs=function(){var e=this;if(this._thumbs){this._$thumbs.undelegate(".thumb","click"),this._$thumbs.empty();for(var t=this._getMultiSelectState(),i=[],n=0;n<this._thumbs.length;n++){var r=(u=this._thumbs[n]).width,o=u.height;u.initialWidth=r,i.push(o),u.multiSelectEnabled=!!t&&t.isEnabled}for(var a=s.g.median(i),l=0;l<this._thumbs.length;l++){var u;(u=this._thumbs[l]).initialHeight=a}if(this._$thumbs.link($.templates.galleryThumbsTemplate,this._thumbs),t&&!t.isEnabled)this._$thumbs.delegate(".thumb","click",(function(t){t.preventDefault();var i=$.view(this).data;e.fire(S.THUMB_SELECTED,i)}));else for(var h=this._$thumbs.find(".thumb"),c=function(){var e=p;$(h[d]).checkboxButton((function(t){var i=$.view(this).data;e._setThumbMultiSelected(i,!i.multiSelected);var n=e.options.data.helper.getCanvasRange(i.data),r=e._getMultiSelectState();r&&(n?r.selectRange(n,i.multiSelected):r.selectCanvas(i.data,i.multiSelected)),e._update(),e.fire(S.THUMB_MULTISELECTED,i)}))},p=this,d=0;d<h.length;d++)c()}},t.prototype._getThumbByCanvas=function(e){return this._thumbs.filter((function(t){return t.data.id===e.id}))[0]},t.prototype._sizeThumb=function(e){var t=e.data().initialwidth,i=e.data().initialheight,n=Number(t),r=Number(i),o=Math.floor(n*this._range),s=Math.floor(r*this._range),a=e.find(".wrap"),l=e.find(".label"),u=e.find(".index"),h=e.find(".searchResults"),c=o;this._data.searchResults&&this._data.searchResults.length&&(h.show(),c=o-h.outerWidth(),void 0!==this._data.minLabelWidth&&c<this._data.minLabelWidth?(h.hide(),c=o):h.show()),this._data.pageModeEnabled?(u.hide(),l.show()):(u.show(),l.hide()),a.outerWidth(o),a.outerHeight(s),u.outerWidth(c),l.outerWidth(c)},t.prototype._loadThumb=function(e,t){var i=e.find(".wrap");if(!i.hasClass("loading")&&!i.hasClass("loaded")){e.removeClass("preLoad");var n=e.attr("data-visible"),r=this._data.imageFadeInDuration||0;if("false"!==n){i.addClass("loading");var o=e.attr("data-src"),s=$('<img class="thumbImage" src="'+o+'" />');s.hide(),s.on("load",(function(){$(this).fadeIn(r,(function(){$(this).parent().switchClass("loading","loaded")}))})),i.prepend(s),t&&t(s)}else i.addClass("hidden")}},t.prototype._getThumbsByRange=function(e){var t=[];if(!this._data.helper)return t;for(var i=0;i<this._thumbs.length;i++){var n=this._thumbs[i],r=n.data,o=this._data.helper.getCanvasRange(r,e.path);o&&o.id===e.id&&t.push(n)}return t},t.prototype._updateThumbs=function(){var e=!!this._data.debug;this._setRange();var t=this._$main.scrollTop(),i=t+this._$main.height();e&&console.log("scrollTop %s, scrollBottom %s",t,i);for(var n=this._getAllThumbs(),r=0,o=0;o<n.length;o++){var s=$(n[o]),a=s.position().top,l=s.outerHeight(),u=a+l,h=l*this._data.thumbLoadPadding;a<=i+h&&u>=t-h?(r+=1,this._sizeThumb(s),s.addClass("insideScrollArea"),this._loadThumb(s)):s.removeClass("insideScrollArea")}e&&console.log("number of thumbs to update: "+r)},t.prototype._getSelectedThumbIndex=function(){return Number(this._$selectedThumb.data("index"))},t.prototype._getAllThumbs=function(){return this._thumbsCache||(this._thumbsCache=this._$thumbs.find(".thumb")),this._thumbsCache},t.prototype._getThumbByIndex=function(e){return this._$thumbs.find('[data-index="'+e+'"]')},t.prototype._scrollToThumb=function(e){var t=this._getThumbByIndex(e);this._$main.scrollTop(t.position().top)},t.prototype.selectIndex=function(e){!this._thumbs||!this._thumbs.length||(this._getAllThumbs().removeClass("selected"),this._$selectedThumb=this._getThumbByIndex(e),this._$selectedThumb.addClass("selected"),this._scrollToThumb(e),this._updateThumbs())},t.prototype._setRange=function(){var e=s.g.normalise(Number(this._$sizeRange.val()),0,10);this._range=s.g.clamp(e,.05,1)},t.prototype._setThumbMultiSelected=function(e,t){$.observable(e).setProperty("multiSelected",t)},t.prototype._resize=function(){},t}(b),S=function(){function e(){}return e.DECREASE_SIZE="decreaseSize",e.INCREASE_SIZE="increaseSize",e.MULTISELECTION_MADE="multiSelectionMade",e.THUMB_SELECTED="thumbSelected",e.THUMB_MULTISELECTED="thumbMultiSelected",e}(),L=(0,a.a)(),C=class extends r.a{constructor(e){super(e,!0,!0),this.isOpen=!1}create(){this.setConfig("contentLeftPanel"),super.create(),this.$gallery=L('<div class="iiif-gallery-component"></div>'),this.$element.append(this.$gallery)}setup(){let e=this;this.galleryComponent=new A({target:this.$gallery[0]}),this.galleryComponent.on("thumbSelected",(function(t){e.extensionHost.publish(s.p.GALLERY_THUMB_SELECTED,t),e.extensionHost.publish(s.p.THUMB_SELECTED,t)}),!1),this.galleryComponent.on("decreaseSize",(function(){e.extensionHost.publish(s.p.GALLERY_DECREASE_SIZE)}),!1),this.galleryComponent.on("increaseSize",(function(){e.extensionHost.publish(s.p.GALLERY_INCREASE_SIZE)}),!1)}databind(){this.galleryComponent.options.data=this.galleryData,this.galleryComponent.set(this.galleryData),this.resize()}show(){this.isOpen=!0,this.$element.show(),setTimeout((()=>{this.galleryComponent.selectIndex(this.extension.helper.canvasIndex)}),10)}hide(){this.isOpen=!1,this.$element.hide()}resize(){super.resize();let e=this.$gallery.find(".main"),t=this.$gallery.find(".header");e.height(this.$element.height()-t.height())}},R=(0,a.a)(),M=class extends n.a{create(){this.setConfig("contentLeftPanel"),super.create(),this.extensionHost.subscribe(O.MODE_CHANGE,(()=>{this.setLabel()})),this.extensionHost.subscribe(O.SEARCH_PREVIEW_START,(e=>{this.searchPreviewStart(e)})),this.extensionHost.subscribe(O.SEARCH_PREVIEW_FINISH,(()=>{this.searchPreviewFinish()})),this.extension.helper.isPaged()&&this.$thumbs.addClass("paged");var e=this;R.views.helpers({separator:function(){return!e.extension.helper.isPaged()||(this.data.index-1)%2!=0}})}addSelectedClassToThumbs(e){let t=this.extension.getPagedIndices(e);for(let i=0;i<t.length;i++)this.getThumbByIndex(t[i]).addClass("selected")}isPageModeEnabled(){return"function"==typeof this.extension.getMode?this.config.options.pageModeEnabled&&this.extension.getMode().toString()===c.page.toString():this.config.options.pageModeEnabled}searchPreviewStart(e){this.scrollToThumb(e),this.getThumbByIndex(e).addClass("searchpreview")}searchPreviewFinish(){this.scrollToThumb(this.extension.helper.canvasIndex),this.getAllThumbs().removeClass("searchpreview")}setLabel(){this.isPDF()?(R(this.$thumbs).find("span.index").hide(),R(this.$thumbs).find("span.label").hide()):this.isPageModeEnabled()?(R(this.$thumbs).find("span.index").hide(),R(this.$thumbs).find("span.label").show()):(R(this.$thumbs).find("span.index").show(),R(this.$thumbs).find("span.label").hide())}},P=(0,l.c)(u()),w=(0,a.a)(),x=class extends r.a{constructor(e){super(e,!0,!0),this.isOpen=!1}create(){this.setConfig("contentLeftPanel"),super.create(),this.$tree=w('<div class="iiif-tree-component"></div>'),this.$element.append(this.$tree)}setup(){let e=this;this.treeComponent=new P.TreeComponent({target:this.$tree[0],data:this.treeData}),this.treeComponent.on("treeNodeSelected",(function(t){e.extensionHost.publish(s.p.TREE_NODE_SELECTED,t)}),!1),this.treeComponent.on("treeNodeMultiSelected",(function(t){e.extensionHost.publish(s.p.TREE_NODE_MULTISELECTED,t)}),!1)}databind(){this.treeComponent.set(this.treeData),this.resize()}show(){this.isOpen=!0,this.$element.show()}hide(){this.isOpen=!1,this.$element.hide()}selectNode(e){if(!this.treeComponent.selectedNode){this.treeComponent.expandParents(e,!0);let t=this.$tree.find("#tree-link-"+e.id)[0];t&&t.scrollIntoView()}this.treeComponent.selectNode(e)}expandNode(e,t){this.treeComponent.expandNode(e,t)}getAllNodes(){return this.treeComponent.getAllNodes()}deselectCurrentNode(){this.treeComponent.deselectCurrentNode()}getNodeById(e){return this.treeComponent.getNodeById(e)}resize(){super.resize()}},D=(0,l.c)((0,o.c)()),V=(0,a.a)(),U=(0,o.a)().ViewingDirection,G=(0,o.a)().ViewingHint,H=class extends r.g{constructor(e){super(e),this.expandFullEnabled=!1,this.isThumbsViewOpen=!1,this.isTreeViewOpen=!1,this.treeSortType=o.d.NONE}create(){this.setConfig("contentLeftPanel"),super.create(),this.extensionHost.subscribe(s.p.SETTINGS_CHANGE,(()=>{this.databind()})),this.extensionHost.subscribe(s.p.GALLERY_THUMB_SELECTED,(()=>{this.collapseFull()})),this.extensionHost.subscribe(s.p.METRIC_CHANGE,(()=>{this.extension.isDesktopMetric()||this.isFullyExpanded&&this.collapseFull()})),this.extensionHost.subscribe(s.p.ANNOTATIONS,(()=>{this.databindThumbsView(),this.databindGalleryView()})),this.extensionHost.subscribe(s.p.ANNOTATIONS_CLEARED,(()=>{this.databindThumbsView(),this.databindGalleryView()})),this.extensionHost.subscribe(s.p.ANNOTATIONS_EMPTY,(()=>{this.databindThumbsView(),this.databindGalleryView()})),this.extensionHost.subscribe(s.p.CANVAS_INDEX_CHANGE,(()=>{this.isFullyExpanded&&this.collapseFull(),this.selectCurrentTreeNode(),this.updateTreeTabBySelection()})),this.extensionHost.subscribe(s.p.RANGE_CHANGE,(()=>{this.isFullyExpanded&&this.collapseFull(),this.selectCurrentTreeNode(),this.updateTreeTabBySelection()})),this.$tabs=V('<div class="tabs"></div>'),this.$main.append(this.$tabs),this.$treeButton=V('<a class="index tab" tabindex="0">'+this.content.index+"</a>"),this.$tabs.append(this.$treeButton),this.$thumbsButton=V('<a class="thumbs tab" tabindex="0">'+this.content.thumbnails+"</a>"),this.$tabs.append(this.$thumbsButton),this.$tabsContent=V('<div class="tabsContent"></div>'),this.$main.append(this.$tabsContent),this.$options=V('<div class="options"></div>'),this.$tabsContent.append(this.$options),this.$topOptions=V('<div class="top"></div>'),this.$options.append(this.$topOptions),this.$treeSelect=V('<select aria-label="'+this.content.manifestRanges+'"></select>'),this.$topOptions.append(this.$treeSelect),this.$bottomOptions=V('<div class="bottom"></div>'),this.$options.append(this.$bottomOptions),this.$leftOptions=V('<div class="left"></div>'),this.$bottomOptions.append(this.$leftOptions),this.$rightOptions=V('<div class="right"></div>'),this.$bottomOptions.append(this.$rightOptions),this.$treeViewOptions=V('<div class="treeView"></div>'),this.$leftOptions.append(this.$treeViewOptions),this.$sortByLabel=V('<span class="sort">'+this.content.sortBy+"</span>"),this.$treeViewOptions.append(this.$sortByLabel),this.$sortButtonGroup=V('<div class="btn-group"></div>'),this.$treeViewOptions.append(this.$sortButtonGroup),this.$sortByDateButton=V('<button class="btn" tabindex="0">'+this.content.date+"</button>"),this.$sortButtonGroup.append(this.$sortByDateButton),this.$sortByVolumeButton=V('<button class="btn" tabindex="0">'+this.content.volume+"</button>"),this.$sortButtonGroup.append(this.$sortByVolumeButton),this.$views=V('<div class="views"></div>'),this.$tabsContent.append(this.$views),this.$treeView=V('<div class="treeView"></div>'),this.$views.append(this.$treeView),this.$thumbsView=V('<div class="thumbsView" tabindex="-1"></div>'),this.$views.append(this.$thumbsView),this.$galleryView=V('<div class="galleryView"></div>'),this.$views.append(this.$galleryView),this.$treeSelect.hide(),this.$treeSelect.change((()=>{this.databindTreeView(),this.selectCurrentTreeNode(),this.updateTreeTabBySelection()})),this.$sortByDateButton.on("click",(()=>{this.sortByDate()})),this.$sortByVolumeButton.on("click",(()=>{this.sortByVolume()})),this.$treeViewOptions.hide(),this.onAccessibleClick(this.$treeButton,(()=>{this.openTreeView()})),this.onAccessibleClick(this.$thumbsButton,(()=>{this.openThumbsView()})),this.setTitle(this.content.title),this.$sortByVolumeButton.addClass("on");var e=this.options.tabOrder;e&&("thumbs"===(e=(e=e.toLowerCase()).replace(/ /g,"")).split(",")[0]?(this.$treeButton.before(this.$thumbsButton),this.$thumbsButton.addClass("first")):this.$treeButton.addClass("first"))}createTreeView(){this.treeView=new x(this.$treeView),this.treeView.treeData=this.getTreeData(),this.treeView.setup(),this.databindTreeView();let e=this.extension.helper.getTopRanges();if(e.length>1)for(let t=0;t<e.length;t++){let i=e[t];this.$treeSelect.append('<option value="'+i.id+'">'+D.LanguageMap.getValue(i.getLabel())+"</option>")}this.updateTreeViewOptions()}databind(){this.databindThumbsView(),this.databindTreeView(),this.databindGalleryView()}updateTreeViewOptions(){let e=this.getTree();!e||(this.isCollection()&&this.extension.helper.treeHasNavDates(e)?this.$treeViewOptions.show():this.$treeViewOptions.hide(),this.$treeSelect.find("option").length?this.$treeSelect.show():this.$treeSelect.hide())}sortByDate(){this.treeSortType=o.d.DATE,this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode(),this.$sortByDateButton.addClass("on"),this.$sortByVolumeButton.removeClass("on"),this.resize()}sortByVolume(){this.treeSortType=o.d.NONE,this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode(),this.$sortByDateButton.removeClass("on"),this.$sortByVolumeButton.addClass("on"),this.resize()}isCollection(){var e=this.getTree();if(e)return e.data.type===D.TreeNodeType.COLLECTION;throw new Error("Tree not available")}databindTreeView(){!this.treeView||(this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode())}getTreeData(){return{autoExpand:this._isTreeAutoExpanded(),branchNodesExpandOnClick:s.b.getBool(this.config.options.branchNodesExpandOnClick,!0),branchNodesSelectable:s.b.getBool(this.config.options.branchNodesSelectable,!1),helper:this.extension.helper,topRangeIndex:this.getSelectedTopRangeIndex(),treeSortType:this.treeSortType}}_isTreeAutoExpanded(){let e=s.b.getBool(this.config.options.autoExpandTreeEnabled,!1),t=this.config.options.autoExpandTreeIfFewerThan||0;if(e){let e=this.extension.helper.getFlattenedTree();if(e&&e.length<t)return!0}return!1}updateTreeTabByCanvasIndex(){let e=this.extension.helper.getTopRanges();if(e.length>1){let t=this.getCurrentCanvasTopRangeIndex();if(-1===t)return;let i=e[t];this.setTreeTabTitle(D.LanguageMap.getValue(i.getLabel()))}else this.setTreeTabTitle(this.content.index)}setTreeTabTitle(e){this.$treeButton.text(e)}updateTreeTabBySelection(){let e=null,t=this.extension.helper.getTopRanges();t.length>1&&(e=this.treeView?this.getSelectedTree().text():D.LanguageMap.getValue(t[0].getLabel())),e?this.setTreeTabTitle(e):this.setTreeTabTitle(this.content.index)}getViewingHint(){return this.extension.helper.getViewingHint()}getViewingDirection(){return this.extension.helper.getViewingDirection()}createThumbsView(){this.thumbsView=new M(this.$thumbsView),this.databindThumbsView()}databindThumbsView(){if(!this.thumbsView)return;let e,t,i=this.getViewingHint(),n=this.getViewingDirection();!n||n!==U.LEFT_TO_RIGHT&&n!==U.RIGHT_TO_LEFT?i&&i===G.PAGED?(e=this.config.options.twoColThumbWidth,t=this.config.options.twoColThumbHeight):(e=this.config.options.oneColThumbWidth,t=this.config.options.oneColThumbHeight):(e=this.config.options.twoColThumbWidth,t=this.config.options.twoColThumbHeight);let r=this.extension.helper.getThumbs(e,t);n&&n===U.BOTTOM_TO_TOP&&r.reverse();let o=this.extension.annotations;if(o&&o.length)for(let s=0;s<o.length;s++){let e=o[s],t=r.filter((t=>t.index===e.canvasIndex))[0];if(t){let i=V.extend(!0,{},t.data);i.searchResults=e.rects.length,t.data=i}}this.thumbsView.thumbs=r,this.thumbsView.databind()}createGalleryView(){this.galleryView=new C(this.$galleryView),this.galleryView.galleryData=this.getGalleryData(),this.galleryView.setup(),this.databindGalleryView()}databindGalleryView(){!this.galleryView||(this.galleryView.galleryData=this.getGalleryData(),this.galleryView.databind())}getGalleryData(){return{helper:this.extension.helper,chunkedResizingThreshold:this.config.options.galleryThumbChunkedResizingThreshold,content:this.config.content,debug:!1,imageFadeInDuration:300,initialZoom:6,minLabelWidth:20,pageModeEnabled:this.isPageModeEnabled(),scrollStopDuration:100,searchResults:this.extension.annotations,sizingEnabled:!0,thumbHeight:this.config.options.galleryThumbHeight,thumbLoadPadding:this.config.options.galleryThumbLoadPadding,thumbWidth:this.config.options.galleryThumbWidth,viewingDirection:this.getViewingDirection()}}isPageModeEnabled(){return"function"==typeof this.extension.getMode?s.b.getBool(this.config.options.pageModeEnabled,!0)&&this.extension.getMode().toString()===c.page.toString():s.b.getBool(this.config.options.pageModeEnabled,!0)}getSelectedTree(){return this.$treeSelect.find(":selected")}getSelectedTopRangeIndex(){let e=this.getSelectedTree().index();return-1===e&&(e=0),e}getTree(){let e=this.getSelectedTopRangeIndex();return this.extension.helper.getTree(e,o.d.NONE)}toggleFinish(){if(super.toggleFinish(),this.isUnopened){let e=s.b.getBool(this.config.options.treeEnabled,!0),t=s.b.getBool(this.config.options.thumbsEnabled,!0),i=this.getTree();(!i||!i.nodes.length)&&(e=!1),(!e||!t)&&this.$tabs.hide(),t&&this.defaultToThumbsView()?this.openThumbsView():e&&this.openTreeView()}}defaultToThumbsView(){let e=s.b.getBool(this.config.options.defaultToTreeEnabled,!1),t=this.config.options.defaultToTreeIfGreaterThan||0,i=this.getTree();return!(e&&i&&i.nodes.length>t)}expandFullStart(){super.expandFullStart(),this.extensionHost.publish(s.p.LEFTPANEL_EXPAND_FULL_START)}expandFullFinish(){super.expandFullFinish(),this.$treeButton.hasClass("on")?this.openTreeView():this.$thumbsButton.hasClass("on")&&this.openThumbsView(),this.extensionHost.publish(s.p.LEFTPANEL_EXPAND_FULL_FINISH)}collapseFullStart(){super.collapseFullStart(),this.extensionHost.publish(s.p.LEFTPANEL_COLLAPSE_FULL_START)}collapseFullFinish(){super.collapseFullFinish(),this.$thumbsButton.hasClass("on")&&this.openThumbsView(),this.extensionHost.publish(s.p.LEFTPANEL_COLLAPSE_FULL_FINISH)}openTreeView(){this.isTreeViewOpen=!0,this.isThumbsViewOpen=!1,this.treeView||this.createTreeView(),this.$treeButton.addClass("on"),this.$thumbsButton.removeClass("on"),this.treeView.show(),this.thumbsView&&this.thumbsView.hide(),this.galleryView&&this.galleryView.hide(),this.updateTreeViewOptions(),this.selectCurrentTreeNode(),this.resize(),this.treeView.resize(),this.extensionHost.publish(s.p.OPEN_TREE_VIEW)}openThumbsView(){this.isTreeViewOpen=!1,this.isThumbsViewOpen=!0,this.thumbsView||this.createThumbsView(),this.isFullyExpanded&&!this.galleryView&&this.createGalleryView(),this.$treeButton.removeClass("on"),this.$thumbsButton.addClass("on"),this.treeView&&this.treeView.hide(),this.$treeSelect.hide(),this.$treeViewOptions.hide(),this.resize(),this.isFullyExpanded?(this.thumbsView.hide(),this.galleryView&&this.galleryView.show(),this.galleryView&&this.galleryView.resize()):(this.galleryView&&this.galleryView.hide(),this.thumbsView.show(),this.thumbsView.resize()),this.extensionHost.publish(s.p.OPEN_THUMBS_VIEW)}selectTopRangeIndex(e){this.$treeSelect.prop("selectedIndex",e)}getCurrentCanvasTopRangeIndex(){let e=-1,t=this.extension.getCurrentCanvasRange();return t&&(e=Number(t.path.split("/")[0])),e}selectCurrentTreeNode(){"uv-openseadragon-extension"===this.extension.type?.name?this.selectCurrentTreeNodeByCanvas():this.selectCurrentTreeNodeByRange()}selectCurrentTreeNodeByRange(){if(this.treeView){let e=this.extension.helper.getCurrentRange(),t=null;e&&e.treeNode&&(t=this.treeView.getNodeById(e.treeNode.id)),t?this.treeView.selectNode(t):this.selectTreeNodeByManifest()}}selectCurrentTreeNodeByCanvas(){if(this.treeView){let e=null,t=this.getCurrentCanvasTopRangeIndex(),i=t===this.getSelectedTopRangeIndex(),n=null;-1!==t&&(n=this.extension.getCurrentCanvasRange(),n&&n.treeNode&&(e=this.treeView.getNodeById(n.treeNode.id))),e&&i?this.treeView.selectNode(e):(n=this.extension.helper.getCurrentRange(),n&&n.treeNode&&(e=this.treeView.getNodeById(n.treeNode.id)),e?this.treeView.selectNode(e):this.selectTreeNodeByManifest())}}selectTreeNodeByManifest(){let e=this.extension.helper.collectionIndex,t=this.extension.helper.manifestIndex,i=this.treeView.getAllNodes(),n=!1;i.map((i=>{i.isCollection()&&i.data.index===e&&(this.treeView.selectNode(i),this.treeView.expandNode(i,!0),n=!0),i.isManifest()&&i.data.index===t&&(this.treeView.selectNode(i),n=!0)})),n||this.treeView.deselectCurrentNode()}resize(){super.resize(),this.$tabsContent.height(this.$main.height()-((0,a.d)(this.$tabs)?this.$tabs.height():0)-this.$tabsContent.verticalPadding()),this.$views.height(this.$tabsContent.height()-this.$options.outerHeight())}}}}]);